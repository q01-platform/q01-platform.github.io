"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[8344],{5244:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var r=i(7624),s=i(2172);const t={title:"Architecture Overview",sidebar_label:"Architecture Overview",sidebar_position:4,description:"High-level architecture of Q01 Core APIs"},l="Q01 Core APIs - Architecture Overview",a={id:"products/map.q01.io/core-api-platform-v4/introduction/architecture-overview",title:"Architecture Overview",description:"High-level architecture of Q01 Core APIs",source:"@site/docs/products/map.q01.io/core-api-platform-v4/00-introduction/architecture-overview.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/00-introduction",slug:"/products/map.q01.io/core-api-platform-v4/introduction/architecture-overview",permalink:"/docs/products/map.q01.io/core-api-platform-v4/introduction/architecture-overview",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Architecture Overview",sidebar_label:"Architecture Overview",sidebar_position:4,description:"High-level architecture of Q01 Core APIs"},sidebar:"mapSidebar",previous:{title:"Benefits of Metadata-Driven Architecture",permalink:"/docs/products/map.q01.io/core-api-platform-v4/introduction/why-metadata-driven"},next:{title:"CQRS Pattern",permalink:"/docs/products/map.q01.io/core-api-platform-v4/introduction/cqrs-pattern"}},c={},d=[{value:"System Architecture",id:"system-architecture",level:2},{value:"Components Deep Dive",id:"components-deep-dive",level:2},{value:"1. CoreService (API Gateway)",id:"1-coreservice-api-gateway",level:3},{value:"2. CoreQuery (Read Service)",id:"2-corequery-read-service",level:3},{value:"3. CoreWrite (Write Service)",id:"3-corewrite-write-service",level:3},{value:"4. Metadata Database",id:"4-metadata-database",level:3},{value:"5. Tenant Data Databases",id:"5-tenant-data-databases",level:3},{value:"6. RabbitMQ (Message Queue)",id:"6-rabbitmq-message-queue",level:3},{value:"Data Flow Examples",id:"data-flow-examples",level:2},{value:"Example 1: Creating a Product",id:"example-1-creating-a-product",level:3},{value:"Example 2: Querying Products",id:"example-2-querying-products",level:3},{value:"Security Layers",id:"security-layers",level:2},{value:"Layer 1: API Gateway (CoreService)",id:"layer-1-api-gateway-coreservice",level:3},{value:"Layer 2: Token Validation",id:"layer-2-token-validation",level:3},{value:"Layer 3: Grant Validation",id:"layer-3-grant-validation",level:3},{value:"Layer 4: Field-Level Access",id:"layer-4-field-level-access",level:3},{value:"Layer 5: Data Isolation",id:"layer-5-data-isolation",level:3},{value:"Layer 6: Audit Trail",id:"layer-6-audit-trail",level:3},{value:"Scalability Patterns",id:"scalability-patterns",level:2},{value:"Horizontal Scaling",id:"horizontal-scaling",level:3},{value:"Vertical Scaling",id:"vertical-scaling",level:3},{value:"Monitoring and Observability",id:"monitoring-and-observability",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"q01-core-apis---architecture-overview",children:"Q01 Core APIs - Architecture Overview"}),"\n",(0,r.jsx)(n.h2,{id:"system-architecture",children:"System Architecture"}),"\n",(0,r.jsx)(n.p,{children:"Q01 Core APIs implement a three-tier architecture with clear separation of concerns:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     CLIENT LAYER                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502   Web App  \u2502  \u2502 Mobile App \u2502  \u2502Application \u2502            \u2502\n\u2502  \u2502            \u2502  \u2502            \u2502  \u2502Microservice\u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502         \u2502                \u2502                \u2502                  \u2502\n\u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502                          \u2502                                   \u2502\n\u2502                          \u2502 HTTPS / JWT                       \u2502\n\u2502                          v                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                   API GATEWAY LAYER                          \u2502\n\u2502                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502                \u2502    CoreService      \u2502  PUBLIC-FACING API   \u2502\n\u2502                \u2502   (Go / Buffalo)    \u2502                       \u2502\n\u2502                \u2502                     \u2502                       \u2502\n\u2502                \u2502  Port: 8080         \u2502                       \u2502\n\u2502                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502                           \u2502                                  \u2502\n\u2502        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502        \u2502 Routes by HTTP method & route name  \u2502              \u2502\n\u2502        \u2502                                      \u2502              \u2502\n\u2502        v                                      v              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502  \u2502   GET Request   \u2502              \u2502 POST/PUT/PATCH  \u2502      \u2502\n\u2502  \u2502                 \u2502              \u2502 DELETE Request  \u2502      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502           \u2502                                 \u2502                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  BACKEND SERVICES LAYER (Internal - Not Directly Accessible)\u2502\n\u2502           \u2502                                 \u2502                \u2502\n\u2502           v                                 v                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502\n\u2502  \u2502   CoreQuery     \u2502              \u2502   CoreWrite     \u2502      \u2502\n\u2502  \u2502 (PHP/Symfony)   \u2502              \u2502 (PHP/Symfony)   \u2502      \u2502\n\u2502  \u2502                 \u2502              \u2502                 \u2502      \u2502\n\u2502  \u2502 Read-optimized  \u2502              \u2502 Write-optimized \u2502      \u2502\n\u2502  \u2502 - Field metadata\u2502              \u2502 - CRUD ops      \u2502      \u2502\n\u2502  \u2502 - Query build   \u2502              \u2502 - Validation    \u2502      \u2502\n\u2502  \u2502 - Filtering     \u2502              \u2502 - Cascades      \u2502      \u2502\n\u2502  \u2502 - Permissions   \u2502              \u2502 - Outbox        \u2502      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2502\n\u2502           \u2502                                 \u2502                \u2502\n\u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502                         \u2502                                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                   DATABASE LAYER                             \u2502\n\u2502                         \u2502                                    \u2502\n\u2502        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502\n\u2502        v                v                v                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u2502\n\u2502  \u2502 Metadata \u2502    \u2502 Tenant 1 \u2502    \u2502 Tenant N \u2502             \u2502\n\u2502  \u2502    DB    \u2502    \u2502   Data   \u2502    \u2502   Data   \u2502             \u2502\n\u2502  \u2502          \u2502    \u2502   DB     \u2502    \u2502   DB     \u2502             \u2502\n\u2502  \u2502TB_DIM    \u2502    \u2502TB_ANAG_*\u2502    \u2502TB_ANAG_*\u2502             \u2502\n\u2502  \u2502TB_COST   \u2502    \u2502          \u2502    \u2502          \u2502             \u2502\n\u2502  \u2502TB_TYPE_FIELDS\u2502  \u2502          \u2502    \u2502          \u2502             \u2502\n\u2502  \u2502TB_MENU   \u2502    \u2502          \u2502    \u2502          \u2502             \u2502\n\u2502  \u2502TB_OBJECT \u2502    \u2502          \u2502    \u2502          \u2502             \u2502\n\u2502  \u2502TB_COUNTER\u2502    \u2502          \u2502    \u2502          \u2502             \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502  \u2502        Message Queue (RabbitMQ)          \u2502              \u2502\n\u2502  \u2502  Outbox events for distributed systems   \u2502              \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(n.h2,{id:"components-deep-dive",children:"Components Deep Dive"}),"\n",(0,r.jsx)(n.h3,{id:"1-coreservice-api-gateway",children:"1. CoreService (API Gateway)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Responsibilities"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single public entry point"})," for all Core API operations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Request routing"})," based on HTTP method and named routes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CQRS dispatch"})," - GET \u2192 CoreQuery, POST/PUT/PATCH/DELETE \u2192 CoreWrite"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cross-cutting concerns"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CORS handling"}),"\n",(0,r.jsx)(n.li,{children:"SSL/TLS termination and HTTPS redirect"}),"\n",(0,r.jsx)(n.li,{children:"Request/response logging"}),"\n",(0,r.jsx)(n.li,{children:"Error standardization"}),"\n",(0,r.jsx)(n.li,{children:"Parameter validation middleware"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Routing Logic"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"The gateway analyzes incoming requests and routes them to the appropriate backend service:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Request Analysis:\n\u251c\u2500 HTTP Method = GET\n\u2502  \u2514\u2500> Route to CoreQuery (Read Service)\n\u2502\n\u2514\u2500 HTTP Method = POST/PUT/PATCH/DELETE\n   \u2514\u2500> Route to CoreWrite (Write Service)\n\nExamples:\n- GET /api/v4/core/PRD        \u2192 CoreQuery\n- POST /api/v4/core/PRD       \u2192 CoreWrite\n- PUT /api/v4/core/PRD/123    \u2192 CoreWrite\n- PATCH /api/v4/core/PRD/123  \u2192 CoreWrite\n- DELETE /api/v4/core/PRD/123 \u2192 CoreWrite\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-corequery-read-service",children:"2. CoreQuery (Read Service)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Responsibilities"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Read-only operations"})," - all GET requests"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Metadata interpretation"})," for query construction"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Dynamic SQL generation"})," from TB_COST, TB_OBJECT"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Field visibility filtering"})," via COD_ON_OFF and center_dett"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Permission enforcement"})," via peso, source, ambiente"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Query optimization"})," - projections, filtering, pagination"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Relational queries"})," - joins via TB_OBJECT relationships"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Document queries"})," - hierarchical data retrieval"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Query Flow"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Extract dimension (",(0,r.jsx)(n.code,{children:"{dim}"}),") and context (source, center_dett, peso, ambiente)"]}),"\n",(0,r.jsx)(n.li,{children:"Load metadata from TB_DIM, TB_COST"}),"\n",(0,r.jsx)(n.li,{children:"Filter fields by COD_ON_OFF matching center_dett"}),"\n",(0,r.jsx)(n.li,{children:"Filter fields by peso (user weight)"}),"\n",(0,r.jsx)(n.li,{children:"Build SELECT clause from visible fields"}),"\n",(0,r.jsx)(n.li,{children:"Apply WHERE conditions from $filter parameter"}),"\n",(0,r.jsx)(n.li,{children:"Add ambiente filtering automatically"}),"\n",(0,r.jsx)(n.li,{children:"Execute query"}),"\n",(0,r.jsx)(n.li,{children:"Return JSON response"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-corewrite-write-service",children:"3. CoreWrite (Write Service)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Responsibilities"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Write operations"})," - POST, PUT, PATCH, DELETE"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-layer validation"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Token validation (JWT)"}),"\n",(0,r.jsx)(n.li,{children:"Grant validation (permission level)"}),"\n",(0,r.jsx)(n.li,{children:"Required field validation (COD_ON_OFF)"}),"\n",(0,r.jsx)(n.li,{children:"Field type validation (TIPO_CAMPO)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pre-insert functions"})," - uuid, md5, counter, sequence, slugify"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Counter generation"})," via TB_COUNTER"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cascade operations"})," - INSERT_CASCADE, UPDATE_CASCADE, DELETE_CASCADE"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Transaction management"})," - ACID guarantees"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Outbox pattern"})," - write-ahead log for event sourcing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"RabbitMQ publishing"})," - distribute change events"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Audit trail"})," - OWNER, LOWNER, CDATA, LDATA, TIMESTAMP"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Write Flow"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Validate JWT token \u2192 Extract tenant, user, peso"}),"\n",(0,r.jsx)(n.li,{children:"Validate grant (level 4 for create, level 2 for update)"}),"\n",(0,r.jsx)(n.li,{children:"Load metadata from TB_DIM, TB_COST"}),"\n",(0,r.jsx)(n.li,{children:"Validate required fields (COD_ON_OFF 'N' for create, 'M' for update)"}),"\n",(0,r.jsx)(n.li,{children:"Execute pre-insert functions (counters, UUIDs)"}),"\n",(0,r.jsx)(n.li,{children:"Begin transaction"}),"\n",(0,r.jsx)(n.li,{children:"Execute INSERT/UPDATE/DELETE"}),"\n",(0,r.jsx)(n.li,{children:"Execute cascades if metadata defines them"}),"\n",(0,r.jsx)(n.li,{children:"Write outbox record (TB_ANAG_OUTBOX00)"}),"\n",(0,r.jsx)(n.li,{children:"Commit transaction"}),"\n",(0,r.jsx)(n.li,{children:"Publish outbox to RabbitMQ"}),"\n",(0,r.jsx)(n.li,{children:"Return success response"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-metadata-database",children:"4. Metadata Database"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Store schema, validation rules, permissions"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Key Tables"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Table"}),(0,r.jsx)(n.th,{children:"Purpose"}),(0,r.jsx)(n.th,{children:"Row Count (Typical)"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TB_DIM"}),(0,r.jsx)(n.td,{children:"Dimension registry"}),(0,r.jsx)(n.td,{children:"100-500"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TB_COST"}),(0,r.jsx)(n.td,{children:"Field definitions"}),(0,r.jsx)(n.td,{children:"5,000-20,000"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TB_TYPE_FIELDS"}),(0,r.jsx)(n.td,{children:"Field type definitions"}),(0,r.jsx)(n.td,{children:"20-50"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TB_MENU"}),(0,r.jsx)(n.td,{children:"Security areas (nested set)"}),(0,r.jsx)(n.td,{children:"500-2,000"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TB_OBJECT"}),(0,r.jsx)(n.td,{children:"Object hierarchies and views (TYPE_OBJ=1/2)"}),(0,r.jsx)(n.td,{children:"100-500"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TB_COUNTER"}),(0,r.jsx)(n.td,{children:"Counter configurations"}),(0,r.jsx)(n.td,{children:"100-500"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Shared across all tenants"})," - one metadata database serves all."]}),"\n",(0,r.jsx)(n.h3,{id:"5-tenant-data-databases",children:"5. Tenant Data Databases"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Store actual business data for each tenant"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Isolation"}),": Each tenant has separate database (or schema)"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Naming Convention"}),": ",(0,r.jsx)(n.code,{children:"TB_ANAG_{DIM}00"})]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"TB_ANAG_PRD00 - Products"}),"\n",(0,r.jsx)(n.li,{children:"TB_ANAG_CLI00 - Customers"}),"\n",(0,r.jsx)(n.li,{children:"TB_ANAG_ORD00 - Orders"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Common Fields"})," (auto-added to all dimensions):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"{DIM}_ID"})," - Primary key"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"OWNER"})," - Creating user"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"LOWNER"})," - Last modifying user"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CDATA"})," - Creation timestamp"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"LDATA"})," - Last modification timestamp"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"TREC"})," - Record state (N=new, M=modified, C=cancelled)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"TIMESTAMP"})," - Microsecond timestamp"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"X{DIM}01"})," - Ambiente (environment filter)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"X{DIM}02"})," - Ambiente_rif (reference environment)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"6-rabbitmq-message-queue",children:"6. RabbitMQ (Message Queue)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Distribute change events for eventual consistency"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Outbox Pattern"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Write to database and outbox table ",(0,r.jsx)(n.strong,{children:"atomically"})," in transaction"]}),"\n",(0,r.jsx)(n.li,{children:"After commit, publish outbox to RabbitMQ"}),"\n",(0,r.jsx)(n.li,{children:"If publish fails, outbox record remains for retry"}),"\n",(0,r.jsx)(n.li,{children:"Guarantees at-least-once delivery"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Exchange Naming"}),": ",(0,r.jsx)(n.code,{children:"hash(tenantId).hash(environment).sync.exchange"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Exchange Type"}),": Fanout (broadcast to all subscribers)"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Message Format"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "XOUTBOX03": "sha1-hash",\n  "XOUTBOX04": "PRD",  // Dimension\n  "XOUTBOX05": "create",  // Operation\n  "XOUTBOX06": {/* full record data */},\n  "XOUTBOX09": "00000Q01-0000-0001-0000-000CUSTOMER",  // tenantId\n  "XOUTBOX11": "mscoreservice",  // microservice\n  "XOUTBOX14": "production"  // environment\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"data-flow-examples",children:"Data Flow Examples"}),"\n",(0,r.jsx)(n.h3,{id:"example-1-creating-a-product",children:"Example 1: Creating a Product"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1. Client POSTs to CoreService\n   POST https://coreservice:8080/api/v4/core/PRD\n   Headers: {Authorization: Bearer eyJ...}\n   Body: {\n     source: \"productManagement\",\n     XPRD01: \"Widget Pro\",\n     XPRD02: 49.99\n   }\n\n2. CoreService routes to CoreWrite\n   - Matches route name \"coreCreatePath\"\n   - Calls routingPost(c, resource, \"WRITE_API\")\n   - Forwards to CoreWrite backend\n\n3. CoreWrite processes request\n   - RequestValidatorSubscriber validates JWT\n   - Extracts tenantId, userId, peso from token\n   - Validates grant for source \"productManagement\" (requires level 4)\n   - Loads TB_COST metadata for DIM='PRD'\n   - Validates XPRD01, XPRD02 have COD_ON_OFF containing 'N'\n   - Executes pre-insert: generates counter for XPRD03 (product code)\n   - Begins transaction\n   - Executes INSERT:\n     INSERT INTO TB_ANAG_PRD00 (\n       XPRD01, XPRD02, XPRD03,\n       OWNER, CDATA, TREC, XPRD01_AMBIENTE\n     ) VALUES (\n       'Widget Pro', 49.99, 'PRD-2025-00123',\n       'user123', '20251219153042', 'N', '1,2,3'\n     )\n   - Captures PRD_ID from lastInsertId()\n   - Writes outbox record to TB_ANAG_OUTBOX00\n   - Commits transaction\n   - Publishes outbox to RabbitMQ\n   - Deletes outbox record\n\n4. CoreWrite responds to CoreService\n   {status: 200, data: {PRD_ID: 456}}\n\n5. CoreService responds to client\n   {PRD_ID: 456, message: \"Record created successfully\"}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"example-2-querying-products",children:"Example 2: Querying Products"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'1. Client GETs from CoreService\n   GET https://coreservice:8080/api/v4/core/PRD?source=productList&center_dett=visualizza&$filter=XPRD02 gt 40\n\n2. CoreService routes to CoreQuery\n   - Matches route name "coreIndexPath"\n   - Calls routingGet(c, resource, "QUERY_API")\n   - Forwards to CoreQuery backend\n\n3. CoreQuery processes request\n   - RequestValidatorSubscriber validates JWT\n   - Extracts peso, ambiente from token\n   - Loads TB_COST metadata for DIM=\'PRD\'\n   - Filters fields: contains(COD_ON_OFF,\'L\') (visualizza = list view)\n   - Filters fields: COD_UTENTE <= peso\n   - Builds SELECT: SELECT PRD_ID, XPRD01, XPRD02 FROM TB_ANAG_PRD00\n   - Adds WHERE: WHERE XPRD02 > 40 AND FIND_IN_SET(ambiente, XPRD01_AMBIENTE)\n   - Executes query\n   - Returns JSON array\n\n4. CoreQuery responds to CoreService\n   [{PRD_ID: 456, XPRD01: "Widget Pro", XPRD02: 49.99}, ...]\n\n5. CoreService responds to client\n   (Same response - pass-through)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"security-layers",children:"Security Layers"}),"\n",(0,r.jsxs)(n.p,{children:["Security enforced at ",(0,r.jsx)(n.strong,{children:"multiple independent layers"}),":"]}),"\n",(0,r.jsx)(n.h3,{id:"layer-1-api-gateway-coreservice",children:"Layer 1: API Gateway (CoreService)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SSL/TLS termination"}),"\n",(0,r.jsx)(n.li,{children:"CORS validation"}),"\n",(0,r.jsx)(n.li,{children:"Rate limiting (can be added)"}),"\n",(0,r.jsx)(n.li,{children:"Request logging"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"layer-2-token-validation",children:"Layer 2: Token Validation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JWT signature verification"}),"\n",(0,r.jsx)(n.li,{children:"Token expiration check"}),"\n",(0,r.jsx)(n.li,{children:"Claim extraction (tenantId, userId, peso, profile)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"layer-3-grant-validation",children:"Layer 3: Grant Validation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Source (COD_MENU) permission check"}),"\n",(0,r.jsx)(n.li,{children:"Grant level verification (level 4 for create, level 2 for update)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"layer-4-field-level-access",children:"Layer 4: Field-Level Access"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"COD_ON_OFF filtering by center_dett"}),"\n",(0,r.jsx)(n.li,{children:"COD_UTENTE filtering by peso (user weight)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"layer-5-data-isolation",children:"Layer 5: Data Isolation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ambiente filtering (tenant environment)"}),"\n",(0,r.jsx)(n.li,{children:"Automatic WHERE clause injection"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"layer-6-audit-trail",children:"Layer 6: Audit Trail"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"All changes logged via outbox"}),"\n",(0,r.jsx)(n.li,{children:"OWNER, LOWNER tracked automatically"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"No single point of failure"})," - each layer independently enforces security."]}),"\n",(0,r.jsx)(n.h2,{id:"scalability-patterns",children:"Scalability Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"horizontal-scaling",children:"Horizontal Scaling"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CoreService"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stateless - can run multiple instances behind load balancer"}),"\n",(0,r.jsx)(n.li,{children:"Session data in JWT - no server-side session store"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CoreQuery"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Read replicas for query distribution"}),"\n",(0,r.jsx)(n.li,{children:"Caching layer (Redis) can be added"}),"\n",(0,r.jsx)(n.li,{children:"Stateless - horizontal scaling easy"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"CoreWrite"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Can scale horizontally with database connection pooling"}),"\n",(0,r.jsx)(n.li,{children:"Outbox pattern ensures consistency even with multiple writers"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"vertical-scaling",children:"Vertical Scaling"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Metadata DB"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Small dataset (MB to GB range)"}),"\n",(0,r.jsx)(n.li,{children:"Can be heavily cached"}),"\n",(0,r.jsx)(n.li,{children:"Rarely changes - perfect for caching"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Tenant DBs"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Isolated per tenant"}),"\n",(0,r.jsx)(n.li,{children:"Can be sharded by tenant"}),"\n",(0,r.jsx)(n.li,{children:"Large tenants can have dedicated database servers"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"monitoring-and-observability",children:"Monitoring and Observability"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Logging"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["CoreService logs all requests via ",(0,r.jsx)(n.code,{children:"c.Logger()"})]}),"\n",(0,r.jsx)(n.li,{children:"Request/response bodies logged for debugging"}),"\n",(0,r.jsx)(n.li,{children:"Errors logged with stack traces"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Metrics"})," (can be added):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Request rate, latency per endpoint"}),"\n",(0,r.jsx)(n.li,{children:"Database query times"}),"\n",(0,r.jsx)(n.li,{children:"RabbitMQ publish success/failure rate"}),"\n",(0,r.jsx)(n.li,{children:"Outbox backlog size"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Health Checks"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CoreService: GET /health"}),"\n",(0,r.jsx)(n.li,{children:"CoreQuery: Database connectivity"}),"\n",(0,r.jsx)(n.li,{children:"CoreWrite: Database + RabbitMQ connectivity"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.p,{children:["Q01 Core APIs implement a ",(0,r.jsx)(n.strong,{children:"clean three-tier architecture"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CoreService"})," - Public API gateway with CQRS routing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CoreQuery / CoreWrite"})," - Internal backend services (transparent)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Metadata + Tenant databases"})," - Separated concerns"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Key architectural decisions:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"CQRS"})," - read/write optimization"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Metadata-driven"})," - runtime schema interpretation"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Multi-tenant"})," - isolated data, shared metadata"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Event-sourced"})," - outbox pattern for consistency"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Multi-layered security"})," - defense in depth"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Horizontally scalable"})," - stateless services"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Learn about the ",(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/introduction/cqrs-pattern",children:"CQRS Pattern"})," in detail"]}),"\n",(0,r.jsxs)(n.li,{children:["Try the ",(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/introduction/quick-start",children:"Quick Start"})," guide"]}),"\n",(0,r.jsxs)(n.li,{children:["Understand ",(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/",children:"Core Concepts"})," that power this architecture"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},2172:(e,n,i)=>{i.d(n,{I:()=>a,M:()=>l});var r=i(1504);const s={},t=r.createContext(s);function l(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);