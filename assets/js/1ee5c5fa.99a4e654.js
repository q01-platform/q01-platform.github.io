"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[9222],{2412:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>c,toc:()=>d});var t=r(7624),s=r(2172);const a={title:"Batch Operations",sidebar_label:"Batch Operations",sidebar_position:8,description:"Create multiple records in a single transaction for efficiency and atomicity"},i="Batch Operations",c={id:"products/map.q01.io/core-api-platform-v4/api-operations/batch-operations",title:"Batch Operations",description:"Create multiple records in a single transaction for efficiency and atomicity",source:"@site/docs/products/map.q01.io/core-api-platform-v4/02-api-operations/batch-operations.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/02-api-operations",slug:"/products/map.q01.io/core-api-platform-v4/api-operations/batch-operations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/batch-operations",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Batch Operations",sidebar_label:"Batch Operations",sidebar_position:8,description:"Create multiple records in a single transaction for efficiency and atomicity"},sidebar:"mapSidebar",previous:{title:"Command Operations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/command-operations"},next:{title:"Query Patterns",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/"}},o={},d=[{value:"Overview",id:"overview",level:2},{value:"Why Batch Operations?",id:"why-batch-operations",level:2},{value:"Performance Benefits",id:"performance-benefits",level:3},{value:"Atomicity Guarantee",id:"atomicity-guarantee",level:3},{value:"Endpoint",id:"endpoint",level:2},{value:"Request Format",id:"request-format",level:2},{value:"Basic Batch Create",id:"basic-batch-create",level:3},{value:"Batch with Shared Metadata",id:"batch-with-shared-metadata",level:3},{value:"Response Format",id:"response-format",level:2},{value:"Success Response",id:"success-response",level:3},{value:"Error Response",id:"error-response",level:3},{value:"Transaction Flow",id:"transaction-flow",level:2},{value:"Batch Create Transaction",id:"batch-create-transaction",level:3},{value:"JavaScript Implementation",id:"javascript-implementation",level:2},{value:"Basic Batch Creator",id:"basic-batch-creator",level:3},{value:"Order with Line Items (Header-Detail Pattern)",id:"order-with-line-items-header-detail-pattern",level:3},{value:"CSV Import with Batch",id:"csv-import-with-batch",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO",id:"-do",level:3},{value:"\u274c DON&#39;T",id:"-dont",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Validation Errors",id:"validation-errors",level:3},{value:"Permission Errors",id:"permission-errors",level:3},{value:"Transaction Timeout",id:"transaction-timeout",level:3},{value:"Use Case: Bulk Product Import",id:"use-case-bulk-product-import",level:2},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"batch-operations",children:"Batch Operations"}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Batch operations"})," enable creating multiple records in a ",(0,t.jsx)(n.strong,{children:"single HTTP request"})," within a ",(0,t.jsx)(n.strong,{children:"single database transaction"}),". This provides atomicity (all succeed or all fail), improved performance, and simplified error handling."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Characteristics:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Multiple records in one POST request"}),"\n",(0,t.jsx)(n.li,{children:"Single ACID transaction"}),"\n",(0,t.jsx)(n.li,{children:"All-or-nothing semantics (rollback on any failure)"}),"\n",(0,t.jsx)(n.li,{children:"Shared metadata (counters, timestamps)"}),"\n",(0,t.jsx)(n.li,{children:"Cascade operations execute for all records"}),"\n",(0,t.jsx)(n.li,{children:"Single outbox event for entire batch"}),"\n",(0,t.jsx)(n.li,{children:"Better performance than individual requests"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"why-batch-operations",children:"Why Batch Operations?"}),"\n",(0,t.jsx)(n.h3,{id:"performance-benefits",children:"Performance Benefits"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Individual Requests (Inefficient):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"POST /api/v4/core/PRD (Product 1) \u2192 200ms\nPOST /api/v4/core/PRD (Product 2) \u2192 200ms\nPOST /api/v4/core/PRD (Product 3) \u2192 200ms\nTotal: 600ms + network overhead\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Batch Request (Efficient):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"POST /api/v4/core/PRD (Products 1-3) \u2192 250ms\nTotal: 250ms\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Improvements:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Fewer database connections"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Single transaction overhead"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Reduced network latency"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Lower server load"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"atomicity-guarantee",children:"Atomicity Guarantee"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Problem:"})," Creating related records individually"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Risk: Order created but items fail\nawait createOrder(order);          // Success\nawait createOrderItem(item1);      // Success\nawait createOrderItem(item2);      // FAILS\n// Result: Orphaned order without items!\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution:"})," Batch operation with transaction"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 All succeed or all fail\nawait createOrderWithItems([order, item1, item2]);\n// Result: Complete order with items or nothing\n"})}),"\n",(0,t.jsx)(n.h2,{id:"endpoint",children:"Endpoint"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Method:"})," ",(0,t.jsx)(n.code,{children:"POST"}),"\n",(0,t.jsx)(n.strong,{children:"Path:"})," ",(0,t.jsx)(n.code,{children:"/api/v4/core/{DIM}"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Same endpoint as single create, but body is an array"})}),"\n",(0,t.jsx)(n.h2,{id:"request-format",children:"Request Format"}),"\n",(0,t.jsx)(n.h3,{id:"basic-batch-create",children:"Basic Batch Create"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Single Record (existing pattern):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "XPRD01": "Widget A",\n  "XPRD02": 29.99,\n  "source": "productCreate"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Multiple Records (batch pattern):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "XPRD01": "Widget A",\n    "XPRD02": 29.99,\n    "source": "productCreate"\n  },\n  {\n    "XPRD01": "Widget B",\n    "XPRD02": 39.99,\n    "source": "productCreate"\n  },\n  {\n    "XPRD01": "Widget C",\n    "XPRD02": 49.99,\n    "source": "productCreate"\n  }\n]\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Critical:"})," Array of objects, each with required fields + ",(0,t.jsx)(n.code,{children:"source"})," parameter"]}),"\n",(0,t.jsx)(n.h3,{id:"batch-with-shared-metadata",children:"Batch with Shared Metadata"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Case:"})," Apply shared configuration to all records (e.g., sequential counters)"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Format:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "metadata": true,\n    "HD_DIM": {\n      "counter": "XPRD_BATCH_ID"\n    }\n  },\n  {\n    "XPRD01": "Widget A",\n    "XPRD02": 29.99,\n    "source": "productCreate"\n  },\n  {\n    "XPRD01": "Widget B",\n    "XPRD02": 39.99,\n    "source": "productCreate"\n  }\n]\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"First element"})," with ",(0,t.jsx)(n.code,{children:'"metadata": true'})," applies to all subsequent records:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Shared counter configuration"}),"\n",(0,t.jsx)(n.li,{children:"Batch-level settings"}),"\n",(0,t.jsx)(n.li,{children:"Header-detail relationships"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"response-format",children:"Response Format"}),"\n",(0,t.jsx)(n.h3,{id:"success-response",children:"Success Response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "code": 201,\n    "insertedId": "123",\n    "body": {\n      "XPRD01": "Widget A",\n      "XPRD02": 29.99,\n      "OWNER": "user123",\n      "CDATA": "20251219143000",\n      "TREC": "N"\n    },\n    "fields": {\n      "PRD_ID": {...},\n      "XPRD01": {...}\n    }\n  },\n  {\n    "code": 201,\n    "insertedId": "124",\n    "body": {\n      "XPRD01": "Widget B",\n      "XPRD02": 39.99,\n      "OWNER": "user123",\n      "CDATA": "20251219143000",\n      "TREC": "N"\n    },\n    "fields": {\n      "PRD_ID": {...},\n      "XPRD01": {...}\n    }\n  },\n  {\n    "code": 201,\n    "insertedId": "125",\n    "body": {\n      "XPRD01": "Widget C",\n      "XPRD02": 49.99,\n      "OWNER": "user123",\n      "CDATA": "20251219143000",\n      "TREC": "N"\n    },\n    "fields": {\n      "PRD_ID": {...},\n      "XPRD01": {...}\n    }\n  }\n]\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Array of results"})," - one per input record"]}),"\n",(0,t.jsx)(n.h3,{id:"error-response",children:"Error Response"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Validation Error (400):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "code": 400,\n  "message": "Validation failed for record at index 1",\n  "errors": [\n    {\n      "index": 1,\n      "field": "XPRD01",\n      "message": "Field is required"\n    }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Transaction Rolled Back:"})," No records created if any validation fails"]}),"\n",(0,t.jsx)(n.h2,{id:"transaction-flow",children:"Transaction Flow"}),"\n",(0,t.jsx)(n.h3,{id:"batch-create-transaction",children:"Batch Create Transaction"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"1. Client sends batch request\n   \u2193\n2. CoreWrite receives array of records\n   \u2193\n3. Validate all records (required fields, types, COD_ON_OFF)\n   \u2193\n4. BEGIN TRANSACTION\n   \u2193\n5. For each record:\n   - Execute pre-insert functions\n   - INSERT into TB_ANAG_{DIM}00\n   - Execute INSERT_CASCADE\n   - Add to outbox batch\n   \u2193\n6. Write batch to TB_ANAG_OUTBOX00\n   \u2193\n7. COMMIT TRANSACTION\n   \u2193\n8. Return array of insertedIds\n\nIf ANY step fails \u2192 ROLLBACK entire transaction\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"ACID Properties:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Atomicity:"})," All records created or none"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Consistency:"})," Metadata constraints enforced"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Isolation:"})," No partial state visible to other transactions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Durability:"})," Committed records persisted"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"javascript-implementation",children:"JavaScript Implementation"}),"\n",(0,t.jsx)(n.h3,{id:"basic-batch-creator",children:"Basic Batch Creator"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class BatchCreator {\n  constructor(apiBase, token) {\n    this.apiBase = apiBase;\n    this.token = token;\n  }\n\n  async createBatch(dimension, records) {\n    // Validate records\n    if (!Array.isArray(records) || records.length === 0) {\n      throw new Error('Records must be non-empty array');\n    }\n\n    // Ensure all records have source parameter\n    const recordsWithSource = records.map(record => ({\n      ...record,\n      source: record.source || 'batchCreate'\n    }));\n\n    const response = await fetch(\n      `${this.apiBase}/api/v4/core/${dimension}`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.token}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(recordsWithSource)\n      }\n    );\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.message || 'Batch create failed');\n    }\n\n    return response.json();\n  }\n\n  async createWithMetadata(dimension, records, metadata) {\n    const batch = [\n      { metadata: true, ...metadata },\n      ...records\n    ];\n\n    return this.createBatch(dimension, batch);\n  }\n}\n\n// Usage\nconst batchCreator = new BatchCreator(apiBase, token);\n\nconst products = [\n  { XPRD01: 'Widget A', XPRD02: 29.99 },\n  { XPRD01: 'Widget B', XPRD02: 39.99 },\n  { XPRD01: 'Widget C', XPRD02: 49.99 }\n];\n\nconst results = await batchCreator.createBatch('PRD', products);\nconsole.log(`Created ${results.length} products`);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"order-with-line-items-header-detail-pattern",children:"Order with Line Items (Header-Detail Pattern)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class OrderBatchCreator {\n  constructor(apiBase, token) {\n    this.batchCreator = new BatchCreator(apiBase, token);\n  }\n\n  async createOrderWithItems(order, items) {\n    // Step 1: Create order\n    const orderResults = await this.batchCreator.createBatch('ORD', [order]);\n    const orderId = orderResults[0].insertedId;\n\n    // Step 2: Create items with order reference\n    const itemsWithOrderId = items.map(item => ({\n      ...item,\n      XORDITEM08: orderId\n    }));\n\n    const itemResults = await this.batchCreator.createBatch(\n      'ORDITEM',\n      itemsWithOrderId\n    );\n\n    return {\n      order: orderResults[0],\n      items: itemResults\n    };\n  }\n\n  async createCompleteOrder(orderData) {\n    const { customer, shippingAddress, items } = orderData;\n\n    try {\n      // Create order header\n      const order = {\n        XORD01: customer.name,\n        XORD09: customer.id,\n        XORD10: shippingAddress,\n        XORD03: items.reduce((sum, item) => sum + item.price * item.qty, 0)\n      };\n\n      // Create order with items\n      const result = await this.createOrderWithItems(order, items);\n\n      return result;\n    } catch (error) {\n      console.error('Order creation failed:', error);\n      throw error;\n    }\n  }\n}\n\n// Usage\nconst orderCreator = new OrderBatchCreator(apiBase, token);\n\nconst result = await orderCreator.createCompleteOrder({\n  customer: { id: '456', name: 'ACME Corp' },\n  shippingAddress: '123 Main St',\n  items: [\n    { XORDITEM01: 'Widget A', price: 29.99, qty: 2 },\n    { XORDITEM01: 'Widget B', price: 39.99, qty: 1 }\n  ]\n});\n\nconsole.log(`Order ${result.order.insertedId} created with ${result.items.length} items`);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"csv-import-with-batch",children:"CSV Import with Batch"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class CSVImporter {\n  constructor(apiBase, token) {\n    this.batchCreator = new BatchCreator(apiBase, token);\n    this.batchSize = 100; // Create 100 records at a time\n  }\n\n  parseCsv(csvText) {\n    const lines = csvText.split('\\n');\n    const headers = lines[0].split(',').map(h => h.trim());\n\n    return lines.slice(1).map(line => {\n      const values = line.split(',');\n      const record = {};\n\n      headers.forEach((header, index) => {\n        record[header] = values[index]?.trim();\n      });\n\n      return record;\n    });\n  }\n\n  async importCsv(dimension, csvText, sourceArea) {\n    const records = this.parseCsv(csvText);\n\n    // Split into batches\n    const batches = [];\n    for (let i = 0; i < records.length; i += this.batchSize) {\n      batches.push(records.slice(i, i + this.batchSize));\n    }\n\n    const results = [];\n    let successCount = 0;\n    let failedBatches = [];\n\n    // Process batches sequentially\n    for (let i = 0; i < batches.length; i++) {\n      try {\n        const batch = batches[i].map(record => ({\n          ...record,\n          source: sourceArea\n        }));\n\n        const batchResults = await this.batchCreator.createBatch(\n          dimension,\n          batch\n        );\n\n        results.push(...batchResults);\n        successCount += batchResults.length;\n\n        console.log(`Batch ${i + 1}/${batches.length} completed: ${batchResults.length} records`);\n      } catch (error) {\n        console.error(`Batch ${i + 1} failed:`, error);\n        failedBatches.push({ batchIndex: i, error: error.message });\n      }\n    }\n\n    return {\n      total: records.length,\n      success: successCount,\n      failed: records.length - successCount,\n      failedBatches,\n      results\n    };\n  }\n}\n\n// Usage\nconst importer = new CSVImporter(apiBase, token);\n\nconst csvData = `\nXPRD01,XPRD02,XPRD05\nWidget A,29.99,electronics\nWidget B,39.99,electronics\nWidget C,49.99,toys\n`.trim();\n\nconst result = await importer.importCsv('PRD', csvData, 'productImport');\nconsole.log(`Imported ${result.success}/${result.total} products`);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"-do",children:"\u2705 DO"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use appropriate batch sizes:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - 50-100 records per batch\nconst BATCH_SIZE = 100;\n\n// \u274c Bad - too large, may timeout\nconst BATCH_SIZE = 10000;\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Validate before sending:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Validate records client-side first\nfunction validateRecord(record) {\n  if (!record.XPRD01) throw new Error('XPRD01 required');\n  if (typeof record.XPRD02 !== 'number') throw new Error('XPRD02 must be number');\n}\n\nproducts.forEach(validateRecord);\nawait batchCreator.createBatch('PRD', products);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Handle partial failures with batching:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Process in smaller batches to isolate failures\nfor (const batch of batches) {\n  try {\n    await createBatch(batch);\n  } catch (error) {\n    logFailedBatch(batch, error);\n    // Continue with next batch\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use transactions for related records:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Use batch for atomicity\nawait createOrderWithItems(order, items);\n// Order and items created together or not at all\n"})}),"\n",(0,t.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't send huge batches:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Wrong - may exceed request size limit or timeout\nawait createBatch('PRD', allProducts); // 10,000 records\n\n// \u2705 Correct - split into reasonable batches\nfor (const batch of chunk(allProducts, 100)) {\n  await createBatch('PRD', batch);\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't ignore failed batches:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Wrong - silent failure\ntry {\n  await createBatch('PRD', products);\n} catch (error) {\n  // Ignored\n}\n\n// \u2705 Correct - log and retry\ntry {\n  await createBatch('PRD', products);\n} catch (error) {\n  logError('Batch failed', { products, error });\n  await retryBatch(products);\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't mix unrelated records:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Wrong - unrelated records in same transaction\nawait createBatch('PRD', [\n  { XPRD01: 'Widget' },\n  { XPRD01: 'Unrelated Product' }\n]);\n\n// \u2705 Correct - batch related records only\nawait createBatch('PRD', relatedProducts);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.h3,{id:"validation-errors",children:"Validation Errors"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'[\n  { "XPRD01": "Widget A", "XPRD02": 29.99, "source": "productCreate" },\n  { "XPRD02": 39.99, "source": "productCreate" },  // Missing XPRD01\n  { "XPRD01": "Widget C", "XPRD02": "invalid", "source": "productCreate" }  // Invalid type\n]\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response (400):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "code": 400,\n  "message": "Batch validation failed",\n  "errors": [\n    {\n      "index": 1,\n      "field": "XPRD01",\n      "message": "Required field missing"\n    },\n    {\n      "index": 2,\n      "field": "XPRD02",\n      "message": "Expected number, got string"\n    }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"No records created"})," - transaction rolled back"]}),"\n",(0,t.jsx)(n.h3,{id:"permission-errors",children:"Permission Errors"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response (403):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "code": 403,\n  "message": "Insufficient permissions for batch create",\n  "required_grant": 4,\n  "user_grant": 2\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"transaction-timeout",children:"Transaction Timeout"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response (500):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "code": 500,\n  "message": "Transaction timeout: Batch too large or slow inserts",\n  "suggestion": "Reduce batch size and retry"\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"use-case-bulk-product-import",children:"Use Case: Bulk Product Import"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class ProductBulkImporter {\n  constructor(apiBase, token) {\n    this.batchCreator = new BatchCreator(apiBase, token);\n    this.batchSize = 50;\n  }\n\n  async importProducts(products, onProgress) {\n    const batches = this.createBatches(products, this.batchSize);\n    const results = {\n      total: products.length,\n      success: 0,\n      failed: 0,\n      errors: []\n    };\n\n    for (let i = 0; i < batches.length; i++) {\n      try {\n        const batchResults = await this.batchCreator.createBatch(\n          'PRD',\n          batches[i]\n        );\n\n        results.success += batchResults.length;\n\n        if (onProgress) {\n          onProgress({\n            processed: (i + 1) * this.batchSize,\n            total: products.length,\n            percentage: Math.round(((i + 1) / batches.length) * 100)\n          });\n        }\n      } catch (error) {\n        results.failed += batches[i].length;\n        results.errors.push({\n          batchIndex: i,\n          records: batches[i],\n          error: error.message\n        });\n      }\n    }\n\n    return results;\n  }\n\n  createBatches(items, size) {\n    const batches = [];\n    for (let i = 0; i < items.length; i += size) {\n      batches.push(items.slice(i, i + size));\n    }\n    return batches;\n  }\n}\n\n// Usage with progress tracking\nconst importer = new ProductBulkImporter(apiBase, token);\n\nconst products = [\n  /* ... 1000 products ... */\n];\n\nconst results = await importer.importProducts(products, (progress) => {\n  console.log(`Progress: ${progress.percentage}% (${progress.processed}/${progress.total})`);\n  updateProgressBar(progress.percentage);\n});\n\nconsole.log(`Import complete: ${results.success} success, ${results.failed} failed`);\nif (results.errors.length > 0) {\n  console.log('Failed batches:', results.errors);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(n.p,{children:"Batch operations provide:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Multiple records in single request"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 ACID transaction guarantees"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 All-or-nothing semantics"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Better performance than individual requests"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Simplified error handling"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Shared metadata support"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Single outbox event for batch"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Send array of records to same POST endpoint"}),"\n",(0,t.jsx)(n.li,{children:"All records created in single transaction"}),"\n",(0,t.jsx)(n.li,{children:"Use reasonable batch sizes (50-100 records)"}),"\n",(0,t.jsx)(n.li,{children:"Validate records client-side before sending"}),"\n",(0,t.jsx)(n.li,{children:"Handle failed batches gracefully"}),"\n",(0,t.jsx)(n.li,{children:"Use batches for related records (atomicity)"}),"\n",(0,t.jsx)(n.li,{children:"Optional metadata element at index [0] for batch configuration"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Phase 5.3 Complete!"})," All API Operations documented."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Next:"})," ",(0,t.jsx)(n.a,{href:"../query-patterns",children:"Query Patterns \u2192"})]}),"\n",(0,t.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/write-operations",children:"Write Operations"})," - Single record create pattern"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/entity-lifecycle",children:"Entity Lifecycle"})," - TREC states for batch records"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/outbox-pattern",children:"Outbox Pattern"})," - Batch event publishing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/cascades",children:"Cascades"})," - Automatic child record creation in batches"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>c,M:()=>i});var t=r(1504);const s={},a=t.createContext(s);function i(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);