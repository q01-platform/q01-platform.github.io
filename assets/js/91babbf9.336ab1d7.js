"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[1132],{3536:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var s=i(7624),t=i(2172);const r={title:"Security",sidebar_label:"Security",sidebar_position:6,description:"Multi-level security architecture for Q01 Core APIs"},c="Security",l={id:"products/map.q01.io/core-api-platform-v4/security/index",title:"Security",description:"Multi-level security architecture for Q01 Core APIs",source:"@site/docs/products/map.q01.io/core-api-platform-v4/05-security/index.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/05-security",slug:"/products/map.q01.io/core-api-platform-v4/security/",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Security",sidebar_label:"Security",sidebar_position:6,description:"Multi-level security architecture for Q01 Core APIs"},sidebar:"mapSidebar",previous:{title:"Batch Operations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/batch-operations"},next:{title:"Authentication",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/authentication"}},a={},d=[{value:"Overview",id:"overview",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Authorization",id:"authorization",level:2},{value:"Tenant Isolation",id:"tenant-isolation",level:2},{value:"Context Security",id:"context-security",level:2},{value:"Field-Level Security",id:"field-level-security",level:2},{value:"Rate Limiting",id:"rate-limiting",level:2},{value:"Audit Trail",id:"audit-trail",level:2},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Common Security Issues",id:"common-security-issues",level:2},{value:"Issue 1: Token Expiration",id:"issue-1-token-expiration",level:3},{value:"Issue 2: Missing Grant",id:"issue-2-missing-grant",level:3},{value:"Issue 3: Cross-Tenant Data Leak",id:"issue-3-cross-tenant-data-leak",level:3},{value:"Issue 4: Rate Limit Exceeded",id:"issue-4-rate-limit-exceeded",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"security",children:"Security"}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Q01 Core APIs implement ",(0,s.jsx)(n.strong,{children:"defense-in-depth security"})," with multiple independent layers protecting data access. Each request passes through authentication, authorization, tenant isolation, and context-based filtering before reaching data."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Security Layers:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authentication"})," - JWT token validation (who are you?)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authorization"})," - TB_MENU grant checking (what can you do?)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tenant Isolation"})," - Multi-tenant data separation (which tenant?)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Context Security"})," - source/peso/ambiente/centro_dett filtering (what context?)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Field-Level Security"})," - COD_ON_OFF visibility control (which fields?)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rate Limiting"})," - API throttling and quotas (how much?)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Audit Trail"})," - Complete operation tracking (who did what?)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Architecture:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Client Request\n    \u2193\n1. SSL/TLS Transport Security\n    \u2193\n2. JWT Token Validation (401 if invalid)\n    \u2193\n3. TB_MENU Grant Check (403 if denied)\n    \u2193\n4. Tenant Isolation Filter (source filtering)\n    \u2193\n5. Context Security (peso/ambiente/centro_dett)\n    \u2193\n6. COD_ON_OFF Field Visibility\n    \u2193\n7. Rate Limit Check (429 if exceeded)\n    \u2193\n8. Execute Query/Write\n    \u2193\n9. Audit Log Entry\n    \u2193\nResponse to Client\n"})}),"\n",(0,s.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"JSON Web Tokens (JWT)"})," authenticate all API requests."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Token Structure:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "header": {\n    "alg": "HS256",\n    "typ": "JWT"\n  },\n  "payload": {\n    "user_id": "user@example.com",\n    "tenant_id": "tenant_123",\n    "source": "productManagement",\n    "centro_dett": "admin",\n    "peso": "1",\n    "ambiente": "production",\n    "grants": ["products.read", "products.write"],\n    "exp": 1735574400,\n    "iat": 1735488000\n  },\n  "signature": "..."\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request Header:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Validation:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Signature verification (HMAC-SHA256)"}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 Expiration check (",(0,s.jsx)(n.code,{children:"exp"})," claim)"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 Issuer verification (",(0,s.jsx)(n.code,{children:"iss"})," claim)"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 Not-before check (",(0,s.jsx)(n.code,{children:"nbf"})," claim)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Token Lifecycle:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Login\n    \u2193\nGenerate access token (1 hour TTL)\nGenerate refresh token (30 days TTL)\n    \u2193\nClient stores tokens\n    \u2193\nAPI requests with access token\n    \u2193\nToken expires \u2192 401 Unauthorized\n    \u2193\nClient uses refresh token \u2192 new access token\n    \u2193\nRefresh token expires \u2192 redirect to login\n"})}),"\n",(0,s.jsx)(n.h2,{id:"authorization",children:"Authorization"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"TB_MENU nested set model"})," defines hierarchical permissions."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Grant Structure:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"TB_MENU (nested set)\n\u251c\u2500\u2500 products (NLEFT=1, NRIGHT=10)\n\u2502   \u251c\u2500\u2500 products.read (NLEFT=2, NRIGHT=3)\n\u2502   \u251c\u2500\u2500 products.write (NLEFT=4, NRIGHT=5)\n\u2502   \u2514\u2500\u2500 products.delete (NLEFT=6, NRIGHT=7)\n\u2514\u2500\u2500 orders (NLEFT=11, NRIGHT=20)\n    \u251c\u2500\u2500 orders.read (NLEFT=12, NRIGHT=13)\n    \u2514\u2500\u2500 orders.write (NLEFT=14, NRIGHT=15)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Grant Checking:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Check if user has 'products.write' grant\nSELECT COUNT(*) FROM TB_MENU parent\nINNER JOIN TB_MENU child\n    ON child.NLEFT BETWEEN parent.NLEFT AND parent.NRIGHT\nWHERE parent.MENU_ID IN (user_grants)\n  AND child.MENU_ID = 'products.write';\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Hierarchical Inheritance:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Parent grant includes all children"}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.code,{children:"products"})," grant \u2192 includes ",(0,s.jsx)(n.code,{children:"products.read"}),", ",(0,s.jsx)(n.code,{children:"products.write"}),", ",(0,s.jsx)(n.code,{children:"products.delete"})]}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Fine-grained or broad permissions"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"tenant-isolation",children:"Tenant Isolation"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Multi-tenant architecture"})," ensures complete data separation between tenants."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Session Context:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "tenant_id": "tenant_123",\n  "source": "productManagement",\n  "centro_dett": "admin",\n  "peso": "1",\n  "ambiente": "production"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Automatic Filtering:"})}),"\n",(0,s.jsx)(n.p,{children:"Every query includes tenant filter:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- User sees only their tenant's data\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'productManagement'  -- Tenant isolation\n  AND PRD_CENTRO_DETT = 'admin'          -- Context filtering\n  AND PRD_PESO <= '1'                    -- User level\n  AND PRD_AMBIENTE = 'production'        -- Environment\n  AND TREC != 'C';                       -- Exclude deleted\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Zero trust - all data filtered by default"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 No cross-tenant data leakage"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Same database, complete logical isolation"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Transparent to application code"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"context-security",children:"Context Security"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Context chain"})," (",(0,s.jsx)(n.code,{children:"source/centro_dett/peso/ambiente"}),") travels with every request and filters what's visible."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Context Components:"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Component"}),(0,s.jsx)(n.th,{children:"Purpose"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"source"})}),(0,s.jsx)(n.td,{children:"Tenant/application identifier"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"productManagement"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"centro_dett"})}),(0,s.jsx)(n.td,{children:"Organizational unit"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"admin"}),", ",(0,s.jsx)(n.code,{children:"warehouse"}),", ",(0,s.jsx)(n.code,{children:"store_001"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"peso"})}),(0,s.jsx)(n.td,{children:"User level (1=admin, 2=manager, 3=user)"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ambiente"})}),(0,s.jsx)(n.td,{children:"Environment"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"production"}),", ",(0,s.jsx)(n.code,{children:"staging"}),", ",(0,s.jsx)(n.code,{children:"test"})]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Hierarchical Filtering:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"peso=1 (admin) \u2192 sees all records (peso 1, 2, 3)\npeso=2 (manager) \u2192 sees peso 2, 3 only\npeso=3 (user) \u2192 sees peso 3 only\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Query Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD?peso=2\n\n# Returns products with peso >= 2 (manager can't see admin-level products)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"field-level-security",children:"Field-Level Security"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"COD_ON_OFF bitmask"})," controls field visibility per operation."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Flags:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"L"})," - List view"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"D"})," - Detail view"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"R"})," - Search/filter"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"N"})," - Create (POST)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"M"})," - Modify (PUT/PATCH)"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- XPRD03 (Product Code) - Read-only after creation\nCOD_ON_OFF = 'LDR'  -- Visible in list/detail/search, NOT modifiable\n\n-- XPRD02 (Price) - Full access\nCOD_ON_OFF = 'LDRNM'  -- Visible everywhere, can create and modify\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Enforcement:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// \u274c Bad - trying to modify read-only field\nPATCH /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD03": "PRD-2025-999"  // Error: FIELD_NOT_MODIFIABLE\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"API throttling"})," prevents abuse and ensures fair usage."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Limits:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Per User:\n- 1000 requests/hour\n- 100 requests/minute\n- 10 requests/second\n\nPer Tenant:\n- 10,000 requests/hour\n- 1000 requests/minute\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response Headers:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"X-RateLimit-Limit: 1000\nX-RateLimit-Remaining: 847\nX-RateLimit-Reset: 1735574400\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Exceeded Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "error": "RateLimitExceeded",\n  "message": "Rate limit exceeded. Retry after 300 seconds.",\n  "code": "RATE_LIMIT_EXCEEDED",\n  "status": 429,\n  "retry_after": 300\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"audit-trail",children:"Audit Trail"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Complete tracking"})," of all operations for compliance and debugging."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Logged Information:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["User identity (",(0,s.jsx)(n.code,{children:"USER"})," field in JWT)"]}),"\n",(0,s.jsx)(n.li,{children:"Operation type (GET/POST/PUT/PATCH/DELETE)"}),"\n",(0,s.jsx)(n.li,{children:"Dimension and record ID"}),"\n",(0,s.jsxs)(n.li,{children:["Timestamp (",(0,s.jsx)(n.code,{children:"CREATED_AT"}),", ",(0,s.jsx)(n.code,{children:"UPDATED_AT"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"IP address and user agent"}),"\n",(0,s.jsx)(n.li,{children:"Request payload (for writes)"}),"\n",(0,s.jsx)(n.li,{children:"Response status"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Audit Fields:"})}),"\n",(0,s.jsx)(n.p,{children:"Every record includes audit metadata:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Automatic audit fields\nCREATED_BY VARCHAR(255)      -- Who created\nCREATED_AT VARCHAR(14)        -- When created\nUPDATED_BY VARCHAR(255)       -- Who last updated\nUPDATED_AT VARCHAR(14)        -- When last updated\nDELETED_BY VARCHAR(255)       -- Who deleted (soft delete)\nDELETED_AT VARCHAR(14)        -- When deleted\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Audit Query:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Who modified product 123?\nSELECT UPDATED_BY, UPDATED_AT, XPRD01, XPRD02\nFROM TB_ANAG_PRD00\nWHERE PRD_ID = '123'\nORDER BY UPDATED_AT DESC;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Always use HTTPS in production:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u2705 Good - encrypted transport\nhttps://api.example.com/api/v4/core/PRD\n\n# \u274c Bad - plaintext credentials\nhttp://api.example.com/api/v4/core/PRD\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Rotate JWT secrets regularly:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# \u2705 Good - monthly secret rotation\nJWT_SECRET=new_secret_2025_01\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Implement token refresh:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - refresh before expiration\nif (isTokenExpiringSoon()) {\n  token = await refreshToken();\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Validate all inputs:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - sanitize user input\nconst sanitized = sanitizeInput(userInput);\nawait createProduct({ XPRD01: sanitized });\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't store JWT in localStorage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - XSS vulnerable\nlocalStorage.setItem('token', jwt);\n\n// \u2705 Good - httpOnly cookie\ndocument.cookie = `token=${jwt}; HttpOnly; Secure; SameSite=Strict`;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't hardcode credentials:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - credentials in code\nconst token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';\n\n// \u2705 Good - environment variables\nconst token = process.env.API_TOKEN;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't bypass validation:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - skipping validation\nconst data = req.body;  // Direct use\nawait createProduct(data);\n\n// \u2705 Good - validate first\nconst validated = validate(req.body);\nawait createProduct(validated);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"common-security-issues",children:"Common Security Issues"}),"\n",(0,s.jsx)(n.h3,{id:"issue-1-token-expiration",children:"Issue 1: Token Expiration"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Symptom:"})," API returns 401 Unauthorized"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause:"})," Access token expired"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"async function apiRequest(url, options) {\n  let response = await fetch(url, options);\n\n  if (response.status === 401) {\n    // Token expired - refresh\n    const newToken = await refreshToken();\n    options.headers.Authorization = `Bearer ${newToken}`;\n    response = await fetch(url, options);\n  }\n\n  return response;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"issue-2-missing-grant",children:"Issue 2: Missing Grant"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Symptom:"})," API returns 403 Forbidden"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause:"})," User lacks required permission"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Check grants before showing UI\nif (!hasGrant('products.write')) {\n  hideCreateButton();\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"issue-3-cross-tenant-data-leak",children:"Issue 3: Cross-Tenant Data Leak"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Symptom:"})," User sees data from other tenants"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause:"})," Missing source/centro_dett in session context"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Always set complete session context\nconst sessionContext = {\n  source: 'productManagement',\n  centro_dett: 'admin',\n  peso: '1',\n  ambiente: 'production'\n};\n"})}),"\n",(0,s.jsx)(n.h3,{id:"issue-4-rate-limit-exceeded",children:"Issue 4: Rate Limit Exceeded"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Symptom:"})," API returns 429 Too Many Requests"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause:"})," Too many requests in short time"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Implement exponential backoff\nasync function apiRequestWithBackoff(url, maxRetries = 3) {\n  for (let i = 0; i < maxRetries; i++) {\n    const response = await fetch(url);\n\n    if (response.status !== 429) {\n      return response;\n    }\n\n    const retryAfter = response.headers.get('Retry-After');\n    await sleep(retryAfter * 1000);\n  }\n\n  throw new Error('Rate limit exceeded after retries');\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Multi-level security: authentication \u2192 authorization \u2192 tenant isolation \u2192 context filtering"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 JWT tokens for stateless authentication"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 TB_MENU nested set for hierarchical permissions"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Automatic tenant isolation via source/centro_dett"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Context-based filtering (peso/ambiente)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Field-level security with COD_ON_OFF"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Rate limiting for abuse prevention"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Complete audit trail for compliance"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Every request passes through multiple security layers"}),"\n",(0,s.jsx)(n.li,{children:"JWT tokens carry user identity and context"}),"\n",(0,s.jsx)(n.li,{children:"TB_MENU defines what users can do"}),"\n",(0,s.jsx)(n.li,{children:"source/centro_dett ensures tenant isolation"}),"\n",(0,s.jsx)(n.li,{children:"peso/ambiente filter what's visible"}),"\n",(0,s.jsx)(n.li,{children:"COD_ON_OFF controls field access"}),"\n",(0,s.jsx)(n.li,{children:"Rate limiting prevents abuse"}),"\n",(0,s.jsx)(n.li,{children:"Audit trail tracks all operations"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Security Checklist:"})}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","HTTPS in production"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","JWT secret rotation"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Token refresh implementation"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Input validation"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","HttpOnly cookies (not localStorage)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Complete session context (source/centro_dett/peso/ambiente)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Rate limit handling"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Error logging and monitoring"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Regular security audits"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/authentication",children:"Authentication"})," - JWT tokens and refresh tokens"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/authorization",children:"Authorization"})," - TB_MENU grants and nested set"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/tenant-isolation",children:"Tenant Isolation"})," - Multi-tenancy architecture"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/context-security",children:"Context Security"})," - source/peso/ambiente filtering"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/rate-limiting",children:"Rate Limiting"})," - API throttling"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/audit-trail",children:"Audit Trail"})," - Operation tracking"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/security-checklist",children:"Security Checklist"})," - Best practices"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},2172:(e,n,i)=>{i.d(n,{I:()=>l,M:()=>c});var s=i(1504);const t={},r=s.createContext(t);function c(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);