"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[5808],{3256:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>d});var i=s(7624),r=s(2172);const t={title:"Troubleshooting",sidebar_label:"Troubleshooting",sidebar_position:8,description:"Common issues and solutions for Core API integrations"},o="Troubleshooting",l={id:"products/map.q01.io/core-api-platform-v4/best-practices/troubleshooting",title:"Troubleshooting",description:"Common issues and solutions for Core API integrations",source:"@site/docs/products/map.q01.io/core-api-platform-v4/07-best-practices/troubleshooting.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/07-best-practices",slug:"/products/map.q01.io/core-api-platform-v4/best-practices/troubleshooting",permalink:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/troubleshooting",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Troubleshooting",sidebar_label:"Troubleshooting",sidebar_position:8,description:"Common issues and solutions for Core API integrations"},sidebar:"mapSidebar",previous:{title:"Migration Guide",permalink:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/migration-guide"},next:{title:"Reference",permalink:"/docs/products/map.q01.io/core-api-platform-v4/reference/"}},c={},d=[{value:"Overview",id:"overview",level:2},{value:"Authentication Errors",id:"authentication-errors",level:2},{value:"Error: 401 Unauthorized",id:"error-401-unauthorized",level:3},{value:"Error: Token Refresh Failed",id:"error-token-refresh-failed",level:3},{value:"Authorization Errors",id:"authorization-errors",level:2},{value:"Error: 403 Forbidden",id:"error-403-forbidden",level:3},{value:"Error: Record Not Found (403 vs 404)",id:"error-record-not-found-403-vs-404",level:3},{value:"Field Visibility Errors",id:"field-visibility-errors",level:2},{value:"Error: Field Not Returned in Response",id:"error-field-not-returned-in-response",level:3},{value:"Error: Field Validation Failed",id:"error-field-validation-failed",level:3},{value:"Performance Issues",id:"performance-issues",level:2},{value:"Issue: Slow Response Times",id:"issue-slow-response-times",level:3},{value:"Issue: High Memory Usage",id:"issue-high-memory-usage",level:3},{value:"Data Inconsistencies",id:"data-inconsistencies",level:2},{value:"Issue: Stale Cache Data",id:"issue-stale-cache-data",level:3},{value:"Issue: Duplicate Records",id:"issue-duplicate-records",level:3},{value:"OUTBOX Event Issues",id:"outbox-event-issues",level:2},{value:"Issue: Events Not Processed",id:"issue-events-not-processed",level:3},{value:"Connection Issues",id:"connection-issues",level:2},{value:"Error: Connection Timeout",id:"error-connection-timeout",level:3},{value:"Diagnostic Tools",id:"diagnostic-tools",level:2},{value:"API Response Inspector",id:"api-response-inspector",level:3},{value:"Database Query Profiler",id:"database-query-profiler",level:3},{value:"Quick Reference",id:"quick-reference",level:2},{value:"HTTP Status Codes",id:"http-status-codes",level:3},{value:"Debug Checklist",id:"debug-checklist",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Quick reference"})," for diagnosing and resolving common Q01 Core API issues. Organized by error category with symptoms, causes, and solutions."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Error Categories:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Authentication Errors"}),"\n",(0,i.jsx)(n.li,{children:"Authorization Errors"}),"\n",(0,i.jsx)(n.li,{children:"Field Visibility Errors"}),"\n",(0,i.jsx)(n.li,{children:"Performance Issues"}),"\n",(0,i.jsx)(n.li,{children:"Data Inconsistencies"}),"\n",(0,i.jsx)(n.li,{children:"OUTBOX Event Issues"}),"\n",(0,i.jsx)(n.li,{children:"Connection Issues"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"authentication-errors",children:"Authentication Errors"}),"\n",(0,i.jsx)(n.h3,{id:"error-401-unauthorized",children:"Error: 401 Unauthorized"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "Unauthorized",\n  "message": "Invalid or expired token"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Common Causes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Expired access token"}),"\n",(0,i.jsx)(n.li,{children:"Invalid token format"}),"\n",(0,i.jsx)(n.li,{children:"Token not included in request"}),"\n",(0,i.jsx)(n.li,{children:"Token revoked"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Check token expiration\nconst jwt = require('jsonwebtoken');\n\nfunction isTokenExpired(token) {\n  try {\n    const decoded = jwt.decode(token);\n    if (!decoded || !decoded.exp) return true;\n\n    return Date.now() >= decoded.exp * 1000;\n  } catch (error) {\n    return true;\n  }\n}\n\n// \u2705 Refresh token if expired\nif (isTokenExpired(accessToken)) {\n  const newToken = await refreshAccessToken(refreshToken);\n  accessToken = newToken;\n}\n\n// \u2705 Include token in header\nconst response = await fetch(url, {\n  headers: {\n    'Authorization': `Bearer ${accessToken}`  // Note: \"Bearer\" prefix required\n  }\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Debug Steps:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Check token format: ",(0,i.jsx)(n.code,{children:"console.log(accessToken)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Decode token: ",(0,i.jsx)(n.code,{children:"jwt.decode(accessToken)"})]}),"\n",(0,i.jsxs)(n.li,{children:["Verify expiration: ",(0,i.jsx)(n.code,{children:"decoded.exp * 1000 > Date.now()"})]}),"\n",(0,i.jsx)(n.li,{children:"Test with fresh token from login"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"error-token-refresh-failed",children:"Error: Token Refresh Failed"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "Invalid refresh token"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Refresh token expired (> 7 days)"}),"\n",(0,i.jsx)(n.li,{children:"Refresh token revoked"}),"\n",(0,i.jsx)(n.li,{children:"User logged out"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"async function handleTokenRefresh() {\n  try {\n    const response = await fetch('/api/v4/auth/refresh', {\n      method: 'POST',\n      body: JSON.stringify({refreshToken})\n    });\n\n    if (response.status === 401) {\n      // Refresh token expired - redirect to login\n      window.location.href = '/login';\n      return;\n    }\n\n    const {accessToken} = await response.json();\n    return accessToken;\n  } catch (error) {\n    // Network error - retry once\n    await sleep(1000);\n    return handleTokenRefresh();\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"authorization-errors",children:"Authorization Errors"}),"\n",(0,i.jsx)(n.h3,{id:"error-403-forbidden",children:"Error: 403 Forbidden"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "Forbidden",\n  "message": "Insufficient permissions"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Missing grant in TB_MENU"}),"\n",(0,i.jsx)(n.li,{children:"Wrong peso level"}),"\n",(0,i.jsx)(n.li,{children:"Wrong centro_dett context"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Check grants\nasync function checkGrant(dimension, operation) {\n  const grants = await fetch('/api/v4/core/menu').then(r => r.json());\n\n  const menu = grants.data.find(m => m.MENU_CODE === dimension);\n\n  if (!menu) {\n    console.error(`No menu entry for ${dimension}`);\n    return false;\n  }\n\n  const grantMap = {read: 'R', create: 'C', update: 'U', delete: 'D'};\n  const required = grantMap[operation];\n\n  if (!menu.GRANTS.includes(required)) {\n    console.error(`Missing ${operation} grant for ${dimension}`);\n    console.log('Available grants:', menu.GRANTS);\n    return false;\n  }\n\n  return true;\n}\n\n// Usage\nif (!(await checkGrant('products', 'delete'))) {\n  alert('You do not have permission to delete products');\n  return;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Debug Steps:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Fetch ",(0,i.jsx)(n.code,{children:"/api/v4/core/menu"})," to see all grants"]}),"\n",(0,i.jsxs)(n.li,{children:["Check ",(0,i.jsx)(n.code,{children:"MENU_CODE"})," matches dimension"]}),"\n",(0,i.jsxs)(n.li,{children:["Verify ",(0,i.jsx)(n.code,{children:"GRANTS"})," contains required letter (R/C/U/D)"]}),"\n",(0,i.jsx)(n.li,{children:"Check nested set hierarchy (NLEFT/NRIGHT)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"error-record-not-found-403-vs-404",children:"Error: Record Not Found (403 vs 404)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Record exists but returns 403 (not 404)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cause:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Context filtering (source, peso, ambiente, centro_dett)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Verify context matches record\nconst headers = {\n  'X-Source': 'tenant_123',      // Must match record's source\n  'X-Peso': '3',                 // Must allow access\n  'X-Ambiente': 'P',             // Must match record's ambiente\n  'X-Centro-Dett': 'HQ'          // Must match record's centro_dett\n};\n\n// Debug: Fetch without filters to see actual values\nconst rawRecord = await db.query(\n  'SELECT source, ambiente, centro_dett FROM TB_ANAG_PRD00 WHERE PRD_ID = ?',\n  [recordId]\n);\n\nconsole.log('Record context:', rawRecord);\nconsole.log('Request context:', headers);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"field-visibility-errors",children:"Field Visibility Errors"}),"\n",(0,i.jsx)(n.h3,{id:"error-field-not-returned-in-response",children:"Error: Field Not Returned in Response"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Field exists in database but not in API response"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cause:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"COD_ON_OFF flag not set for operation (L/D/N/M/R)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Check field metadata\nconst fields = await fetch('/api/v4/core/products/fields').then(r => r.json());\n\nconst field = fields.data.find(f => f.VAR === 'XPRD07');\n\nconsole.log('COD_ON_OFF:', field.COD_ON_OFF);\n// Example: \"LDN\" means visible in List, Detail, New (not Modify or seaRch)\n\n// \u2705 Request specific fields\nconst products = await fetch('/api/v4/core/products', {\n  params: {\n    fields: 'PRD_ID,XPRD01,XPRD02,XPRD07'  // Explicit field list\n  }\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"COD_ON_OFF Flag Reference:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"L"})," - List (GET /dimension)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"D"})," - Detail (GET /dimension/",":id",")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"N"})," - New (POST /dimension)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"M"})," - Modify (PUT/PATCH /dimension/",":id",")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"R"})," - seaRch (filters)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Debug Steps:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Check TB_VAR for field configuration"}),"\n",(0,i.jsx)(n.li,{children:"Verify COD_ON_OFF contains required flag"}),"\n",(0,i.jsxs)(n.li,{children:["Test with explicit ",(0,i.jsx)(n.code,{children:"fields"})," parameter"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"error-field-validation-failed",children:"Error: Field Validation Failed"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "Validation failed",\n  "field": "XPRD02",\n  "message": "Field is required"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Missing required field (REQUIRED = 'Y' in TB_VAR)"}),"\n",(0,i.jsx)(n.li,{children:"Wrong data type"}),"\n",(0,i.jsx)(n.li,{children:"Value out of range"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Validate before sending\nfunction validateProduct(product, fieldMeta) {\n  const errors = [];\n\n  for (const field of fieldMeta) {\n    // Check required\n    if (field.REQUIRED === 'Y' && !product[field.VAR]) {\n      errors.push(`${field.VAR} is required`);\n    }\n\n    // Check type\n    if (product[field.VAR]) {\n      if (field.TYPE === 'numeric' && typeof product[field.VAR] !== 'number') {\n        errors.push(`${field.VAR} must be a number`);\n      }\n      if (field.TYPE === 'string' && typeof product[field.VAR] !== 'string') {\n        errors.push(`${field.VAR} must be a string`);\n      }\n    }\n  }\n\n  return errors;\n}\n\n// Usage\nconst fieldMeta = await fetch('/api/v4/core/products/fields').then(r => r.json());\nconst errors = validateProduct(productData, fieldMeta.data);\n\nif (errors.length > 0) {\n  console.error('Validation errors:', errors);\n  return;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,i.jsx)(n.h3,{id:"issue-slow-response-times",children:"Issue: Slow Response Times"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"API responses taking > 1 second"}),"\n",(0,i.jsx)(n.li,{children:"Timeouts"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Missing database indexes"}),"\n",(0,i.jsx)(n.li,{children:"Fetching too many fields"}),"\n",(0,i.jsx)(n.li,{children:"Large result sets without pagination"}),"\n",(0,i.jsx)(n.li,{children:"N+1 query problem"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Add indexes for filtered fields\nCREATE INDEX idx_prd_category ON TB_ANAG_PRD00(XPRD05);\nCREATE INDEX idx_prd_active ON TB_ANAG_PRD00(XPRD06);\nCREATE INDEX idx_prd_cat_active ON TB_ANAG_PRD00(XPRD05, XPRD06);\n\n-- \u2705 Check query execution\nEXPLAIN SELECT * FROM TB_ANAG_PRD00 WHERE XPRD05 = 5;\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Fetch only required fields\nconst products = await fetch('/api/v4/core/products', {\n  params: {\n    fields: 'PRD_ID,XPRD01,XPRD02',  // Only 3 fields instead of 50\n    limit: 50  // Reasonable limit\n  }\n});\n\n// \u2705 Use pagination\nasync function* fetchAllProducts() {\n  let offset = 0;\n  const limit = 100;\n\n  while (true) {\n    const batch = await fetch('/api/v4/core/products', {\n      params: {limit, offset}\n    });\n\n    if (batch.data.length === 0) break;\n\n    yield batch.data;\n    offset += limit;\n  }\n}\n\n// \u2705 Use expansion instead of N+1 queries\nconst products = await fetch('/api/v4/core/products', {\n  params: {\n    limit: 100,\n    expand: 'XPRD05'  // Expand category in single query\n  }\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Debug Steps:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Enable slow query log"}),"\n",(0,i.jsx)(n.li,{children:"Check database indexes"}),"\n",(0,i.jsx)(n.li,{children:"Profile API response times"}),"\n",(0,i.jsx)(n.li,{children:"Monitor network waterfall"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"issue-high-memory-usage",children:"Issue: High Memory Usage"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cause:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Fetching too many records at once"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - Loads all 100k products in memory\nconst allProducts = await fetch('/api/v4/core/products?limit=100000');\n\n// \u2705 Good - Stream in batches\nasync function processAllProducts() {\n  for await (const batch of fetchAllProducts()) {\n    processBatch(batch);  // Process 100 at a time\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"data-inconsistencies",children:"Data Inconsistencies"}),"\n",(0,i.jsx)(n.h3,{id:"issue-stale-cache-data",children:"Issue: Stale Cache Data"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Updates not reflected in UI"}),"\n",(0,i.jsx)(n.li,{children:"Old data returned"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cause:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Cache not invalidated on update"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"class CachedAPIClient {\n  async update(dimension, id, data) {\n    // Update via API\n    const result = await api.patch(`/api/v4/core/${dimension}/${id}`, data);\n\n    // Invalidate cache\n    this.cache.delete(`${dimension}:${id}`);\n    this.cache.delete(`${dimension}:list`);\n\n    return result;\n  }\n}\n\n// \u2705 Subscribe to OUTBOX events for invalidation\nwebsocket.on('ProductUpdated', (event) => {\n  cache.delete(`product:${event.data.PRD_ID}`);\n  cache.delete('products:list');\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"issue-duplicate-records",children:"Issue: Duplicate Records"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Same record appears multiple times"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Concurrent inserts without locking"}),"\n",(0,i.jsx)(n.li,{children:"Retry logic creating duplicates"}),"\n",(0,i.jsx)(n.li,{children:"No unique constraints"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Use idempotency key\nasync function createProduct(product, idempotencyKey) {\n  // Check if already processed\n  const existing = await redis.get(`idempotency:${idempotencyKey}`);\n  if (existing) {\n    return JSON.parse(existing);\n  }\n\n  // Create product\n  const result = await api.post('/api/v4/core/products', product);\n\n  // Store result with idempotency key (24h TTL)\n  await redis.set(\n    `idempotency:${idempotencyKey}`,\n    JSON.stringify(result),\n    'EX',\n    86400\n  );\n\n  return result;\n}\n\n// Usage with UUID\nconst idempotencyKey = uuidv4();\nawait createProduct(productData, idempotencyKey);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"outbox-event-issues",children:"OUTBOX Event Issues"}),"\n",(0,i.jsx)(n.h3,{id:"issue-events-not-processed",children:"Issue: Events Not Processed"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Search index not updated"}),"\n",(0,i.jsx)(n.li,{children:"Cache not invalidated"}),"\n",(0,i.jsx)(n.li,{children:"Webhooks not sent"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Subscriber not running"}),"\n",(0,i.jsx)(n.li,{children:"RabbitMQ connection issue"}),"\n",(0,i.jsx)(n.li,{children:"Event processing error"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Debug Steps:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check RabbitMQ queue\nrabbitmqctl list_queues\n\n# Check subscriber logs\ndocker logs search-indexer\n\n# Check OUTBOX table\nSELECT * FROM OUTBOX\nWHERE PUBLISHED = 'N'\nORDER BY CREATED_AT DESC\nLIMIT 10;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Monitor subscriber health\nclass HealthySubscriber extends OutboxSubscriber {\n  async start() {\n    // Health check endpoint\n    app.get('/health', (req, res) => {\n      res.json({\n        status: this.isConnected ? 'healthy' : 'unhealthy',\n        queue: this.queueName,\n        lastMessage: this.lastMessageTime\n      });\n    });\n\n    // Reconnect on failure\n    this.connection.on('error', async (error) => {\n      console.error('Connection error:', error);\n      await this.reconnect();\n    });\n  }\n\n  async reconnect() {\n    await sleep(5000);\n    await this.connect();\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"connection-issues",children:"Connection Issues"}),"\n",(0,i.jsx)(n.h3,{id:"error-connection-timeout",children:"Error: Connection Timeout"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptoms:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: ETIMEDOUT\nError: ECONNRESET\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Causes:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Network issues"}),"\n",(0,i.jsx)(n.li,{children:"API server down"}),"\n",(0,i.jsx)(n.li,{children:"Firewall blocking"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Implement retry with exponential backoff\nasync function fetchWithRetry(url, options, maxRetries = 3) {\n  for (let i = 0; i < maxRetries; i++) {\n    try {\n      return await fetch(url, {\n        ...options,\n        timeout: 10000  // 10 second timeout\n      });\n    } catch (error) {\n      if (i === maxRetries - 1) throw error;\n\n      const delay = Math.pow(2, i) * 1000;\n      console.log(`Retry ${i + 1}/${maxRetries} after ${delay}ms...`);\n      await sleep(delay);\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"diagnostic-tools",children:"Diagnostic Tools"}),"\n",(0,i.jsx)(n.h3,{id:"api-response-inspector",children:"API Response Inspector"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// Log all API interactions\napi.interceptors.request.use(config => {\n  console.log('[Request]', config.method, config.url);\n  console.log('[Headers]', config.headers);\n  console.log('[Body]', config.data);\n  config.metadata = {startTime: Date.now()};\n  return config;\n});\n\napi.interceptors.response.use(\n  response => {\n    const duration = Date.now() - response.config.metadata.startTime;\n    console.log('[Response]', response.status, `${duration}ms`);\n    console.log('[Data]', response.data);\n    return response;\n  },\n  error => {\n    console.error('[Error]', error.response?.status, error.message);\n    console.error('[Response]', error.response?.data);\n    throw error;\n  }\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"database-query-profiler",children:"Database Query Profiler"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Enable slow query log\nSET GLOBAL slow_query_log = 1;\nSET GLOBAL long_query_time = 0.5;\n\n-- Check slow queries\nSELECT * FROM mysql.slow_log\nORDER BY start_time DESC\nLIMIT 10;\n\n-- Analyze query\nEXPLAIN SELECT * FROM TB_ANAG_PRD00 WHERE XPRD05 = 5;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,i.jsx)(n.h3,{id:"http-status-codes",children:"HTTP Status Codes"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Code"}),(0,i.jsx)(n.th,{children:"Meaning"}),(0,i.jsx)(n.th,{children:"Common Cause"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"200"}),(0,i.jsx)(n.td,{children:"OK"}),(0,i.jsx)(n.td,{children:"Success"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"201"}),(0,i.jsx)(n.td,{children:"Created"}),(0,i.jsx)(n.td,{children:"POST success"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"400"}),(0,i.jsx)(n.td,{children:"Bad Request"}),(0,i.jsx)(n.td,{children:"Invalid input"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"401"}),(0,i.jsx)(n.td,{children:"Unauthorized"}),(0,i.jsx)(n.td,{children:"Missing/invalid token"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"403"}),(0,i.jsx)(n.td,{children:"Forbidden"}),(0,i.jsx)(n.td,{children:"Insufficient permissions"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"404"}),(0,i.jsx)(n.td,{children:"Not Found"}),(0,i.jsx)(n.td,{children:"Record doesn't exist"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"409"}),(0,i.jsx)(n.td,{children:"Conflict"}),(0,i.jsx)(n.td,{children:"Duplicate key"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"422"}),(0,i.jsx)(n.td,{children:"Validation Error"}),(0,i.jsx)(n.td,{children:"Field validation failed"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"429"}),(0,i.jsx)(n.td,{children:"Too Many Requests"}),(0,i.jsx)(n.td,{children:"Rate limit exceeded"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"500"}),(0,i.jsx)(n.td,{children:"Internal Server Error"}),(0,i.jsx)(n.td,{children:"Server error"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"503"}),(0,i.jsx)(n.td,{children:"Service Unavailable"}),(0,i.jsx)(n.td,{children:"Server down"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"debug-checklist",children:"Debug Checklist"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Authentication Issues:"})}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Token included in Authorization header"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Token not expired"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ",'"Bearer" prefix present']}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Token format valid (JWT)"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Authorization Issues:"})}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Grant exists in TB_MENU"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Context headers correct (source, peso, ambiente, centro_dett)"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Peso level sufficient"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Centro_dett matches record"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Field Visibility:"})}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","COD_ON_OFF flag set for operation"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Field requested explicitly"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Field not hidden by peso"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Performance:"})}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Indexes created"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Pagination used"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Only required fields fetched"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Caching implemented"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Common Issue Resolution Times:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Authentication: < 5 minutes"}),"\n",(0,i.jsx)(n.li,{children:"Authorization: 10-30 minutes (TB_MENU verification)"}),"\n",(0,i.jsx)(n.li,{children:"Field visibility: 5-10 minutes (COD_ON_OFF check)"}),"\n",(0,i.jsx)(n.li,{children:"Performance: 1-2 hours (indexing, optimization)"}),"\n",(0,i.jsx)(n.li,{children:"Data inconsistency: 30-60 minutes (debugging)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Troubleshooting Steps:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Check error message and HTTP status"}),"\n",(0,i.jsx)(n.li,{children:"Verify authentication (token valid)"}),"\n",(0,i.jsx)(n.li,{children:"Verify authorization (grants present)"}),"\n",(0,i.jsx)(n.li,{children:"Check context headers"}),"\n",(0,i.jsx)(n.li,{children:"Validate field metadata"}),"\n",(0,i.jsx)(n.li,{children:"Profile performance"}),"\n",(0,i.jsx)(n.li,{children:"Check logs"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/security-tips",children:"Security Tips"})," - Security best practices"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/performance-tips",children:"Performance Tips"})," - Optimization"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/anti-patterns",children:"Anti-Patterns"})," - Common mistakes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/best-practices",children:"Best Practices"})," - Overview"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},2172:(e,n,s)=>{s.d(n,{I:()=>l,M:()=>o});var i=s(1504);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);