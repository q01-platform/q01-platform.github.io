"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[2996],{2012:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>T,frontMatter:()=>t,metadata:()=>i,toc:()=>l});var s=r(7624),a=r(2172);const t={title:"Cascade Operations",sidebar_label:"Cascade Operations",sidebar_position:8,description:"Automatic propagation of operations to related records"},d="Cascade Operations",i={id:"products/map.q01.io/core-api-platform-v4/write-patterns/cascade-operations",title:"Cascade Operations",description:"Automatic propagation of operations to related records",source:"@site/docs/products/map.q01.io/core-api-platform-v4/04-write-patterns/cascade-operations.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/04-write-patterns",slug:"/products/map.q01.io/core-api-platform-v4/write-patterns/cascade-operations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/cascade-operations",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Cascade Operations",sidebar_label:"Cascade Operations",sidebar_position:8,description:"Automatic propagation of operations to related records"},sidebar:"mapSidebar",previous:{title:"ACID Transactions",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/transactions"},next:{title:"Outbox Pattern",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/outbox-pattern"}},c={},l=[{value:"Overview",id:"overview",level:2},{value:"INSERT_CASCADE",id:"insert_cascade",level:2},{value:"Metadata Configuration",id:"metadata-configuration",level:3},{value:"Single Request Creates Multiple Records",id:"single-request-creates-multiple-records",level:3},{value:"UPDATE_CASCADE",id:"update_cascade",level:2},{value:"Metadata Configuration",id:"metadata-configuration-1",level:3},{value:"Propagates Updates Automatically",id:"propagates-updates-automatically",level:3},{value:"Conditional Cascades",id:"conditional-cascades",level:3},{value:"DELETE_CASCADE",id:"delete_cascade",level:2},{value:"Metadata Configuration",id:"metadata-configuration-2",level:3},{value:"Soft Delete Cascade",id:"soft-delete-cascade",level:3},{value:"Force Delete Cascade",id:"force-delete-cascade",level:3},{value:"Common Cascade Patterns",id:"common-cascade-patterns",level:2},{value:"Pattern 1: Master-Detail (1)",id:"pattern-1-master-detail-1",level:3},{value:"Pattern 2: Parent-Child Hierarchy",id:"pattern-2-parent-child-hierarchy",level:3},{value:"JavaScript Examples",id:"javascript-examples",level:2},{value:"Create with Cascades",id:"create-with-cascades",level:3},{value:"Update with Cascades",id:"update-with-cascades",level:3},{value:"Delete with Cascades",id:"delete-with-cascades",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Cascade Performance",id:"cascade-performance",level:3},{value:"Indexing for Cascades",id:"indexing-for-cascades",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"cascade-operations",children:"Cascade Operations"}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cascade operations"})," automatically propagate create, update, and delete operations to related records. This is achieved through explicit configuration in the request body using the ",(0,s.jsx)(n.code,{children:"metadata"})," key."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cascade Types:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"INSERT_CASCADE"})," - Create related records on POST"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"UPDATE_CASCADE"})," - Update related records on PUT/PATCH"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DELETE_CASCADE"})," - Delete related records on DELETE"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"INS_UP_DUPVAL_CASCADE"})," - Insert with ON DUPLICATE KEY UPDATE behavior"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DELETE_BYID_CASCADE"})," - Delete related records by specific ID"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Single API call creates master + detail records"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Maintains referential integrity automatically"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Reduces N+1 query problems"}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 Explicitly configured via ",(0,s.jsx)(n.code,{children:"metadata"})," field in request body"]}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Transactional (ACID guarantees)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"insert_cascade",children:"INSERT_CASCADE"}),"\n",(0,s.jsx)(n.h3,{id:"metadata-configuration",children:"Metadata Configuration"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["INSERT_CASCADE is configured via the ",(0,s.jsx)(n.code,{children:"metadata"})," field in the request body:"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'{\n  "metadata": {\n    "INSERT_CASCADE": {\n      "TARGET_DIMENSION": {\n        "replace": {\n          "TARGET_FIELD": "SOURCE_FIELD"\n        },\n        "body": [\n          // Array of records to create in target dimension\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Structure:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TARGET_DIMENSION"}),": The dimension where related records will be created (e.g., ",(0,s.jsx)(n.code,{children:"ARTCERT"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"replace"}),": Field mapping from source to target","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TARGET_FIELD"}),": Field in the target dimension"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SOURCE_FIELD"}),": Field from the parent record whose value will be used"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"body"}),": Array of record objects to create in the target dimension"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["How ",(0,s.jsx)(n.code,{children:"replace"})," works:"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The value from ",(0,s.jsx)(n.code,{children:"SOURCE_FIELD"})," in the parent record is used to populate ",(0,s.jsx)(n.code,{children:"TARGET_FIELD"})," in child records"]}),"\n",(0,s.jsxs)(n.li,{children:["In the body array, use ",(0,s.jsx)(n.code,{children:'"TARGET_FIELD": "?"'})," as a placeholder"]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"?"})," will be replaced with the actual value from ",(0,s.jsx)(n.code,{children:"SOURCE_FIELD"})," after the parent record is created"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"single-request-creates-multiple-records",children:"Single Request Creates Multiple Records"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/ART\n[\n    {\n        "source": "artwork-2",\n        "XART01": "",\n        "XART02": "",\n        "counter": "XART03",\n        "XART03": "1",\n        "XART19": 1,\n        "XART04": "test",\n        "XART21": "",\n        "XART32": 1,\n        "XART22": 1,\n        "XART23": "on hold",\n        "XART05": 18,\n        "XART06": "",\n        "XART07": "",\n        "XART08": 3,\n        "XART36": "",\n        "XART09": "0.00",\n        "XART10": "0.00",\n        "XART11": "0.00",\n        "XART12": "cm",\n        "XART24": 0,\n        "XART25": "0.00",\n        "XART26": "0.00",\n        "XART27": "0.00",\n        "XART28": "0.00",\n        "XART29": "cm",\n        "XART30": 1,\n        "XART13": "0.00",\n        "XART14": "EUR",\n        "XART16": "",\n        "XART17": "no",\n        "XART31": "no",\n        "XART34": 0,\n        "XART37": 1,\n        "metadata": {\n            "INSERT_CASCADE": {\n                "ARTCERT": {\n                    "replace": {\n                        "XARTCERT04": "XART03"\n                    },\n                    "body": [\n                        {\n                            "source": "artwork-2",\n                            "XARTCERT03": 0,\n                            "counter": "XARTCERT03",\n                            "XARTCERT04": "?",\n                            "XARTCERT05": "1",\n                            "debug": true,\n                            "skipCodOnOffCheck": true\n                        },\n                        {\n                            "source": "artwork-2",\n                            "XARTCERT03": 0,\n                            "counter": "XARTCERT03",\n                            "XARTCERT04": "?",\n                            "XARTCERT05": "2",\n                            "debug": true,\n                            "skipCodOnOffCheck": true\n                        }\n                    ]\n                }\n            }\n        }\n    }\n]\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What happens:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Parent record (ART) is created with ",(0,s.jsx)(n.code,{children:"XART03"})," counter field auto-generated (e.g., value = 33)"]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"metadata.INSERT_CASCADE.ARTCERT.replace"})," mapping indicates that ",(0,s.jsx)(n.code,{children:"XARTCERT04"})," should receive the value of ",(0,s.jsx)(n.code,{children:"XART03"})]}),"\n",(0,s.jsxs)(n.li,{children:["Two child records (ARTCERT) are created:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["First record: ",(0,s.jsx)(n.code,{children:"XARTCERT04 = 33"})," (from parent's XART03), ",(0,s.jsx)(n.code,{children:'XARTCERT05 = "1"'}),", ",(0,s.jsx)(n.code,{children:"XARTCERT03"})," counter auto-generated"]}),"\n",(0,s.jsxs)(n.li,{children:["Second record: ",(0,s.jsx)(n.code,{children:"XARTCERT04 = 33"})," (from parent's XART03), ",(0,s.jsx)(n.code,{children:'XARTCERT05 = "2"'}),", ",(0,s.jsx)(n.code,{children:"XARTCERT03"})," counter auto-generated"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Generated SQL (single transaction):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"BEGIN TRANSACTION;\n\n-- 1. Insert parent artwork record (with counter generation for XART03)\nINSERT INTO TB_ANAG_ART00 (\n    XART03, XART04, XART19, XART23, XART05, XART08,\n    XART09, XART10, XART11, XART12, XART24, XART25,\n    XART26, XART27, XART28, XART29, XART30, XART13,\n    XART14, XART17, XART31, XART32, XART22, XART34, XART37,\n    OWNER, LOWNER, CDATA, LDATA, TIMESTAMP, TREC\n) VALUES (\n    33, 'test', 1, 'on hold', 18, 3,\n    '0.00', '0.00', '0.00', 'cm', 0, '0.00',\n    '0.00', '0.00', '0.00', 'cm', 1, '0.00',\n    'EUR', 'no', 'no', 1, 1, 0, 1,\n    ?, ?, ?, ?, ?, 'N'\n);\n-- Returns: insertedId = 43, counter XART03 = 33\n\n-- 2. Insert first certificate record (cascade)\nINSERT INTO TB_ANAG_ARTCERT00 (\n    XARTCERT03, XARTCERT04, XARTCERT05,\n    XARTCERT01, XARTCERT02,\n    OWNER, LOWNER, CDATA, LDATA, TIMESTAMP, TREC\n) VALUES (\n    1, 33, '1',  -- XARTCERT04=33 from parent's XART03, XARTCERT03=1 from counter\n    ?, ?,        -- XARTCERT01, XARTCERT02 auto-populated\n    ?, ?, ?, ?, ?, 'N'\n) ON DUPLICATE KEY UPDATE\n    XARTCERT04 = ?, XARTCERT05 = ?,\n    XARTCERT01 = ?, XARTCERT02 = ?,\n    LOWNER = ?, LDATA = ?, TREC = ?;\n-- Returns: insertedId = 1\n\n-- 3. Insert second certificate record (cascade)\nINSERT INTO TB_ANAG_ARTCERT00 (\n    XARTCERT03, XARTCERT04, XARTCERT05,\n    XARTCERT01, XARTCERT02,\n    OWNER, LOWNER, CDATA, LDATA, TIMESTAMP, TREC\n) VALUES (\n    2, 33, '2',  -- XARTCERT04=33 from parent's XART03, XARTCERT03=2 from counter\n    ?, ?,        -- XARTCERT01, XARTCERT02 auto-populated\n    ?, ?, ?, ?, ?, 'N'\n) ON DUPLICATE KEY UPDATE\n    XARTCERT04 = ?, XARTCERT05 = ?,\n    XARTCERT01 = ?, XARTCERT02 = ?,\n    LOWNER = ?, LDATA = ?, TREC = ?;\n-- Returns: insertedId = 2\n\n-- 4. Insert outbox event\nINSERT INTO OUTBOX (...) VALUES (...);\n\nCOMMIT;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'[\n    {\n        "INSERT_CASCADE": {\n            "ARTCERT": [\n                {\n                    "code": 201,\n                    "debug": {\n                        "body": {\n                            "XARTCERT01": 2,\n                            "XARTCERT02": 2,\n                            "XARTCERT03": 1,\n                            "XARTCERT04": 33,\n                            "XARTCERT05": "1",\n                            "counter": "XARTCERT03",\n                            "debug": true,\n                            "skipCodOnOffCheck": true,\n                            "source": "artwork-2"\n                        },\n                        "fields": {\n                            "XARTCERT01": 2,\n                            "XARTCERT02": 2,\n                            "XARTCERT03": 1,\n                            "XARTCERT04": 33,\n                            "XARTCERT05": "1",\n                            "counter": "XARTCERT03",\n                            "debug": true,\n                            "skipCodOnOffCheck": true,\n                            "source": "artwork-2"\n                        },\n                        "sql": "insert into TB_ANAG_ARTCERT00 (XARTCERT03, XARTCERT04, XARTCERT05, XARTCERT01, XARTCERT02, OWNER, LOWNER, CDATA, LDATA, TIMESTAMP, TREC) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) on duplicate key update XARTCERT04 = ?,XARTCERT05 = ?,XARTCERT01 = ?,XARTCERT02 = ?,LOWNER = ?,LDATA = ?,TREC = ?"\n                    },\n                    "insertedId": 1\n                },\n                {\n                    "code": 201,\n                    "debug": {\n                        "body": {\n                            "XARTCERT01": 2,\n                            "XARTCERT02": 2,\n                            "XARTCERT03": 2,\n                            "XARTCERT04": 33,\n                            "XARTCERT05": "2",\n                            "counter": "XARTCERT03",\n                            "debug": true,\n                            "skipCodOnOffCheck": true,\n                            "source": "artwork-2"\n                        },\n                        "fields": {\n                            "XARTCERT01": 2,\n                            "XARTCERT02": 2,\n                            "XARTCERT03": 2,\n                            "XARTCERT04": 33,\n                            "XARTCERT05": "2",\n                            "counter": "XARTCERT03",\n                            "debug": true,\n                            "skipCodOnOffCheck": true,\n                            "source": "artwork-2"\n                        },\n                        "sql": "insert into TB_ANAG_ARTCERT00 (XARTCERT03, XARTCERT04, XARTCERT05, XARTCERT01, XARTCERT02, OWNER, LOWNER, CDATA, LDATA, TIMESTAMP, TREC) values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) on duplicate key update XARTCERT04 = ?,XARTCERT05 = ?,XARTCERT01 = ?,XARTCERT02 = ?,LOWNER = ?,LDATA = ?,TREC = ?"\n                    },\n                    "insertedId": 2\n                }\n            ]\n        },\n        "code": 201,\n        "counter": 33,\n        "insertedId": 43,\n        "outbox": false,\n        "rowCount": 1\n    }\n]\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key points in the response:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"counter: 33"})," - The auto-generated value for XART03 in the parent record"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"insertedId: 43"})," - The ID of the parent ART record"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"INSERT_CASCADE.ARTCERT"})," - Array containing results for each cascaded ARTCERT record"]}),"\n",(0,s.jsxs)(n.li,{children:["Each cascaded record includes:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"code: 201"})," - Success status"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"insertedId"})," - The ID of the created certificate record (1, 2)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"debug"})," object - Contains the actual body sent, final fields, and SQL executed"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"update_cascade",children:"UPDATE_CASCADE"}),"\n",(0,s.jsx)(n.h3,{id:"metadata-configuration-1",children:"Metadata Configuration"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TB_COST.UPDATE_CASCADE defines automatic propagation:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- When product name changes, update all order items\nINSERT INTO TB_COST (\n    COD_DIM,\n    NUM_COST,\n    COD_VAR,\n    UPDATE_CASCADE,\n    DESCRIZIONE_COST\n) VALUES (\n    'PRD',  -- Source dimension\n    1,      -- Field position\n    'XPRD01',  -- Source field (product name)\n    'ORDITEM:XORDITEM_PRODUCT_NAME',  -- Target: Dimension:FieldToUpdate\n    'Product name'\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Format:"})," ",(0,s.jsx)(n.code,{children:"TargetDimension:FieldToUpdate"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TargetDimension"}),": Dimension to update (ORDITEM)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"FieldToUpdate"}),": Field that should receive new value (XORDITEM_PRODUCT_NAME)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"propagates-updates-automatically",children:"Propagates Updates Automatically"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'PATCH /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD01": "Widget Pro V2"  // Name changed\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Generated SQL (single transaction):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"BEGIN TRANSACTION;\n\n-- 1. Update product\nUPDATE TB_ANAG_PRD00\nSET XPRD01 = 'Widget Pro V2',\n    TREC = 'M',\n    LDATA = '20251219160000',\n    LOWNER = 'admin@example.com'\nWHERE PRD_ID = 123;\n\n-- 2. Update all related order items (cascade)\nUPDATE TB_ANAG_ORDITEM00\nSET XORDITEM_PRODUCT_NAME = 'Widget Pro V2',\n    TREC = 'M',\n    LDATA = '20251219160000',\n    LOWNER = 'admin@example.com'\nWHERE XORDITEM10 = 123;\n\n-- 3. Insert outbox events\nINSERT INTO OUTBOX (...) VALUES (...);\n\nCOMMIT;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,s.jsx)(n.strong,{children:"Caution:"})," UPDATE_CASCADE affects ALL related records. Use carefully for fields like price (you may NOT want to update historical orders)."]}),"\n",(0,s.jsx)(n.h3,{id:"conditional-cascades",children:"Conditional Cascades"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Only cascade to active records:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Only update active order items (not completed orders)\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, UPDATE_CASCADE)\nVALUES ('PRD', 1, 'XPRD01', 'ORDITEM:XORDITEM_PRODUCT_NAME:WHERE XORDITEM_STATUS=''pending''');\n"})}),"\n",(0,s.jsx)(n.h2,{id:"delete_cascade",children:"DELETE_CASCADE"}),"\n",(0,s.jsx)(n.h3,{id:"metadata-configuration-2",children:"Metadata Configuration"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TB_COST.DELETE_CASCADE defines automatic deletion:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- When order is deleted, also delete order items\nINSERT INTO TB_COST (\n    COD_DIM,\n    NUM_COST,\n    COD_VAR,\n    DELETE_CASCADE,\n    DESCRIZIONE_COST\n) VALUES (\n    'ORD',  -- Source dimension\n    10,     -- Field position\n    'items',  -- Relationship name\n    'ORDITEM:XORDITEM_ORDER_ID:soft',  -- Target:ForeignKey:Mode\n    'Order items'\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Format:"})," ",(0,s.jsx)(n.code,{children:"TargetDimension:ForeignKeyField:Mode"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"TargetDimension"}),": Dimension to delete from (ORDITEM)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ForeignKeyField"}),": Field linking to parent (XORDITEM_ORDER_ID)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Mode"}),": ",(0,s.jsx)(n.code,{children:"soft"})," (TREC='C') or ",(0,s.jsx)(n.code,{children:"force"})," (physical delete)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"soft-delete-cascade",children:"Soft Delete Cascade"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"DELETE /api/v4/core/ORD/123\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Generated SQL (soft delete):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"BEGIN TRANSACTION;\n\n-- 1. Soft delete order\nUPDATE TB_ANAG_ORD00\nSET TREC = 'C',\n    LDATA = '20251219160000',\n    LOWNER = 'admin@example.com'\nWHERE ORD_ID = 123;\n\n-- 2. Soft delete all order items (cascade)\nUPDATE TB_ANAG_ORDITEM00\nSET TREC = 'C',\n    LDATA = '20251219160000',\n    LOWNER = 'admin@example.com'\nWHERE XORDITEM_ORDER_ID = 123;\n\n-- 3. Insert outbox events\nINSERT INTO OUTBOX (...) VALUES (...);\n\nCOMMIT;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"force-delete-cascade",children:"Force Delete Cascade"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"DELETE /api/v4/core/ORD/123?force=true\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Generated SQL (force delete):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"BEGIN TRANSACTION;\n\n-- 1. Force delete all order items (cascade)\nDELETE FROM TB_ANAG_ORDITEM00\nWHERE XORDITEM_ORDER_ID = 123;\n\n-- 2. Force delete order\nDELETE FROM TB_ANAG_ORD00\nWHERE ORD_ID = 123;\n\n-- 3. Insert outbox events\nINSERT INTO OUTBOX (...) VALUES (...);\n\nCOMMIT;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Cascade deletes happen BEFORE parent delete to satisfy foreign key constraints."]}),"\n",(0,s.jsx)(n.h2,{id:"common-cascade-patterns",children:"Common Cascade Patterns"}),"\n",(0,s.jsxs)(n.h3,{id:"pattern-1-master-detail-1",children:["Pattern 1: Master-Detail (1",":N",")"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Order \u2192 Order Items using INSERT_CASCADE:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// Request body with metadata configuration\n{\n  "XORD01": "ORD-2025-001",\n  "XORD_CUSTOMER_ID": "cust_123",\n  "metadata": {\n    "INSERT_CASCADE": {\n      "ORDITEM": {\n        "replace": {\n          "XORDITEM_ORDER_ID": "ORD_ID"\n        },\n        "body": [\n          { "XORDITEM10": "prd_1", "XORDITEM_QTY": 2 },\n          { "XORDITEM10": "prd_2", "XORDITEM_QTY": 1 }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"pattern-2-parent-child-hierarchy",children:"Pattern 2: Parent-Child Hierarchy"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Category \u2192 Subcategories using INSERT_CASCADE:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'{\n  "XCAT_NAME": "Electronics",\n  "metadata": {\n    "INSERT_CASCADE": {\n      "CAT": {\n        "replace": {\n          "XCAT_PARENT_ID": "CAT_ID"\n        },\n        "body": [\n          { "XCAT_NAME": "Mobile Phones" },\n          { "XCAT_NAME": "Laptops" },\n          { "XCAT_NAME": "Accessories" }\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"javascript-examples",children:"JavaScript Examples"}),"\n",(0,s.jsx)(n.h3,{id:"create-with-cascades",children:"Create with Cascades"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"async function createOrderWithItems(orderData, items) {\n  const response = await fetch(`${apiBase}/api/v4/core/ORD`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify([{\n      ...orderData,\n      metadata: {\n        INSERT_CASCADE: {\n          ORDITEM: {\n            replace: {\n              XORDITEM_ORDER_ID: 'ORD_ID'\n            },\n            body: items\n          }\n        }\n      }\n    }])\n  });\n\n  const result = await response.json();\n  console.log('Order created:', result[0].insertedId);\n  console.log('Counter:', result[0].counter);\n  console.log('Items created:', result[0].INSERT_CASCADE.ORDITEM.length);\n\n  return result;\n}\n\n// Usage\nawait createOrderWithItems(\n  {\n    source: 'my-app',\n    XORD_CUSTOMER_ID: 'cust_123',\n    XORD03: 299.97\n  },\n  [\n    { XORDITEM10: 'prd_1', XORDITEM_QTY: 2, XORDITEM09: 99.99 },\n    { XORDITEM10: 'prd_2', XORDITEM_QTY: 1, XORDITEM09: 99.99 }\n  ]\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"update-with-cascades",children:"Update with Cascades"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"async function updateProductName(productId, newName) {\n  // Update propagates to all order items automatically\n  const response = await fetch(`${apiBase}/api/v4/core/PRD/${productId}`, {\n    method: 'PATCH',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      data: { XPRD01: newName }\n    })\n  });\n\n  const result = await response.json();\n  console.log('Product updated:', result.data.PRD_ID);\n  // Cascade updates happen automatically in transaction\n\n  return result;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"delete-with-cascades",children:"Delete with Cascades"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"async function deleteOrderWithItems(orderId) {\n  // Soft delete cascades to all items automatically\n  const response = await fetch(`${apiBase}/api/v4/core/ORD/${orderId}`, {\n    method: 'DELETE',\n    headers: { 'Authorization': `Bearer ${token}` }\n  });\n\n  const result = await response.json();\n  console.log('Order soft deleted:', orderId);\n  // All items also soft deleted (TREC='C')\n\n  return result;\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use INSERT_CASCADE for master-detail:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:'// \u2705 Good - single request creates order + items\n{\n  "XORD01": "ORD-2025-001",\n  "metadata": {\n    "INSERT_CASCADE": {\n      "ORDITEM": {\n        "replace": { "XORDITEM_ORDER_ID": "ORD_ID" },\n        "body": [/* items */]\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use soft DELETE_CASCADE by default:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - reversible\nDELETE_CASCADE = 'ORDITEM:XORDITEM_ORDER_ID:soft'\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Be selective with UPDATE_CASCADE:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - only reference data\nUPDATE_CASCADE = 'ORDITEM:XORDITEM_PRODUCT_NAME'  -- Product name\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't cascade updates for transactional fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - changes historical orders\nUPDATE_CASCADE = 'ORDITEM:XORDITEM09'  -- Product price\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't use force DELETE_CASCADE without reason:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - irreversible\nDELETE_CASCADE = 'ORDITEM:XORDITEM_ORDER_ID:force'\n\n-- \u2705 Good - soft delete first\nDELETE_CASCADE = 'ORDITEM:XORDITEM_ORDER_ID:soft'\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't create circular cascades:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - infinite loop\n-- Order cascades to Items, Items cascade back to Order\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"cascade-performance",children:"Cascade Performance"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Large cascades impact transaction time:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Order with 1 item:    ~10ms\nOrder with 10 items:  ~50ms\nOrder with 100 items: ~500ms\nOrder with 1000 items: ~5s\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Optimization strategies:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Batch inserts when possible"}),"\n",(0,s.jsx)(n.li,{children:"Use database batch operations"}),"\n",(0,s.jsx)(n.li,{children:"Consider async processing for large cascades"}),"\n",(0,s.jsx)(n.li,{children:"Monitor transaction duration"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"indexing-for-cascades",children:"Indexing for Cascades"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Index foreign key fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - fast cascade lookups\nCREATE INDEX idx_orditem_order_id ON TB_ANAG_ORDITEM00(XORDITEM_ORDER_ID);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 INSERT_CASCADE creates related records automatically"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 UPDATE_CASCADE propagates changes to related records"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 DELETE_CASCADE deletes related records (soft or force)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 INS_UP_DUPVAL_CASCADE provides INSERT with ON DUPLICATE KEY UPDATE behavior"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 DELETE_BYID_CASCADE deletes related records by specific ID"}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 Configured via ",(0,s.jsx)(n.code,{children:"metadata"})," field in request body"]}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Transactional (ACID guarantees)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Single API call for complex operations"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Reduces N+1 query problems"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["INSERT_CASCADE configured via ",(0,s.jsx)(n.code,{children:"metadata"})," field in request body"]}),"\n",(0,s.jsx)(n.li,{children:"All cascade operations are transactional"}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"replace"})," mapping to link parent fields to child fields"]}),"\n",(0,s.jsx)(n.li,{children:"Child records created in same transaction as parent"}),"\n",(0,s.jsx)(n.li,{children:"Works with counter fields and pre-insert functions"}),"\n",(0,s.jsx)(n.li,{children:"Single-level cascades only (no nested cascades)"}),"\n",(0,s.jsx)(n.li,{children:"Soft delete cascade is default (reversible)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cascade Types:"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Cascade Type"}),(0,s.jsx)(n.th,{children:"Purpose"}),(0,s.jsx)(n.th,{children:"Configuration"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"INSERT_CASCADE"}),(0,s.jsx)(n.td,{children:"Create related records"}),(0,s.jsxs)(n.td,{children:["Via ",(0,s.jsx)(n.code,{children:"metadata"})," in request body"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"UPDATE_CASCADE"}),(0,s.jsx)(n.td,{children:"Update related records"}),(0,s.jsxs)(n.td,{children:["Via ",(0,s.jsx)(n.code,{children:"metadata"})," in request body"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DELETE_CASCADE"}),(0,s.jsx)(n.td,{children:"Delete related records"}),(0,s.jsxs)(n.td,{children:["Via ",(0,s.jsx)(n.code,{children:"metadata"})," in request body"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"INS_UP_DUPVAL_CASCADE"}),(0,s.jsx)(n.td,{children:"INSERT or UPDATE on duplicate"}),(0,s.jsxs)(n.td,{children:["Via ",(0,s.jsx)(n.code,{children:"metadata"})," in request body"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DELETE_BYID_CASCADE"}),(0,s.jsx)(n.td,{children:"Delete by specific ID"}),(0,s.jsxs)(n.td,{children:["Via ",(0,s.jsx)(n.code,{children:"metadata"})," in request body"]})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Next:"})," ",(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/outbox-pattern",children:"Outbox Pattern \u2192"})]}),"\n",(0,s.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/create-operations",children:"Create Operations"})," - INSERT_CASCADE"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/update-operations",children:"Update Operations"})," - UPDATE_CASCADE"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/delete-operations",children:"Delete Operations"})," - DELETE_CASCADE"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/transactions",children:"Transactions"})," - ACID guarantees"]}),"\n"]})]})}function T(e={}){const{wrapper:n}={...(0,a.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>i,M:()=>d});var s=r(1504);const a={},t=s.createContext(a);function d(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);