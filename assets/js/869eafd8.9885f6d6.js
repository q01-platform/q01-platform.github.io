"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[8950],{4840:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>d,toc:()=>o});var t=r(7624),s=r(2172);const i={title:"Update Operations",sidebar_label:"Update Operations (PUT)",sidebar_position:3,description:"Full record updates with PUT operations"},a="Update Operations (PUT)",d={id:"products/map.q01.io/core-api-platform-v4/write-patterns/update-operations",title:"Update Operations",description:"Full record updates with PUT operations",source:"@site/docs/products/map.q01.io/core-api-platform-v4/04-write-patterns/update-operations.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/04-write-patterns",slug:"/products/map.q01.io/core-api-platform-v4/write-patterns/update-operations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/update-operations",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Update Operations",sidebar_label:"Update Operations (PUT)",sidebar_position:3,description:"Full record updates with PUT operations"},sidebar:"mapSidebar",previous:{title:"Create Operations (POST)",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/create-operations"},next:{title:"Partial Updates (PATCH)",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/partial-updates"}},c={},o=[{value:"Overview",id:"overview",level:2},{value:"Basic PUT Request",id:"basic-put-request",level:2},{value:"Full Record Update",id:"full-record-update",level:3},{value:"TREC State Transition",id:"trec-state-transition",level:2},{value:"Lifecycle Changes",id:"lifecycle-changes",level:3},{value:"PUT vs PATCH",id:"put-vs-patch",level:2},{value:"Key Differences",id:"key-differences",level:3},{value:"PUT Overwrites Fields",id:"put-overwrites-fields",level:3},{value:"COD_ON_OFF Validation",id:"cod_on_off-validation",level:2},{value:"Modify Permission",id:"modify-permission",level:3},{value:"UPDATE_CASCADE Operations",id:"update_cascade-operations",level:2},{value:"Propagating Updates",id:"propagating-updates",level:3},{value:"Outbox Event",id:"outbox-event",level:2},{value:"Update Event Publication",id:"update-event-publication",level:3},{value:"JavaScript Implementation",id:"javascript-implementation",level:2},{value:"Product Update Service",id:"product-update-service",level:3},{value:"Update with Optimistic Locking",id:"update-with-optimistic-locking",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Pattern 1: Read-Modify-Write",id:"pattern-1-read-modify-write",level:3},{value:"Pattern 2: Bulk Update",id:"pattern-2-bulk-update",level:3},{value:"Pattern 3: Conditional Update",id:"pattern-3-conditional-update",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"update-operations-put",children:"Update Operations (PUT)"}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"PUT"})," operations perform full record updates, replacing ALL field values. CoreService routes PUT requests to CoreWrite, which validates, updates TREC state, executes cascades, and publishes events."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Endpoint:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"PUT /api/v4/core/{dim}/{dim_id}\nContent-Type: application/json\nAuthorization: Bearer {token}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Sets TREC='M' (Modified)"}),"\n",(0,t.jsx)(n.li,{children:"Sets LDATA, LOWNER (last update audit fields)"}),"\n",(0,t.jsx)(n.li,{children:"Replaces ALL fields in request body"}),"\n",(0,t.jsx)(n.li,{children:"Validates COD_ON_OFF='M' permissions"}),"\n",(0,t.jsx)(n.li,{children:"Executes UPDATE_CASCADE operations"}),"\n",(0,t.jsx)(n.li,{children:"Publishes update event to outbox"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,t.jsx)(n.strong,{children:"Warning:"})," PUT replaces entire record. Use PATCH for partial updates."]}),"\n",(0,t.jsx)(n.h2,{id:"basic-put-request",children:"Basic PUT Request"}),"\n",(0,t.jsx)(n.h3,{id:"full-record-update",children:"Full Record Update"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'PUT /api/v4/core/PRD/123\nAuthorization: Bearer eyJhbGc...\nContent-Type: application/json\n\n{\n  "data": {\n    "XPRD01": "Widget Pro Updated",\n    "XPRD02": 109.99,\n    "XPRD04": "Updated description",\n    "XPRD05": "cat_electronics",\n    "XPRD06": true,\n    "XPRD09": 150\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "data": {\n    "PRD_ID": 123,\n    "XPRD01": "Widget Pro Updated",\n    "XPRD02": 109.99,\n    "XPRD03": "PRD-2025-001",  // Unchanged\n    "XPRD04": "Updated description",\n    "XPRD05": "cat_electronics",\n    "XPRD06": true,\n    "XPRD09": 150,\n    "TREC": "M",  // Changed from \'N\' to \'M\'\n    "CDATA": "20251219153045",  // Original creation time\n    "OWNER": "user@example.com",  // Original creator\n    "LDATA": "20251219160000",  // Last update timestamp\n    "LOWNER": "admin@example.com"  // Last updater\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"trec-state-transition",children:"TREC State Transition"}),"\n",(0,t.jsx)(n.h3,{id:"lifecycle-changes",children:"Lifecycle Changes"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"POST \u2192 PUT Transition:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"TREC='N' (New)\n    \u2193 PUT request\nTREC='M' (Modified)\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Database Update:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Before PUT\nSELECT TREC, CDATA, OWNER, LDATA, LOWNER\nFROM TB_ANAG_PRD00\nWHERE PRD_ID = 123;\n-- Result: 'N', '20251219153045', 'user@example.com', NULL, NULL\n\n-- After PUT\nSELECT TREC, CDATA, OWNER, LDATA, LOWNER\nFROM TB_ANAG_PRD00\nWHERE PRD_ID = 123;\n-- Result: 'M', '20251219153045', 'user@example.com', '20251219160000', 'admin@example.com'\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Audit Trail:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"CDATA/OWNER: Preserved (original creation info)"}),"\n",(0,t.jsx)(n.li,{children:"LDATA/LOWNER: Updated (last modification info)"}),"\n",(0,t.jsx)(n.li,{children:"TREC: Changed to 'M'"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"put-vs-patch",children:"PUT vs PATCH"}),"\n",(0,t.jsx)(n.h3,{id:"key-differences",children:"Key Differences"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Aspect"}),(0,t.jsx)(n.th,{children:"PUT"}),(0,t.jsx)(n.th,{children:"PATCH"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Fields"})}),(0,t.jsx)(n.td,{children:"Replaces ALL fields"}),(0,t.jsx)(n.td,{children:"Updates ONLY specified fields"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Missing fields"})}),(0,t.jsx)(n.td,{children:"Set to NULL/default"}),(0,t.jsx)(n.td,{children:"Unchanged"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Use case"})}),(0,t.jsx)(n.td,{children:"Full record replacement"}),(0,t.jsx)(n.td,{children:"Partial field updates"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Safety"})}),(0,t.jsx)(n.td,{children:"\u26a0\ufe0f Can lose data"}),(0,t.jsx)(n.td,{children:"\u2705 Safe for single field updates"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"put-overwrites-fields",children:"PUT Overwrites Fields"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Original record:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "PRD_ID": 123,\n  "XPRD01": "Widget Pro",\n  "XPRD02": 99.99,\n  "XPRD04": "Original description",\n  "XPRD05": "cat_electronics",\n  "XPRD06": true,\n  "XPRD09": 100\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"PUT request (missing XPRD04):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'PUT /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD01": "Widget Pro",\n    "XPRD02": 109.99,\n    "XPRD05": "cat_electronics",\n    "XPRD06": true,\n    "XPRD09": 150\n    // Missing XPRD04\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "PRD_ID": 123,\n  "XPRD01": "Widget Pro",\n  "XPRD02": 109.99,\n  "XPRD04": null,  // \u26a0\ufe0f CLEARED because not in request\n  "XPRD05": "cat_electronics",\n  "XPRD06": true,\n  "XPRD09": 150,\n  "TREC": "M"\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,t.jsx)(n.strong,{children:"XPRD04 was cleared!"})," Use PATCH to avoid this."]}),"\n",(0,t.jsx)(n.h2,{id:"cod_on_off-validation",children:"COD_ON_OFF Validation"}),"\n",(0,t.jsx)(n.h3,{id:"modify-permission",children:"Modify Permission"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"TB_COST.COD_ON_OFF must include 'M' flag for PUT:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- XPRD01 can be updated (M flag present)\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, COD_ON_OFF) VALUES\n('PRD', 1, 'XPRD01', 'LDNMR');\n\n-- XPRD03 cannot be updated (M flag missing)\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, COD_ON_OFF) VALUES\n('PRD', 3, 'XPRD03', 'LDR');  -- No 'M' flag (counter, read-only)\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Validation Error:"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'PUT /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD01": "Product",\n    "XPRD03": "PRD-2025-999"  // Read-only counter\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "error": "ValidationError",\n  "message": "Field not modifiable: XPRD03",\n  "code": "FIELD_NOT_MODIFIABLE",\n  "field": "XPRD03",\n  "dimension": "PRD"\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"update_cascade-operations",children:"UPDATE_CASCADE Operations"}),"\n",(0,t.jsx)(n.h3,{id:"propagating-updates",children:"Propagating Updates"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"TB_COST.UPDATE_CASCADE triggers related record updates:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- When product price changes, update all order items\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, UPDATE_CASCADE) VALUES\n('PRD', 2, 'XPRD02', 'ORDITEM:XORDITEM09');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Cascade Behavior:"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'PUT /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD01": "Widget Pro",\n    "XPRD02": 89.99  // Price changed from 99.99\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Updates product\nUPDATE TB_ANAG_PRD00\nSET XPRD02 = 89.99, TREC = 'M', LDATA = '20251219160000'\nWHERE PRD_ID = 123;\n\n-- Cascades to order items (if configured)\nUPDATE TB_ANAG_ORDITEM00\nSET XORDITEM09 = 89.99, TREC = 'M', LDATA = '20251219160000'\nWHERE XORDITEM10 = 123;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,t.jsx)(n.strong,{children:"Cascade caution:"})," Use cascades carefully. Updating product price may NOT want to change historical orders."]}),"\n",(0,t.jsx)(n.h2,{id:"outbox-event",children:"Outbox Event"}),"\n",(0,t.jsx)(n.h3,{id:"update-event-publication",children:"Update Event Publication"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Every PUT publishes event to RabbitMQ:"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Outbox Record:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "event_id": "evt_660f9511",\n  "event_type": "ProductUpdated",\n  "aggregate_id": "123",\n  "aggregate_type": "PRD",\n  "operation": "PUT",\n  "timestamp": "2025-12-19T16:00:00Z",\n  "payload": {\n    "PRD_ID": 123,\n    "XPRD01": "Widget Pro Updated",\n    "XPRD02": 109.99,\n    "TREC": "M"\n  },\n  "previous_payload": {\n    "XPRD01": "Widget Pro",\n    "XPRD02": 99.99\n  },\n  "user": "admin@example.com",\n  "session": {\n    "source": "productManagement",\n    "centro_dett": "admin"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"RabbitMQ Exchange:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Exchange: corewrite.fanout\nRouting Key: product.updated\nSubscribers: search-indexer, cache-invalidator, price-change-notifier\n"})}),"\n",(0,t.jsx)(n.h2,{id:"javascript-implementation",children:"JavaScript Implementation"}),"\n",(0,t.jsx)(n.h3,{id:"product-update-service",children:"Product Update Service"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class ProductService {\n  constructor(apiBase, token) {\n    this.apiBase = apiBase;\n    this.token = token;\n  }\n\n  /**\n   * Full record update (PUT)\n   */\n  async updateProduct(productId, productData) {\n    const response = await fetch(`${this.apiBase}/api/v4/core/PRD/${productId}`, {\n      method: 'PUT',\n      headers: {\n        'Authorization': `Bearer ${this.token}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ data: productData })\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new ProductUpdateError(error);\n    }\n\n    return response.json();\n  }\n\n  /**\n   * Safe update - fetches current, merges changes, then PUTs\n   */\n  async safeUpdate(productId, changes) {\n    // 1. Fetch current record\n    const current = await this.getProduct(productId);\n\n    // 2. Merge changes\n    const updated = { ...current.data, ...changes };\n\n    // 3. PUT full record\n    const result = await this.updateProduct(productId, updated);\n\n    console.log('Product updated:', result.data.PRD_ID);\n    console.log('TREC changed to:', result.data.TREC);\n\n    return result;\n  }\n\n  /**\n   * Get product by ID\n   */\n  async getProduct(productId) {\n    const response = await fetch(`${this.apiBase}/api/v4/core/PRD/${productId}`, {\n      headers: { 'Authorization': `Bearer ${this.token}` }\n    });\n\n    return response.json();\n  }\n}\n\nclass ProductUpdateError extends Error {\n  constructor(errorResponse) {\n    super(errorResponse.message);\n    this.code = errorResponse.code;\n    this.field = errorResponse.field;\n  }\n}\n\n// Usage\nconst productService = new ProductService(apiBase, token);\n\n// \u274c Unsafe - might lose fields\nawait productService.updateProduct(123, {\n  XPRD01: 'Updated Name',\n  XPRD02: 109.99\n  // Missing other fields!\n});\n\n// \u2705 Safe - merges with current data\nawait productService.safeUpdate(123, {\n  XPRD02: 109.99  // Only change price\n});\n"})}),"\n",(0,t.jsx)(n.h3,{id:"update-with-optimistic-locking",children:"Update with Optimistic Locking"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class ProductService {\n  /**\n   * Update with version check (optimistic locking)\n   */\n  async updateWithVersionCheck(productId, changes, expectedVersion) {\n    // 1. Fetch current record\n    const current = await this.getProduct(productId);\n\n    // 2. Check version\n    if (current.data.LDATA !== expectedVersion) {\n      throw new Error('Record was modified by another user. Please refresh and try again.');\n    }\n\n    // 3. Merge and update\n    const updated = { ...current.data, ...changes };\n    return this.updateProduct(productId, updated);\n  }\n}\n\n// Usage\nconst product = await productService.getProduct(123);\nconst version = product.data.LDATA;  // \"20251219153045\"\n\n// ... user makes changes ...\n\ntry {\n  await productService.updateWithVersionCheck(123, {\n    XPRD02: 109.99\n  }, version);\n} catch (error) {\n  alert('Record was modified by another user');\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"pattern-1-read-modify-write",children:"Pattern 1: Read-Modify-Write"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Safe pattern for full updates:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"async function updateProductPrice(productId, newPrice) {\n  // 1. Read current\n  const response = await fetch(`${apiBase}/api/v4/core/PRD/${productId}`, {\n    headers: { 'Authorization': `Bearer ${token}` }\n  });\n  const current = await response.json();\n\n  // 2. Modify\n  const updated = {\n    ...current.data,\n    XPRD02: newPrice\n  };\n\n  // 3. Write\n  const result = await fetch(`${apiBase}/api/v4/core/PRD/${productId}`, {\n    method: 'PUT',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ data: updated })\n  });\n\n  return result.json();\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pattern-2-bulk-update",children:"Pattern 2: Bulk Update"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Update multiple records:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"async function bulkUpdateCategory(productIds, newCategory) {\n  const updates = productIds.map(async (id) => {\n    // Fetch current\n    const response = await fetch(`${apiBase}/api/v4/core/PRD/${id}`, {\n      headers: { 'Authorization': `Bearer ${token}` }\n    });\n    const current = await response.json();\n\n    // Update category\n    const updated = {\n      ...current.data,\n      XPRD05: newCategory\n    };\n\n    // PUT\n    return fetch(`${apiBase}/api/v4/core/PRD/${id}`, {\n      method: 'PUT',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ data: updated })\n    });\n  });\n\n  return Promise.all(updates);\n}\n\n// Usage\nawait bulkUpdateCategory([123, 124, 125], 'cat_electronics');\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pattern-3-conditional-update",children:"Pattern 3: Conditional Update"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Update only if condition met:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"async function updatePriceIfBelowThreshold(productId, newPrice, threshold) {\n  // Fetch current\n  const response = await fetch(`${apiBase}/api/v4/core/PRD/${productId}`, {\n    headers: { 'Authorization': `Bearer ${token}` }\n  });\n  const current = await response.json();\n\n  // Check condition\n  if (current.data.XPRD02 >= threshold) {\n    throw new Error(`Price ${current.data.XPRD02} is above threshold ${threshold}`);\n  }\n\n  // Update\n  const updated = {\n    ...current.data,\n    XPRD02: newPrice\n  };\n\n  const result = await fetch(`${apiBase}/api/v4/core/PRD/${productId}`, {\n    method: 'PUT',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ data: updated })\n  });\n\n  return result.json();\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Fetch before PUT (read-modify-write):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - safe update\nconst current = await getProduct(123);\nconst updated = { ...current.data, XPRD02: 109.99 };\nawait updateProduct(123, updated);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use PATCH instead for partial updates:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u2705 Good - use PATCH for single field\nPATCH /api/v4/core/PRD/123\n{ "data": { "XPRD02": 109.99 } }\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Handle concurrent modifications:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - version check\nif (current.LDATA !== expectedVersion) {\n  throw new Error('Record modified by another user');\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Include all fields in PUT:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u2705 Good - complete record\nPUT /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD01": "...",\n    "XPRD02": "...",\n    "XPRD04": "...",\n    "XPRD05": "...",\n    "XPRD06": "..."\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't PUT without reading first:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u274c Bad - might lose fields\nPUT /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD02": 109.99\n    // Missing other fields \u2192 they\'ll be cleared!\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't use PUT for single field updates:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u274c Bad - use PATCH instead\nPUT /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD01": "...",\n    "XPRD02": 109.99,  // Only changing this\n    "XPRD04": "...",\n    "XPRD05": "...",\n    "XPRD06": "..."\n  }\n}\n\n// \u2705 Good\nPATCH /api/v4/core/PRD/123\n{ "data": { "XPRD02": 109.99 } }\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't ignore concurrent modifications:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - last write wins (data loss)\nawait updateProduct(123, data1);  // User A\nawait updateProduct(123, data2);  // User B (overwrites A's changes)\n\n// \u2705 Good - version check\nawait updateWithVersionCheck(123, data, expectedVersion);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 PUT performs full record updates, sets TREC='M'"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Replaces ALL fields - missing fields set to NULL/default"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Use PATCH for partial updates (safer)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 COD_ON_OFF='M' flag required for field to be modifiable"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 UPDATE_CASCADE propagates changes to related records"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Always fetch-modify-write to avoid data loss"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Outbox event published to RabbitMQ"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"PUT replaces entire record - use carefully"}),"\n",(0,t.jsx)(n.li,{children:"Fetch current record before PUT (read-modify-write pattern)"}),"\n",(0,t.jsx)(n.li,{children:"Use PATCH for single field updates"}),"\n",(0,t.jsx)(n.li,{children:"Check COD_ON_OFF='M' flag for modifiable fields"}),"\n",(0,t.jsx)(n.li,{children:"Handle concurrent modifications with version checks"}),"\n",(0,t.jsx)(n.li,{children:"TREC automatically transitions to 'M'"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Next:"})," ",(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/partial-updates",children:"Partial Updates \u2192"})," for safer field updates"]}),"\n",(0,t.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/partial-updates",children:"Partial Updates"})," - PATCH operations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/trec-filtering",children:"TREC Filtering"})," - Query by TREC state"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/entity-lifecycle",children:"Entity Lifecycle"})," - TREC state machine"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/field-visibility",children:"Field Visibility"})," - COD_ON_OFF flags"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>d,M:()=>a});var t=r(1504);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);