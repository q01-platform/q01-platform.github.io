"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[8096],{5284:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var t=r(7624),a=r(2172);const i={title:"Create Operations",sidebar_label:"Create Operations (POST)",sidebar_position:2,description:"Creating new records with POST operations"},s="Create Operations (POST)",o={id:"products/map.q01.io/core-api-platform-v4/write-patterns/create-operations",title:"Create Operations",description:"Creating new records with POST operations",source:"@site/docs/products/map.q01.io/core-api-platform-v4/04-write-patterns/create-operations.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/04-write-patterns",slug:"/products/map.q01.io/core-api-platform-v4/write-patterns/create-operations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/create-operations",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Create Operations",sidebar_label:"Create Operations (POST)",sidebar_position:2,description:"Creating new records with POST operations"},sidebar:"mapSidebar",previous:{title:"Write Patterns",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/"},next:{title:"Update Operations (PUT)",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/update-operations"}},d={},c=[{value:"Overview",id:"overview",level:2},{value:"Basic POST Request",id:"basic-post-request",level:2},{value:"Simple Record Creation",id:"simple-record-creation",level:3},{value:"Automatic Field Population",id:"automatic-field-population",level:2},{value:"Pre-Insert Functions",id:"pre-insert-functions",level:3},{value:"UUID Generation",id:"uuid-generation",level:4},{value:"Counter Generation",id:"counter-generation",level:4},{value:"MD5 Hash",id:"md5-hash",level:4},{value:"Timestamp",id:"timestamp",level:4},{value:"Slugify",id:"slugify",level:4},{value:"Required Field Validation",id:"required-field-validation",level:2},{value:"Validation Rules",id:"validation-rules",level:3},{value:"Validation Errors",id:"validation-errors",level:3},{value:"COD_ON_OFF Validation",id:"cod_on_off-validation",level:2},{value:"Create Permission",id:"create-permission",level:3},{value:"INSERT_CASCADE Operations",id:"insert_cascade-operations",level:2},{value:"Master-Detail Creation",id:"master-detail-creation",level:3},{value:"Outbox Event",id:"outbox-event",level:2},{value:"Event Publication",id:"event-publication",level:3},{value:"JavaScript Implementation",id:"javascript-implementation",level:2},{value:"Product Creation Service",id:"product-creation-service",level:3},{value:"Master-Detail Creation",id:"master-detail-creation-1",level:3},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Pattern 1: Simple Create",id:"pattern-1-simple-create",level:3},{value:"Pattern 2: Create with Auto-Generated Fields",id:"pattern-2-create-with-auto-generated-fields",level:3},{value:"Pattern 3: Create with Validation",id:"pattern-3-create-with-validation",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"create-operations-post",children:"Create Operations (POST)"}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"POST"})," operations create new records in dimensions. CoreService routes POST requests to CoreWrite, which validates, populates automatic fields, executes cascades, and publishes events."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Endpoint:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"POST /api/v4/core/{dim}\nContent-Type: application/json\nAuthorization: Bearer {token}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Sets TREC='N' (New)"}),"\n",(0,t.jsx)(n.li,{children:"Sets CDATA, OWNER (audit fields)"}),"\n",(0,t.jsx)(n.li,{children:"Executes pre-insert functions (uuid, counter, md5, etc.)"}),"\n",(0,t.jsx)(n.li,{children:"Validates required fields"}),"\n",(0,t.jsx)(n.li,{children:"Validates COD_ON_OFF='N' permissions"}),"\n",(0,t.jsx)(n.li,{children:"Executes INSERT_CASCADE operations"}),"\n",(0,t.jsx)(n.li,{children:"Publishes creation event to outbox"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"basic-post-request",children:"Basic POST Request"}),"\n",(0,t.jsx)(n.h3,{id:"simple-record-creation",children:"Simple Record Creation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/PRD\nAuthorization: Bearer eyJhbGc...\nContent-Type: application/json\n\n{\n  "data": {\n    "XPRD01": "Widget Pro",\n    "XPRD02": 99.99,\n    "XPRD04": "Professional widget with advanced features",\n    "XPRD05": "cat_electronics",\n    "XPRD06": true,\n    "XPRD09": 100\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "data": {\n    "PRD_ID": 123,\n    "XPRD01": "Widget Pro",\n    "XPRD02": 99.99,\n    "XPRD03": "PRD-2025-001",  // Auto-generated counter\n    "XPRD04": "Professional widget with advanced features",\n    "XPRD05": "cat_electronics",\n    "XPRD06": true,\n    "XPRD09": 100,\n    "TREC": "N",  // Automatically set\n    "CDATA": "20251219153045",  // Creation timestamp\n    "OWNER": "user@example.com"  // Creator\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"automatic-field-population",children:"Automatic Field Population"}),"\n",(0,t.jsx)(n.h3,{id:"pre-insert-functions",children:"Pre-Insert Functions"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"TB_COST.VALUE_TEMP defines automatic field population:"})}),"\n",(0,t.jsx)(n.h4,{id:"uuid-generation",children:"UUID Generation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Metadata:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, VALUE_TEMP) VALUES\n('PRD', 1, 'PRD_ID', '{uuid}');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'POST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD01": "Product Name"\n    // PRD_ID auto-populated: "550e8400-e29b-41d4-a716-446655440000"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"counter-generation",children:"Counter Generation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Metadata:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, VALUE_TEMP) VALUES\n('PRD', 3, 'XPRD03', '{counter:PRD-{YYYY}-{NNN}}');\n\nINSERT INTO TB_COUNTER (COD_DIM, COD_VAR, COUNTER_VALUE, FORMAT_MASK) VALUES\n('PRD', 'XPRD03', 0, 'PRD-{YYYY}-{NNN}');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'POST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD01": "Product Name"\n    // XPRD03 auto-populated: "PRD-2025-001"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Format Tokens:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{YYYY}"})," - 4-digit year (2025)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{YY}"})," - 2-digit year (25)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{MM}"})," - 2-digit month (12)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{DD}"})," - 2-digit day (19)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{NNN}"})," - Sequential number with padding (001, 002, ...)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{N}"})," - Sequential number without padding (1, 2, ...)"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"md5-hash",children:"MD5 Hash"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Metadata:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, VALUE_TEMP) VALUES\n('USR', 5, 'XUSR05', '{md5:XUSR02}');  -- Hash password field\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'POST /api/v4/core/USR\n{\n  "data": {\n    "XUSR01": "john.doe",\n    "XUSR02": "mypassword123"\n    // XUSR05 auto-populated: "5f4dcc3b5aa765d61d8327deb882cf99"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"timestamp",children:"Timestamp"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Metadata:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, VALUE_TEMP) VALUES\n('LOG', 3, 'XLOG03', '{timestamp}');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'POST /api/v4/core/LOG\n{\n  "data": {\n    "XLOG01": "Action performed"\n    // XLOG03 auto-populated: "20251219153045"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"slugify",children:"Slugify"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Metadata:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, VALUE_TEMP) VALUES\n('PRD', 10, 'XPRD10', '{slugify:XPRD01}');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'POST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD01": "Widget Pro 2025!"\n    // XPRD10 auto-populated: "widget-pro-2025"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"required-field-validation",children:"Required Field Validation"}),"\n",(0,t.jsx)(n.h3,{id:"validation-rules",children:"Validation Rules"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"TB_COST.REQUIRED='1' marks mandatory fields:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, REQUIRED) VALUES\n('PRD', 1, 'XPRD01', 1),  -- Name required\n('PRD', 5, 'XPRD05', 1);  -- Category required\n"})}),"\n",(0,t.jsx)(n.h3,{id:"validation-errors",children:"Validation Errors"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Missing required field:"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD02": 99.99\n    // Missing XPRD01 (required)\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "error": "ValidationError",\n  "message": "Required field missing: XPRD01",\n  "code": "REQUIRED_FIELD_MISSING",\n  "field": "XPRD01",\n  "dimension": "PRD"\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"cod_on_off-validation",children:"COD_ON_OFF Validation"}),"\n",(0,t.jsx)(n.h3,{id:"create-permission",children:"Create Permission"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"TB_COST.COD_ON_OFF must include 'N' flag for POST:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- XPRD01 can be set on creation (N flag present)\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, COD_ON_OFF) VALUES\n('PRD', 1, 'XPRD01', 'LDNMR');\n\n-- XPRD12 cannot be set on creation (N flag missing)\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, COD_ON_OFF) VALUES\n('PRD', 12, 'XPRD12', 'LDM');  -- No 'N' flag\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Validation Error:"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD01": "Product",\n    "XPRD12": "image.jpg"  // Not allowed on creation\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "error": "ValidationError",\n  "message": "Field not allowed in create operation: XPRD12",\n  "code": "FIELD_NOT_CREATEABLE",\n  "field": "XPRD12",\n  "dimension": "PRD"\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"insert_cascade-operations",children:"INSERT_CASCADE Operations"}),"\n",(0,t.jsx)(n.h3,{id:"master-detail-creation",children:"Master-Detail Creation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"TB_COST.INSERT_CASCADE triggers related record creation:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- When order is created, also create order items\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, INSERT_CASCADE) VALUES\n('ORD', 10, 'items', 'ORDITEM:XORDITEM_ORDER_ID');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Single Request Creates Multiple Records:"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/ORD\n{\n  "data": {\n    "XORD01": "ORD-2025-001",\n    "XORD_CUSTOMER_ID": "cust_123",\n    "XORD03": 299.97,\n    "items": [\n      {\n        "XORDITEM10": "prd_1",\n        "XORDITEM_QTY": 2,\n        "XORDITEM09": 99.99\n      },\n      {\n        "XORDITEM10": "prd_2",\n        "XORDITEM_QTY": 1,\n        "XORDITEM09": 99.99\n      }\n    ]\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Creates 1 order record\nINSERT INTO TB_ANAG_ORD00 (XORD01, XORD_CUSTOMER_ID, XORD03, TREC, CDATA, OWNER)\nVALUES ('ORD-2025-001', 'cust_123', 299.97, 'N', '20251219153045', 'user@example.com');\n\n-- Creates 2 order item records (cascade)\nINSERT INTO TB_ANAG_ORDITEM00 (XORDITEM_ORDER_ID, XORDITEM10, XORDITEM_QTY, XORDITEM09, TREC, CDATA, OWNER)\nVALUES (123, 'prd_1', 2, 99.99, 'N', '20251219153045', 'user@example.com');\n\nINSERT INTO TB_ANAG_ORDITEM00 (XORDITEM_ORDER_ID, XORDITEM10, XORDITEM_QTY, XORDITEM09, TREC, CDATA, OWNER)\nVALUES (123, 'prd_2', 1, 99.99, 'N', '20251219153045', 'user@example.com');\n"})}),"\n",(0,t.jsx)(n.h2,{id:"outbox-event",children:"Outbox Event"}),"\n",(0,t.jsx)(n.h3,{id:"event-publication",children:"Event Publication"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Every POST publishes event to RabbitMQ:"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Outbox Record:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "event_id": "evt_550e8400",\n  "event_type": "ProductCreated",\n  "aggregate_id": "123",\n  "aggregate_type": "PRD",\n  "operation": "POST",\n  "timestamp": "2025-12-19T15:30:45Z",\n  "payload": {\n    "PRD_ID": 123,\n    "XPRD01": "Widget Pro",\n    "XPRD02": 99.99,\n    "XPRD03": "PRD-2025-001",\n    "TREC": "N"\n  },\n  "user": "user@example.com",\n  "session": {\n    "source": "productManagement",\n    "centro_dett": "admin",\n    "microservice": "adminApp"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"RabbitMQ Exchange:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Exchange: corewrite.fanout\nRouting Key: product.created\nSubscribers: search-indexer, cache-invalidator, analytics\n"})}),"\n",(0,t.jsx)(n.h2,{id:"javascript-implementation",children:"JavaScript Implementation"}),"\n",(0,t.jsx)(n.h3,{id:"product-creation-service",children:"Product Creation Service"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class ProductService {\n  constructor(apiBase, token) {\n    this.apiBase = apiBase;\n    this.token = token;\n  }\n\n  /**\n   * Create new product\n   */\n  async createProduct(productData) {\n    const response = await fetch(`${this.apiBase}/api/v4/core/PRD`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${this.token}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ data: productData })\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new ProductCreationError(error);\n    }\n\n    return response.json();\n  }\n\n  /**\n   * Create product with validation\n   */\n  async createProductWithValidation(productData) {\n    // Client-side validation\n    this.validateRequired(productData, ['XPRD01', 'XPRD05']);\n\n    try {\n      const result = await this.createProduct(productData);\n      console.log('Product created:', result.data.PRD_ID);\n      return result;\n    } catch (error) {\n      if (error.code === 'REQUIRED_FIELD_MISSING') {\n        console.error('Missing required field:', error.field);\n      } else if (error.code === 'FIELD_NOT_CREATEABLE') {\n        console.error('Field not allowed on creation:', error.field);\n      }\n      throw error;\n    }\n  }\n\n  /**\n   * Validate required fields\n   */\n  validateRequired(data, requiredFields) {\n    for (const field of requiredFields) {\n      if (!data[field]) {\n        throw new Error(`Required field missing: ${field}`);\n      }\n    }\n  }\n}\n\nclass ProductCreationError extends Error {\n  constructor(errorResponse) {\n    super(errorResponse.message);\n    this.code = errorResponse.code;\n    this.field = errorResponse.field;\n    this.dimension = errorResponse.dimension;\n  }\n}\n\n// Usage\nconst productService = new ProductService(apiBase, token);\n\nconst newProduct = await productService.createProduct({\n  XPRD01: 'Widget Pro',\n  XPRD02: 99.99,\n  XPRD04: 'Professional widget',\n  XPRD05: 'cat_electronics',\n  XPRD06: true,\n  XPRD09: 100\n});\n\nconsole.log('Created product:', newProduct.data.PRD_ID);\nconsole.log('Counter code:', newProduct.data.XPRD03); // \"PRD-2025-001\"\n"})}),"\n",(0,t.jsx)(n.h3,{id:"master-detail-creation-1",children:"Master-Detail Creation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class OrderService {\n  constructor(apiBase, token) {\n    this.apiBase = apiBase;\n    this.token = token;\n  }\n\n  /**\n   * Create order with items (master-detail)\n   */\n  async createOrder(orderData, items) {\n    const response = await fetch(`${this.apiBase}/api/v4/core/ORD`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${this.token}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        data: {\n          ...orderData,\n          items: items  // Cascade insert\n        }\n      })\n    });\n\n    if (!response.ok) {\n      throw new Error('Order creation failed');\n    }\n\n    return response.json();\n  }\n\n  /**\n   * Create order from cart\n   */\n  async createOrderFromCart(customerId, cartItems) {\n    // Calculate total\n    const total = cartItems.reduce((sum, item) =>\n      sum + (item.price * item.quantity), 0\n    );\n\n    // Build order data\n    const orderData = {\n      XORD_CUSTOMER_ID: customerId,\n      XORD03: total\n    };\n\n    // Build items array\n    const items = cartItems.map(item => ({\n      XORDITEM10: item.productId,\n      XORDITEM_QTY: item.quantity,\n      XORDITEM09: item.price\n    }));\n\n    // Create order with items in single request\n    const result = await this.createOrder(orderData, items);\n\n    console.log('Order created:', result.data.ORD_ID);\n    console.log('Order code:', result.data.XORD01);\n    console.log('Items created:', items.length);\n\n    return result;\n  }\n}\n\n// Usage\nconst orderService = new OrderService(apiBase, token);\n\nconst order = await orderService.createOrderFromCart('cust_123', [\n  { productId: 'prd_1', quantity: 2, price: 99.99 },\n  { productId: 'prd_2', quantity: 1, price: 99.99 }\n]);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"pattern-1-simple-create",children:"Pattern 1: Simple Create"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Single record, no cascades:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"async function createCategory(name, description) {\n  const response = await fetch(`${apiBase}/api/v4/core/CAT`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      data: {\n        XCAT01: name,\n        XCAT02: description\n      }\n    })\n  });\n\n  return response.json();\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pattern-2-create-with-auto-generated-fields",children:"Pattern 2: Create with Auto-Generated Fields"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Let system populate counters, UUIDs:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"async function createProduct(data) {\n  // Don't include PRD_ID (uuid) or XPRD03 (counter)\n  // System will auto-generate\n  const response = await fetch(`${apiBase}/api/v4/core/PRD`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      data: {\n        XPRD01: data.name,\n        XPRD02: data.price,\n        XPRD05: data.categoryId\n        // PRD_ID and XPRD03 auto-populated\n      }\n    })\n  });\n\n  const result = await response.json();\n  console.log('Generated UUID:', result.data.PRD_ID);\n  console.log('Generated code:', result.data.XPRD03);\n\n  return result;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pattern-3-create-with-validation",children:"Pattern 3: Create with Validation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Handle validation errors gracefully:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"async function createProductWithValidation(data) {\n  try {\n    const response = await fetch(`${apiBase}/api/v4/core/PRD`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ data })\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw error;\n    }\n\n    return response.json();\n  } catch (error) {\n    switch (error.code) {\n      case 'REQUIRED_FIELD_MISSING':\n        alert(`Please fill in ${error.field}`);\n        break;\n      case 'FIELD_NOT_CREATEABLE':\n        alert(`Field ${error.field} cannot be set on creation`);\n        break;\n      case 'GRANT_DENIED':\n        alert('You do not have permission to create products');\n        break;\n      default:\n        alert('Product creation failed');\n    }\n    throw error;\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Let system manage automatic fields:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u2705 Good - don\'t include auto fields\n{\n  "data": {\n    "XPRD01": "Product Name",\n    "XPRD02": 99.99\n    // PRD_ID, XPRD03, TREC, CDATA auto-populated\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use cascades for master-detail:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u2705 Good - single request with items\nPOST /api/v4/core/ORD\n{\n  "data": {\n    "XORD01": "Order",\n    "items": [...]\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Handle validation errors:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good\ntry {\n  await createProduct(data);\n} catch (error) {\n  handleValidationError(error);\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't include auto-generated fields:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// \u274c Bad - trying to set auto fields\n{\n  "data": {\n    "PRD_ID": "custom-id",  // Auto-generated by uuid\n    "XPRD03": "custom-code",  // Auto-generated by counter\n    "TREC": "N"  // Auto-managed\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't create detail records separately:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - separate requests (N+1 problem)\nconst order = await createOrder(orderData);\nfor (const item of items) {\n  await createOrderItem(order.ORD_ID, item);\n}\n\n// \u2705 Good - single request with cascade\nawait createOrder({ ...orderData, items });\n"})}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 POST creates new records with TREC='N'"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Auto-populated fields: PRD_ID (uuid), counters, timestamps, slugs, hashes"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Required field validation via TB_COST.REQUIRED"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 COD_ON_OFF='N' flag required for field to be createable"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 INSERT_CASCADE creates related records automatically"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Outbox event published to RabbitMQ"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 ACID transaction ensures all-or-nothing"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Don't include auto-generated fields (uuid, counter, TREC, CDATA)"}),"\n",(0,t.jsx)(n.li,{children:"Use INSERT_CASCADE for master-detail creation"}),"\n",(0,t.jsx)(n.li,{children:"Handle validation errors (REQUIRED_FIELD_MISSING, FIELD_NOT_CREATEABLE)"}),"\n",(0,t.jsx)(n.li,{children:"Trust pre-insert functions to populate fields"}),"\n",(0,t.jsx)(n.li,{children:"Every creation publishes event for downstream consumers"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Next:"})," ",(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/update-operations",children:"Update Operations \u2192"})]}),"\n",(0,t.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/counter-management",children:"Counter Management"})," - TB_COUNTER details"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/validation",children:"Validation"})," - Validation layers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/cascade-operations",children:"Cascade Operations"})," - INSERT_CASCADE patterns"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/outbox-pattern",children:"Outbox Pattern"})," - Event sourcing"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>o,M:()=>s});var t=r(1504);const a={},i=t.createContext(a);function s(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);