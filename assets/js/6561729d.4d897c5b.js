"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[4468],{9796:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>c,toc:()=>a});var s=r(7624),t=r(2172);const d={title:"Nested Set Model (TB_MENU)",sidebar_label:"7. Nested Set Model",sidebar_position:8,description:"Understanding TB_MENU hierarchical structure using the nested set model for security areas"},i="Nested Set Model: TB_MENU Hierarchy",c={id:"products/map.q01.io/core-api-platform-v4/core-concepts/nested-set-model",title:"Nested Set Model (TB_MENU)",description:"Understanding TB_MENU hierarchical structure using the nested set model for security areas",source:"@site/docs/products/map.q01.io/core-api-platform-v4/01-core-concepts/nested-set-model.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/01-core-concepts",slug:"/products/map.q01.io/core-api-platform-v4/core-concepts/nested-set-model",permalink:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/nested-set-model",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Nested Set Model (TB_MENU)",sidebar_label:"7. Nested Set Model",sidebar_position:8,description:"Understanding TB_MENU hierarchical structure using the nested set model for security areas"},sidebar:"mapSidebar",previous:{title:"6. Multi-Level Permissions",permalink:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/permissions"},next:{title:"8. Entity Lifecycle",permalink:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/entity-lifecycle"}},l={},a=[{value:"What is the Nested Set Model?",id:"what-is-the-nested-set-model",level:2},{value:"Why Nested Set?",id:"why-nested-set",level:2},{value:"TB_MENU Structure",id:"tb_menu-structure",level:2},{value:"How Nested Set Works",id:"how-nested-set-works",level:2},{value:"The Left-Right Numbering",id:"the-left-right-numbering",level:3},{value:"Visual Representation",id:"visual-representation",level:3},{value:"Common Nested Set Queries",id:"common-nested-set-queries",level:2},{value:"1. Get All Descendants (Subtree)",id:"1-get-all-descendants-subtree",level:3},{value:"2. Get All Ancestors (Path to Root)",id:"2-get-all-ancestors-path-to-root",level:3},{value:"3. Get Direct Children Only",id:"3-get-direct-children-only",level:3},{value:"4. Get Leaf Nodes (No Children)",id:"4-get-leaf-nodes-no-children",level:3},{value:"5. Check if Node A Contains Node B",id:"5-check-if-node-a-contains-node-b",level:3},{value:"Security and Permissions",id:"security-and-permissions",level:2},{value:"Grant Levels",id:"grant-levels",level:3},{value:"Permission Validation",id:"permission-validation",level:3},{value:"Hierarchical Grant Inheritance",id:"hierarchical-grant-inheritance",level:3},{value:"Source Parameter Mapping",id:"source-parameter-mapping",level:2},{value:"Modulo Context",id:"modulo-context",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Pattern 1: Read-Only Public Area",id:"pattern-1-read-only-public-area",level:3},{value:"Pattern 2: Standard CRUD Hierarchy",id:"pattern-2-standard-crud-hierarchy",level:3},{value:"Pattern 3: Progressive Disclosure",id:"pattern-3-progressive-disclosure",level:3},{value:"Common Mistakes",id:"common-mistakes",level:2},{value:"\u274c DON&#39;T: Modify NLEFT/NRIGHT Manually",id:"-dont-modify-nleftnright-manually",level:3},{value:"\u274c DON&#39;T: Create Overlapping Ranges",id:"-dont-create-overlapping-ranges",level:3},{value:"\u274c DON&#39;T: Assume source is Optional",id:"-dont-assume-source-is-optional",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO: Use Consistent Naming",id:"-do-use-consistent-naming",level:3},{value:"\u2705 DO: Assign Grants Conservatively",id:"-do-assign-grants-conservatively",level:3},{value:"\u2705 DO: Group Related Areas",id:"-do-group-related-areas",level:3},{value:"Summary",id:"summary",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"nested-set-model-tb_menu-hierarchy",children:"Nested Set Model: TB_MENU Hierarchy"}),"\n",(0,s.jsx)(n.h2,{id:"what-is-the-nested-set-model",children:"What is the Nested Set Model?"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Nested Set"})," is a mathematical model for representing hierarchical tree structures in a relational database using two numbers (NLEFT and NRIGHT) instead of parent-child pointers."]}),"\n",(0,s.jsxs)(n.p,{children:["In Q01, ",(0,s.jsx)(n.strong,{children:"TB_MENU"})," uses this model to represent ",(0,s.jsx)(n.strong,{children:"security areas"})," as a hierarchy where permissions and grants cascade from parent to child nodes."]}),"\n",(0,s.jsx)(n.h2,{id:"why-nested-set",children:"Why Nested Set?"}),"\n",(0,s.jsx)(n.p,{children:"Traditional parent-child relationships require recursive queries to traverse a tree:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Traditional approach (slow, recursive)\nWITH RECURSIVE menu_tree AS (\n  SELECT * FROM TB_MENU WHERE PARENT_ID = 'root'\n  UNION ALL\n  SELECT m.* FROM TB_MENU m\n  JOIN menu_tree mt ON m.PARENT_ID = mt.COD_MENU\n)\nSELECT * FROM menu_tree;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Nested Set approach"})," (fast, single query):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Get all descendants of a node\nSELECT * FROM TB_MENU\nWHERE NLEFT > :parentLeft AND NRIGHT < :parentRight\nORDER BY NLEFT;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"One query. No recursion. Blazing fast."})}),"\n",(0,s.jsx)(n.h2,{id:"tb_menu-structure",children:"TB_MENU Structure"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Fields:"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"COD_MENU"})}),(0,s.jsx)(n.td,{children:"varchar(50)"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"Security area code"}),' (e.g., "productManagement")']})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DESC_MENU"})}),(0,s.jsx)(n.td,{children:"varchar(255)"}),(0,s.jsx)(n.td,{children:"Human-readable description"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"NLEFT"})}),(0,s.jsx)(n.td,{children:"int"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"Left boundary"})," of nested set"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"NRIGHT"})}),(0,s.jsx)(n.td,{children:"int"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"Right boundary"})," of nested set"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"NLEVEL"})}),(0,s.jsx)(n.td,{children:"int"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"Depth level"})," in hierarchy (0=root)"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"MODULO"})}),(0,s.jsx)(n.td,{children:"varchar(50)"}),(0,s.jsx)(n.td,{children:"Module context (Default, POS, B2B)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"COD_MENU_PADRE"})}),(0,s.jsx)(n.td,{children:"varchar(50)"}),(0,s.jsx)(n.td,{children:"Parent menu code (for reference)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GRANT"})}),(0,s.jsx)(n.td,{children:"int"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"Required grant level"})," (0-4)"]})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"how-nested-set-works",children:"How Nested Set Works"}),"\n",(0,s.jsx)(n.h3,{id:"the-left-right-numbering",children:"The Left-Right Numbering"}),"\n",(0,s.jsx)(n.p,{children:"Each node gets two numbers:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"NLEFT"}),": Assigned when entering the node during tree traversal"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"NRIGHT"}),": Assigned when leaving the node"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"          [Products] (1, 12)\n         /                  \\\n   [View] (2, 5)        [Manage] (6, 11)\n      |                    /        \\\n   [List] (3, 4)   [Create] (7, 8)  [Edit] (9, 10)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example TB_MENU Data:"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"COD_MENU"}),(0,s.jsx)(n.th,{children:"DESC_MENU"}),(0,s.jsx)(n.th,{children:"NLEFT"}),(0,s.jsx)(n.th,{children:"NRIGHT"}),(0,s.jsx)(n.th,{children:"NLEVEL"}),(0,s.jsx)(n.th,{children:"GRANT"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"products"}),(0,s.jsx)(n.td,{children:"Products"}),(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"12"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"0"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"productView"}),(0,s.jsx)(n.td,{children:"View Products"}),(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"5"}),(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"productList"}),(0,s.jsx)(n.td,{children:"Product List"}),(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"4"}),(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"productManage"}),(0,s.jsx)(n.td,{children:"Manage Products"}),(0,s.jsx)(n.td,{children:"6"}),(0,s.jsx)(n.td,{children:"11"}),(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"2"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"productCreate"}),(0,s.jsx)(n.td,{children:"Create Product"}),(0,s.jsx)(n.td,{children:"7"}),(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"4"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"productEdit"}),(0,s.jsx)(n.td,{children:"Edit Product"}),(0,s.jsx)(n.td,{children:"9"}),(0,s.jsx)(n.td,{children:"10"}),(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"2"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"visual-representation",children:"Visual Representation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"products (1, 12) GRANT=0\n\u251c\u2500 productView (2, 5) GRANT=1\n\u2502  \u2514\u2500 productList (3, 4) GRANT=1\n\u2514\u2500 productManage (6, 11) GRANT=2\n   \u251c\u2500 productCreate (7, 8) GRANT=4\n   \u2514\u2500 productEdit (9, 10) GRANT=2\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Properties:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parent contains children"}),": ",(0,s.jsx)(n.code,{children:"parent.NLEFT < child.NLEFT < child.NRIGHT < parent.NRIGHT"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Siblings don't overlap"}),": ",(0,s.jsx)(n.code,{children:"sibling1.NRIGHT < sibling2.NLEFT"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Leaf nodes"}),": ",(0,s.jsx)(n.code,{children:"NRIGHT = NLEFT + 1"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"common-nested-set-queries",children:"Common Nested Set Queries"}),"\n",(0,s.jsx)(n.h3,{id:"1-get-all-descendants-subtree",children:"1. Get All Descendants (Subtree)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Get all nodes under \"productManage\"\nSELECT child.*\nFROM TB_MENU parent\nJOIN TB_MENU child ON child.NLEFT > parent.NLEFT\n                   AND child.NRIGHT < parent.NRIGHT\nWHERE parent.COD_MENU = 'productManage'\nORDER BY child.NLEFT;\n\n-- Result: productCreate, productEdit\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-get-all-ancestors-path-to-root",children:"2. Get All Ancestors (Path to Root)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Get path from \"productCreate\" to root\nSELECT parent.*\nFROM TB_MENU child\nJOIN TB_MENU parent ON child.NLEFT > parent.NLEFT\n                    AND child.NRIGHT < parent.NRIGHT\nWHERE child.COD_MENU = 'productCreate'\nORDER BY parent.NLEVEL;\n\n-- Result: products, productManage\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-get-direct-children-only",children:"3. Get Direct Children Only"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Get immediate children of \"products\"\nSELECT child.*\nFROM TB_MENU parent\nJOIN TB_MENU child ON child.NLEFT > parent.NLEFT\n                   AND child.NRIGHT < parent.NRIGHT\n                   AND child.NLEVEL = parent.NLEVEL + 1\nWHERE parent.COD_MENU = 'products';\n\n-- Result: productView, productManage\n"})}),"\n",(0,s.jsx)(n.h3,{id:"4-get-leaf-nodes-no-children",children:"4. Get Leaf Nodes (No Children)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Get all leaf nodes in \"products\" tree\nSELECT child.*\nFROM TB_MENU parent\nJOIN TB_MENU child ON child.NLEFT > parent.NLEFT\n                   AND child.NRIGHT < parent.NRIGHT\nWHERE parent.COD_MENU = 'products'\n  AND child.NRIGHT = child.NLEFT + 1;\n\n-- Result: productList, productCreate, productEdit\n"})}),"\n",(0,s.jsx)(n.h3,{id:"5-check-if-node-a-contains-node-b",children:"5. Check if Node A Contains Node B"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Is \"productCreate\" inside \"products\"?\nSELECT COUNT(*) > 0 as is_descendant\nFROM TB_MENU parent, TB_MENU child\nWHERE parent.COD_MENU = 'products'\n  AND child.COD_MENU = 'productCreate'\n  AND child.NLEFT > parent.NLEFT\n  AND child.NRIGHT < parent.NRIGHT;\n\n-- Result: TRUE\n"})}),"\n",(0,s.jsx)(n.h2,{id:"security-and-permissions",children:"Security and Permissions"}),"\n",(0,s.jsx)(n.h3,{id:"grant-levels",children:"Grant Levels"}),"\n",(0,s.jsxs)(n.p,{children:["TB_MENU nodes have ",(0,s.jsx)(n.strong,{children:"GRANT"})," values representing required permission level:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Grant Level"}),(0,s.jsx)(n.th,{children:"Permission"}),(0,s.jsx)(n.th,{children:"Typical Use"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"0"})}),(0,s.jsx)(n.td,{children:"Public"}),(0,s.jsx)(n.td,{children:"Read-only access"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"1"})}),(0,s.jsx)(n.td,{children:"View"}),(0,s.jsx)(n.td,{children:"List/detail views"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"2"})}),(0,s.jsx)(n.td,{children:"Modify"}),(0,s.jsx)(n.td,{children:"Update existing records"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"3"})}),(0,s.jsx)(n.td,{children:"Advanced"}),(0,s.jsx)(n.td,{children:"Special operations"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"4"})}),(0,s.jsx)(n.td,{children:"Create"}),(0,s.jsx)(n.td,{children:"Create new records"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"permission-validation",children:"Permission Validation"}),"\n",(0,s.jsxs)(n.p,{children:["When a request arrives with ",(0,s.jsx)(n.code,{children:"source=productCreate"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Look up source in TB_MENU:"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT COD_MENU, GRANT, NLEFT, NRIGHT\nFROM TB_MENU\nWHERE COD_MENU = 'productCreate';\n-- Result: GRANT=4 required\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Check user's grant from JWT:"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "grants": {\n    "products": 4,\n    "productManage": 4\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validate permission:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["User has ",(0,s.jsx)(n.code,{children:'"products": 4'})," grant"]}),"\n",(0,s.jsx)(n.li,{children:'"productCreate" is descendant of "products" (NLEFT=7 is within 1-12)'}),"\n",(0,s.jsx)(n.li,{children:"User grant (4) >= Required grant (4)"}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Permission granted"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"hierarchical-grant-inheritance",children:"Hierarchical Grant Inheritance"}),"\n",(0,s.jsx)(n.p,{children:"If user has grant on parent, they have access to all descendants:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'User has grant on "products" (NLEFT=1, NRIGHT=12)\n\u2193\nCan access:\n- productView (2-5) \u2705\n- productList (3-4) \u2705\n- productManage (6-11) \u2705\n- productCreate (7-8) \u2705\n- productEdit (9-10) \u2705\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Query to check access:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Check if user can access \"productCreate\"\nSELECT COUNT(*) > 0 as has_access\nFROM TB_MENU node\nWHERE node.COD_MENU = 'productCreate'\n  AND EXISTS (\n    -- User has grant on this node or any ancestor\n    SELECT 1 FROM TB_MENU ancestor\n    WHERE node.NLEFT >= ancestor.NLEFT\n      AND node.NRIGHT <= ancestor.NRIGHT\n      AND ancestor.COD_MENU IN ('products', 'productManage')  -- User's grants\n      AND node.GRANT <= 4  -- User's grant level\n  );\n"})}),"\n",(0,s.jsx)(n.h2,{id:"source-parameter-mapping",children:"Source Parameter Mapping"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"source"})," parameter in API requests maps directly to ",(0,s.jsx)(n.code,{children:"COD_MENU"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"GET /api/v4/core/PRD?source=productList&center_dett=visualizza\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"CoreQuery processing:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Extracts ",(0,s.jsx)(n.code,{children:"source=productList"})]}),"\n",(0,s.jsx)(n.li,{children:'Queries TB_MENU for "productList" node'}),"\n",(0,s.jsx)(n.li,{children:'Validates user has grant on "productList" or ancestor'}),"\n",(0,s.jsx)(n.li,{children:"Uses GRANT level for additional permission checks"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"modulo-context",children:"Modulo Context"}),"\n",(0,s.jsxs)(n.p,{children:["TB_MENU supports ",(0,s.jsx)(n.strong,{children:"multiple hierarchies"})," via ",(0,s.jsx)(n.code,{children:"MODULO"})," field:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Default module hierarchy\nSELECT * FROM TB_MENU WHERE MODULO = 'Default' ORDER BY NLEFT;\n\n-- POS module hierarchy (different security areas)\nSELECT * FROM TB_MENU WHERE MODULO = 'POS' ORDER BY NLEFT;\n\n-- B2B module hierarchy\nSELECT * FROM TB_MENU WHERE MODULO = 'B2B' ORDER BY NLEFT;\n"})}),"\n",(0,s.jsx)(n.p,{children:"Each module has independent security tree."}),"\n",(0,s.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"pattern-1-read-only-public-area",children:"Pattern 1: Read-Only Public Area"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"publicProducts (GRANT=0)\n\u2514\u2500 publicProductList (GRANT=0)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Anyone can view, no authentication required for GRANT=0."}),"\n",(0,s.jsx)(n.h3,{id:"pattern-2-standard-crud-hierarchy",children:"Pattern 2: Standard CRUD Hierarchy"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"orderManagement (GRANT=1)\n\u251c\u2500 orderList (GRANT=1)\n\u251c\u2500 orderView (GRANT=1)\n\u251c\u2500 orderCreate (GRANT=4)\n\u251c\u2500 orderEdit (GRANT=2)\n\u2514\u2500 orderDelete (GRANT=3)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Separate grants for different operations."}),"\n",(0,s.jsx)(n.h3,{id:"pattern-3-progressive-disclosure",children:"Pattern 3: Progressive Disclosure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"reports (GRANT=1)\n\u251c\u2500 basicReports (GRANT=1)\n\u2514\u2500 advancedReports (GRANT=3)\n    \u251c\u2500 financialReports (GRANT=4)\n    \u2514\u2500 auditReports (GRANT=4)\n"})}),"\n",(0,s.jsx)(n.p,{children:"More sensitive reports require higher grants."}),"\n",(0,s.jsx)(n.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,s.jsx)(n.h3,{id:"-dont-modify-nleftnright-manually",children:"\u274c DON'T: Modify NLEFT/NRIGHT Manually"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- WRONG - breaks tree structure\nUPDATE TB_MENU SET NLEFT = 15 WHERE COD_MENU = 'newNode';\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Why:"})," Nested set requires recalculating all affected nodes when inserting/deleting."]}),"\n",(0,s.jsx)(n.h3,{id:"-dont-create-overlapping-ranges",children:"\u274c DON'T: Create Overlapping Ranges"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- WRONG - node1 and node2 overlap\nINSERT INTO TB_MENU (COD_MENU, NLEFT, NRIGHT) VALUES ('node1', 5, 10);\nINSERT INTO TB_MENU (COD_MENU, NLEFT, NRIGHT) VALUES ('node2', 8, 12);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Why:"})," Violates nested set invariant (siblings must not overlap)."]}),"\n",(0,s.jsx)(n.h3,{id:"-dont-assume-source-is-optional",children:"\u274c DON'T: Assume source is Optional"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"GET /api/v4/core/PRD?center_dett=visualizza\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Why:"})," ",(0,s.jsx)(n.code,{children:"source"})," is required for permission validation via TB_MENU."]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"-do-use-consistent-naming",children:"\u2705 DO: Use Consistent Naming"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"{module}{Entity}{Action}\nproductList, productCreate, productEdit\norderList, orderCreate, orderEdit\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-do-assign-grants-conservatively",children:"\u2705 DO: Assign Grants Conservatively"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"GRANT=0: Public data"}),"\n",(0,s.jsx)(n.li,{children:"GRANT=1: View operations"}),"\n",(0,s.jsx)(n.li,{children:"GRANT=2: Update operations"}),"\n",(0,s.jsx)(n.li,{children:"GRANT=3: Delete operations"}),"\n",(0,s.jsx)(n.li,{children:"GRANT=4: Create operations"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Higher grants for more sensitive operations."}),"\n",(0,s.jsx)(n.h3,{id:"-do-group-related-areas",children:"\u2705 DO: Group Related Areas"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"products (GRANT=0)\n\u251c\u2500 productCatalog (GRANT=0)\n\u2502  \u251c\u2500 productList (GRANT=0)\n\u2502  \u2514\u2500 productSearch (GRANT=0)\n\u2514\u2500 productManagement (GRANT=2)\n   \u251c\u2500 productCreate (GRANT=4)\n   \u2514\u2500 productEdit (GRANT=2)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Logical grouping makes permissions intuitive."}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Nested Set Model"})," in TB_MENU provides:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Fast hierarchical queries"})," - single query, no recursion"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Efficient permission validation"})," - check if node in subtree"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Grant inheritance"})," - parent grants cascade to children"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Flexible security areas"})," - multiple hierarchies via MODULO"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Insight:"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["TB_MENU is not just a menu structure - it's the ",(0,s.jsx)(n.strong,{children:"security backbone"})," of Q01 Core APIs. Every ",(0,s.jsx)(n.code,{children:"source"})," parameter validates against this hierarchy."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Next Concept:"})}),"\n",(0,s.jsxs)(n.p,{children:["Continue to ",(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/entity-lifecycle",children:"Entity Lifecycle - TREC States"})," to understand record state management."]})]})}function h(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>c,M:()=>i});var s=r(1504);const t={},d=s.createContext(t);function i(e){const n=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);