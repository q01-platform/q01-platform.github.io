"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[5452],{4948:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>a});var s=r(7624),i=r(2172);const t={title:"Sort Operations",sidebar_label:"Sort Operations",sidebar_position:6,description:"Drag-and-drop reordering of records with sequence management"},o="Sort Operations",d={id:"products/map.q01.io/core-api-platform-v4/api-operations/sort-operations",title:"Sort Operations",description:"Drag-and-drop reordering of records with sequence management",source:"@site/docs/products/map.q01.io/core-api-platform-v4/02-api-operations/sort-operations.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/02-api-operations",slug:"/products/map.q01.io/core-api-platform-v4/api-operations/sort-operations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/sort-operations",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Sort Operations",sidebar_label:"Sort Operations",sidebar_position:6,description:"Drag-and-drop reordering of records with sequence management"},sidebar:"mapSidebar",previous:{title:"Media Operations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/media-operations"},next:{title:"Command Operations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/command-operations"}},c={},a=[{value:"Overview",id:"overview",level:2},{value:"Endpoint",id:"endpoint",level:2},{value:"How Sort Works",id:"how-sort-works",level:2},{value:"Conceptual Model",id:"conceptual-model",level:3},{value:"Request Format",id:"request-format",level:3},{value:"Response Format",id:"response-format",level:2},{value:"Sort Algorithms",id:"sort-algorithms",level:2},{value:"Scenario 1: Moving Down (active_sequence &lt; over_sequence)",id:"scenario-1-moving-down-active_sequence--over_sequence",level:3},{value:"Scenario 2: Moving Up (active_sequence &gt; over_sequence)",id:"scenario-2-moving-up-active_sequence--over_sequence",level:3},{value:"Transaction Safety",id:"transaction-safety",level:2},{value:"Conditional Sorting with extra_cond",id:"conditional-sorting-with-extra_cond",level:2},{value:"JavaScript Implementation",id:"javascript-implementation",level:2},{value:"Basic Drag-and-Drop Sort",id:"basic-drag-and-drop-sort",level:3},{value:"HTML Drag-and-Drop Integration",id:"html-drag-and-drop-integration",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO",id:"-do",level:3},{value:"\u274c DON&#39;T",id:"-dont",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Missing Required Fields",id:"missing-required-fields",level:3},{value:"Permission Denied",id:"permission-denied",level:3},{value:"Use Case: Category-Scoped Product Sorting",id:"use-case-category-scoped-product-sorting",level:2},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"sort-operations",children:"Sort Operations"}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Sort operations"})," enable ",(0,s.jsx)(n.strong,{children:"drag-and-drop reordering"})," of records by updating sequence field values. When a user moves an item from one position to another, CoreWrite automatically recalculates sequence numbers for affected records in a single transaction."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Characteristics:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Drag-and-drop reordering"}),"\n",(0,s.jsx)(n.li,{children:"Automatic sequence recalculation"}),"\n",(0,s.jsx)(n.li,{children:"Transaction-safe (ACID)"}),"\n",(0,s.jsx)(n.li,{children:"Supports conditional sorting (e.g., sort within category)"}),"\n",(0,s.jsx)(n.li,{children:"Updates LOWNER and LDATA audit fields"}),"\n",(0,s.jsx)(n.li,{children:"Maintains TREC state"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"endpoint",children:"Endpoint"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Method:"})," ",(0,s.jsx)(n.code,{children:"POST"}),"\n",(0,s.jsx)(n.strong,{children:"Path:"})," ",(0,s.jsx)(n.code,{children:"/api/v4/core/{DIM}/sort"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Authentication:"})," Required (Bearer token)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Permission:"})," Grant \u2265 2 (same as UPDATE operations)"]}),"\n",(0,s.jsx)(n.h2,{id:"how-sort-works",children:"How Sort Works"}),"\n",(0,s.jsx)(n.h3,{id:"conceptual-model",children:"Conceptual Model"}),"\n",(0,s.jsx)(n.p,{children:"Imagine a sortable list of products:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Initial State:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 A - seq: 1           \u2502\n\u2502 B - seq: 2  \u2190active  \u2502\n\u2502 C - seq: 3           \u2502\n\u2502 D - seq: 4           \u2502\n\u2502 E - seq: 5  \u2190over    \u2502\n\u2502 F - seq: 6           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"User drags B to E's position (moving down):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Step 1: Shift items up\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 A - seq: 1           \u2502\n\u2502 B - seq: 2  (active) \u2502\n\u2502 C - seq: 2  \u2b06        \u2502\n\u2502 D - seq: 3  \u2b06        \u2502\n\u2502 E - seq: 4  \u2b06        \u2502\n\u2502 F - seq: 6           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nStep 2: Move active to target\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 A - seq: 1           \u2502\n\u2502 C - seq: 2           \u2502\n\u2502 D - seq: 3           \u2502\n\u2502 E - seq: 4           \u2502\n\u2502 B - seq: 5  \u2713        \u2502\n\u2502 F - seq: 6           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h3,{id:"request-format",children:"Request Format"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/PRD/sort\nContent-Type: application/json\nAuthorization: Bearer {token}\n\n{\n  "active_id": "123",\n  "active_sequence": 2,\n  "over_id": "456",\n  "over_sequence": 5,\n  "sort_column_name": "XPRD40",\n  "source": "productList"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Required Fields:"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"active_id"})}),(0,s.jsx)(n.td,{children:"string/int"}),(0,s.jsx)(n.td,{children:"ID of item being moved"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"123"'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"active_sequence"})}),(0,s.jsx)(n.td,{children:"int"}),(0,s.jsx)(n.td,{children:"Current sequence number of active item"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"2"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"over_id"})}),(0,s.jsx)(n.td,{children:"string/int"}),(0,s.jsx)(n.td,{children:"ID of target position item"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"456"'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"over_sequence"})}),(0,s.jsx)(n.td,{children:"int"}),(0,s.jsx)(n.td,{children:"Sequence number of target position"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"5"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"sort_column_name"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Field name containing sequence"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"XPRD40"'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"source"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Security area"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"productList"'})})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Optional Fields:"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"extra_cond"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"SQL condition for scoped sorting"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"\"XPRD05 = 'electronics'\""})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"skipOwner"})}),(0,s.jsx)(n.td,{children:"boolean"}),(0,s.jsx)(n.td,{children:"Skip LOWNER update"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"false"})," (default)"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"forceOwner"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Override LOWNER value"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"user123"'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"skipLDATA"})}),(0,s.jsx)(n.td,{children:"boolean"}),(0,s.jsx)(n.td,{children:"Skip LDATA update"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"false"})," (default)"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"forceLDATA"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"Override LDATA value"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"20251219143000"'})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"response-format",children:"Response Format"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Success (200 OK):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "code": 200,\n  "message": "Sort operation completed successfully",\n  "affectedRows": 4\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Error (500):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "code": 500,\n  "msg": "Invalid body provided for Sort operation! Fix errors before retry.",\n  "errors": [\n    "Missing active_id",\n    "Missing sort_column_name"\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"sort-algorithms",children:"Sort Algorithms"}),"\n",(0,s.jsx)(n.h3,{id:"scenario-1-moving-down-active_sequence--over_sequence",children:"Scenario 1: Moving Down (active_sequence < over_sequence)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example:"})," Drag item at position 2 to position 5"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Algorithm:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Shift items up"})," between active and target positions:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"UPDATE TB_ANAG_{DIM}00\nSET {sort_field} = {sort_field} - 1\nWHERE {sort_field} <= {over_sequence}\n  AND {sort_field} > {active_sequence}\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Move active item"})," to target position:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"UPDATE TB_ANAG_{DIM}00\nSET {sort_field} = {over_sequence}\nWHERE {sort_field} = {active_sequence}\n  AND {ID} = {active_id}\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Visual:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Before:  A(1) B(2) C(3) D(4) E(5) F(6)\n         ---- \u2193              \u2191\nStep 1:  A(1) B(2) C(2) D(3) E(4) F(6)  [shift C,D,E up]\nStep 2:  A(1) C(2) D(3) E(4) B(5) F(6)  [move B to 5]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"scenario-2-moving-up-active_sequence--over_sequence",children:"Scenario 2: Moving Up (active_sequence > over_sequence)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example:"})," Drag item at position 5 to position 2"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Algorithm:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Shift items down"})," between target and active positions:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"UPDATE TB_ANAG_{DIM}00\nSET {sort_field} = {sort_field} + 1\nWHERE {sort_field} >= {over_sequence}\n  AND {sort_field} < {active_sequence}\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Move active item"})," to target position:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"UPDATE TB_ANAG_{DIM}00\nSET {sort_field} = {over_sequence}\nWHERE {sort_field} = {active_sequence}\n  AND {ID} = {active_id}\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Visual:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Before:  A(1) B(2) C(3) D(4) E(5) F(6)\n              \u2193              \u2191 ----\nStep 1:  A(1) B(3) C(4) D(5) E(5) F(6)  [shift B,C,D down]\nStep 2:  A(1) E(2) B(3) C(4) D(5) F(6)  [move E to 2]\n"})}),"\n",(0,s.jsx)(n.h2,{id:"transaction-safety",children:"Transaction Safety"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"ACID Guarantees:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"BEGIN TRANSACTION\n  UPDATE (shift items)\n  UPDATE (move active item)\n  UPDATE LOWNER, LDATA for all affected rows\nCOMMIT\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Rollback Scenarios:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Database error during shift operation"}),"\n",(0,s.jsx)(n.li,{children:"Active item not found"}),"\n",(0,s.jsx)(n.li,{children:"Permission denied"}),"\n",(0,s.jsx)(n.li,{children:"Invalid sequence numbers"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"conditional-sorting-with-extra_cond",children:"Conditional Sorting with extra_cond"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use Case:"})," Sort products within a specific category only"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "active_id": "123",\n  "active_sequence": 2,\n  "over_id": "456",\n  "over_sequence": 5,\n  "sort_column_name": "XPRD40",\n  "extra_cond": "XPRD05 = \'electronics\'",\n  "source": "productList"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Effect:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Only products where ",(0,s.jsx)(n.code,{children:"XPRD05 = 'electronics'"})," are affected"]}),"\n",(0,s.jsx)(n.li,{children:"Products in other categories maintain their sequence"}),"\n",(0,s.jsx)(n.li,{children:"Enables grouped sorting (e.g., sort within parent, sort within status)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"SQL Generated:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"UPDATE TB_ANAG_PRD00\nSET XPRD40 = XPRD40 - 1\nWHERE XPRD40 <= 5\n  AND XPRD40 > 2\n  AND XPRD05 = 'electronics'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"javascript-implementation",children:"JavaScript Implementation"}),"\n",(0,s.jsx)(n.h3,{id:"basic-drag-and-drop-sort",children:"Basic Drag-and-Drop Sort"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"class SortableList {\n  constructor(apiBase, token, dimension, sortField) {\n    this.apiBase = apiBase;\n    this.token = token;\n    this.dimension = dimension;\n    this.sortField = sortField;\n  }\n\n  async reorderItem(activeItem, overItem, extraCond = null) {\n    const requestBody = {\n      active_id: activeItem.id,\n      active_sequence: activeItem.sequence,\n      over_id: overItem.id,\n      over_sequence: overItem.sequence,\n      sort_column_name: this.sortField,\n      source: 'productList'\n    };\n\n    if (extraCond) {\n      requestBody.extra_cond = extraCond;\n    }\n\n    const response = await fetch(\n      `${this.apiBase}/api/v4/core/${this.dimension}/sort`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.token}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(requestBody)\n      }\n    );\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.msg || 'Sort operation failed');\n    }\n\n    return response.json();\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"html-drag-and-drop-integration",children:"HTML Drag-and-Drop Integration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"class DraggableProductList {\n  constructor(containerId, sorter) {\n    this.container = document.getElementById(containerId);\n    this.sorter = sorter;\n    this.activeItem = null;\n  }\n\n  renderList(products) {\n    this.container.innerHTML = '';\n\n    products.forEach(product => {\n      const item = document.createElement('div');\n      item.className = 'product-item';\n      item.draggable = true;\n      item.dataset.id = product.PRD_ID;\n      item.dataset.sequence = product.XPRD40;\n      item.textContent = product.XPRD01;\n\n      // Drag events\n      item.addEventListener('dragstart', (e) => {\n        this.activeItem = {\n          id: item.dataset.id,\n          sequence: parseInt(item.dataset.sequence)\n        };\n        item.classList.add('dragging');\n      });\n\n      item.addEventListener('dragend', (e) => {\n        item.classList.remove('dragging');\n      });\n\n      item.addEventListener('dragover', (e) => {\n        e.preventDefault(); // Allow drop\n      });\n\n      item.addEventListener('drop', async (e) => {\n        e.preventDefault();\n\n        const overItem = {\n          id: item.dataset.id,\n          sequence: parseInt(item.dataset.sequence)\n        };\n\n        if (this.activeItem.id === overItem.id) {\n          return; // Same item\n        }\n\n        try {\n          await this.sorter.reorderItem(this.activeItem, overItem);\n\n          // Refresh list after successful sort\n          await this.refreshList();\n        } catch (error) {\n          console.error('Sort failed:', error);\n          alert(error.message);\n        }\n      });\n\n      this.container.appendChild(item);\n    });\n  }\n\n  async refreshList() {\n    // Fetch updated list and re-render\n    const response = await fetch(\n      `/api/v4/core/PRD?source=productList&$order=XPRD40 ASC`,\n      {\n        headers: { 'Authorization': `Bearer ${token}` }\n      }\n    );\n\n    const products = await response.json();\n    this.renderList(products);\n  }\n}\n\n// Usage\nconst sorter = new SortableList(apiBase, token, 'PRD', 'XPRD40');\nconst list = new DraggableProductList('product-list', sorter);\n\n// Initial load\nfetch('/api/v4/core/PRD?source=productList&$order=XPRD40 ASC', {\n  headers: { 'Authorization': `Bearer ${token}` }\n})\n  .then(res => res.json())\n  .then(products => list.renderList(products));\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"-do",children:"\u2705 DO"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Always use transactions:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Sort operations are atomic"}),"\n",(0,s.jsx)(n.li,{children:"No manual transaction handling required"}),"\n",(0,s.jsx)(n.li,{children:"CoreWrite handles BEGIN/COMMIT automatically"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Refresh list after sort:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"await sorter.reorderItem(active, over);\nawait refreshProductList(); // Get updated sequences\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use extra_cond for grouped sorting:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// Sort only within same category\nconst extraCond = `XPRD05 = '${product.category}'`;\nawait sorter.reorderItem(active, over, extraCond);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Validate sequence numbers client-side:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"if (active.sequence === over.sequence) {\n  return; // No change needed\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't skip refreshing after sort:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u274c Wrong - UI may be out of sync\nawait sorter.reorderItem(active, over);\n// (no refresh)\n\n// \u2705 Correct\nawait sorter.reorderItem(active, over);\nawait refreshList();\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't forget source parameter:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u274c Wrong - permission validation fails\nbody: { active_id, active_sequence, over_id, over_sequence, sort_column_name }\n\n// \u2705 Correct\nbody: { ..., source: 'productList' }\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't sort across different groups without extra_cond:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u274c Wrong - sorts all products globally\nawait sorter.reorderItem(active, over);\n\n// \u2705 Correct - sorts within category only\nconst extraCond = `XPRD05 = '${category}'`;\nawait sorter.reorderItem(active, over, extraCond);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.h3,{id:"missing-required-fields",children:"Missing Required Fields"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "active_id": "123",\n  "sort_column_name": "XPRD40"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response (500):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "code": 500,\n  "msg": "Invalid body provided for Sort operation! Fix errors before retry.",\n  "errors": [\n    "Missing active_sequence",\n    "Missing over_id",\n    "Missing over_sequence"\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"permission-denied",children:"Permission Denied"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response (403):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "code": 403,\n  "message": "Insufficient permissions for sort operation",\n  "required_grant": 2,\n  "user_grant": 1\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"use-case-category-scoped-product-sorting",children:"Use Case: Category-Scoped Product Sorting"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"class CategoryProductSorter {\n  constructor(apiBase, token) {\n    this.apiBase = apiBase;\n    this.token = token;\n  }\n\n  async loadCategory(categoryId) {\n    const response = await fetch(\n      `/api/v4/core/PRD?source=productList` +\n      `&$filter=XPRD05 eq '${categoryId}'` +\n      `&$order=XPRD40 ASC`,\n      {\n        headers: { 'Authorization': `Bearer ${this.token}` }\n      }\n    );\n\n    return response.json();\n  }\n\n  async reorderInCategory(categoryId, activeItem, overItem) {\n    const response = await fetch(\n      `${this.apiBase}/api/v4/core/PRD/sort`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.token}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          active_id: activeItem.PRD_ID,\n          active_sequence: activeItem.XPRD40,\n          over_id: overItem.PRD_ID,\n          over_sequence: overItem.XPRD40,\n          sort_column_name: 'XPRD40',\n          extra_cond: `XPRD05 = '${categoryId}'`,\n          source: 'productList'\n        })\n      }\n    );\n\n    if (!response.ok) {\n      throw new Error('Sort failed');\n    }\n\n    return response.json();\n  }\n\n  async handleDrop(categoryId, activeProduct, targetProduct) {\n    try {\n      await this.reorderInCategory(categoryId, activeProduct, targetProduct);\n\n      // Refresh category products\n      const updatedProducts = await this.loadCategory(categoryId);\n      this.renderProducts(updatedProducts);\n    } catch (error) {\n      console.error('Sort error:', error);\n      alert('Failed to reorder products');\n    }\n  }\n\n  renderProducts(products) {\n    // Render logic here\n    console.log('Updated products:', products);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"Sort operations provide:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Drag-and-drop reordering via POST endpoint"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Automatic sequence recalculation with two algorithms"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Transaction-safe updates (ACID)"}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 Conditional sorting with ",(0,s.jsx)(n.code,{children:"extra_cond"})]}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Audit trail updates (LOWNER, LDATA)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Support for grouped sorting (category, parent, status)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"POST /api/v4/core/{DIM}/sort"})," for reordering"]}),"\n",(0,s.jsx)(n.li,{children:"Provide active and target item IDs with sequences"}),"\n",(0,s.jsxs)(n.li,{children:["Always specify ",(0,s.jsx)(n.code,{children:"sort_column_name"})," (sequence field)"]}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"extra_cond"})," for grouped sorting"]}),"\n",(0,s.jsx)(n.li,{children:"Refresh list after successful sort"}),"\n",(0,s.jsx)(n.li,{children:"Operations are transaction-safe and atomic"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Next:"})," ",(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/command-operations",children:"Command Operations \u2192"})]}),"\n",(0,s.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/write-operations",children:"Write Operations"})," - Understanding LOWNER/LDATA updates"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/read-operations",children:"Read Operations"})," - Using $order for sorted retrieval"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/permissions",children:"Permissions"})," - Grant level requirements for sort"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>d,M:()=>o});var s=r(1504);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);