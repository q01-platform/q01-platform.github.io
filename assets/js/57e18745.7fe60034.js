"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[1776],{1404:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>g,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var s=r(7624),a=r(2172);const i={title:"Aggregations",sidebar_label:"Aggregations",sidebar_position:8,description:"COUNT, SUM, AVG and GROUP BY operations for reporting"},l="Aggregations",o={id:"products/map.q01.io/core-api-platform-v4/query-patterns/aggregations",title:"Aggregations",description:"COUNT, SUM, AVG and GROUP BY operations for reporting",source:"@site/docs/products/map.q01.io/core-api-platform-v4/03-query-patterns/aggregations.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/03-query-patterns",slug:"/products/map.q01.io/core-api-platform-v4/query-patterns/aggregations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/aggregations",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Aggregations",sidebar_label:"Aggregations",sidebar_position:8,description:"COUNT, SUM, AVG and GROUP BY operations for reporting"},sidebar:"mapSidebar",previous:{title:"Relational Queries",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/relational-queries"},next:{title:"Full-Text Search",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/full-text-search"}},t={},c=[{value:"Overview",id:"overview",level:2},{value:"Basic Aggregations",id:"basic-aggregations",level:2},{value:"COUNT - Count Records",id:"count---count-records",level:3},{value:"SUM - Total Values",id:"sum---total-values",level:3},{value:"AVG - Average Values",id:"avg---average-values",level:3},{value:"GROUP BY Aggregations",id:"group-by-aggregations",level:2},{value:"Count by Category",id:"count-by-category",level:3},{value:"Sales by Month",id:"sales-by-month",level:3},{value:"Common Aggregation Patterns",id:"common-aggregation-patterns",level:2},{value:"Pattern 1: Dashboard Statistics",id:"pattern-1-dashboard-statistics",level:3},{value:"Pattern 2: Top N Report",id:"pattern-2-top-n-report",level:3},{value:"Pattern 3: Period Comparison",id:"pattern-3-period-comparison",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Indexed GROUP BY",id:"indexed-group-by",level:3},{value:"Aggregation Caching",id:"aggregation-caching",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"aggregations",children:"Aggregations"}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Aggregation queries perform calculations across multiple records: COUNT, SUM, AVG, MIN, MAX. Core APIs support aggregations through ",(0,s.jsx)(n.strong,{children:"TB_OBJECT views"})," with GROUP BY clauses."]}),"\n",(0,s.jsx)(n.h2,{id:"basic-aggregations",children:"Basic Aggregations"}),"\n",(0,s.jsx)(n.h3,{id:"count---count-records",children:"COUNT - Count Records"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Count total products:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Define in TB_OBJECT\nVIEW_SCHEMA:\nSELECT COUNT(*) as TOTAL_PRODUCTS\nFROM TB_ANAG_PRD00\nWHERE TREC != 'C'\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Query:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD_COUNT?source=productStats\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "data": [\n    {"TOTAL_PRODUCTS": 1250}\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"sum---total-values",children:"SUM - Total Values"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Total inventory value:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"VIEW_SCHEMA:\nSELECT SUM(XPRD02 * XPRD09) as TOTAL_VALUE\nFROM TB_ANAG_PRD00\nWHERE TREC != 'C'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"avg---average-values",children:"AVG - Average Values"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Average product price:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"VIEW_SCHEMA:\nSELECT AVG(XPRD02) as AVG_PRICE\nFROM TB_ANAG_PRD00\nWHERE TREC != 'C' AND XPRD06 = 1\n"})}),"\n",(0,s.jsx)(n.h2,{id:"group-by-aggregations",children:"GROUP BY Aggregations"}),"\n",(0,s.jsx)(n.h3,{id:"count-by-category",children:"Count by Category"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Products per category:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"VIEW_SCHEMA:\nSELECT\n  XPRD05 as CATEGORY,\n  COUNT(*) as PRODUCT_COUNT,\n  AVG(XPRD02) as AVG_PRICE,\n  SUM(XPRD09) as TOTAL_STOCK\nFROM TB_ANAG_PRD00\nWHERE TREC != 'C'\nGROUP BY XPRD05\nORDER BY PRODUCT_COUNT DESC\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "data": [\n    {\n      "CATEGORY": "Electronics",\n      "PRODUCT_COUNT": 450,\n      "AVG_PRICE": 299.99,\n      "TOTAL_STOCK": 2500\n    },\n    {\n      "CATEGORY": "Toys",\n      "PRODUCT_COUNT": 320,\n      "AVG_PRICE": 49.99,\n      "TOTAL_STOCK": 5000\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"sales-by-month",children:"Sales by Month"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Monthly revenue:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"VIEW_SCHEMA:\nSELECT\n  DATE_FORMAT(CDATA, '%Y-%m') as MONTH,\n  COUNT(*) as ORDER_COUNT,\n  SUM(XORD03) as TOTAL_REVENUE,\n  AVG(XORD03) as AVG_ORDER_VALUE\nFROM TB_ANAG_ORD00\nWHERE TREC != 'C'\nGROUP BY DATE_FORMAT(CDATA, '%Y-%m')\nORDER BY MONTH DESC\n"})}),"\n",(0,s.jsx)(n.h2,{id:"common-aggregation-patterns",children:"Common Aggregation Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"pattern-1-dashboard-statistics",children:"Pattern 1: Dashboard Statistics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"VIEW_SCHEMA:\nSELECT\n  COUNT(CASE WHEN XPRD06 = 1 THEN 1 END) as ACTIVE_PRODUCTS,\n  COUNT(CASE WHEN XPRD06 = 0 THEN 1 END) as INACTIVE_PRODUCTS,\n  COUNT(CASE WHEN XPRD09 = 0 THEN 1 END) as OUT_OF_STOCK,\n  SUM(XPRD02 * XPRD09) as INVENTORY_VALUE\nFROM TB_ANAG_PRD00\nWHERE TREC != 'C'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"pattern-2-top-n-report",children:"Pattern 2: Top N Report"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Top 10 customers by revenue:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"VIEW_SCHEMA:\nSELECT\n  c.CLI_ID,\n  c.XCLI01 as CUSTOMER_NAME,\n  COUNT(o.ORD_ID) as ORDER_COUNT,\n  SUM(o.XORD03) as TOTAL_REVENUE\nFROM TB_ANAG_CLI00 c\nLEFT JOIN TB_ANAG_ORD00 o ON c.CLI_ID = o.XORD09\nWHERE c.TREC != 'C' AND o.TREC != 'C'\nGROUP BY c.CLI_ID, c.XCLI01\nORDER BY TOTAL_REVENUE DESC\nLIMIT 10\n"})}),"\n",(0,s.jsx)(n.h3,{id:"pattern-3-period-comparison",children:"Pattern 3: Period Comparison"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Year-over-year comparison:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"VIEW_SCHEMA:\nSELECT\n  DATE_FORMAT(CDATA, '%m') as MONTH,\n  SUM(CASE WHEN YEAR(CDATA) = 2025 THEN XORD03 ELSE 0 END) as REVENUE_2025,\n  SUM(CASE WHEN YEAR(CDATA) = 2024 THEN XORD03 ELSE 0 END) as REVENUE_2024\nFROM TB_ANAG_ORD00\nWHERE TREC != 'C'\nGROUP BY DATE_FORMAT(CDATA, '%m')\nORDER BY MONTH\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,s.jsx)(n.h3,{id:"indexed-group-by",children:"Indexed GROUP BY"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u2705 Fast - Group by indexed field:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"GROUP BY XPRD05  -- Indexed category field\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u26a0\ufe0f Slower - Group by non-indexed field:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"GROUP BY XPRD04  -- Non-indexed text field\n"})}),"\n",(0,s.jsx)(n.h3,{id:"aggregation-caching",children:"Aggregation Caching"}),"\n",(0,s.jsx)(n.p,{children:"For expensive aggregations:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create materialized view in database"}),"\n",(0,s.jsx)(n.li,{children:"Schedule periodic refresh"}),"\n",(0,s.jsx)(n.li,{children:"Query cached results via Core APIs"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Group by indexed fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"GROUP BY XPRD05, XPRD06  -- Indexed fields\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Include TREC filter:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"WHERE TREC != 'C'\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Limit result sets:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"ORDER BY TOTAL_REVENUE DESC\nLIMIT 100\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't group by large text fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Slow\nGROUP BY XPRD04  -- Long description field\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't aggregate without indexes:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Slow on large tables\nGROUP BY non_indexed_field\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Use TB_OBJECT views for aggregations"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Support COUNT, SUM, AVG, MIN, MAX"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 GROUP BY enables grouped aggregations"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Always include TREC filtering"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Index fields used in GROUP BY"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Next:"})," ",(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/full-text-search",children:"Full-Text Search \u2192"})]}),"\n",(0,s.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/relational-queries",children:"Relational Queries"})," - JOIN patterns"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/query-performance",children:"Query Performance"})," - Optimization"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/map-framework",children:"TB_OBJECT"})," - View definitions"]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,a.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>o,M:()=>l});var s=r(1504);const a={},i=s.createContext(a);function l(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);