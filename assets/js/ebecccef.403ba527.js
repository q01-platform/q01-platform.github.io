"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[3514],{3604:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>d,toc:()=>o});var r=i(7624),s=i(2172);const a={title:"Validation",sidebar_label:"Multi-Level Validation",sidebar_position:6,description:"Request validation layers and error handling"},l="Multi-Level Validation",d={id:"products/map.q01.io/core-api-platform-v4/write-patterns/validation",title:"Validation",description:"Request validation layers and error handling",source:"@site/docs/products/map.q01.io/core-api-platform-v4/04-write-patterns/validation.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/04-write-patterns",slug:"/products/map.q01.io/core-api-platform-v4/write-patterns/validation",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/validation",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Validation",sidebar_label:"Multi-Level Validation",sidebar_position:6,description:"Request validation layers and error handling"},sidebar:"mapSidebar",previous:{title:"Delete Operations (DELETE)",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/delete-operations"},next:{title:"ACID Transactions",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/transactions"}},t={},o=[{value:"Overview",id:"overview",level:2},{value:"Validation Flow",id:"validation-flow",level:2},{value:"Request Processing",id:"request-processing",level:3},{value:"Validation Middleware Architecture",id:"validation-middleware-architecture",level:3},{value:"Layer 1: Token Validation",id:"layer-1-token-validation",level:2},{value:"JWT Validation",id:"jwt-validation",level:3},{value:"Common Token Errors",id:"common-token-errors",level:3},{value:"Layer 2: Grant Validation",id:"layer-2-grant-validation",level:2},{value:"Permission Check via TB_MENU",id:"permission-check-via-tb_menu",level:3},{value:"Layer 3: Required Field Validation",id:"layer-3-required-field-validation",level:2},{value:"TB_COST.REQUIRED=&#39;1&#39;",id:"tb_costrequired1",level:3},{value:"Layer 4: COD_ON_OFF Validation",id:"layer-4-cod_on_off-validation",level:2},{value:"Field Visibility Flags",id:"field-visibility-flags",level:3},{value:"COD_UTENTE Weight-Based Access Control",id:"cod_utente-weight-based-access-control",level:3},{value:"Layer 5: Business Logic Validation",id:"layer-5-business-logic-validation",level:2},{value:"Custom Validation Rules",id:"custom-validation-rules",level:3},{value:"AC/VARS Foreign Key Validation",id:"acvars-foreign-key-validation",level:3},{value:"JavaScript Validation Handling",id:"javascript-validation-handling",level:2},{value:"Client-Side Validation",id:"client-side-validation",level:3},{value:"Error Handling",id:"error-handling",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"multi-level-validation",children:"Multi-Level Validation"}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["Every write operation passes through ",(0,r.jsx)(n.strong,{children:"5 validation layers"})," before execution. This ensures data integrity, security, and business rule compliance."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validation Layers:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Token Validation"})," - JWT signature, expiration, issuer"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Grant Validation"})," - User permissions via TB_MENU"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Required Field Validation"})," - TB_COST.REQUIRED='1'"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"COD_ON_OFF Validation"})," - Field visibility flags"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Business Logic Validation"})," - Custom rules (optional)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Failure at any layer"})," rejects the entire request."]}),"\n",(0,r.jsx)(n.h2,{id:"validation-flow",children:"Validation Flow"}),"\n",(0,r.jsx)(n.h3,{id:"request-processing",children:"Request Processing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"POST /api/v4/core/PRD\n    \u2193\n1. Token Validation\n   \u2514\u2500 Valid? \u2192 Continue\n   \u2514\u2500 Invalid? \u2192 401 Unauthorized\n    \u2193\n2. Grant Validation\n   \u2514\u2500 Has permission? \u2192 Continue\n   \u2514\u2500 No permission? \u2192 403 Forbidden\n    \u2193\n3. Required Field Validation\n   \u2514\u2500 All required fields present? \u2192 Continue\n   \u2514\u2500 Missing field? \u2192 400 ValidationError\n    \u2193\n4. COD_ON_OFF Validation\n   \u2514\u2500 Fields allowed for operation? \u2192 Continue\n   \u2514\u2500 Field not allowed? \u2192 400 ValidationError\n    \u2193\n5. Business Logic Validation (optional)\n   \u2514\u2500 Custom rules pass? \u2192 Continue\n   \u2514\u2500 Rule violation? \u2192 400 BusinessRuleError\n    \u2193\nExecute Write Operation\n"})}),"\n",(0,r.jsx)(n.h3,{id:"validation-middleware-architecture",children:"Validation Middleware Architecture"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Symfony Event Dispatcher Chain:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"HTTP Request\n    \u2193\nCoreService (API Gateway) - Routing\n    \u2193\nCoreWrite (Symfony) - Event Dispatcher\n    \u2193\nRequestValidatorSubscriber::onKernelRequest\n    \u251c\u2500 TokenValidatorMiddleware\n    \u2502    \u2514\u2500 JWT decode, signature verification, expiration check\n    \u2502         \u2514\u2500 Success \u2192 Continue\n    \u2502         \u2514\u2500 Failure \u2192 401 Unauthorized\n    \u251c\u2500 GrantValidatorMiddleware\n    \u2502    \u2514\u2500 TB_MENU nested set query, permission check\n    \u2502         \u2514\u2500 Success \u2192 Continue\n    \u2502         \u2514\u2500 Failure \u2192 403 Forbidden\n    \u251c\u2500 RequiredFieldValidatorMiddleware\n    \u2502    \u2514\u2500 TB_COST.REQUIRED='1' check\n    \u2502         \u2514\u2500 Success \u2192 Continue\n    \u2502         \u2514\u2500 Failure \u2192 400 ValidationError\n    \u251c\u2500 COD_ON_OFF_ValidatorMiddleware\n    \u2502    \u2514\u2500 TB_COST.COD_ON_OFF flag check (N/M based on operation)\n    \u2502         \u2514\u2500 Success \u2192 Continue\n    \u2502         \u2514\u2500 Failure \u2192 400 ValidationError\n    \u2514\u2500 BusinessLogicValidatorMiddleware (optional)\n         \u2514\u2500 Custom rules, foreign key checks, AC/VARS validation\n              \u2514\u2500 Success \u2192 Controller\n              \u2514\u2500 Failure \u2192 400 BusinessRuleError\n    \u2193\nController \u2192 DataStore \u2192 Database\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// src/EventDispatcher/Subscriber/RequestValidatorSubscriber.php\n\nclass RequestValidatorSubscriber implements EventSubscriberInterface\n{\n    public static function getSubscribedEvents(): array\n    {\n        return [\n            KernelEvents::REQUEST => [\n                ['validateToken', 100],       // Priority 100 - first\n                ['validateGrant', 90],        // Priority 90  - second\n                ['validateRequiredFields', 80], // Priority 80  - third\n                ['validateCOD_ON_OFF', 70],   // Priority 70  - fourth\n                ['validateBusinessLogic', 60]  // Priority 60  - fifth\n            ],\n        ];\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Points:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Middleware runs in priority order (100 \u2192 60)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Failure at any middleware stops the chain"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 RequestValidatorSubscriber orchestrates all validation"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Each middleware is single-purpose (SOLID principles)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"layer-1-token-validation",children:"Layer 1: Token Validation"}),"\n",(0,r.jsx)(n.h3,{id:"jwt-validation",children:"JWT Validation"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validates Authorization header:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"POST /api/v4/core/PRD\nAuthorization: Bearer eyJhbGciOiJIUzI1NiIs...\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Checks:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Signature valid (cryptographic verification)"}),"\n",(0,r.jsxs)(n.li,{children:["Not expired (",(0,r.jsx)(n.code,{children:"exp"})," claim)"]}),"\n",(0,r.jsxs)(n.li,{children:["Correct issuer (",(0,r.jsx)(n.code,{children:"iss"})," claim)"]}),"\n",(0,r.jsx)(n.li,{children:"Valid format (3-part JWT)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Success:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "user": "user@example.com",\n  "tenant": "company_abc",\n  "roles": ["admin", "product_manager"],\n  "exp": 1703012345\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Failure:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "error": "UnauthorizedError",\n  "message": "Invalid or expired token",\n  "code": "TOKEN_INVALID",\n  "status": 401\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"common-token-errors",children:"Common Token Errors"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// Expired token\n{\n  "code": "TOKEN_EXPIRED",\n  "message": "Token has expired",\n  "status": 401\n}\n\n// Invalid signature\n{\n  "code": "TOKEN_INVALID_SIGNATURE",\n  "message": "Token signature verification failed",\n  "status": 401\n}\n\n// Missing token\n{\n  "code": "TOKEN_MISSING",\n  "message": "Authorization header missing",\n  "status": 401\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"layer-2-grant-validation",children:"Layer 2: Grant Validation"}),"\n",(0,r.jsx)(n.h3,{id:"permission-check-via-tb_menu",children:"Permission Check via TB_MENU"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"TB_MENU nested set determines user permissions:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- User grants stored in TB_MENU hierarchy\nSELECT *\nFROM TB_MENU\nWHERE COD_MENU IN (user_grants)\n  AND NLEFT <= (SELECT NLEFT FROM TB_MENU WHERE COD_MENU = target_area)\n  AND NRIGHT >= (SELECT NRIGHT FROM TB_MENU WHERE COD_MENU = target_area);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Grant Hierarchy:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"admin (NLEFT=1, NRIGHT=100)\n\u251c\u2500\u2500 products (NLEFT=2, NRIGHT=50)\n\u2502   \u251c\u2500\u2500 products.read (NLEFT=3, NRIGHT=20)\n\u2502   \u2514\u2500\u2500 products.write (NLEFT=21, NRIGHT=49)\n\u2502       \u251c\u2500\u2500 products.create (NLEFT=22, NRIGHT=30)\n\u2502       \u251c\u2500\u2500 products.update (NLEFT=31, NRIGHT=39)\n\u2502       \u2514\u2500\u2500 products.delete (NLEFT=40, NRIGHT=48)\n\u2514\u2500\u2500 orders (NLEFT=51, NRIGHT=99)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["User with ",(0,r.jsx)(n.code,{children:"products.write"})," grant can:"]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Create products (POST)"}),"\n",(0,r.jsx)(n.li,{children:"Update products (PUT/PATCH)"}),"\n",(0,r.jsx)(n.li,{children:"Delete products (DELETE)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["User with only ",(0,r.jsx)(n.code,{children:"products.read"})," grant cannot:"]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Create/update/delete products"}),"\n",(0,r.jsx)(n.li,{children:"Receives 403 Forbidden"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Failure:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "error": "ForbiddenError",\n  "message": "Insufficient permissions for this operation",\n  "code": "GRANT_DENIED",\n  "required_grant": "products.write",\n  "user_grants": ["products.read"],\n  "status": 403\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"layer-3-required-field-validation",children:"Layer 3: Required Field Validation"}),"\n",(0,r.jsx)(n.h3,{id:"tb_costrequired1",children:"TB_COST.REQUIRED='1'"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Metadata marks mandatory fields:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, REQUIRED, DESCRIZIONE_COST) VALUES\n('PRD', 1, 'XPRD01', 1, 'Product name'),  -- Required\n('PRD', 2, 'XPRD02', 1, 'Price'),         -- Required\n('PRD', 4, 'XPRD04', 0, 'Description'),   -- Optional\n('PRD', 5, 'XPRD05', 1, 'Category');      -- Required\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validation Logic:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// CoreWrite RequestValidatorSubscriber.php\nforeach ($costs as $cost) {\n    if ($cost['REQUIRED'] == 1 && !isset($data[$cost['COD_VAR']])) {\n        throw new ValidationException(\n            \"Required field missing: {$cost['COD_VAR']}\",\n            'REQUIRED_FIELD_MISSING',\n            $cost['COD_VAR']\n        );\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request Missing Required Field:"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD02": 99.99,\n    "XPRD04": "Description"\n    // Missing XPRD01 (required)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Response:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "error": "ValidationError",\n  "message": "Required field missing: XPRD01",\n  "code": "REQUIRED_FIELD_MISSING",\n  "field": "XPRD01",\n  "fieldDescription": "Product name",\n  "status": 400\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"layer-4-cod_on_off-validation",children:"Layer 4: COD_ON_OFF Validation"}),"\n",(0,r.jsx)(n.h3,{id:"field-visibility-flags",children:"Field Visibility Flags"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"TB_COST.COD_ON_OFF controls field usage:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, COD_ON_OFF) VALUES\n('PRD', 1, 'XPRD01', 'LDNMR'),  -- Allowed: List, Detail, New, Modify, Ricerca\n('PRD', 3, 'XPRD03', 'LDR'),    -- Allowed: List, Detail, Ricerca (read-only counter)\n('PRD', 12, 'XPRD12', 'LDM');   -- Allowed: List, Detail, Modify (not on creation)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Operation Checks:"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Operation"}),(0,r.jsx)(n.th,{children:"Flag Required"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"POST"}),(0,r.jsx)(n.td,{children:"N (New)"}),(0,r.jsx)(n.td,{children:"Field can be set on creation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"PUT/PATCH"}),(0,r.jsx)(n.td,{children:"M (Modify)"}),(0,r.jsx)(n.td,{children:"Field can be updated"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"GET"}),(0,r.jsx)(n.td,{children:"L/D/R"}),(0,r.jsx)(n.td,{children:"Field visible in queries"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validation Example (POST):"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD01": "Product",      // \u2705 COD_ON_OFF=\'LDNMR\' (N flag present)\n    "XPRD03": "PRD-2025-001", // \u274c COD_ON_OFF=\'LDR\' (N flag missing)\n    "XPRD12": "image.jpg"     // \u274c COD_ON_OFF=\'LDM\' (N flag missing)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Response:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "error": "ValidationError",\n  "message": "Field not allowed in create operation: XPRD03",\n  "code": "FIELD_NOT_CREATEABLE",\n  "field": "XPRD03",\n  "cod_on_off": "LDR",\n  "required_flag": "N",\n  "status": 400\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validation Example (PUT/PATCH):"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'PATCH /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD01": "Updated",      // \u2705 COD_ON_OFF=\'LDNMR\' (M flag present)\n    "XPRD03": "PRD-2025-999"  // \u274c COD_ON_OFF=\'LDR\' (M flag missing)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Response:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "error": "ValidationError",\n  "message": "Field not modifiable: XPRD03",\n  "code": "FIELD_NOT_MODIFIABLE",\n  "field": "XPRD03",\n  "cod_on_off": "LDR",\n  "required_flag": "M",\n  "status": 400\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"cod_utente-weight-based-access-control",children:"COD_UTENTE Weight-Based Access Control"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"TB_COST.COD_UTENTE defines minimum user weight required to access a field:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, COD_ON_OFF, COD_UTENTE) VALUES\n('PRD', 1, 'XPRD01', 'LDNMR', '*'),   -- All users can access\n('PRD', 8, 'XPRD08', 'LDNM', '70'),   -- Only users with peso >= 70\n('PRD', 15, 'XPRD15', 'LDM', '90');   -- Only users with peso >= 90 (admin)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"User Peso (Weight) Levels:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"peso = 1-30"}),": Admin users (full access)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"peso = 31-60"}),": Manager users (most fields)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"peso = 61-90"}),": Standard users (basic fields)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"peso = 91-100"}),": Limited users (read-only)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validation Logic:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Check user peso vs COD_UTENTE requirement\nif ($cost['COD_UTENTE'] !== '*' && $userPeso > $cost['COD_UTENTE']) {\n    throw new ValidationException(\n        \"Insufficient user weight to access field: {$cost['COD_VAR']}\",\n        'USER_WEIGHT_INSUFFICIENT',\n        $cost['COD_VAR']\n    );\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example: Manager (peso=50) Attempting to Modify Admin Field:"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'PATCH /api/v4/core/PRD/123\nAuthorization: Bearer {token}  # User with peso=50\n\n{\n  "data": {\n    "XPRD01": "Product Name",   // \u2705 COD_UTENTE=\'*\' (allowed)\n    "XPRD15": "Admin Value"     // \u274c COD_UTENTE=\'90\' (peso 50 < 90)\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Response:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "error": "ValidationError",\n  "message": "Insufficient user weight to modify field: XPRD15",\n  "code": "USER_WEIGHT_INSUFFICIENT",\n  "field": "XPRD15",\n  "required_peso": 90,\n  "user_peso": 50,\n  "status": 400\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Sensitive financial fields"})," (COD_UTENTE='10') - Only top admin access"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pricing fields"})," (COD_UTENTE='70') - Manager and above"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Standard product info"})," (COD_UTENTE='*') - All users"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"layer-5-business-logic-validation",children:"Layer 5: Business Logic Validation"}),"\n",(0,r.jsx)(n.h3,{id:"custom-validation-rules",children:"Custom Validation Rules"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Application-specific constraints (optional):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Custom validator in CoreWrite\nclass ProductValidator {\n    public function validate(array $data): void {\n        // Price must be positive\n        if (isset($data['XPRD02']) && $data['XPRD02'] <= 0) {\n            throw new BusinessRuleException(\n                'Price must be greater than zero',\n                'INVALID_PRICE'\n            );\n        }\n\n        // Stock cannot be negative\n        if (isset($data['XPRD09']) && $data['XPRD09'] < 0) {\n            throw new BusinessRuleException(\n                'Stock cannot be negative',\n                'INVALID_STOCK'\n            );\n        }\n\n        // Discount cannot exceed 100%\n        if (isset($data['XPRD_DISCOUNT']) && $data['XPRD_DISCOUNT'] > 100) {\n            throw new BusinessRuleException(\n                'Discount cannot exceed 100%',\n                'INVALID_DISCOUNT'\n            );\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Failure:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "error": "BusinessRuleError",\n  "message": "Price must be greater than zero",\n  "code": "INVALID_PRICE",\n  "field": "XPRD02",\n  "value": -10.00,\n  "status": 400\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"acvars-foreign-key-validation",children:"AC/VARS Foreign Key Validation"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"AC (Autocomplete) and VARS (Select) fields are foreign keys"})," that must reference existing records in the destination table. The platform prevents orphaned links by validating foreign key existence before insert/update."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validation Steps:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Type validation"})," - Ensure value matches TIPO_CAMPO definition (AC or VARS)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Foreign key existence check"})," - Verify value exists in destination table"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Return error if not found"})," - Prevent orphaned links"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Metadata Structure:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- TB_VAR: Field definition\nCOD_DIM: ART\nCOD_VAR: XART53\nTIPO_CAMPO: VARS\nTIPO_VAR: DEPFOOD  -- Foreign key to TB_ANAG_DEPFOOD00\n\n-- TB_OBJECT: Foreign key relationship\nCOD_DIM: ART (source dimension)\nCOD_VAR: XART53 (source field - stores foreign key)\nCOD_DIM_OBJ: DEPFOOD (destination dimension)\nCOD_VAR_OBJ: XDEPFOOD03 (destination field - primary key)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Relationship:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"TB_ANAG_ART00.XART53 \u2192 TB_ANAG_DEPFOOD00.XDEPFOOD03\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validation Logic:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// CoreWrite validates foreign key existence\nif ($var['TIPO_CAMPO'] === 'VARS' || $var['TIPO_CAMPO'] === 'AC') {\n    // Get destination table from TB_OBJECT\n    $foreignKey = $this->getForeignKeyDefinition($dim, $field);\n\n    // Check if foreign key value exists\n    $exists = $this->checkForeignKeyExists(\n        $foreignKey['COD_DIM_OBJ'],\n        $foreignKey['COD_VAR_OBJ'],\n        $value\n    );\n\n    if (!$exists) {\n        throw new ValidationException(\n            \"Invalid foreign key: {$field} references {$foreignKey['COD_DIM_OBJ']}, but '{$value}' does not exist\",\n            'INVALID_FOREIGN_KEY',\n            $field\n        );\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example: Valid Foreign Key:"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/ART\n{\n  "data": {\n    "XART20": "Product Name",\n    "XART53": "rep1"  // Must exist in TB_ANAG_DEPFOOD00.XDEPFOOD03\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validation Query:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT COUNT(*) FROM TB_ANAG_DEPFOOD00\nWHERE XDEPFOOD03 = 'rep1';  -- Must return > 0\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Success"}),": Record created if foreign key exists."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example: Invalid Foreign Key:"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/ART\n{\n  "data": {\n    "XART20": "Product Name",\n    "XART53": "invalid_dept"  // Does NOT exist in TB_ANAG_DEPFOOD00\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Response:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "error": "ValidationError",\n  "message": "Invalid foreign key: XART53 references DEPFOOD, but \'invalid_dept\' does not exist",\n  "code": "INVALID_FOREIGN_KEY",\n  "field": "XART53",\n  "foreign_table": "TB_ANAG_DEPFOOD00",\n  "foreign_field": "XDEPFOOD03",\n  "value": "invalid_dept",\n  "status": 400\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Why This Matters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Prevents orphaned links (referencing non-existent records)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Ensures data integrity across dimensions"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Validates foreign keys before database write"}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Client can query ",(0,r.jsx)(n.code,{children:"/api/v4/core/vars"})," to get valid values"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Related:"})," See ",(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/ac-vars-queries",children:"AC/VARS Queries"})," for how to query valid foreign key values."]}),"\n",(0,r.jsx)(n.h2,{id:"javascript-validation-handling",children:"JavaScript Validation Handling"}),"\n",(0,r.jsx)(n.h3,{id:"client-side-validation",children:"Client-Side Validation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"class ProductValidator {\n  /**\n   * Validate before POST\n   */\n  static validateCreate(data) {\n    const errors = [];\n\n    // Required field check\n    if (!data.XPRD01) {\n      errors.push({\n        field: 'XPRD01',\n        message: 'Product name is required'\n      });\n    }\n\n    if (!data.XPRD02) {\n      errors.push({\n        field: 'XPRD02',\n        message: 'Price is required'\n      });\n    }\n\n    if (!data.XPRD05) {\n      errors.push({\n        field: 'XPRD05',\n        message: 'Category is required'\n      });\n    }\n\n    // Business logic\n    if (data.XPRD02 && data.XPRD02 <= 0) {\n      errors.push({\n        field: 'XPRD02',\n        message: 'Price must be greater than zero'\n      });\n    }\n\n    if (data.XPRD09 && data.XPRD09 < 0) {\n      errors.push({\n        field: 'XPRD09',\n        message: 'Stock cannot be negative'\n      });\n    }\n\n    return errors;\n  }\n\n  /**\n   * Validate before PUT/PATCH\n   */\n  static validateUpdate(data) {\n    const errors = [];\n\n    // Business logic\n    if (data.XPRD02 !== undefined && data.XPRD02 <= 0) {\n      errors.push({\n        field: 'XPRD02',\n        message: 'Price must be greater than zero'\n      });\n    }\n\n    if (data.XPRD09 !== undefined && data.XPRD09 < 0) {\n      errors.push({\n        field: 'XPRD09',\n        message: 'Stock cannot be negative'\n      });\n    }\n\n    return errors;\n  }\n}\n\n// Usage\nasync function createProduct(data) {\n  // Client-side validation\n  const errors = ProductValidator.validateCreate(data);\n  if (errors.length > 0) {\n    alert(`Validation errors:\\n${errors.map(e => `- ${e.message}`).join('\\n')}`);\n    return;\n  }\n\n  // API call\n  try {\n    const response = await fetch(`${apiBase}/api/v4/core/PRD`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({ data })\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      handleValidationError(error);\n      return;\n    }\n\n    const result = await response.json();\n    alert('Product created successfully!');\n    return result;\n  } catch (error) {\n    alert('Network error');\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"function handleValidationError(error) {\n  switch (error.code) {\n    case 'TOKEN_INVALID':\n    case 'TOKEN_EXPIRED':\n      // Redirect to login\n      window.location.href = '/login';\n      break;\n\n    case 'GRANT_DENIED':\n      alert(`Access denied: You don't have permission for this operation`);\n      break;\n\n    case 'REQUIRED_FIELD_MISSING':\n      alert(`Required field missing: ${error.field}`);\n      highlightField(error.field);\n      break;\n\n    case 'FIELD_NOT_CREATEABLE':\n      alert(`Field ${error.field} cannot be set on creation`);\n      break;\n\n    case 'FIELD_NOT_MODIFIABLE':\n      alert(`Field ${error.field} is read-only`);\n      break;\n\n    case 'INVALID_PRICE':\n    case 'INVALID_STOCK':\n    case 'INVALID_DISCOUNT':\n      alert(error.message);\n      highlightField(error.field);\n      break;\n\n    default:\n      alert(`Validation error: ${error.message}`);\n  }\n}\n\nfunction highlightField(fieldName) {\n  const input = document.querySelector(`[name=\"${fieldName}\"]`);\n  if (input) {\n    input.classList.add('error');\n    input.focus();\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Validate client-side before API call:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - catch errors early\nconst errors = validateCreate(data);\nif (errors.length > 0) {\n  showErrors(errors);\n  return;\n}\nawait createProduct(data);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Handle specific error codes:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - specific handling\nif (error.code === 'REQUIRED_FIELD_MISSING') {\n  highlightField(error.field);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Provide clear error messages:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - user-friendly\nalert(`${error.fieldDescription} is required`);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Don't skip client-side validation:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - unnecessary API roundtrip\nawait createProduct(data);  // Will fail with obvious errors\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Don't show technical error codes to users:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// \u274c Bad - confusing\nalert(error.code);  // "REQUIRED_FIELD_MISSING"\n\n// \u2705 Good - user-friendly\nalert(`Please fill in ${error.fieldDescription}`);\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Don't try to set read-only fields:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// \u274c Bad - will be rejected\n{\n  "data": {\n    "XPRD03": "custom-code",  // Auto-generated counter\n    "TREC": "N"  // Auto-managed\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 5 validation layers: Token \u2192 Grant \u2192 Required \u2192 COD_ON_OFF \u2192 Business Logic"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Failure at any layer rejects entire request"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Token validation ensures authentication (401 Unauthorized)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Grant validation ensures authorization (403 Forbidden)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Required field validation via TB_COST.REQUIRED='1'"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 COD_ON_OFF validation enforces N (create) and M (modify) flags"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Business logic validation enforces custom rules"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Validation happens at 5 layers before write execution"}),"\n",(0,r.jsx)(n.li,{children:"Token validation: JWT signature, expiration, issuer"}),"\n",(0,r.jsx)(n.li,{children:"Grant validation: TB_MENU nested set permissions"}),"\n",(0,r.jsx)(n.li,{children:"Required fields: TB_COST.REQUIRED='1'"}),"\n",(0,r.jsx)(n.li,{children:"COD_ON_OFF: N flag for POST, M flag for PUT/PATCH"}),"\n",(0,r.jsx)(n.li,{children:"Client-side validation reduces unnecessary API calls"}),"\n",(0,r.jsx)(n.li,{children:"Handle specific error codes for better UX"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Error Code Reference:"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Code"}),(0,r.jsx)(n.th,{children:"Layer"}),(0,r.jsx)(n.th,{children:"HTTP Status"}),(0,r.jsx)(n.th,{children:"Meaning"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TOKEN_INVALID"}),(0,r.jsx)(n.td,{children:"1"}),(0,r.jsx)(n.td,{children:"401"}),(0,r.jsx)(n.td,{children:"Invalid/expired token"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"GRANT_DENIED"}),(0,r.jsx)(n.td,{children:"2"}),(0,r.jsx)(n.td,{children:"403"}),(0,r.jsx)(n.td,{children:"Insufficient permissions"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"REQUIRED_FIELD_MISSING"}),(0,r.jsx)(n.td,{children:"3"}),(0,r.jsx)(n.td,{children:"400"}),(0,r.jsx)(n.td,{children:"Mandatory field missing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"FIELD_NOT_CREATEABLE"}),(0,r.jsx)(n.td,{children:"4"}),(0,r.jsx)(n.td,{children:"400"}),(0,r.jsx)(n.td,{children:"Field missing N flag"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"FIELD_NOT_MODIFIABLE"}),(0,r.jsx)(n.td,{children:"4"}),(0,r.jsx)(n.td,{children:"400"}),(0,r.jsx)(n.td,{children:"Field missing M flag"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"INVALID_*"}),(0,r.jsx)(n.td,{children:"5"}),(0,r.jsx)(n.td,{children:"400"}),(0,r.jsx)(n.td,{children:"Business rule violation"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Next:"})," ",(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/transactions",children:"Transactions \u2192"})]}),"\n",(0,r.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/field-visibility",children:"Field Visibility"})," - COD_ON_OFF flags"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/context-chain",children:"Context Chain"})," - source/peso/ambiente"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/permissions",children:"Multi-Level Permissions"})," - TB_MENU grants"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},2172:(e,n,i)=>{i.d(n,{I:()=>d,M:()=>l});var r=i(1504);const s={},a=r.createContext(s);function l(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);