"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[7536],{7748:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>c});var i=r(7624),t=r(2172);const s={title:"Write Patterns",sidebar_label:"Write Patterns",sidebar_position:5,description:"Data modification operations and CRUD patterns"},a="Write Patterns",d={id:"products/map.q01.io/core-api-platform-v4/write-patterns/index",title:"Write Patterns",description:"Data modification operations and CRUD patterns",source:"@site/docs/products/map.q01.io/core-api-platform-v4/04-write-patterns/index.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/04-write-patterns",slug:"/products/map.q01.io/core-api-platform-v4/write-patterns/",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Write Patterns",sidebar_label:"Write Patterns",sidebar_position:5,description:"Data modification operations and CRUD patterns"},sidebar:"mapSidebar",previous:{title:"AC/VARS Queries",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/ac-vars-queries"},next:{title:"Create Operations (POST)",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/create-operations"}},l={},c=[{value:"Overview",id:"overview",level:2},{value:"Write Flow Architecture",id:"write-flow-architecture",level:2},{value:"Request Flow",id:"request-flow",level:3},{value:"Internal Routing",id:"internal-routing",level:3},{value:"TREC Lifecycle",id:"trec-lifecycle",level:2},{value:"Record States",id:"record-states",level:3},{value:"State Transitions",id:"state-transitions",level:3},{value:"Audit Fields",id:"audit-fields",level:3},{value:"Write Operations Summary",id:"write-operations-summary",level:2},{value:"POST - Create Record",id:"post---create-record",level:3},{value:"PUT - Full Update",id:"put---full-update",level:3},{value:"PATCH - Partial Update",id:"patch---partial-update",level:3},{value:"DELETE - Soft or Force Delete",id:"delete---soft-or-force-delete",level:3},{value:"Multi-Level Validation",id:"multi-level-validation",level:2},{value:"Validation Layers",id:"validation-layers",level:3},{value:"Validation Example",id:"validation-example",level:3},{value:"Pre-Insert Functions",id:"pre-insert-functions",level:2},{value:"Automatic Field Population",id:"automatic-field-population",level:3},{value:"Cascade Operations",id:"cascade-operations",level:2},{value:"Metadata-Driven Cascades",id:"metadata-driven-cascades",level:3},{value:"Outbox Pattern",id:"outbox-pattern",level:2},{value:"Event Sourcing",id:"event-sourcing",level:3},{value:"Transaction Management",id:"transaction-management",level:2},{value:"ACID Guarantees",id:"acid-guarantees",level:3},{value:"Write Patterns by Use Case",id:"write-patterns-by-use-case",level:2},{value:"Pattern 1: Simple Create",id:"pattern-1-simple-create",level:3},{value:"Pattern 2: Create with Cascades",id:"pattern-2-create-with-cascades",level:3},{value:"Pattern 3: Partial Update",id:"pattern-3-partial-update",level:3},{value:"Pattern 4: Soft Delete with Undo",id:"pattern-4-soft-delete-with-undo",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"write-patterns",children:"Write Patterns"}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["Write operations modify data through ",(0,i.jsx)(n.strong,{children:"CoreService API endpoints"})," routed internally to ",(0,i.jsx)(n.strong,{children:"CoreWrite backend"}),". All writes are metadata-driven, validated, transactional, and event-sourced."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Write Operations:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"POST"})," - Create new records (TREC='N')"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PUT"})," - Full update existing records (TREC='M')"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PATCH"})," - Partial update specific fields (TREC='M')"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"DELETE"})," - Soft or force delete records (TREC='C' or physical removal)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"write-flow-architecture",children:"Write Flow Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"request-flow",children:"Request Flow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Client Application\n    \u2193\nPOST /api/v4/core/PRD\n    \u2193\nCoreService (API Gateway)\n    \u2193 [Routes to WRITE_API]\n    \u2193\nCoreWrite (PHP/Symfony)\n    \u2193\n1. Token validation\n2. Grant validation\n3. Required field validation\n4. COD_ON_OFF validation\n5. Pre-insert functions\n6. Database write (ACID transaction)\n7. Outbox event (RabbitMQ)\n    \u2193\nResponse + Event published\n"})}),"\n",(0,i.jsx)(n.h3,{id:"internal-routing",children:"Internal Routing"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CoreService automatically routes write requests:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// In CoreService routingController.go\nfunc RoutingDefault(c buffalo.Context) error {\n  routeName := c.Value("current_route").(buffalo.RouteInfo).PathName\n\n  switch routeName {\n  case "coreCreatePath":   // POST\n    return routingPost(c, "WRITE_API")\n  case "coreUpdatePath":   // PUT\n    return routingPut(c, "WRITE_API")\n  case "corePatchPath":    // PATCH\n    return routingPatch(c, "WRITE_API")\n  case "coreDeletePath":   // DELETE\n    return routingDelete(c, "WRITE_API")\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"User perspective:"})," Single API endpoint with different HTTP methods."]}),"\n",(0,i.jsx)(n.h2,{id:"trec-lifecycle",children:"TREC Lifecycle"}),"\n",(0,i.jsx)(n.h3,{id:"record-states",children:"Record States"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"TREC (Transaction Record) tracks lifecycle:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"State"}),(0,i.jsx)(n.th,{children:"Meaning"}),(0,i.jsx)(n.th,{children:"Set By"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"N"})}),(0,i.jsx)(n.td,{children:"New"}),(0,i.jsx)(n.td,{children:"POST"}),(0,i.jsx)(n.td,{children:"Record created"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"M"})}),(0,i.jsx)(n.td,{children:"Modified"}),(0,i.jsx)(n.td,{children:"PUT/PATCH"}),(0,i.jsx)(n.td,{children:"Record updated"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"C"})}),(0,i.jsx)(n.td,{children:"Cancelled"}),(0,i.jsx)(n.td,{children:"DELETE (soft)"}),(0,i.jsx)(n.td,{children:"Soft deleted"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"P"})}),(0,i.jsx)(n.td,{children:"Processed"}),(0,i.jsx)(n.td,{children:"Special"}),(0,i.jsx)(n.td,{children:"Custom state (rare)"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"state-transitions",children:"State Transitions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"POST (Create)\n    \u2193\n  TREC='N' (New)\n    \u2193\nPUT/PATCH (Update)\n    \u2193\n  TREC='M' (Modified)\n    \u2193\nDELETE?force=false (Soft Delete)\n    \u2193\n  TREC='C' (Cancelled)\n\nDELETE?force=true (Force Delete)\n    \u2193\n  Record physically removed\n"})}),"\n",(0,i.jsx)(n.h3,{id:"audit-fields",children:"Audit Fields"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Automatically managed on writes:"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"On CREATE (POST):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "TREC": "N",\n  "CDATA": "20251219153045",  // Create timestamp\n  "OWNER": "user@example.com" // Creator\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"On UPDATE (PUT/PATCH):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "TREC": "M",\n  "LDATA": "20251219160000",  // Last update timestamp\n  "LOWNER": "admin@example.com" // Last modifier\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"On DELETE (soft):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "TREC": "C",\n  "LDATA": "20251219170000",\n  "LOWNER": "admin@example.com"\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"write-operations-summary",children:"Write Operations Summary"}),"\n",(0,i.jsx)(n.h3,{id:"post---create-record",children:"POST - Create Record"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Endpoint:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"POST /api/v4/core/{dim}\nContent-Type: application/json\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Validates required fields"}),"\n",(0,i.jsx)(n.li,{children:"Executes pre-insert functions (uuid, counter, md5, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"Sets TREC='N', CDATA, OWNER"}),"\n",(0,i.jsx)(n.li,{children:"Executes INSERT_CASCADE operations"}),"\n",(0,i.jsx)(n.li,{children:"Publishes creation event to outbox"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD01": "New Product",\n    "XPRD02": 99.99,\n    "XPRD05": "cat_electronics"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"put---full-update",children:"PUT - Full Update"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Endpoint:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"PUT /api/v4/core/{dim}/{dim_id}\nContent-Type: application/json\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Updates ALL fields in request body"}),"\n",(0,i.jsx)(n.li,{children:"Sets TREC='M', LDATA, LOWNER"}),"\n",(0,i.jsx)(n.li,{children:"Executes UPDATE_CASCADE operations"}),"\n",(0,i.jsx)(n.li,{children:"Publishes update event to outbox"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'PUT /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD01": "Updated Product Name",\n    "XPRD02": 109.99,\n    "XPRD05": "cat_electronics",\n    "XPRD06": true\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"patch---partial-update",children:"PATCH - Partial Update"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Endpoint:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"PATCH /api/v4/core/{dim}/{dim_id}\nContent-Type: application/json\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Updates ONLY specified fields"}),"\n",(0,i.jsx)(n.li,{children:"Other fields unchanged"}),"\n",(0,i.jsx)(n.li,{children:"Sets TREC='M', LDATA, LOWNER"}),"\n",(0,i.jsx)(n.li,{children:"Executes UPDATE_CASCADE operations"}),"\n",(0,i.jsx)(n.li,{children:"Publishes update event to outbox"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'PATCH /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD02": 89.99  // Only update price\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"delete---soft-or-force-delete",children:"DELETE - Soft or Force Delete"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Soft Delete (default):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"DELETE /api/v4/core/PRD/123\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Sets TREC='C', LDATA, LOWNER"}),"\n",(0,i.jsx)(n.li,{children:"Record remains in database (soft deleted)"}),"\n",(0,i.jsx)(n.li,{children:"Excluded from queries by default"}),"\n",(0,i.jsx)(n.li,{children:"Executes DELETE_CASCADE (soft) operations"}),"\n",(0,i.jsx)(n.li,{children:"Publishes deletion event to outbox"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Force Delete:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"DELETE /api/v4/core/PRD/123?force=true\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Physically removes record from database"}),"\n",(0,i.jsx)(n.li,{children:"Irreversible operation"}),"\n",(0,i.jsx)(n.li,{children:"Executes DELETE_CASCADE (force) operations"}),"\n",(0,i.jsx)(n.li,{children:"Publishes deletion event to outbox"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"multi-level-validation",children:"Multi-Level Validation"}),"\n",(0,i.jsx)(n.h3,{id:"validation-layers",children:"Validation Layers"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. Token Validation"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Authorization: Bearer <JWT_TOKEN>\n\u2193\nValidates token signature, expiration, issuer\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"2. Grant Validation"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"User grants checked via TB_MENU nested set\n\u2193\nVerifies user has permission for operation on dimension\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"3. Required Field Validation"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"TB_COST.REQUIRED='1' fields checked\n\u2193\nEnsures all mandatory fields present\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"4. COD_ON_OFF Validation"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"TB_COST.COD_ON_OFF flags checked\n\u2193\nN flag required for POST, M flag for PUT/PATCH\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"5. Business Logic Validation"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Custom validation rules (if defined)\n\u2193\nApplication-specific constraints\n"})}),"\n",(0,i.jsx)(n.h3,{id:"validation-example",children:"Validation Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'// POST request validation flow\nPOST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD01": "Product Name"\n    // Missing XPRD05 (required field)\n  }\n}\n\n// Validation error response\n{\n  "error": "ValidationError",\n  "message": "Required field missing: XPRD05",\n  "code": "REQUIRED_FIELD_MISSING",\n  "field": "XPRD05"\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"pre-insert-functions",children:"Pre-Insert Functions"}),"\n",(0,i.jsx)(n.h3,{id:"automatic-field-population",children:"Automatic Field Population"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"TB_COST.VALUE_TEMP defines pre-insert functions:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Function"}),(0,i.jsx)(n.th,{children:"Purpose"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{uuid}"})}),(0,i.jsx)(n.td,{children:"Generate UUID"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"550e8400-e29b-41d4-a716-446655440000"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{md5}"})}),(0,i.jsx)(n.td,{children:"Hash field value"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"5d41402abc4b2a76b9719d911017c592"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{counter}"})}),(0,i.jsx)(n.td,{children:"Sequential counter"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PRD-2025-001"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{sequence}"})}),(0,i.jsx)(n.td,{children:"Database sequence"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"12345"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{slugify}"})}),(0,i.jsx)(n.td,{children:"URL-friendly slug"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"product-name"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"{timestamp}"})}),(0,i.jsx)(n.td,{children:"Current timestamp"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"20251219153045"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Metadata Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- XPRD03 auto-generates formatted counter\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, VALUE_TEMP) VALUES\n('PRD', 3, 'XPRD03', '{counter:PRD-{YYYY}-{NNN}}');\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Result:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'POST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD01": "New Product"\n    // XPRD03 auto-populated: "PRD-2025-001"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"cascade-operations",children:"Cascade Operations"}),"\n",(0,i.jsx)(n.h3,{id:"metadata-driven-cascades",children:"Metadata-Driven Cascades"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"TB_COST cascade fields trigger automatic operations:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"INSERT_CASCADE"})," - Create related records on POST"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"UPDATE_CASCADE"})," - Update related records on PUT/PATCH"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"DELETE_CASCADE"})," - Delete related records on DELETE"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Create order items when order is created\nINSERT INTO TB_COST (COD_DIM, NUM_COST, INSERT_CASCADE) VALUES\n('ORD', 10, 'ORDITEM:XORDITEM_ORDER_ID');\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/ORD\n{\n  "data": {\n    "XORD01": "ORD-2025-001",\n    "items": [\n      {"XORDITEM01": "Product A", "XORDITEM02": 2},\n      {"XORDITEM01": "Product B", "XORDITEM02": 1}\n    ]\n  }\n}\n\n# Automatically creates:\n# 1. TB_ANAG_ORD00 record (order)\n# 2. TB_ANAG_ORDITEM00 records (2 items)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"outbox-pattern",children:"Outbox Pattern"}),"\n",(0,i.jsx)(n.h3,{id:"event-sourcing",children:"Event Sourcing"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Every write operation publishes event to RabbitMQ:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Write Operation (POST/PUT/PATCH/DELETE)\n    \u2193\n1. Insert to TB_ANAG_{DIM}00 (data table)\n2. Insert to OUTBOX table (write-ahead log)\n3. Commit transaction (ACID)\n    \u2193\nBackground process publishes to RabbitMQ\n    \u2193\nEvent consumed by subscribers\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Event Structure:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "eventType": "ProductCreated",\n  "aggregateId": "123",\n  "dimension": "PRD",\n  "operation": "POST",\n  "timestamp": "2025-12-19T15:30:45Z",\n  "payload": {\n    "PRD_ID": 123,\n    "XPRD01": "New Product",\n    "XPRD02": 99.99\n  },\n  "user": "user@example.com"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"At-least-once delivery guarantee"}),"\n",(0,i.jsx)(n.li,{children:"Eventual consistency across microservices"}),"\n",(0,i.jsx)(n.li,{children:"Event replay for debugging"}),"\n",(0,i.jsx)(n.li,{children:"Audit trail"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"transaction-management",children:"Transaction Management"}),"\n",(0,i.jsx)(n.h3,{id:"acid-guarantees",children:"ACID Guarantees"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"All write operations are transactional:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// CoreWrite DataStore.php\npublic function insert(string $dimension, array $data): array {\n  $this->pdo->beginTransaction();\n\n  try {\n    // 1. Insert main record\n    $recordId = $this->insertRecord($dimension, $data);\n\n    // 2. Execute cascades\n    $this->executeCascades($dimension, $recordId, $data);\n\n    // 3. Insert outbox event\n    $this->insertOutboxEvent($dimension, $recordId, 'INSERT', $data);\n\n    // 4. Commit transaction\n    $this->pdo->commit();\n\n    return ['id' => $recordId, 'status' => 'success'];\n  } catch (\\Exception $e) {\n    // Rollback on any error\n    $this->pdo->rollBack();\n    throw $e;\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Atomicity:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All operations succeed or all fail"}),"\n",(0,i.jsx)(n.li,{children:"No partial writes"}),"\n",(0,i.jsx)(n.li,{children:"Database consistency maintained"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"write-patterns-by-use-case",children:"Write Patterns by Use Case"}),"\n",(0,i.jsx)(n.h3,{id:"pattern-1-simple-create",children:"Pattern 1: Simple Create"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Single record creation:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"async function createProduct(productData) {\n  const response = await fetch(`${apiBase}/api/v4/core/PRD`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ data: productData })\n  });\n\n  return response.json();\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pattern-2-create-with-cascades",children:"Pattern 2: Create with Cascades"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Order with items (master-detail):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"async function createOrder(orderData) {\n  const response = await fetch(`${apiBase}/api/v4/core/ORD`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      data: {\n        XORD01: 'ORD-2025-001',\n        XORD_CUSTOMER_ID: 'cust_123',\n        items: [\n          { XORDITEM10: 'prd_1', XORDITEM_QTY: 2 },\n          { XORDITEM10: 'prd_2', XORDITEM_QTY: 1 }\n        ]\n      }\n    })\n  });\n\n  return response.json();\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pattern-3-partial-update",children:"Pattern 3: Partial Update"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Update single field:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"async function updateProductPrice(productId, newPrice) {\n  const response = await fetch(`${apiBase}/api/v4/core/PRD/${productId}`, {\n    method: 'PATCH',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      data: { XPRD02: newPrice }\n    })\n  });\n\n  return response.json();\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pattern-4-soft-delete-with-undo",children:"Pattern 4: Soft Delete with Undo"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Trash functionality:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"async function deleteProduct(productId) {\n  // Soft delete\n  await fetch(`${apiBase}/api/v4/core/PRD/${productId}`, {\n    method: 'DELETE',\n    headers: { 'Authorization': `Bearer ${token}` }\n  });\n}\n\nasync function restoreProduct(productId) {\n  // Restore by setting TREC='M'\n  await fetch(`${apiBase}/api/v4/core/PRD/${productId}`, {\n    method: 'PATCH',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      data: { TREC: 'M' }\n    })\n  });\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use POST for creation:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good\nPOST /api/v4/core/PRD\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use PATCH for partial updates:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'// \u2705 Good - only update price\nPATCH /api/v4/core/PRD/123\n{ "data": { "XPRD02": 89.99 } }\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use soft delete by default:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - can be restored\nDELETE /api/v4/core/PRD/123\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Handle validation errors:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"try {\n  await createProduct(data);\n} catch (error) {\n  if (error.code === 'REQUIRED_FIELD_MISSING') {\n    console.error('Missing required field:', error.field);\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't use PUT for partial updates:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'// \u274c Bad - overwrites all fields\nPUT /api/v4/core/PRD/123\n{ "data": { "XPRD02": 89.99 } }  // Other fields cleared!\n\n// \u2705 Good\nPATCH /api/v4/core/PRD/123\n{ "data": { "XPRD02": 89.99 } }\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't manipulate TREC manually:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'// \u274c Bad - TREC managed automatically\nPOST /api/v4/core/PRD\n{ "data": { "TREC": "N", ... } }\n\n// \u2705 Good - let system manage TREC\nPOST /api/v4/core/PRD\n{ "data": { "XPRD01": "Product", ... } }\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't force delete without reason:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - irreversible\nDELETE /api/v4/core/PRD/123?force=true\n\n// \u2705 Good - soft delete (reversible)\nDELETE /api/v4/core/PRD/123\n"})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Write operations route to CoreWrite via CoreService"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 POST creates (TREC='N'), PUT updates (TREC='M'), DELETE soft-deletes (TREC='C')"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Multi-level validation: token, grant, required fields, COD_ON_OFF"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Pre-insert functions auto-populate fields (uuid, counter, md5, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Cascades propagate operations to related dimensions"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Outbox pattern ensures event sourcing and eventual consistency"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 ACID transactions guarantee data integrity"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Use PATCH for partial updates, PUT for full replacement"}),"\n",(0,i.jsx)(n.li,{children:"Soft delete (TREC='C') by default, force delete only when necessary"}),"\n",(0,i.jsx)(n.li,{children:"Trust automatic field management (TREC, CDATA, OWNER, counters)"}),"\n",(0,i.jsx)(n.li,{children:"Validation happens at multiple layers before write"}),"\n",(0,i.jsx)(n.li,{children:"Every write publishes event to RabbitMQ"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Next Topics:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/create-operations",children:"Create Operations \u2192"})," - POST in detail"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/update-operations",children:"Update Operations \u2192"})," - PUT lifecycle"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/partial-updates",children:"Partial Updates \u2192"})," - PATCH patterns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/delete-operations",children:"Delete Operations \u2192"})," - Soft vs. force delete"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/validation",children:"Validation \u2192"})," - Validation layers explained"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/cascade-operations",children:"Cascade Operations \u2192"})," - Automatic propagation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/outbox-pattern",children:"Outbox Pattern \u2192"})," - Event sourcing details"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/trec-filtering",children:"TREC Filtering"})," - Query by lifecycle state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/entity-lifecycle",children:"Entity Lifecycle"})," - TREC state machine"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/field-visibility",children:"Field Visibility"})," - COD_ON_OFF validation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/dimensions",children:"Dimensions"})," - Dimension structure"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>d,M:()=>a});var i=r(1504);const t={},s=i.createContext(t);function a(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);