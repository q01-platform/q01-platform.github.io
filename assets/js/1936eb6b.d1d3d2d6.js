"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[9216],{7440:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});var c=a(7624),t=a(2172);const i={title:"Caching Strategies",sidebar_label:"Caching Strategies",sidebar_position:5,description:"Multi-layer caching for optimal performance"},s="Caching Strategies",r={id:"products/map.q01.io/core-api-platform-v4/advanced-topics/caching-strategies",title:"Caching Strategies",description:"Multi-layer caching for optimal performance",source:"@site/docs/products/map.q01.io/core-api-platform-v4/06-advanced-topics/caching-strategies.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/06-advanced-topics",slug:"/products/map.q01.io/core-api-platform-v4/advanced-topics/caching-strategies",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/caching-strategies",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Caching Strategies",sidebar_label:"Caching Strategies",sidebar_position:5,description:"Multi-layer caching for optimal performance"},sidebar:"mapSidebar",previous:{title:"Outbox Subscribers",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/outbox-subscribers"},next:{title:"Performance Optimization",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/performance-optimization"}},d={},l=[{value:"Overview",id:"overview",level:2},{value:"Cache Invalidation",id:"cache-invalidation",level:2},{value:"Event-Driven Invalidation",id:"event-driven-invalidation",level:3},{value:"Client-Side Caching",id:"client-side-caching",level:2},{value:"Browser Cache Headers",id:"browser-cache-headers",level:3},{value:"JavaScript Cache Implementation",id:"javascript-cache-implementation",level:3},{value:"Application-Level Caching",id:"application-level-caching",level:2},{value:"Redis Cache",id:"redis-cache",level:3},{value:"Cache-Aside Pattern",id:"cache-aside-pattern",level:3},{value:"CDN Caching",id:"cdn-caching",level:2},{value:"CloudFront Configuration",id:"cloudfront-configuration",level:3},{value:"Cache Patterns",id:"cache-patterns",level:2},{value:"Read-Through Cache",id:"read-through-cache",level:3},{value:"Write-Through Cache",id:"write-through-cache",level:3},{value:"Write-Behind Cache",id:"write-behind-cache",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.M)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h1,{id:"caching-strategies",children:"Caching Strategies"}),"\n",(0,c.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,c.jsxs)(n.p,{children:["Q01 Core APIs benefit from ",(0,c.jsx)(n.strong,{children:"multi-layer caching"})," to reduce latency and database load. Implement caching at client, CDN, application, and database levels for optimal performance."]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Caching Layers:"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Browser Cache"})," - Static assets, API responses"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"CDN Cache"})," - Media files, public content"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Application Cache"})," - Redis/Memcached for API responses"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Database Cache"})," - Query result cache"]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u2705 Reduced latency (faster response times)"}),"\n",(0,c.jsx)(n.li,{children:"\u2705 Lower database load"}),"\n",(0,c.jsx)(n.li,{children:"\u2705 Better scalability"}),"\n",(0,c.jsx)(n.li,{children:"\u2705 Cost savings (fewer database queries)"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"cache-invalidation",children:"Cache Invalidation"}),"\n",(0,c.jsx)(n.h3,{id:"event-driven-invalidation",children:"Event-Driven Invalidation"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Use Outbox events to invalidate cache:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"// cache-invalidator subscriber\nclass CacheInvalidator {\n  async handleEvent(event) {\n    const keys = this.getCacheKeys(event);\n\n    for (const key of keys) {\n      await redis.del(key);\n      console.log(`Invalidated: ${key}`);\n    }\n  }\n\n  getCacheKeys(event) {\n    const { AGGREGATE_TYPE, AGGREGATE_ID, PAYLOAD } = event;\n    const keys = [];\n\n    // Specific record\n    keys.push(`${AGGREGATE_TYPE}:${AGGREGATE_ID}`);\n\n    // List caches\n    keys.push(`${AGGREGATE_TYPE}:list:*`);\n\n    // Related caches\n    if (AGGREGATE_TYPE === 'PRD' && PAYLOAD.XPRD05) {\n      keys.push(`CAT:${PAYLOAD.XPRD05}:products`);\n    }\n\n    return keys;\n  }\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"client-side-caching",children:"Client-Side Caching"}),"\n",(0,c.jsx)(n.h3,{id:"browser-cache-headers",children:"Browser Cache Headers"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"// CoreService sets cache headers\napp.get('/api/v4/core/:dim/:id', (req, res) => {\n  // Public data - cache 5 minutes\n  res.set('Cache-Control', 'public, max-age=300');\n\n  // Private data - cache only in browser\n  res.set('Cache-Control', 'private, max-age=60');\n\n  // No cache for sensitive data\n  res.set('Cache-Control', 'no-store');\n});\n"})}),"\n",(0,c.jsx)(n.h3,{id:"javascript-cache-implementation",children:"JavaScript Cache Implementation"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"class CachedAPIClient {\n  constructor(ttl = 60000) {\n    this.cache = new Map();\n    this.ttl = ttl;\n  }\n\n  async get(url) {\n    const cached = this.cache.get(url);\n\n    if (cached && Date.now() - cached.timestamp < this.ttl) {\n      return cached.data;\n    }\n\n    const data = await fetch(url).then(r => r.json());\n\n    this.cache.set(url, {\n      data,\n      timestamp: Date.now()\n    });\n\n    return data;\n  }\n\n  invalidate(url) {\n    this.cache.delete(url);\n  }\n\n  clear() {\n    this.cache.clear();\n  }\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"application-level-caching",children:"Application-Level Caching"}),"\n",(0,c.jsx)(n.h3,{id:"redis-cache",children:"Redis Cache"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"const Redis = require('ioredis');\nconst redis = new Redis(process.env.REDIS_URL);\n\nclass APICache {\n  async get(key) {\n    const cached = await redis.get(key);\n    return cached ? JSON.parse(cached) : null;\n  }\n\n  async set(key, value, ttl = 300) {\n    await redis.set(key, JSON.stringify(value), 'EX', ttl);\n  }\n\n  async del(key) {\n    await redis.del(key);\n  }\n\n  async delPattern(pattern) {\n    const keys = await redis.keys(pattern);\n    if (keys.length > 0) {\n      await redis.del(...keys);\n    }\n  }\n}\n\n// Usage\nconst cache = new APICache();\n\nasync function getProduct(id) {\n  const cacheKey = `product:${id}`;\n\n  // Check cache\n  let product = await cache.get(cacheKey);\n  if (product) return product;\n\n  // Fetch from API\n  product = await fetchProductFromAPI(id);\n\n  // Store in cache (5 minutes)\n  await cache.set(cacheKey, product, 300);\n\n  return product;\n}\n"})}),"\n",(0,c.jsx)(n.h3,{id:"cache-aside-pattern",children:"Cache-Aside Pattern"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"async function getProducts(filters) {\n  const cacheKey = `products:${JSON.stringify(filters)}`;\n\n  // 1. Check cache\n  let products = await cache.get(cacheKey);\n  if (products) {\n    console.log('Cache hit');\n    return products;\n  }\n\n  // 2. Cache miss - fetch from API\n  console.log('Cache miss');\n  products = await api.getProducts(filters);\n\n  // 3. Store in cache\n  await cache.set(cacheKey, products, 300);\n\n  return products;\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"cdn-caching",children:"CDN Caching"}),"\n",(0,c.jsx)(n.h3,{id:"cloudfront-configuration",children:"CloudFront Configuration"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"// Cache media files\napp.get('/api/v4/media/:dim/:id/:field', (req, res) => {\n  // Long cache for immutable media\n  res.set('Cache-Control', 'public, max-age=31536000, immutable');\n  res.set('ETag', generateETag(file));\n\n  res.sendFile(filePath);\n});\n"})}),"\n",(0,c.jsx)(n.h2,{id:"cache-patterns",children:"Cache Patterns"}),"\n",(0,c.jsx)(n.h3,{id:"read-through-cache",children:"Read-Through Cache"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"class ReadThroughCache {\n  constructor(loader, ttl = 300) {\n    this.loader = loader;\n    this.cache = new Map();\n    this.ttl = ttl;\n  }\n\n  async get(key) {\n    const cached = this.cache.get(key);\n\n    if (cached && Date.now() - cached.timestamp < this.ttl * 1000) {\n      return cached.value;\n    }\n\n    // Load from source\n    const value = await this.loader(key);\n\n    this.cache.set(key, {\n      value,\n      timestamp: Date.now()\n    });\n\n    return value;\n  }\n}\n\n// Usage\nconst productCache = new ReadThroughCache(\n  async (id) => await api.getProduct(id),\n  300\n);\n\nconst product = await productCache.get('123');\n"})}),"\n",(0,c.jsx)(n.h3,{id:"write-through-cache",children:"Write-Through Cache"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"async function updateProduct(id, data) {\n  // 1. Update database via API\n  await api.updateProduct(id, data);\n\n  // 2. Update cache immediately\n  await cache.set(`product:${id}`, data, 300);\n\n  return data;\n}\n"})}),"\n",(0,c.jsx)(n.h3,{id:"write-behind-cache",children:"Write-Behind Cache"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"class WriteBehindCache {\n  constructor() {\n    this.queue = [];\n    this.flushInterval = 5000; // 5 seconds\n\n    setInterval(() => this.flush(), this.flushInterval);\n  }\n\n  async set(key, value) {\n    // Update cache immediately\n    await cache.set(key, value);\n\n    // Queue for database write\n    this.queue.push({ key, value });\n  }\n\n  async flush() {\n    if (this.queue.length === 0) return;\n\n    const batch = this.queue.splice(0, 100);\n\n    for (const { key, value } of batch) {\n      await api.update(key, value);\n    }\n  }\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,c.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Set appropriate TTL:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - different TTL for different data\nawait cache.set('static-config', data, 3600);    // 1 hour\nawait cache.set('product-list', data, 300);      // 5 minutes\nawait cache.set('user-session', data, 1800);     // 30 minutes\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Invalidate on writes:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - invalidate related caches\nasync function updateProduct(id, data) {\n  await api.updateProduct(id, data);\n\n  await cache.del(`product:${id}`);\n  await cache.delPattern(`products:list:*`);\n  await cache.delPattern(`category:${data.category}:*`);\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Use cache keys wisely:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - structured keys\nconst key = `${tenant}:${dimension}:${id}:${version}`;\n"})}),"\n",(0,c.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Don't cache everything:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - caching frequently changing data\nawait cache.set('current-time', Date.now(), 3600);\n\n// \u2705 Good - cache stable data\nawait cache.set('product-catalog', products, 300);\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Don't forget to invalidate:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - stale data\nawait api.updateProduct(id, data);\n// Cache not invalidated!\n\n// \u2705 Good - invalidate immediately\nawait api.updateProduct(id, data);\nawait cache.del(`product:${id}`);\n"})}),"\n",(0,c.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u2705 Multi-layer caching (browser, CDN, application, database)"}),"\n",(0,c.jsx)(n.li,{children:"\u2705 Event-driven cache invalidation"}),"\n",(0,c.jsx)(n.li,{children:"\u2705 Cache-aside pattern for reads"}),"\n",(0,c.jsx)(n.li,{children:"\u2705 Write-through for immediate consistency"}),"\n",(0,c.jsx)(n.li,{children:"\u2705 Appropriate TTL for different data types"}),"\n",(0,c.jsx)(n.li,{children:"\u2705 Structured cache keys"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Cache at multiple layers for best performance"}),"\n",(0,c.jsx)(n.li,{children:"Invalidate cache on writes using Outbox events"}),"\n",(0,c.jsx)(n.li,{children:"Set appropriate TTL based on data volatility"}),"\n",(0,c.jsx)(n.li,{children:"Use Redis for application-level caching"}),"\n",(0,c.jsx)(n.li,{children:"Implement cache patterns (read-through, write-through)"}),"\n",(0,c.jsx)(n.li,{children:"Monitor cache hit rates"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/performance-optimization",children:"Performance Optimization"})," - Query tuning"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/outbox-subscribers",children:"Outbox Subscribers"})," - Cache invalidation events"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics",children:"Advanced Topics"})," - Overview"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}},2172:(e,n,a)=>{a.d(n,{I:()=>r,M:()=>s});var c=a(1504);const t={},i=c.createContext(t);function s(e){const n=c.useContext(i);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),c.createElement(i.Provider,{value:n},e.children)}}}]);