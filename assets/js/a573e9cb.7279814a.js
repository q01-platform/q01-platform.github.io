"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[9290],{3920:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var t=i(7624),s=i(2172);const r={title:"Security Tips",sidebar_label:"Security Tips",sidebar_position:5,description:"Security best practices and hardening strategies"},l="Security Tips",a={id:"products/map.q01.io/core-api-platform-v4/best-practices/security-tips",title:"Security Tips",description:"Security best practices and hardening strategies",source:"@site/docs/products/map.q01.io/core-api-platform-v4/07-best-practices/security-tips.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/07-best-practices",slug:"/products/map.q01.io/core-api-platform-v4/best-practices/security-tips",permalink:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/security-tips",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Security Tips",sidebar_label:"Security Tips",sidebar_position:5,description:"Security best practices and hardening strategies"},sidebar:"mapSidebar",previous:{title:"Performance Tips",permalink:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/performance-tips"},next:{title:"Testing Strategies",permalink:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/testing-strategies"}},o={},c=[{value:"Overview",id:"overview",level:2},{value:"Tip 1: Secure Token Storage",id:"tip-1-secure-token-storage",level:2},{value:"Problem",id:"problem",level:3},{value:"Solution",id:"solution",level:3},{value:"Tip 2: Implement Token Refresh",id:"tip-2-implement-token-refresh",level:2},{value:"Problem",id:"problem-1",level:3},{value:"Solution",id:"solution-1",level:3},{value:"Tip 3: Validate All Input",id:"tip-3-validate-all-input",level:2},{value:"Problem",id:"problem-2",level:3},{value:"Solution",id:"solution-2",level:3},{value:"Tip 4: Always Check Grants",id:"tip-4-always-check-grants",level:2},{value:"Problem",id:"problem-3",level:3},{value:"Solution",id:"solution-3",level:3},{value:"Tip 5: Enforce Rate Limiting",id:"tip-5-enforce-rate-limiting",level:2},{value:"Problem",id:"problem-4",level:3},{value:"Solution",id:"solution-4",level:3},{value:"Tip 6: Implement CORS Properly",id:"tip-6-implement-cors-properly",level:2},{value:"Problem",id:"problem-5",level:3},{value:"Solution",id:"solution-5",level:3},{value:"Tip 7: Enable HTTPS Only",id:"tip-7-enable-https-only",level:2},{value:"Problem",id:"problem-6",level:3},{value:"Solution",id:"solution-6",level:3},{value:"Tip 8: Log Security Events",id:"tip-8-log-security-events",level:2},{value:"Problem",id:"problem-7",level:3},{value:"Solution",id:"solution-7",level:3},{value:"Tip 9: Implement CSRF Protection",id:"tip-9-implement-csrf-protection",level:2},{value:"Problem",id:"problem-8",level:3},{value:"Solution",id:"solution-8",level:3},{value:"Tip 10: Monitor and Alert",id:"tip-10-monitor-and-alert",level:2},{value:"Problem",id:"problem-9",level:3},{value:"Solution",id:"solution-9",level:3},{value:"Security Checklist",id:"security-checklist",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Authorization",id:"authorization",level:3},{value:"Input Validation",id:"input-validation",level:3},{value:"Data Protection",id:"data-protection",level:3},{value:"Infrastructure",id:"infrastructure",level:3},{value:"Monitoring",id:"monitoring",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"security-tips",children:"Security Tips"}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Practical security tips"})," for hardening Q01 Core API integrations against common threats. Security is multi-layered: authentication, authorization, input validation, data protection, and monitoring."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Security Layers:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Authentication (JWT tokens)"}),"\n",(0,t.jsx)(n.li,{children:"Authorization (TB_MENU grants)"}),"\n",(0,t.jsx)(n.li,{children:"Input Validation"}),"\n",(0,t.jsx)(n.li,{children:"Data Protection"}),"\n",(0,t.jsx)(n.li,{children:"Rate Limiting"}),"\n",(0,t.jsx)(n.li,{children:"Audit Trail"}),"\n",(0,t.jsx)(n.li,{children:"Monitoring & Alerts"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"tip-1-secure-token-storage",children:"Tip 1: Secure Token Storage"}),"\n",(0,t.jsx)(n.h3,{id:"problem",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"Tokens exposed in localStorage or code are vulnerable to XSS attacks."}),"\n",(0,t.jsx)(n.h3,{id:"solution",children:"Solution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c INSECURE - localStorage (XSS vulnerable!)\nlocalStorage.setItem('accessToken', token);\n\n// \u274c INSECURE - Hardcoded\nconst TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';\n\n// \u2705 SECURE - httpOnly cookie (server-side)\nres.cookie('accessToken', token, {\n  httpOnly: true,        // Not accessible via JavaScript\n  secure: true,          // HTTPS only\n  sameSite: 'strict',    // CSRF protection\n  maxAge: 900000,        // 15 minutes\n  domain: '.q01.io',\n  path: '/'\n});\n\n// \u2705 SECURE - Environment variable (server-side)\nconst TOKEN = process.env.CORE_API_TOKEN;\n\n// \u2705 ACCEPTABLE - sessionStorage (better than localStorage)\nsessionStorage.setItem('accessToken', token);  // Cleared on tab close\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Best practices:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Server-side: httpOnly cookies or environment variables"}),"\n",(0,t.jsx)(n.li,{children:"Client-side: sessionStorage only (never localStorage)"}),"\n",(0,t.jsx)(n.li,{children:"Never hardcode tokens in code"}),"\n",(0,t.jsx)(n.li,{children:"Use short expiration times (15 minutes for access tokens)"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),": Prevents token theft via XSS"]}),"\n",(0,t.jsx)(n.h2,{id:"tip-2-implement-token-refresh",children:"Tip 2: Implement Token Refresh"}),"\n",(0,t.jsx)(n.h3,{id:"problem-1",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"Long-lived tokens increase security risk."}),"\n",(0,t.jsx)(n.h3,{id:"solution-1",children:"Solution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class SecureAPIClient {\n  constructor() {\n    this.accessToken = null;\n    this.refreshToken = null;\n    this.tokenExpiry = null;\n  }\n\n  async request(url, options) {\n    // Check if token expired\n    if (this.isTokenExpired()) {\n      await this.refreshAccessToken();\n    }\n\n    return fetch(url, {\n      ...options,\n      headers: {\n        ...options.headers,\n        'Authorization': `Bearer ${this.accessToken}`\n      }\n    });\n  }\n\n  isTokenExpired() {\n    if (!this.tokenExpiry) return true;\n    return Date.now() >= this.tokenExpiry - 60000;  // Refresh 1 min before\n  }\n\n  async refreshAccessToken() {\n    try {\n      const response = await fetch('https://api.q01.io/api/v4/auth/refresh', {\n        method: 'POST',\n        headers: {'Content-Type': 'application/json'},\n        body: JSON.stringify({refreshToken: this.refreshToken})\n      });\n\n      const {accessToken, expiresIn} = await response.json();\n\n      this.accessToken = accessToken;\n      this.tokenExpiry = Date.now() + (expiresIn * 1000);\n    } catch (error) {\n      // Refresh failed - redirect to login\n      window.location.href = '/login';\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Token lifetimes:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Access token: 15 minutes"}),"\n",(0,t.jsx)(n.li,{children:"Refresh token: 7 days"}),"\n",(0,t.jsx)(n.li,{children:"Auto-refresh: 1 minute before expiry"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),": Limits token exposure window"]}),"\n",(0,t.jsx)(n.h2,{id:"tip-3-validate-all-input",children:"Tip 3: Validate All Input"}),"\n",(0,t.jsx)(n.h3,{id:"problem-2",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"Unvalidated input enables SQL injection, XSS, and data corruption."}),"\n",(0,t.jsx)(n.h3,{id:"solution-2",children:"Solution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const validator = require('validator');\n\nfunction validateProductInput(data) {\n  const errors = [];\n\n  // Required fields\n  if (!data.XPRD01 || validator.isEmpty(data.XPRD01)) {\n    errors.push('Product name is required');\n  }\n\n  // Type validation\n  if (typeof data.XPRD02 !== 'number' || data.XPRD02 <= 0) {\n    errors.push('Price must be a positive number');\n  }\n\n  // Length validation\n  if (data.XPRD01 && data.XPRD01.length > 255) {\n    errors.push('Product name too long (max 255 characters)');\n  }\n\n  // Format validation\n  if (data.XPRD03 && !validator.isAlphanumeric(data.XPRD03.replace(/-/g, ''))) {\n    errors.push('Product code must be alphanumeric');\n  }\n\n  // Sanitize HTML\n  if (data.XPRD01) {\n    data.XPRD01 = validator.escape(data.XPRD01);\n  }\n\n  if (errors.length > 0) {\n    throw new ValidationError(errors);\n  }\n\n  return data;\n}\n\n// Usage\napp.post('/api/products', async (req, res) => {\n  try {\n    const validatedData = validateProductInput(req.body);\n    const product = await coreAPI.post('/api/v4/core/products', validatedData);\n    res.json(product);\n  } catch (error) {\n    if (error instanceof ValidationError) {\n      return res.status(400).json({errors: error.errors});\n    }\n    throw error;\n  }\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Validation checklist:"})}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Required fields present"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Correct data types"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Length constraints"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Format validation (email, phone, etc.)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Range validation (min/max)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Whitelist allowed characters"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Sanitize HTML"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Escape special characters"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),": Prevents injection attacks and data corruption"]}),"\n",(0,t.jsx)(n.h2,{id:"tip-4-always-check-grants",children:"Tip 4: Always Check Grants"}),"\n",(0,t.jsx)(n.h3,{id:"problem-3",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"Performing operations without permission checks."}),"\n",(0,t.jsx)(n.h3,{id:"solution-3",children:"Solution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class GrantChecker {\n  constructor(coreAPI) {\n    this.coreAPI = coreAPI;\n    this.grants = null;\n  }\n\n  async loadGrants() {\n    const response = await this.coreAPI.get('/api/v4/core/menu');\n    this.grants = response.data;\n  }\n\n  hasGrant(dimension, operation) {\n    if (!this.grants) {\n      throw new Error('Grants not loaded');\n    }\n\n    const menu = this.grants.find(m => m.MENU_CODE === dimension);\n\n    if (!menu) return false;\n\n    // Check operation grant\n    const grantMap = {\n      'read': 'R',\n      'create': 'C',\n      'update': 'U',\n      'delete': 'D'\n    };\n\n    const requiredGrant = grantMap[operation];\n    return menu.GRANTS.includes(requiredGrant);\n  }\n\n  requireGrant(dimension, operation) {\n    if (!this.hasGrant(dimension, operation)) {\n      throw new Error(`Permission denied: ${operation} grant required for ${dimension}`);\n    }\n  }\n}\n\n// Usage\nconst grantChecker = new GrantChecker(coreAPI);\nawait grantChecker.loadGrants();\n\n// Before operations\nasync function deleteProduct(id) {\n  // Check grant first\n  grantChecker.requireGrant('PRD', 'delete');\n\n  // Proceed with delete\n  return coreAPI.delete(`/api/v4/core/products/${id}`);\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Grant checking strategy:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Check grants on page load"}),"\n",(0,t.jsx)(n.li,{children:"Cache grants in memory"}),"\n",(0,t.jsx)(n.li,{children:"Re-check before sensitive operations"}),"\n",(0,t.jsx)(n.li,{children:"Show/hide UI based on grants"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),": Prevents unauthorized operations"]}),"\n",(0,t.jsx)(n.h2,{id:"tip-5-enforce-rate-limiting",children:"Tip 5: Enforce Rate Limiting"}),"\n",(0,t.jsx)(n.h3,{id:"problem-4",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"APIs vulnerable to abuse without rate limiting."}),"\n",(0,t.jsx)(n.h3,{id:"solution-4",children:"Solution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const rateLimit = require('express-rate-limit');\nconst RedisStore = require('rate-limit-redis');\nconst Redis = require('ioredis');\n\n// Create Redis client\nconst redis = new Redis({\n  host: 'redis',\n  port: 6379\n});\n\n// Configure rate limiter\nconst limiter = rateLimit({\n  store: new RedisStore({\n    client: redis,\n    prefix: 'ratelimit:'\n  }),\n  windowMs: 15 * 60 * 1000,  // 15 minutes\n  max: 100,                   // Max 100 requests per window\n  standardHeaders: true,      // Return rate limit info in headers\n  legacyHeaders: false,\n  handler: (req, res) => {\n    res.status(429).json({\n      error: 'Too many requests',\n      retryAfter: req.rateLimit.resetTime\n    });\n  },\n  skip: (req) => {\n    // Skip rate limiting for internal services\n    return req.ip === '10.0.0.1';\n  }\n});\n\n// Apply to all routes\napp.use('/api/', limiter);\n\n// Stricter limit for sensitive operations\nconst strictLimiter = rateLimit({\n  windowMs: 60 * 60 * 1000,  // 1 hour\n  max: 10                     // Max 10 requests per hour\n});\n\napp.post('/api/auth/login', strictLimiter);\napp.post('/api/auth/register', strictLimiter);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Rate limit tiers:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Anonymous: 10 req/min"}),"\n",(0,t.jsx)(n.li,{children:"Authenticated: 100 req/min"}),"\n",(0,t.jsx)(n.li,{children:"Premium: 1000 req/min"}),"\n",(0,t.jsx)(n.li,{children:"Internal: Unlimited"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),": Prevents abuse and DDoS attacks"]}),"\n",(0,t.jsx)(n.h2,{id:"tip-6-implement-cors-properly",children:"Tip 6: Implement CORS Properly"}),"\n",(0,t.jsx)(n.h3,{id:"problem-5",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"Incorrect CORS allows unauthorized access."}),"\n",(0,t.jsx)(n.h3,{id:"solution-5",children:"Solution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const cors = require('cors');\n\n// \u274c INSECURE - Allow all origins\napp.use(cors({origin: '*'}));\n\n// \u2705 SECURE - Whitelist specific origins\nconst allowedOrigins = [\n  'https://app.q01.io',\n  'https://admin.q01.io',\n  'https://mobile.q01.io'\n];\n\napp.use(cors({\n  origin: (origin, callback) => {\n    // Allow requests with no origin (mobile apps, Postman, etc.)\n    if (!origin) return callback(null, true);\n\n    if (allowedOrigins.includes(origin)) {\n      callback(null, true);\n    } else {\n      callback(new Error('Not allowed by CORS'));\n    }\n  },\n  credentials: true,  // Allow cookies\n  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],\n  allowedHeaders: ['Content-Type', 'Authorization', 'X-Source', 'X-Peso'],\n  exposedHeaders: ['X-RateLimit-Remaining', 'X-RateLimit-Reset'],\n  maxAge: 86400  // Cache preflight for 24h\n}));\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"CORS best practices:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Whitelist specific origins (never use ",(0,t.jsx)(n.code,{children:"*"})," in production)"]}),"\n",(0,t.jsx)(n.li,{children:"Enable credentials only when needed"}),"\n",(0,t.jsx)(n.li,{children:"Restrict allowed methods"}),"\n",(0,t.jsx)(n.li,{children:"Validate origin on server-side"}),"\n",(0,t.jsx)(n.li,{children:"Set appropriate maxAge for preflight caching"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),": Prevents unauthorized cross-origin access"]}),"\n",(0,t.jsx)(n.h2,{id:"tip-7-enable-https-only",children:"Tip 7: Enable HTTPS Only"}),"\n",(0,t.jsx)(n.h3,{id:"problem-6",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"Unencrypted HTTP exposes data in transit."}),"\n",(0,t.jsx)(n.h3,{id:"solution-6",children:"Solution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// Redirect HTTP to HTTPS\napp.use((req, res, next) => {\n  if (req.protocol === 'http') {\n    return res.redirect(301, `https://${req.headers.host}${req.url}`);\n  }\n  next();\n});\n\n// Force HTTPS (Strict-Transport-Security)\nconst helmet = require('helmet');\n\napp.use(helmet({\n  hsts: {\n    maxAge: 31536000,        // 1 year\n    includeSubDomains: true,\n    preload: true\n  },\n  contentSecurityPolicy: {\n    directives: {\n      defaultSrc: [\"'self'\"],\n      styleSrc: [\"'self'\", \"'unsafe-inline'\"],\n      scriptSrc: [\"'self'\"],\n      imgSrc: [\"'self'\", 'data:', 'https:'],\n      connectSrc: [\"'self'\", 'https://api.q01.io']\n    }\n  },\n  referrerPolicy: {policy: 'strict-origin-when-cross-origin'}\n}));\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"SSL/TLS configuration:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use TLS 1.2 or higher"}),"\n",(0,t.jsx)(n.li,{children:"Strong cipher suites only"}),"\n",(0,t.jsx)(n.li,{children:"Valid certificate from trusted CA"}),"\n",(0,t.jsx)(n.li,{children:"Enable HTTP/2 for better performance"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),": Protects data in transit"]}),"\n",(0,t.jsx)(n.h2,{id:"tip-8-log-security-events",children:"Tip 8: Log Security Events"}),"\n",(0,t.jsx)(n.h3,{id:"problem-7",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"Security incidents go undetected without logging."}),"\n",(0,t.jsx)(n.h3,{id:"solution-7",children:"Solution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const winston = require('winston');\n\n// Create security logger\nconst securityLogger = winston.createLogger({\n  level: 'info',\n  format: winston.format.json(),\n  transports: [\n    new winston.transports.File({filename: 'security.log'})\n  ]\n});\n\n// Log security events\nfunction logSecurityEvent(event, details) {\n  securityLogger.info({\n    timestamp: new Date().toISOString(),\n    event: event,\n    ...details\n  });\n}\n\n// Middleware to log authentication\napp.use('/api/', (req, res, next) => {\n  logSecurityEvent('api_request', {\n    method: req.method,\n    url: req.url,\n    ip: req.ip,\n    userAgent: req.headers['user-agent'],\n    userId: req.user?.id\n  });\n  next();\n});\n\n// Log failed authentication\napp.post('/api/auth/login', async (req, res) => {\n  try {\n    const user = await authenticate(req.body);\n    res.json({token: user.token});\n  } catch (error) {\n    logSecurityEvent('failed_login', {\n      username: req.body.username,\n      ip: req.ip,\n      reason: error.message\n    });\n    res.status(401).json({error: 'Invalid credentials'});\n  }\n});\n\n// Alert on suspicious activity\nfunction detectSuspiciousActivity(userId, ip) {\n  // Check for unusual patterns\n  const recentAttempts = getRecentLoginAttempts(userId, ip);\n\n  if (recentAttempts > 5) {\n    logSecurityEvent('suspicious_activity', {\n      type: 'multiple_failed_logins',\n      userId: userId,\n      ip: ip,\n      count: recentAttempts\n    });\n\n    // Send alert\n    sendSecurityAlert({\n      title: 'Suspicious Login Activity',\n      userId: userId,\n      ip: ip\n    });\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Events to log:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Authentication attempts (success/failure)"}),"\n",(0,t.jsx)(n.li,{children:"Authorization failures"}),"\n",(0,t.jsx)(n.li,{children:"Data access (sensitive records)"}),"\n",(0,t.jsx)(n.li,{children:"Data modifications (create/update/delete)"}),"\n",(0,t.jsx)(n.li,{children:"Configuration changes"}),"\n",(0,t.jsx)(n.li,{children:"API errors"}),"\n",(0,t.jsx)(n.li,{children:"Rate limit violations"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),": Enables detection and response to security incidents"]}),"\n",(0,t.jsx)(n.h2,{id:"tip-9-implement-csrf-protection",children:"Tip 9: Implement CSRF Protection"}),"\n",(0,t.jsx)(n.h3,{id:"problem-8",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"Cross-Site Request Forgery attacks."}),"\n",(0,t.jsx)(n.h3,{id:"solution-8",children:"Solution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const csrf = require('csurf');\nconst cookieParser = require('cookie-parser');\n\n// Configure CSRF protection\napp.use(cookieParser());\n\nconst csrfProtection = csrf({\n  cookie: {\n    httpOnly: true,\n    secure: true,\n    sameSite: 'strict'\n  }\n});\n\n// Apply to state-changing operations\napp.post('/api/products', csrfProtection, async (req, res) => {\n  // CSRF token validated automatically\n  const product = await coreAPI.post('/api/v4/core/products', req.body);\n  res.json(product);\n});\n\n// Provide token to frontend\napp.get('/api/csrf-token', csrfProtection, (req, res) => {\n  res.json({csrfToken: req.csrfToken()});\n});\n\n// Frontend - Include token in requests\nconst csrfResponse = await fetch('/api/csrf-token');\nconst {csrfToken} = await csrfResponse.json();\n\nawait fetch('/api/products', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n    'X-CSRF-Token': csrfToken\n  },\n  body: JSON.stringify(productData)\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"CSRF protection strategies:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Synchronizer token pattern (CSRF tokens)"}),"\n",(0,t.jsx)(n.li,{children:"Double-submit cookie"}),"\n",(0,t.jsx)(n.li,{children:"SameSite cookie attribute"}),"\n",(0,t.jsx)(n.li,{children:"Custom request headers"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),": Prevents unauthorized state-changing requests"]}),"\n",(0,t.jsx)(n.h2,{id:"tip-10-monitor-and-alert",children:"Tip 10: Monitor and Alert"}),"\n",(0,t.jsx)(n.h3,{id:"problem-9",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"Security incidents detected too late."}),"\n",(0,t.jsx)(n.h3,{id:"solution-9",children:"Solution"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class SecurityMonitor {\n  constructor() {\n    this.alerts = [];\n  }\n\n  checkFailedLogins(userId) {\n    const recentFailures = this.getRecentFailures(userId);\n\n    if (recentFailures > 5) {\n      this.sendAlert({\n        level: 'warning',\n        title: 'Multiple Failed Logins',\n        userId: userId,\n        count: recentFailures\n      });\n    }\n\n    if (recentFailures > 10) {\n      // Lock account\n      this.lockAccount(userId);\n\n      this.sendAlert({\n        level: 'critical',\n        title: 'Account Locked',\n        userId: userId,\n        reason: 'Too many failed login attempts'\n      });\n    }\n  }\n\n  checkUnusualActivity(userId, action) {\n    const pattern = this.getUserPattern(userId);\n\n    // Check for unusual time\n    if (this.isUnusualTime(pattern)) {\n      this.sendAlert({\n        level: 'info',\n        title: 'Unusual Access Time',\n        userId: userId,\n        time: new Date().toISOString()\n      });\n    }\n\n    // Check for unusual location\n    if (this.isUnusualLocation(pattern)) {\n      this.sendAlert({\n        level: 'warning',\n        title: 'Unusual Access Location',\n        userId: userId,\n        location: pattern.location\n      });\n    }\n\n    // Check for privilege escalation\n    if (this.isPrivilegeEscalation(action)) {\n      this.sendAlert({\n        level: 'critical',\n        title: 'Privilege Escalation Attempt',\n        userId: userId,\n        action: action\n      });\n    }\n  }\n\n  async sendAlert(alert) {\n    console.error('[SECURITY ALERT]', alert);\n\n    // Send to monitoring service\n    await fetch(process.env.ALERT_WEBHOOK_URL, {\n      method: 'POST',\n      headers: {'Content-Type': 'application/json'},\n      body: JSON.stringify(alert)\n    });\n\n    // Store alert\n    this.alerts.push({\n      ...alert,\n      timestamp: Date.now()\n    });\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Monitoring checklist:"})}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Failed authentication attempts"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Unusual access patterns"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Privilege escalation attempts"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Data exfiltration attempts"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Rate limit violations"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","API errors"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Configuration changes"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Impact"}),": Early detection and response to threats"]}),"\n",(0,t.jsx)(n.h2,{id:"security-checklist",children:"Security Checklist"}),"\n",(0,t.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use JWT tokens"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Store tokens securely (httpOnly cookies)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement token refresh"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Short token lifetimes (15 min access, 7 days refresh)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Revoke tokens on logout"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"authorization",children:"Authorization"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Check TB_MENU grants before operations"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement role-based access control"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Validate permissions server-side"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Cache grants efficiently"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Log authorization failures"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"input-validation",children:"Input Validation"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Validate all user input"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Sanitize HTML content"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Escape special characters"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Enforce type constraints"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Check length limits"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"data-protection",children:"Data Protection"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use HTTPS only"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Enable HSTS"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement CORS properly"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Encrypt sensitive data at rest"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Mask sensitive data in logs"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"infrastructure",children:"Infrastructure"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement rate limiting"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Enable CSRF protection"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Configure security headers (helmet)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Keep dependencies updated"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Regular security audits"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"monitoring",children:"Monitoring"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Log security events"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Set up alerts"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Monitor failed logins"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Track unusual activity"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Regular security reviews"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Top 5 Security Must-Haves:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Secure token storage (httpOnly cookies)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Input validation (prevent injection)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Grant checking (verify permissions)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Rate limiting (prevent abuse)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Security monitoring (detect threats)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Security is multi-layered (defense in depth)"}),"\n",(0,t.jsx)(n.li,{children:"Validate everything (never trust user input)"}),"\n",(0,t.jsx)(n.li,{children:"Log security events (enable detection)"}),"\n",(0,t.jsx)(n.li,{children:"Monitor continuously (proactive defense)"}),"\n",(0,t.jsx)(n.li,{children:"Keep dependencies updated (patch vulnerabilities)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Security = Authentication + Authorization + Validation + Monitoring"})}),"\n",(0,t.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/",children:"Security"})," - Security deep dive"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/authentication",children:"Authentication"})," - JWT tokens"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/authorization",children:"Authorization"})," - TB_MENU grants"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/best-practices",children:"Best Practices"})," - Overview"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},2172:(e,n,i)=>{i.d(n,{I:()=>a,M:()=>l});var t=i(1504);const s={},r=t.createContext(s);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);