"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[6856],{5276:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var i=t(7624),r=t(2172);const s={title:"Rate Limiting",sidebar_label:"Rate Limiting",sidebar_position:6,description:"API throttling and quotas to prevent abuse"},a="Rate Limiting",l={id:"products/map.q01.io/core-api-platform-v4/security/rate-limiting",title:"Rate Limiting",description:"API throttling and quotas to prevent abuse",source:"@site/docs/products/map.q01.io/core-api-platform-v4/05-security/rate-limiting.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/05-security",slug:"/products/map.q01.io/core-api-platform-v4/security/rate-limiting",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/rate-limiting",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Rate Limiting",sidebar_label:"Rate Limiting",sidebar_position:6,description:"API throttling and quotas to prevent abuse"},sidebar:"mapSidebar",previous:{title:"Context Security",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/context-security"},next:{title:"Audit Trail",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/audit-trail"}},d={},c=[{value:"Overview",id:"overview",level:2},{value:"Rate Limit Tiers",id:"rate-limit-tiers",level:2},{value:"Standard Limits",id:"standard-limits",level:3},{value:"Operation-Specific Limits",id:"operation-specific-limits",level:3},{value:"Rate Limit Headers",id:"rate-limit-headers",level:2},{value:"Response Headers",id:"response-headers",level:3},{value:"Example Response",id:"example-response",level:3},{value:"Rate Limit Implementation",id:"rate-limit-implementation",level:2},{value:"Server-Side Tracking",id:"server-side-tracking",level:3},{value:"Token Bucket Algorithm",id:"token-bucket-algorithm",level:3},{value:"Handling Rate Limits",id:"handling-rate-limits",level:2},{value:"Client-Side Detection",id:"client-side-detection",level:3},{value:"Exponential Backoff",id:"exponential-backoff",level:3},{value:"Throttling Requests",id:"throttling-requests",level:3},{value:"Rate Limit Monitoring",id:"rate-limit-monitoring",level:2},{value:"Client-Side Monitoring",id:"client-side-monitoring",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["Q01 Core APIs implement ",(0,i.jsx)(n.strong,{children:"rate limiting"})," to prevent abuse, ensure fair usage, and maintain system stability. Rate limits restrict the number of API requests a user or tenant can make within a specific time window."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Prevents API abuse and DoS attacks"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Ensures fair resource allocation"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Maintains system performance"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Protects backend services from overload"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Encourages efficient client implementations"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rate Limit Dimensions:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Per User"})," - Individual user request limits"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Per Tenant"})," - Tenant-wide request limits"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Per Endpoint"})," - Operation-specific limits"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Global"})," - System-wide limits"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"rate-limit-tiers",children:"Rate Limit Tiers"}),"\n",(0,i.jsx)(n.h3,{id:"standard-limits",children:"Standard Limits"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Per User Limits:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Window"}),(0,i.jsx)(n.th,{children:"Limit"}),(0,i.jsx)(n.th,{children:"Burst"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Second"}),(0,i.jsx)(n.td,{children:"10 requests"}),(0,i.jsx)(n.td,{children:"15 requests"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Minute"}),(0,i.jsx)(n.td,{children:"100 requests"}),(0,i.jsx)(n.td,{children:"150 requests"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Hour"}),(0,i.jsx)(n.td,{children:"1,000 requests"}),(0,i.jsx)(n.td,{children:"1,500 requests"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Per Tenant Limits:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Window"}),(0,i.jsx)(n.th,{children:"Limit"}),(0,i.jsx)(n.th,{children:"Burst"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Second"}),(0,i.jsx)(n.td,{children:"100 requests"}),(0,i.jsx)(n.td,{children:"150 requests"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Minute"}),(0,i.jsx)(n.td,{children:"1,000 requests"}),(0,i.jsx)(n.td,{children:"1,500 requests"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Hour"}),(0,i.jsx)(n.td,{children:"10,000 requests"}),(0,i.jsx)(n.td,{children:"15,000 requests"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"operation-specific-limits",children:"Operation-Specific Limits"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Read Operations (GET):"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Endpoint"}),(0,i.jsx)(n.th,{children:"Limit"}),(0,i.jsx)(n.th,{children:"Window"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GET /api/v4/core/{dim}"})}),(0,i.jsx)(n.td,{children:"200/min"}),(0,i.jsx)(n.td,{children:"1 minute"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"GET /api/v4/core/{dim}/{id}"})}),(0,i.jsx)(n.td,{children:"300/min"}),(0,i.jsx)(n.td,{children:"1 minute"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Write Operations (POST/PUT/PATCH/DELETE):"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Endpoint"}),(0,i.jsx)(n.th,{children:"Limit"}),(0,i.jsx)(n.th,{children:"Window"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"POST /api/v4/core/{dim}"})}),(0,i.jsx)(n.td,{children:"50/min"}),(0,i.jsx)(n.td,{children:"1 minute"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PUT /api/v4/core/{dim}/{id}"})}),(0,i.jsx)(n.td,{children:"100/min"}),(0,i.jsx)(n.td,{children:"1 minute"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PATCH /api/v4/core/{dim}/{id}"})}),(0,i.jsx)(n.td,{children:"100/min"}),(0,i.jsx)(n.td,{children:"1 minute"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"DELETE /api/v4/core/{dim}/{id}"})}),(0,i.jsx)(n.td,{children:"20/min"}),(0,i.jsx)(n.td,{children:"1 minute"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rationale:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Read operations have higher limits (less resource-intensive)"}),"\n",(0,i.jsx)(n.li,{children:"Write operations have lower limits (database writes, cascades, outbox)"}),"\n",(0,i.jsx)(n.li,{children:"Delete operations have lowest limits (destructive operations)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"rate-limit-headers",children:"Rate Limit Headers"}),"\n",(0,i.jsx)(n.h3,{id:"response-headers",children:"Response Headers"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Every API response includes rate limit headers:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"X-RateLimit-Limit: 1000\nX-RateLimit-Remaining: 847\nX-RateLimit-Reset: 1735574400\nX-RateLimit-Window: 3600\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Header Descriptions:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Header"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"X-RateLimit-Limit"})}),(0,i.jsx)(n.td,{children:"Total requests allowed in window"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"1000"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"X-RateLimit-Remaining"})}),(0,i.jsx)(n.td,{children:"Remaining requests in current window"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"847"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"X-RateLimit-Reset"})}),(0,i.jsx)(n.td,{children:"Unix timestamp when limit resets"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"1735574400"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"X-RateLimit-Window"})}),(0,i.jsx)(n.td,{children:"Window duration in seconds"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"3600"})," (1 hour)"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"example-response",children:"Example Response"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Normal Response (within limits):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'GET /api/v4/core/PRD\nAuthorization: Bearer {token}\n\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-RateLimit-Limit: 1000\nX-RateLimit-Remaining: 847\nX-RateLimit-Reset: 1735574400\n\n{\n  "status": "success",\n  "data": [...]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rate Limit Exceeded:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'GET /api/v4/core/PRD\nAuthorization: Bearer {token}\n\nHTTP/1.1 429 Too Many Requests\nContent-Type: application/json\nX-RateLimit-Limit: 1000\nX-RateLimit-Remaining: 0\nX-RateLimit-Reset: 1735574400\nRetry-After: 300\n\n{\n  "error": "RateLimitExceeded",\n  "message": "Rate limit exceeded. Retry after 300 seconds.",\n  "code": "RATE_LIMIT_EXCEEDED",\n  "status": 429,\n  "retry_after": 300,\n  "limit": 1000,\n  "window": 3600\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"rate-limit-implementation",children:"Rate Limit Implementation"}),"\n",(0,i.jsx)(n.h3,{id:"server-side-tracking",children:"Server-Side Tracking"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CoreService tracks requests using Redis:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// routingController.go\nfunc RateLimitMiddleware(next buffalo.Handler) buffalo.Handler {\n    return func(c buffalo.Context) error {\n        // Extract user from JWT\n        userId := c.Value("user_id").(string)\n\n        // Check rate limit\n        allowed, remaining, resetAt := checkRateLimit(userId)\n\n        // Set headers\n        c.Response().Header().Set("X-RateLimit-Limit", "1000")\n        c.Response().Header().Set("X-RateLimit-Remaining", fmt.Sprintf("%d", remaining))\n        c.Response().Header().Set("X-RateLimit-Reset", fmt.Sprintf("%d", resetAt))\n\n        if !allowed {\n            retryAfter := resetAt - time.Now().Unix()\n            c.Response().Header().Set("Retry-After", fmt.Sprintf("%d", retryAfter))\n\n            return c.Render(429, r.JSON(map[string]interface{}{\n                "error": "RateLimitExceeded",\n                "message": fmt.Sprintf("Rate limit exceeded. Retry after %d seconds.", retryAfter),\n                "code": "RATE_LIMIT_EXCEEDED",\n                "status": 429,\n                "retry_after": retryAfter,\n            }))\n        }\n\n        return next(c)\n    }\n}\n\nfunc checkRateLimit(userId string) (bool, int, int64) {\n    key := fmt.Sprintf("ratelimit:%s:hour", userId)\n\n    // Increment counter\n    count, _ := redis.Incr(key)\n\n    // Set expiration on first request\n    if count == 1 {\n        redis.Expire(key, 3600) // 1 hour\n    }\n\n    // Get TTL\n    ttl, _ := redis.TTL(key)\n    resetAt := time.Now().Unix() + ttl\n\n    limit := 1000\n    remaining := limit - count\n    allowed := count <= limit\n\n    return allowed, remaining, resetAt\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"token-bucket-algorithm",children:"Token Bucket Algorithm"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rate limiting uses token bucket algorithm:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Bucket Capacity: 1000 tokens\nRefill Rate: 1000 tokens/hour (or ~0.28 tokens/second)\n\nRequest arrives:\n    \u2193\nBucket has tokens? \u2192 Yes \u2192 Consume 1 token, allow request\n    \u2193\n    No \u2192 Return 429 Too Many Requests\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Allows bursts (temporary spikes)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Smooth rate limiting"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Fair over time"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"handling-rate-limits",children:"Handling Rate Limits"}),"\n",(0,i.jsx)(n.h3,{id:"client-side-detection",children:"Client-Side Detection"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"JavaScript Rate Limit Handler:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"class RateLimitHandler {\n  constructor() {\n    this.rateLimitInfo = {\n      limit: 1000,\n      remaining: 1000,\n      resetAt: Date.now() + 3600000\n    };\n  }\n\n  updateFromHeaders(headers) {\n    this.rateLimitInfo = {\n      limit: parseInt(headers.get('X-RateLimit-Limit')) || 1000,\n      remaining: parseInt(headers.get('X-RateLimit-Remaining')) || 1000,\n      resetAt: parseInt(headers.get('X-RateLimit-Reset')) * 1000\n    };\n  }\n\n  isNearLimit(threshold = 0.1) {\n    const percentRemaining = this.rateLimitInfo.remaining / this.rateLimitInfo.limit;\n    return percentRemaining <= threshold;\n  }\n\n  getResetTime() {\n    return new Date(this.rateLimitInfo.resetAt);\n  }\n\n  getTimeUntilReset() {\n    return Math.max(0, this.rateLimitInfo.resetAt - Date.now());\n  }\n}\n\n// Usage\nconst rateLimitHandler = new RateLimitHandler();\n\nasync function apiRequest(url, options = {}) {\n  // Check if near limit\n  if (rateLimitHandler.isNearLimit(0.1)) {\n    console.warn('Approaching rate limit:', rateLimitHandler.rateLimitInfo);\n  }\n\n  const response = await fetch(url, options);\n\n  // Update rate limit info from response headers\n  rateLimitHandler.updateFromHeaders(response.headers);\n\n  // Handle rate limit exceeded\n  if (response.status === 429) {\n    const error = await response.json();\n    const retryAfter = error.retry_after * 1000; // Convert to milliseconds\n\n    console.warn(`Rate limit exceeded. Retry after ${error.retry_after}s`);\n\n    // Wait and retry\n    await sleep(retryAfter);\n    return apiRequest(url, options);\n  }\n\n  return response;\n}\n\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"exponential-backoff",children:"Exponential Backoff"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Retry with exponential backoff:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"async function apiRequestWithBackoff(url, options = {}, maxRetries = 3) {\n  let retryCount = 0;\n\n  while (retryCount < maxRetries) {\n    try {\n      const response = await fetch(url, options);\n\n      if (response.status === 429) {\n        retryCount++;\n\n        if (retryCount >= maxRetries) {\n          throw new Error('Max retries exceeded');\n        }\n\n        // Get Retry-After header or use exponential backoff\n        const retryAfter = response.headers.get('Retry-After');\n        const backoffMs = retryAfter\n          ? parseInt(retryAfter) * 1000\n          : Math.pow(2, retryCount) * 1000; // 2s, 4s, 8s\n\n        console.log(`Rate limited. Retry ${retryCount}/${maxRetries} after ${backoffMs}ms`);\n\n        await sleep(backoffMs);\n        continue;\n      }\n\n      return response;\n    } catch (error) {\n      console.error('API request failed:', error);\n      throw error;\n    }\n  }\n\n  throw new Error('Request failed after retries');\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"throttling-requests",children:"Throttling Requests"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Limit concurrent requests:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"class RequestThrottler {\n  constructor(maxConcurrent = 10) {\n    this.maxConcurrent = maxConcurrent;\n    this.activeRequests = 0;\n    this.queue = [];\n  }\n\n  async throttle(requestFn) {\n    // Wait if at max concurrency\n    if (this.activeRequests >= this.maxConcurrent) {\n      await new Promise(resolve => this.queue.push(resolve));\n    }\n\n    this.activeRequests++;\n\n    try {\n      return await requestFn();\n    } finally {\n      this.activeRequests--;\n\n      // Process next queued request\n      if (this.queue.length > 0) {\n        const resolve = this.queue.shift();\n        resolve();\n      }\n    }\n  }\n}\n\n// Usage\nconst throttler = new RequestThrottler(10);\n\nasync function batchCreateProducts(products) {\n  const results = await Promise.all(\n    products.map(product =>\n      throttler.throttle(() => createProduct(product))\n    )\n  );\n\n  return results;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"rate-limit-monitoring",children:"Rate Limit Monitoring"}),"\n",(0,i.jsx)(n.h3,{id:"client-side-monitoring",children:"Client-Side Monitoring"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Track rate limit usage:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"class RateLimitMonitor {\n  constructor() {\n    this.history = [];\n  }\n\n  record(remaining, limit, timestamp = Date.now()) {\n    this.history.push({ remaining, limit, timestamp });\n\n    // Keep last 100 records\n    if (this.history.length > 100) {\n      this.history.shift();\n    }\n  }\n\n  getAverageUsage() {\n    if (this.history.length === 0) return 0;\n\n    const totalUsage = this.history.reduce((sum, record) => {\n      return sum + (record.limit - record.remaining);\n    }, 0);\n\n    return totalUsage / this.history.length;\n  }\n\n  isHighUsage(threshold = 0.8) {\n    if (this.history.length === 0) return false;\n\n    const latest = this.history[this.history.length - 1];\n    const percentUsed = (latest.limit - latest.remaining) / latest.limit;\n\n    return percentUsed >= threshold;\n  }\n\n  logStatus() {\n    if (this.history.length === 0) {\n      console.log('No rate limit data');\n      return;\n    }\n\n    const latest = this.history[this.history.length - 1];\n    const percentUsed = ((latest.limit - latest.remaining) / latest.limit * 100).toFixed(1);\n\n    console.log(`Rate Limit: ${latest.remaining}/${latest.limit} (${percentUsed}% used)`);\n  }\n}\n\n// Usage\nconst monitor = new RateLimitMonitor();\n\nasync function apiRequest(url, options = {}) {\n  const response = await fetch(url, options);\n\n  // Record rate limit info\n  const remaining = parseInt(response.headers.get('X-RateLimit-Remaining'));\n  const limit = parseInt(response.headers.get('X-RateLimit-Limit'));\n  monitor.record(remaining, limit);\n\n  // Check if high usage\n  if (monitor.isHighUsage(0.8)) {\n    console.warn('High API usage detected');\n  }\n\n  return response;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Check rate limit headers:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - monitor remaining requests\nconst remaining = response.headers.get('X-RateLimit-Remaining');\nif (remaining < 50) {\n  console.warn('Low rate limit remaining:', remaining);\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Implement exponential backoff:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - retry with backoff\nif (response.status === 429) {\n  const retryAfter = response.headers.get('Retry-After');\n  await sleep(retryAfter * 1000);\n  return retry();\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Throttle batch operations:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - limit concurrent requests\nconst throttler = new RequestThrottler(10);\nawait Promise.all(products.map(p =>\n  throttler.throttle(() => createProduct(p))\n));\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cache responses:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - reduce API calls\nconst cached = cache.get(key);\nif (cached) return cached;\n\nconst data = await fetchFromAPI();\ncache.set(key, data, 60); // Cache 1 minute\nreturn data;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't ignore rate limit headers:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - no rate limit awareness\nawait fetch(url);  // No header checking\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't hammer API on 429:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - immediate retry\nif (response.status === 429) {\n  return fetch(url);  // No waiting!\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't send unbounded parallel requests:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - 1000 concurrent requests\nawait Promise.all(\n  largeArray.map(item => createItem(item))\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't skip caching:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - fetching same data repeatedly\nfor (let i = 0; i < 10; i++) {\n  await getProduct(123);  // Same product 10 times!\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Rate limits prevent abuse and ensure fair usage"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Limits per user, tenant, endpoint, and global"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Response headers indicate limit status"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 429 status code when limit exceeded"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Retry-After header indicates wait time"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Token bucket algorithm allows bursts"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Client should implement exponential backoff"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Throttle concurrent requests for batch operations"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Monitor rate limit headers on every response"}),"\n",(0,i.jsx)(n.li,{children:"Implement exponential backoff for 429 errors"}),"\n",(0,i.jsx)(n.li,{children:"Throttle batch operations to stay within limits"}),"\n",(0,i.jsx)(n.li,{children:"Cache responses to reduce API calls"}),"\n",(0,i.jsx)(n.li,{children:"Check Retry-After header for wait time"}),"\n",(0,i.jsx)(n.li,{children:"Write operations have lower limits than reads"}),"\n",(0,i.jsx)(n.li,{children:"Be a good API citizen - don't abuse limits"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rate Limit Flow:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"API Request\n    \u2193\nCheck Rate Limit (Redis)\n    \u2193\nWithin Limit? \u2192 Yes \u2192 Process Request\n    \u2193              \u2193\n    No         Set Headers\n    \u2193              \u2193\nReturn 429     Return Response\n    \u2193\nClient Waits (Retry-After)\n    \u2193\nRetry Request\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response Headers:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"X-RateLimit-Limit: 1000        (total allowed)\nX-RateLimit-Remaining: 847     (remaining in window)\nX-RateLimit-Reset: 1735574400  (reset timestamp)\nRetry-After: 300               (wait 300 seconds)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security",children:"Security Overview"})," - Multi-level security"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/authentication",children:"Authentication"})," - JWT tokens"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/error-handling",children:"Error Handling"})," - 429 errors"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/batch-operations",children:"Batch Operations"})," - Throttling batches"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},2172:(e,n,t)=>{t.d(n,{I:()=>l,M:()=>a});var i=t(1504);const r={},s=i.createContext(r);function a(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);