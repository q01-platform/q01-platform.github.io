"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[67],{6064:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>o,contentTitle:()=>r,default:()=>p,frontMatter:()=>t,metadata:()=>c,toc:()=>l});var s=a(7624),i=a(2172);const t={title:"Multi-Database Support",sidebar_label:"Multi-Database",sidebar_position:2,description:"MySQL, Oracle, and PostgreSQL support through PDO abstraction"},r="Multi-Database Support",c={id:"products/map.q01.io/core-api-platform-v4/advanced-topics/multi-database",title:"Multi-Database Support",description:"MySQL, Oracle, and PostgreSQL support through PDO abstraction",source:"@site/docs/products/map.q01.io/core-api-platform-v4/06-advanced-topics/multi-database.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/06-advanced-topics",slug:"/products/map.q01.io/core-api-platform-v4/advanced-topics/multi-database",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/multi-database",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Multi-Database Support",sidebar_label:"Multi-Database",sidebar_position:2,description:"MySQL, Oracle, and PostgreSQL support through PDO abstraction"},sidebar:"mapSidebar",previous:{title:"Advanced Topics",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/"},next:{title:"Media Handling",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/media-handling"}},o={},l=[{value:"Overview",id:"overview",level:2},{value:"PDO Abstraction Layer",id:"pdo-abstraction-layer",level:2},{value:"PDO Wrapper",id:"pdo-wrapper",level:3},{value:"Database Configuration",id:"database-configuration",level:2},{value:"Configuration File",id:"configuration-file",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Database-Specific Syntax",id:"database-specific-syntax",level:2},{value:"Pagination",id:"pagination",level:3},{value:"String Concatenation",id:"string-concatenation",level:3},{value:"Date Functions",id:"date-functions",level:3},{value:"Auto-Increment",id:"auto-increment",level:3},{value:"Connection Management",id:"connection-management",level:2},{value:"Connection Pooling",id:"connection-pooling",level:3},{value:"Connection Manager",id:"connection-manager",level:3},{value:"Database-Specific Optimizations",id:"database-specific-optimizations",level:2},{value:"MySQL Optimizations",id:"mysql-optimizations",level:3},{value:"Oracle Optimizations",id:"oracle-optimizations",level:3},{value:"PostgreSQL Optimizations",id:"postgresql-optimizations",level:3},{value:"Multi-Database Transactions",id:"multi-database-transactions",level:2},{value:"Distributed Transactions",id:"distributed-transactions",level:3},{value:"Migration Between Databases",id:"migration-between-databases",level:2},{value:"Database Migration Tools",id:"database-migration-tools",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.M)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h1,{id:"multi-database-support",children:"Multi-Database Support"}),"\n",(0,s.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(e.p,{children:["Q01 Core APIs support multiple database engines through ",(0,s.jsx)(e.strong,{children:"PDO (PHP Data Objects) abstraction layer"}),". This allows the same codebase to work with MySQL, Oracle, and PostgreSQL without modification."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Supported Databases:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"MySQL 5.7+ / MariaDB 10.2+"}),"\n",(0,s.jsx)(e.li,{children:"Oracle 11g+ / 12c+ / 19c+"}),"\n",(0,s.jsx)(e.li,{children:"PostgreSQL 9.6+ / 10+ / 11+"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u2705 Single codebase for all databases"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Database-specific optimizations"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Automatic query adaptation"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Connection pooling"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Transaction support across databases"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Easy migration between engines"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"pdo-abstraction-layer",children:"PDO Abstraction Layer"}),"\n",(0,s.jsx)(e.h3,{id:"pdo-wrapper",children:"PDO Wrapper"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"CoreQuery/CoreWrite use custom PDO wrapper:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-php",children:"// DbInterface/PDOWrapper.php\nclass PDOWrapper {\n    private $pdo;\n    private $driver;  // mysql, oci, pgsql\n\n    public function __construct(array $config) {\n        $this->driver = $config['driver'];\n        $dsn = $this->buildDSN($config);\n\n        $this->pdo = new PDO($dsn, $config['username'], $config['password'], [\n            PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n            PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\n            PDO::ATTR_EMULATE_PREPARES => false\n        ]);\n    }\n\n    private function buildDSN(array $config): string {\n        switch ($config['driver']) {\n            case 'mysql':\n                return \"mysql:host={$config['host']};dbname={$config['database']};charset=utf8mb4\";\n\n            case 'oci':\n                return \"oci:dbname=//{$config['host']}/{$config['database']}\";\n\n            case 'pgsql':\n                return \"pgsql:host={$config['host']};dbname={$config['database']}\";\n\n            default:\n                throw new \\Exception(\"Unsupported driver: {$config['driver']}\");\n        }\n    }\n\n    public function query(string $sql, array $params = []): PDOStatement {\n        // Adapt SQL for database-specific syntax\n        $adaptedSQL = $this->adaptSQL($sql);\n\n        $stmt = $this->pdo->prepare($adaptedSQL);\n        $stmt->execute($params);\n\n        return $stmt;\n    }\n\n    private function adaptSQL(string $sql): string {\n        // Convert generic SQL to database-specific syntax\n        if ($this->driver === 'oci') {\n            // Oracle: LIMIT \u2192 ROWNUM\n            $sql = preg_replace('/LIMIT (\\d+) OFFSET (\\d+)/', 'OFFSET \\2 ROWS FETCH NEXT \\1 ROWS ONLY', $sql);\n        }\n\n        if ($this->driver === 'pgsql') {\n            // PostgreSQL: CONCAT \u2192 ||\n            $sql = str_replace('CONCAT(', '(', $sql);\n            $sql = str_replace(',', ' || ', $sql);\n        }\n\n        return $sql;\n    }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"database-configuration",children:"Database Configuration"}),"\n",(0,s.jsx)(e.h3,{id:"configuration-file",children:"Configuration File"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"config/database.php:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-php",children:"return [\n    // Metadata database (TB_DIM, TB_COST, TB_VAR, TB_MENU)\n    'meta' => [\n        'driver' => env('META_DB_DRIVER', 'mysql'),\n        'host' => env('META_DB_HOST', 'localhost'),\n        'port' => env('META_DB_PORT', 3306),\n        'database' => env('META_DB_DATABASE', 'q01_meta'),\n        'username' => env('META_DB_USERNAME', 'q01_user'),\n        'password' => env('META_DB_PASSWORD', 'secure_password'),\n        'charset' => 'utf8mb4',\n        'collation' => 'utf8mb4_unicode_ci',\n        'options' => [\n            PDO::ATTR_PERSISTENT => true\n        ]\n    ],\n\n    // Data database (TB_ANAG_{DIM}00)\n    'data' => [\n        'driver' => env('DATA_DB_DRIVER', 'oracle'),\n        'host' => env('DATA_DB_HOST', 'oracle.internal'),\n        'port' => env('DATA_DB_PORT', 1521),\n        'database' => env('DATA_DB_DATABASE', 'q01_data'),\n        'username' => env('DATA_DB_USERNAME', 'q01_user'),\n        'password' => env('DATA_DB_PASSWORD', 'secure_password')\n    ],\n\n    // Auth database (users, JWT secrets)\n    'auth' => [\n        'driver' => env('AUTH_DB_DRIVER', 'postgresql'),\n        'host' => env('AUTH_DB_HOST', 'postgres.internal'),\n        'port' => env('AUTH_DB_PORT', 5432),\n        'database' => env('AUTH_DB_DATABASE', 'q01_auth'),\n        'username' => env('AUTH_DB_USERNAME', 'q01_user'),\n        'password' => env('AUTH_DB_PASSWORD', 'secure_password'),\n        'schema' => 'public'\n    ]\n];\n"})}),"\n",(0,s.jsx)(e.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:".env file:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Metadata database (MySQL)\nMETA_DB_DRIVER=mysql\nMETA_DB_HOST=mysql-meta.example.com\nMETA_DB_PORT=3306\nMETA_DB_DATABASE=q01_meta\nMETA_DB_USERNAME=q01_user\nMETA_DB_PASSWORD=secure_meta_password\n\n# Data database (Oracle)\nDATA_DB_DRIVER=oci\nDATA_DB_HOST=oracle-data.example.com\nDATA_DB_PORT=1521\nDATA_DB_DATABASE=q01_data\nDATA_DB_USERNAME=q01_user\nDATA_DB_PASSWORD=secure_data_password\n\n# Auth database (PostgreSQL)\nAUTH_DB_DRIVER=pgsql\nAUTH_DB_HOST=postgres-auth.example.com\nAUTH_DB_PORT=5432\nAUTH_DB_DATABASE=q01_auth\nAUTH_DB_USERNAME=q01_user\nAUTH_DB_PASSWORD=secure_auth_password\n"})}),"\n",(0,s.jsx)(e.h2,{id:"database-specific-syntax",children:"Database-Specific Syntax"}),"\n",(0,s.jsx)(e.h3,{id:"pagination",children:"Pagination"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Generic SQL:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'tenant'\nLIMIT 100 OFFSET 50;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"MySQL:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'tenant'\nLIMIT 100 OFFSET 50;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Oracle:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'tenant'\nOFFSET 50 ROWS FETCH NEXT 100 ROWS ONLY;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"PostgreSQL:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'tenant'\nLIMIT 100 OFFSET 50;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"string-concatenation",children:"String Concatenation"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"MySQL:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT CONCAT(XPRD01, ' - ', XPRD03) as full_name\nFROM TB_ANAG_PRD00;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Oracle:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT XPRD01 || ' - ' || XPRD03 as full_name\nFROM TB_ANAG_PRD00;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"PostgreSQL:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT XPRD01 || ' - ' || XPRD03 as full_name\nFROM TB_ANAG_PRD00;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"date-functions",children:"Date Functions"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"MySQL:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT DATE_FORMAT(CREATED_AT, '%Y-%m-%d') as created_date\nFROM TB_ANAG_PRD00;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Oracle:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT TO_CHAR(TO_DATE(CREATED_AT, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') as created_date\nFROM TB_ANAG_PRD00;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"PostgreSQL:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"SELECT TO_CHAR(TO_TIMESTAMP(CREATED_AT, 'YYYYMMDDHH24MISS'), 'YYYY-MM-DD') as created_date\nFROM TB_ANAG_PRD00;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"auto-increment",children:"Auto-Increment"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"MySQL:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE TB_COUNTER (\n    COUNTER_ID INT PRIMARY KEY AUTO_INCREMENT,\n    COUNTER_VALUE INT\n);\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Oracle:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE SEQUENCE seq_counter START WITH 1 INCREMENT BY 1;\n\nCREATE TABLE TB_COUNTER (\n    COUNTER_ID NUMBER PRIMARY KEY,\n    COUNTER_VALUE NUMBER\n);\n\nCREATE TRIGGER trg_counter_id\nBEFORE INSERT ON TB_COUNTER\nFOR EACH ROW\nBEGIN\n    SELECT seq_counter.NEXTVAL INTO :NEW.COUNTER_ID FROM DUAL;\nEND;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"PostgreSQL:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE TB_COUNTER (\n    COUNTER_ID SERIAL PRIMARY KEY,\n    COUNTER_VALUE INT\n);\n"})}),"\n",(0,s.jsx)(e.h2,{id:"connection-management",children:"Connection Management"}),"\n",(0,s.jsx)(e.h3,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"PHP-FPM configuration:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"; php-fpm.conf\npm = dynamic\npm.max_children = 50\npm.start_servers = 10\npm.min_spare_servers = 5\npm.max_spare_servers = 20\npm.max_requests = 500\n\n; Persistent connections\npdo_mysql.persistent = 1\npdo_oci.persistent = 1\npdo_pgsql.persistent = 1\n"})}),"\n",(0,s.jsx)(e.h3,{id:"connection-manager",children:"Connection Manager"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Multiple database connections:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-php",children:"class ConnectionManager {\n    private $connections = [];\n\n    public function getConnection(string $database): PDOWrapper {\n        if (!isset($this->connections[$database])) {\n            $config = config(\"database.{$database}\");\n            $this->connections[$database] = new PDOWrapper($config);\n        }\n\n        return $this->connections[$database];\n    }\n\n    public function getMeta(): PDOWrapper {\n        return $this->getConnection('meta');\n    }\n\n    public function getData(): PDOWrapper {\n        return $this->getConnection('data');\n    }\n\n    public function getAuth(): PDOWrapper {\n        return $this->getConnection('auth');\n    }\n}\n\n// Usage\n$cm = new ConnectionManager();\n\n// Query metadata\n$dimensions = $cm->getMeta()->query(\"SELECT * FROM TB_DIM\")->fetchAll();\n\n// Query data\n$products = $cm->getData()->query(\n    \"SELECT * FROM TB_ANAG_PRD00 WHERE PRD_SOURCE = ?\",\n    ['tenant']\n)->fetchAll();\n\n// Query auth\n$user = $cm->getAuth()->query(\n    \"SELECT * FROM USERS WHERE EMAIL = ?\",\n    ['user@example.com']\n)->fetch();\n"})}),"\n",(0,s.jsx)(e.h2,{id:"database-specific-optimizations",children:"Database-Specific Optimizations"}),"\n",(0,s.jsx)(e.h3,{id:"mysql-optimizations",children:"MySQL Optimizations"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"InnoDB Configuration:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"[mysqld]\n# InnoDB buffer pool (70-80% of RAM)\ninnodb_buffer_pool_size = 8G\ninnodb_buffer_pool_instances = 8\n\n# InnoDB logs\ninnodb_log_file_size = 512M\ninnodb_log_buffer_size = 16M\n\n# Connection limits\nmax_connections = 500\nthread_cache_size = 100\n\n# Query cache\nquery_cache_type = 1\nquery_cache_size = 256M\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Indexes:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- Composite index for common queries\nCREATE INDEX idx_prd_tenant_active ON TB_ANAG_PRD00(\n    PRD_SOURCE,\n    TREC,\n    XPRD06,\n    CREATED_AT\n) USING BTREE;\n\n-- Full-text search\nCREATE FULLTEXT INDEX idx_prd_fulltext ON TB_ANAG_PRD00(XPRD01, XPRD_DESCRIPTION);\n"})}),"\n",(0,s.jsx)(e.h3,{id:"oracle-optimizations",children:"Oracle Optimizations"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Tablespace Configuration:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- Create tablespace for Q01 data\nCREATE TABLESPACE q01_data\n    DATAFILE '/u01/app/oracle/oradata/q01/q01_data01.dbf'\n    SIZE 1G\n    AUTOEXTEND ON NEXT 100M MAXSIZE 10G;\n\n-- Create table in tablespace\nCREATE TABLE TB_ANAG_PRD00 (\n    PRD_ID VARCHAR2(36) PRIMARY KEY,\n    XPRD01 VARCHAR2(255),\n    ...\n) TABLESPACE q01_data;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Partitioning:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- Partition by source (tenant)\nCREATE TABLE TB_ANAG_PRD00 (\n    PRD_ID VARCHAR2(36),\n    PRD_SOURCE VARCHAR2(50),\n    ...\n) PARTITION BY LIST (PRD_SOURCE) (\n    PARTITION p_tenant_a VALUES ('tenantA'),\n    PARTITION p_tenant_b VALUES ('tenantB'),\n    PARTITION p_default VALUES (DEFAULT)\n);\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Indexes:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- Bitmap index for low-cardinality columns\nCREATE BITMAP INDEX idx_prd_trec ON TB_ANAG_PRD00(TREC);\n\n-- B-tree index for high-cardinality\nCREATE INDEX idx_prd_source ON TB_ANAG_PRD00(PRD_SOURCE);\n"})}),"\n",(0,s.jsx)(e.h3,{id:"postgresql-optimizations",children:"PostgreSQL Optimizations"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Configuration:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ini",children:"# postgresql.conf\n\n# Memory\nshared_buffers = 2GB\neffective_cache_size = 6GB\nwork_mem = 50MB\nmaintenance_work_mem = 512MB\n\n# Connections\nmax_connections = 200\n\n# Query planning\nrandom_page_cost = 1.1\neffective_io_concurrency = 200\n\n# WAL\nwal_buffers = 16MB\nmin_wal_size = 1GB\nmax_wal_size = 4GB\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Indexes:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- GIN index for JSONB columns\nCREATE INDEX idx_prd_metadata ON TB_ANAG_PRD00 USING GIN(metadata);\n\n-- Partial index for active products\nCREATE INDEX idx_prd_active ON TB_ANAG_PRD00(XPRD06)\nWHERE TREC != 'C';\n\n-- Expression index\nCREATE INDEX idx_prd_name_lower ON TB_ANAG_PRD00(LOWER(XPRD01));\n"})}),"\n",(0,s.jsx)(e.h2,{id:"multi-database-transactions",children:"Multi-Database Transactions"}),"\n",(0,s.jsx)(e.h3,{id:"distributed-transactions",children:"Distributed Transactions"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Two-phase commit (2PC):"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-php",children:"class DistributedTransaction {\n    private $connections = [];\n\n    public function begin() {\n        foreach ($this->connections as $conn) {\n            $conn->query('BEGIN');\n        }\n    }\n\n    public function commit() {\n        // Phase 1: Prepare\n        foreach ($this->connections as $conn) {\n            $conn->query('PREPARE TRANSACTION \\'xid\\'');\n        }\n\n        // Phase 2: Commit\n        foreach ($this->connections as $conn) {\n            $conn->query('COMMIT PREPARED \\'xid\\'');\n        }\n    }\n\n    public function rollback() {\n        foreach ($this->connections as $conn) {\n            $conn->query('ROLLBACK');\n        }\n    }\n}\n\n// Usage\n$dt = new DistributedTransaction();\n$dt->addConnection($metaDB);\n$dt->addConnection($dataDB);\n\ntry {\n    $dt->begin();\n\n    // Update metadata\n    $metaDB->query(\"UPDATE TB_DIM SET ...\");\n\n    // Update data\n    $dataDB->query(\"UPDATE TB_ANAG_PRD00 SET ...\");\n\n    $dt->commit();\n} catch (\\Exception $e) {\n    $dt->rollback();\n    throw $e;\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"migration-between-databases",children:"Migration Between Databases"}),"\n",(0,s.jsx)(e.h3,{id:"database-migration-tools",children:"Database Migration Tools"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Export from MySQL to Oracle:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Export MySQL data\nmysqldump -u user -p q01_data > q01_data_mysql.sql\n\n# Convert MySQL \u2192 Oracle syntax\nsed -i 's/AUTO_INCREMENT/GENERATED ALWAYS AS IDENTITY/g' q01_data_mysql.sql\nsed -i 's/VARCHAR(255)/VARCHAR2(255)/g' q01_data_mysql.sql\nsed -i 's/DATETIME/TIMESTAMP/g' q01_data_mysql.sql\n\n# Import to Oracle\nsqlplus user/password@oracle < q01_data_oracle.sql\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Schema Compatibility:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-php",children:"// Modules.php - Database-agnostic schema\npublic function getTableSchema(string $dimension): array {\n    $driver = $this->pdo->getDriver();\n\n    $columns = match($driver) {\n        'mysql' => $this->getTableSchemaMySQL($dimension),\n        'oci' => $this->getTableSchemaOracle($dimension),\n        'pgsql' => $this->getTableSchemaPostgreSQL($dimension),\n    };\n\n    return $columns;\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(e.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Use parameterized queries:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-php",children:'// \u2705 Good - prevents SQL injection across all databases\n$stmt = $pdo->query(\n    "SELECT * FROM TB_ANAG_PRD00 WHERE PRD_SOURCE = ?",\n    [$source]\n);\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Test on all target databases:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# \u2705 Good - CI/CD pipeline tests\ndocker-compose up -d mysql oracle postgres\n./vendor/bin/phpunit --group database\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Use database-agnostic SQL:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-php",children:'// \u2705 Good - works on all databases\n$sql = "SELECT * FROM TB_ANAG_PRD00 WHERE PRD_SOURCE = ? LIMIT ? OFFSET ?";\n\n// PDOWrapper adapts to database-specific syntax\n'})}),"\n",(0,s.jsx)(e.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Don't use database-specific features directly:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u274c Bad - MySQL specific\nSELECT * FROM TB_ANAG_PRD00 FORCE INDEX (idx_prd_source);\n\n-- \u2705 Good - database agnostic\nSELECT * FROM TB_ANAG_PRD00 WHERE PRD_SOURCE = ?;\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Don't hardcode database types:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-php",children:"// \u274c Bad\nif ($database === 'mysql') {\n    // MySQL logic\n}\n\n// \u2705 Good - use driver detection\nif ($pdo->getDriver() === 'mysql') {\n    // Adapt query\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u2705 PDO abstraction supports MySQL, Oracle, PostgreSQL"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Single codebase works with all databases"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Automatic SQL adaptation for database-specific syntax"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Connection pooling for performance"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Database-specific optimizations (indexes, partitioning)"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Distributed transactions with two-phase commit"}),"\n",(0,s.jsx)(e.li,{children:"\u2705 Easy migration between database engines"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Key Takeaways:"})}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"PDO abstraction layer enables multi-database support"}),"\n",(0,s.jsx)(e.li,{children:"Use database-agnostic SQL when possible"}),"\n",(0,s.jsx)(e.li,{children:"Adapt syntax automatically for database-specific features"}),"\n",(0,s.jsx)(e.li,{children:"Configure connection pooling for performance"}),"\n",(0,s.jsx)(e.li,{children:"Apply database-specific optimizations (indexes, partitioning)"}),"\n",(0,s.jsx)(e.li,{children:"Test on all target databases"}),"\n",(0,s.jsx)(e.li,{children:"Use parameterized queries for security"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Database Separation:"})}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Database"}),(0,s.jsx)(e.th,{children:"Purpose"}),(0,s.jsx)(e.th,{children:"Tables"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Meta"}),(0,s.jsx)(e.td,{children:"Metadata"}),(0,s.jsx)(e.td,{children:"TB_DIM, TB_COST, TB_VAR, TB_MENU"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Data"}),(0,s.jsx)(e.td,{children:"Business data"}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.code,{children:"TB_ANAG_{DIM}00"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Auth"}),(0,s.jsx)(e.td,{children:"Authentication"}),(0,s.jsx)(e.td,{children:"USERS, JWT_SECRETS"})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/performance-optimization",children:"Performance Optimization"})," - Query tuning and indexing"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/internal-architecture",children:"Internal Architecture"})," - CoreService/CoreQuery/CoreWrite"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics",children:"Advanced Topics"})," - Overview"]}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,i.M)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},2172:(n,e,a)=>{a.d(e,{I:()=>c,M:()=>r});var s=a(1504);const i={},t=s.createContext(i);function r(n){const e=s.useContext(t);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),s.createElement(t.Provider,{value:e},n.children)}}}]);