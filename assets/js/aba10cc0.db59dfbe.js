"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[9384],{2716:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>a});var s=n(7624),c=n(2172);const i={title:"TREC Filtering",sidebar_label:"TREC Filtering",sidebar_position:6,description:"Filtering by record lifecycle state with cond_trec parameter"},l="TREC Filtering",t={id:"products/map.q01.io/core-api-platform-v4/query-patterns/trec-filtering",title:"TREC Filtering",description:"Filtering by record lifecycle state with cond_trec parameter",source:"@site/docs/products/map.q01.io/core-api-platform-v4/03-query-patterns/trec-filtering.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/03-query-patterns",slug:"/products/map.q01.io/core-api-platform-v4/query-patterns/trec-filtering",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/trec-filtering",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"TREC Filtering",sidebar_label:"TREC Filtering",sidebar_position:6,description:"Filtering by record lifecycle state with cond_trec parameter"},sidebar:"mapSidebar",previous:{title:"Sorting Patterns",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/sorting-patterns"},next:{title:"Relational Queries",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/relational-queries"}},d={},a=[{value:"Overview",id:"overview",level:2},{value:"Default TREC Filtering",id:"default-trec-filtering",level:2},{value:"Automatic Exclusion of Cancelled Records",id:"automatic-exclusion-of-cancelled-records",level:3},{value:"cond_trec Parameter",id:"cond_trec-parameter",level:2},{value:"Include Specific States",id:"include-specific-states",level:3},{value:"Common Use Cases",id:"common-use-cases",level:2},{value:"Use Case 1: Active Records Only (Default)",id:"use-case-1-active-records-only-default",level:3},{value:"Use Case 2: Audit Trail (All Records)",id:"use-case-2-audit-trail-all-records",level:3},{value:"Use Case 3: Recently Modified Only",id:"use-case-3-recently-modified-only",level:3},{value:"Use Case 4: Soft Deleted Records",id:"use-case-4-soft-deleted-records",level:3},{value:"TREC Lifecycle",id:"trec-lifecycle",level:2},{value:"State Transitions",id:"state-transitions",level:3},{value:"Audit Fields Updated with TREC",id:"audit-fields-updated-with-trec",level:3},{value:"Combining TREC with Filters",id:"combining-trec-with-filters",level:2},{value:"TREC + Business Logic",id:"trec--business-logic",level:3},{value:"JavaScript Examples",id:"javascript-examples",level:2},{value:"TREC Filter Helper",id:"trec-filter-helper",level:3},{value:"Audit Trail Component",id:"audit-trail-component",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Common Mistakes",id:"common-mistakes",level:2},{value:"Mistake 1: Forgetting Cancelled Records in Audit",id:"mistake-1-forgetting-cancelled-records-in-audit",level:3},{value:"Mistake 2: Including Cancelled in Normal List",id:"mistake-2-including-cancelled-in-normal-list",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function o(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h1,{id:"trec-filtering",children:"TREC Filtering"}),"\n",(0,s.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"TREC"})," (Transaction Record) tracks the lifecycle state of every record. The ",(0,s.jsx)(r.code,{children:"cond_trec"})," parameter filters records by their TREC state."]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"TREC States:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"N"})," - New (newly created)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"M"})," - Modified (updated)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"C"})," - Cancelled (soft deleted)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"P"})," - Processed (special state, rare)"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"default-trec-filtering",children:"Default TREC Filtering"}),"\n",(0,s.jsx)(r.h3,{id:"automatic-exclusion-of-cancelled-records",children:"Automatic Exclusion of Cancelled Records"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"By default, queries exclude TREC='C':"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productList\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Generated SQL:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sql",children:"WHERE TREC != 'C'\n"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Result:"})," Returns only N, M, P records (active records)."]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Why?"}),' Cancelled records are "soft deleted" and should not appear in normal queries.']}),"\n",(0,s.jsx)(r.h2,{id:"cond_trec-parameter",children:"cond_trec Parameter"}),"\n",(0,s.jsx)(r.h3,{id:"include-specific-states",children:"Include Specific States"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Show only new records:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productList&\\\n  cond_trec=N\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Show new and modified:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productList&\\\n  cond_trec=N,M\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Show cancelled records:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productList&\\\n  cond_trec=C\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Show all records (including cancelled):"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productList&\\\n  cond_trec=N,M,C,P\n"})}),"\n",(0,s.jsx)(r.h2,{id:"common-use-cases",children:"Common Use Cases"}),"\n",(0,s.jsx)(r.h3,{id:"use-case-1-active-records-only-default",children:"Use Case 1: Active Records Only (Default)"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Most common - normal queries:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productList\n# Automatically excludes TREC='C'\n"})}),"\n",(0,s.jsx)(r.h3,{id:"use-case-2-audit-trail-all-records",children:"Use Case 2: Audit Trail (All Records)"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Show everything including deleted:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productAudit&\\\n  cond_trec=N,M,C&\\\n  $order=LDATA DESC\n"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Use:"})," Audit logs, compliance reports, data recovery."]}),"\n",(0,s.jsx)(r.h3,{id:"use-case-3-recently-modified-only",children:"Use Case 3: Recently Modified Only"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Show only updated records:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productChanges&\\\n  cond_trec=M&\\\n  $filter=LDATA ge '20251201000000'\n"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Use:"})," Change tracking, sync operations."]}),"\n",(0,s.jsx)(r.h3,{id:"use-case-4-soft-deleted-records",children:"Use Case 4: Soft Deleted Records"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Show cancelled records for recovery:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productTrash&\\\n  cond_trec=C&\\\n  $order=LDATA DESC\n"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Use:"}),' "Trash" view, undelete functionality.']}),"\n",(0,s.jsx)(r.h2,{id:"trec-lifecycle",children:"TREC Lifecycle"}),"\n",(0,s.jsx)(r.h3,{id:"state-transitions",children:"State Transitions"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"NEW (N) \u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u251c\u2500\u2500\u2192 MODIFIED (M) \u2500\u2500\u2192 CANCELLED (C)\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 CANCELLED (C)\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Flow:"})}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"POST creates record with TREC='N'"}),"\n",(0,s.jsx)(r.li,{children:"PUT/PATCH updates to TREC='M'"}),"\n",(0,s.jsx)(r.li,{children:"DELETE (soft) sets TREC='C'"}),"\n",(0,s.jsx)(r.li,{children:"DELETE (force) physically removes record"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"audit-fields-updated-with-trec",children:"Audit Fields Updated with TREC"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"On CREATE (TREC='N'):"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"OWNER = current user"}),"\n",(0,s.jsx)(r.li,{children:"CDATA = current timestamp"}),"\n",(0,s.jsx)(r.li,{children:"TREC = 'N'"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"On UPDATE (TREC='M'):"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"LOWNER = current user"}),"\n",(0,s.jsx)(r.li,{children:"LDATA = current timestamp"}),"\n",(0,s.jsx)(r.li,{children:"TREC = 'M'"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"On DELETE (TREC='C'):"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"LOWNER = current user"}),"\n",(0,s.jsx)(r.li,{children:"LDATA = current timestamp"}),"\n",(0,s.jsx)(r.li,{children:"TREC = 'C'"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"combining-trec-with-filters",children:"Combining TREC with Filters"}),"\n",(0,s.jsx)(r.h3,{id:"trec--business-logic",children:"TREC + Business Logic"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Active products in Electronics:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productList&\\\n  cond_trec=N,M&\\\n  $filter=XPRD05 eq 'Electronics' AND XPRD06 eq true\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Recently deleted Electronics:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productTrash&\\\n  cond_trec=C&\\\n  $filter=XPRD05 eq 'Electronics' AND LDATA ge '20251201000000'\n"})}),"\n",(0,s.jsx)(r.h2,{id:"javascript-examples",children:"JavaScript Examples"}),"\n",(0,s.jsx)(r.h3,{id:"trec-filter-helper",children:"TREC Filter Helper"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"class TrecFilter {\n  static ACTIVE = 'N,M';        // Normal queries\n  static ALL = 'N,M,C,P';       // Audit queries\n  static NEW_ONLY = 'N';        // New records only\n  static MODIFIED_ONLY = 'M';   // Modified records only\n  static DELETED = 'C';         // Soft deleted records\n\n  static buildUrl(baseUrl, trecFilter) {\n    const url = new URL(baseUrl);\n    if (trecFilter) {\n      url.searchParams.append('cond_trec', trecFilter);\n    }\n    return url;\n  }\n}\n\n// Usage\nconst activeUrl = TrecFilter.buildUrl(\n  `${apiBase}/api/v4/core/PRD?source=productList`,\n  TrecFilter.ACTIVE\n);\n\nconst trashUrl = TrecFilter.buildUrl(\n  `${apiBase}/api/v4/core/PRD?source=productTrash`,\n  TrecFilter.DELETED\n);\n"})}),"\n",(0,s.jsx)(r.h3,{id:"audit-trail-component",children:"Audit Trail Component"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"async function fetchAuditTrail(dimension, recordId) {\n  const url = new URL(`${apiBase}/api/v4/core/${dimension}`);\n  url.searchParams.append('source', 'audit');\n  url.searchParams.append('cond_trec', 'N,M,C'); // All states\n  url.searchParams.append('$filter', `${dimension}_ID eq ${recordId}`);\n  url.searchParams.append('$order', 'LDATA DESC');\n\n  const response = await fetch(url, {\n    headers: { 'Authorization': `Bearer ${token}` }\n  });\n\n  const result = await response.json();\n\n  return result.data.map(record => ({\n    state: record.TREC,\n    timestamp: record.LDATA || record.CDATA,\n    user: record.LOWNER || record.OWNER,\n    action: getTrecActionName(record.TREC)\n  }));\n}\n\nfunction getTrecActionName(trec) {\n  switch (trec) {\n    case 'N': return 'Created';\n    case 'M': return 'Modified';\n    case 'C': return 'Deleted';\n    default: return 'Unknown';\n  }\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(r.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Rely on default for normal queries:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"# \u2705 Good - automatic TREC filtering\nGET /api/v4/core/PRD?source=productList\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Explicitly include cancelled for audit:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"# \u2705 Good - audit trail\ncond_trec=N,M,C\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Filter deleted by date:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"# \u2705 Good - recently deleted\ncond_trec=C&$filter=LDATA ge '20251201000000'\n"})}),"\n",(0,s.jsx)(r.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Don't include cancelled in normal queries:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"# \u274c Bad - shows deleted records\ncond_trec=N,M,C\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Don't forget cond_trec in audit queries:"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"# \u274c Bad - missing deleted records\nGET /api/v4/core/PRD?source=audit\n# Should use: cond_trec=N,M,C\n"})}),"\n",(0,s.jsx)(r.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,s.jsx)(r.h3,{id:"mistake-1-forgetting-cancelled-records-in-audit",children:"Mistake 1: Forgetting Cancelled Records in Audit"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"# \u274c Wrong - missing deleted records\nGET /api/v4/core/PRD?source=audit\n\n# \u2705 Correct\nGET /api/v4/core/PRD?source=audit&cond_trec=N,M,C\n"})}),"\n",(0,s.jsx)(r.h3,{id:"mistake-2-including-cancelled-in-normal-list",children:"Mistake 2: Including Cancelled in Normal List"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"# \u274c Wrong - shows deleted products\nGET /api/v4/core/PRD?source=productList&cond_trec=N,M,C\n\n# \u2705 Correct - rely on default\nGET /api/v4/core/PRD?source=productList\n"})}),"\n",(0,s.jsx)(r.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"\u2705 Default excludes TREC='C' (cancelled)"}),"\n",(0,s.jsxs)(r.li,{children:["\u2705 Use ",(0,s.jsx)(r.code,{children:"cond_trec"})," to control which states to include"]}),"\n",(0,s.jsx)(r.li,{children:"\u2705 Format: comma-separated states (N,M,C,P)"}),"\n",(0,s.jsx)(r.li,{children:"\u2705 Include C for audit trails and trash views"}),"\n",(0,s.jsx)(r.li,{children:"\u2705 TREC changes automatically on CREATE/UPDATE/DELETE"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Key Takeaways:"})}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"Normal queries: rely on default (no cond_trec)"}),"\n",(0,s.jsx)(r.li,{children:"Audit queries: use cond_trec=N,M,C"}),"\n",(0,s.jsx)(r.li,{children:"Trash view: use cond_trec=C"}),"\n",(0,s.jsx)(r.li,{children:"TREC tracks record lifecycle automatically"}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Next:"})," ",(0,s.jsx)(r.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/relational-queries",children:"Relational Queries \u2192"})]}),"\n",(0,s.jsx)(r.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/entity-lifecycle",children:"Entity Lifecycle"})," - TREC state details"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/write-operations",children:"Write Operations"})," - How TREC changes"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/query-performance",children:"Query Performance"})," - TREC filtering performance"]}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,c.M)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},2172:(e,r,n)=>{n.d(r,{I:()=>t,M:()=>l});var s=n(1504);const c={},i=s.createContext(c);function l(e){const r=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function t(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);