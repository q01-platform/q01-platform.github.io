"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[1820],{4064:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>a});var i=r(7624),s=r(2172);const t={title:"Internal Architecture",sidebar_label:"Internal Architecture",sidebar_position:9,description:"CoreService routing and CQRS implementation"},l="Internal Architecture",c={id:"products/map.q01.io/core-api-platform-v4/advanced-topics/internal-architecture",title:"Internal Architecture",description:"CoreService routing and CQRS implementation",source:"@site/docs/products/map.q01.io/core-api-platform-v4/06-advanced-topics/internal-architecture.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/06-advanced-topics",slug:"/products/map.q01.io/core-api-platform-v4/advanced-topics/internal-architecture",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/internal-architecture",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:9,frontMatter:{title:"Internal Architecture",sidebar_label:"Internal Architecture",sidebar_position:9,description:"CoreService routing and CQRS implementation"},sidebar:"mapSidebar",previous:{title:"Custom Functions",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/custom-functions"},next:{title:"Batch Processing",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/batch-processing"}},o={},a=[{value:"Overview",id:"overview",level:2},{value:"Architecture Diagram",id:"architecture-diagram",level:2},{value:"CoreService (API Gateway)",id:"coreservice-api-gateway",level:2},{value:"Technology Stack",id:"technology-stack",level:3},{value:"Responsibilities",id:"responsibilities",level:3},{value:"Routing Logic",id:"routing-logic",level:3},{value:"Backend Destination Resolution",id:"backend-destination-resolution",level:3},{value:"HTTP Method Handlers",id:"http-method-handlers",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Binary/Media Handling",id:"binarymedia-handling",level:3},{value:"CoreQuery (Read Service)",id:"corequery-read-service",level:2},{value:"Technology Stack",id:"technology-stack-1",level:3},{value:"Responsibilities",id:"responsibilities-1",level:3},{value:"Core Components",id:"core-components",level:3},{value:"CoreWrite (Write Service)",id:"corewrite-write-service",level:2},{value:"Technology Stack",id:"technology-stack-2",level:3},{value:"Responsibilities",id:"responsibilities-2",level:3},{value:"Core Components",id:"core-components-1",level:3},{value:"Request Flow",id:"request-flow",level:2},{value:"Read Request Flow",id:"read-request-flow",level:3},{value:"Write Request Flow",id:"write-request-flow",level:3},{value:"CQRS Benefits",id:"cqrs-benefits",level:2},{value:"Read Optimization",id:"read-optimization",level:3},{value:"Write Optimization",id:"write-optimization",level:3},{value:"Deployment Architecture",id:"deployment-architecture",level:2},{value:"Docker Compose Example",id:"docker-compose-example",level:3},{value:"Kubernetes Example",id:"kubernetes-example",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Latency",id:"latency",level:3},{value:"Throughput",id:"throughput",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"internal-architecture",children:"Internal Architecture"}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["Q01 Core APIs implement a ",(0,i.jsx)(n.strong,{children:"CQRS (Command Query Responsibility Segregation)"})," pattern with three microservices:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CoreService"})," (Go/Buffalo) - API Gateway"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CoreQuery"})," (PHP/Symfony) - Read Operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CoreWrite"})," (PHP/Symfony) - Write Operations"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"From the user perspective:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["All requests go to ",(0,i.jsx)(n.strong,{children:"CoreService"})," endpoints only"]}),"\n",(0,i.jsx)(n.li,{children:"HTTP method determines operation type"}),"\n",(0,i.jsx)(n.li,{children:"Internal routing is completely transparent"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Read/write optimization (separate databases possible)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Independent scaling (scale reads and writes separately)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Clear separation of concerns"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Improved maintainability"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Security isolation"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"architecture-diagram",children:"Architecture Diagram"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Applications                      \u2502\n\u2502  (Web Apps, Mobile Apps, Backend Services, etc.)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502\n                       \u2502 HTTP/HTTPS\n                       \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              CoreService (API Gateway)              \u2502\n\u2502              Go/Buffalo - Port 8080                 \u2502\n\u2502                                                      \u2502\n\u2502  \u2022 CORS handling                                    \u2502\n\u2502  \u2022 SSL/TLS termination                              \u2502\n\u2502  \u2022 Request logging                                  \u2502\n\u2502  \u2022 Route-based routing logic                        \u2502\n\u2502  \u2022 Error normalization                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502                    \u2502\n               \u2502 GET requests       \u2502 POST/PUT/PATCH/DELETE\n               \u2502                    \u2502\n               \u25bc                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    CoreQuery         \u2502   \u2502    CoreWrite         \u2502\n\u2502  PHP/Symfony         \u2502   \u2502  PHP/Symfony         \u2502\n\u2502  Port 8081           \u2502   \u2502  Port 8082           \u2502\n\u2502                      \u2502   \u2502                      \u2502\n\u2502  \u2022 TB_DIM metadata   \u2502   \u2502  \u2022 TB_DIM metadata   \u2502\n\u2502  \u2022 TB_VAR, TB_COST   \u2502   \u2502  \u2022 CRUD operations   \u2502\n\u2502  \u2022 TB_MENU grants    \u2502   \u2502  \u2022 TREC lifecycle    \u2502\n\u2502  \u2022 Context filtering \u2502   \u2502  \u2022 Cascade ops       \u2502\n\u2502  \u2022 Field visibility  \u2502   \u2502  \u2022 OUTBOX events     \u2502\n\u2502  \u2022 Read-only SQL     \u2502   \u2502  \u2022 Pre-insert funcs  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502                          \u2502\n           \u2502                          \u2502\n           \u25bc                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Database Layer                       \u2502\n\u2502                                                   \u2502\n\u2502  \u2022 TB_META (metadata database)                   \u2502\n\u2502  \u2022 TB_DATA (data database)                       \u2502\n\u2502  \u2022 TB_AUTH (authentication database)             \u2502\n\u2502                                                   \u2502\n\u2502  MySQL / Oracle / PostgreSQL                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u2502 RabbitMQ Events\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Event Subscribers                        \u2502\n\u2502                                                   \u2502\n\u2502  \u2022 search-indexer (Elasticsearch)                \u2502\n\u2502  \u2022 cache-invalidator (Redis)                     \u2502\n\u2502  \u2022 analytics-writer (Data warehouse)             \u2502\n\u2502  \u2022 notification-sender (Email/SMS)               \u2502\n\u2502  \u2022 webhook-dispatcher (External APIs)            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h2,{id:"coreservice-api-gateway",children:"CoreService (API Gateway)"}),"\n",(0,i.jsx)(n.h3,{id:"technology-stack",children:"Technology Stack"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Language"}),": Go 1.19+"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Framework"}),": Buffalo v1.1.0"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Port"}),": 8080 (default)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Repository"}),": ",(0,i.jsx)(n.code,{children:"q01sdk/mscoreservice/dkcoreservice"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"responsibilities",children:"Responsibilities"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Single Entry Point"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"All applications call CoreService endpoints"}),"\n",(0,i.jsx)(n.li,{children:"Public-facing API surface"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request Routing"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Route-based routing (named routes, not path matching)"}),"\n",(0,i.jsx)(n.li,{children:"Intelligent routing to QUERY_API or WRITE_API"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cross-Cutting Concerns"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CORS handling"}),"\n",(0,i.jsx)(n.li,{children:"SSL/TLS termination"}),"\n",(0,i.jsx)(n.li,{children:"Request/response logging"}),"\n",(0,i.jsx)(n.li,{children:"Error normalization"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"No Business Logic"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pure gateway - no data validation"}),"\n",(0,i.jsx)(n.li,{children:"No metadata interpretation"}),"\n",(0,i.jsx)(n.li,{children:"No database access"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"routing-logic",children:"Routing Logic"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Route-based routing (not path-based):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'func RoutingDefault(c buffalo.Context) error {\n    // Get route name from context\n    currRouteStruct := buffalo.RouteInfo{}\n    currRoute := c.Data()["current_route"]\n    jsonData, _ := json.Marshal(currRoute)\n    json.Unmarshal(jsonData, &currRouteStruct)\n    routeName := currRouteStruct.PathName\n\n    resource := c.Request().URL.Path\n\n    // Route based on named route\n    switch routeName {\n    // READ OPERATIONS \u2192 CoreQuery\n    case "coreIndexPath",        // GET /api/v4/core/{dim}\n         "coreShowPath",         // GET /api/v4/core/{dim}/{id}\n         "coreFieldsPath",       // GET /api/v4/core/{dim}/fields\n         "coreMenuPath":         // GET /api/v4/core/menu\n        code, contentType, data = routingGet(c, resource, "QUERY_API")\n\n    // WRITE OPERATIONS \u2192 CoreWrite\n    case "coreCreatePath":       // POST /api/v4/core/{dim}\n        code, contentType, data = routingPost(c, resource, "WRITE_API")\n\n    case "coreUpdatePath":       // PUT /api/v4/core/{dim}/{id}\n        code, contentType, data = routingPut(c, resource, "WRITE_API")\n\n    case "corePatchPath":        // PATCH /api/v4/core/{dim}/{id}\n        code, contentType, data = routingPatch(c, resource, "WRITE_API")\n\n    case "coreDestroyByIDPath":  // DELETE /api/v4/core/{dim}/{id}\n        code, contentType, data = routingDelete(c, resource, "WRITE_API")\n    }\n\n    return c.Render(code, r.JSON(data))\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key characteristics:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Routing based on ",(0,i.jsx)(n.strong,{children:"route name"})," (e.g., ",(0,i.jsx)(n.code,{children:'"coreIndexPath"'}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Route names end with ",(0,i.jsx)(n.code,{children:'"Path"'})," suffix"]}),"\n",(0,i.jsx)(n.li,{children:"Same URL path can route to different backends based on route name"}),"\n",(0,i.jsx)(n.li,{children:"No path pattern matching - purely based on named routes"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"backend-destination-resolution",children:"Backend Destination Resolution"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'func getDestination(destination string) (string, string) {\n    var host string\n    var port string\n\n    if destination == "QUERY_API" {\n        host = os.Getenv("R_API_HOST")   // CoreQuery host\n        port = os.Getenv("R_API_PORT")   // CoreQuery port\n    } else {\n        host = os.Getenv("W_API_HOST")   // CoreWrite host\n        port = os.Getenv("W_API_PORT")   // CoreWrite port\n    }\n\n    return host, port\n}\n\nfunc getUrl(destination string, resource string) string {\n    host, port := getDestination(destination)\n\n    apiUrl := host\n    if port != "" {\n        apiUrl = host + ":" + port\n    }\n\n    return apiUrl + path.Clean(resource)\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"http-method-handlers",children:"HTTP Method Handlers"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"GET requests:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'func routingGet(c buffalo.Context, resource string, destination string) (int, string, *interface{}) {\n    apiurl := getUrl(destination, resource)\n\n    // Create HTTP GET request\n    api_req, _ := http.NewRequest("GET", apiurl, nil)\n\n    // Clone headers from original request\n    api_req.Header = c.Request().Header\n\n    // Clone query parameters\n    api_req.URL.RawQuery = c.Request().URL.Query().Encode()\n\n    // Forward request\n    core_api_client := &http.Client{}\n    api_resp, _ := core_api_client.Do(api_req)\n\n    // Read response\n    data, _ := io.ReadAll(api_resp.Body)\n\n    return api_resp.StatusCode, api_resp.Header.Get("Content-Type"), &data\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"POST/PUT/PATCH requests:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'func routingPost(c buffalo.Context, resource string, destination string) (int, string, *interface{}) {\n    apiurl := getUrl(destination, resource)\n\n    // Read request body\n    body, _ := io.ReadAll(c.Request().Body)\n\n    // Create HTTP POST request\n    api_req, _ := http.NewRequest("POST", apiurl, bytes.NewBuffer(body))\n\n    // Clone headers\n    api_req.Header = c.Request().Header\n\n    // Clone query parameters\n    api_req.URL.RawQuery = c.Request().URL.Query().Encode()\n\n    // Forward request\n    core_api_client := &http.Client{}\n    api_resp, _ := core_api_client.Do(api_req)\n\n    // Parse response\n    var result interface{}\n    json.NewDecoder(api_resp.Body).Decode(&result)\n\n    return api_resp.StatusCode, "application/json", &result\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CoreQuery (Read API):"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"R_API_HOST"})," - CoreQuery hostname (e.g., ",(0,i.jsx)(n.code,{children:"corequery"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"R_API_PORT"})," - CoreQuery port (e.g., ",(0,i.jsx)(n.code,{children:"8081"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"R_API_VERSION"})," - Read API version (e.g., ",(0,i.jsx)(n.code,{children:"v4"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CoreWrite (Write API):"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"W_API_HOST"})," - CoreWrite hostname (e.g., ",(0,i.jsx)(n.code,{children:"corewrite"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"W_API_PORT"})," - CoreWrite port (e.g., ",(0,i.jsx)(n.code,{children:"8082"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"W_API_VERSION"})," - Write API version (e.g., ",(0,i.jsx)(n.code,{children:"v4"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CoreService:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GO_ENV"})," - Environment (development/production)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ADDR"})," - Bind address (default: ",(0,i.jsx)(n.code,{children:"0.0.0.0"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PORT"})," - Server port (default: ",(0,i.jsx)(n.code,{children:"8080"}),")"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"binarymedia-handling",children:"Binary/Media Handling"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Special handler for binary responses:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'case "coreMediaPath",\n     "coreMediaPublicPath":\n    code, contentType, data = routingGetImage(c, resource, "QUERY_API")\n\nfunc routingGetImage(c buffalo.Context, resource string, destination string) (int, string, []byte) {\n    apiurl := getUrl(destination, resource)\n\n    api_req, _ := http.NewRequest("GET", apiurl, nil)\n    api_req.Header = c.Request().Header\n    api_req.URL.RawQuery = c.Request().URL.Query().Encode()\n\n    core_api_client := &http.Client{}\n    api_resp, _ := core_api_client.Do(api_req)\n\n    // Read binary data\n    data, _ := io.ReadAll(api_resp.Body)\n\n    return api_resp.StatusCode, api_resp.Header.Get("Content-Type"), data\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"corequery-read-service",children:"CoreQuery (Read Service)"}),"\n",(0,i.jsx)(n.h3,{id:"technology-stack-1",children:"Technology Stack"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Language"}),": PHP 8.0+"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Framework"}),": Symfony 6.x"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Port"}),": 8081 (default)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Repository"}),": ",(0,i.jsx)(n.code,{children:"q01sdk/mscorequery/dkcorequery"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"responsibilities-1",children:"Responsibilities"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Metadata-Driven Queries"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"TB_DIM, TB_VAR, TB_COST, TB_MENU interpretation"}),"\n",(0,i.jsx)(n.li,{children:"Runtime schema resolution"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Read-Only Operations"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"GET endpoints only"}),"\n",(0,i.jsx)(n.li,{children:"SELECT queries only"}),"\n",(0,i.jsx)(n.li,{children:"No database modifications"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Multi-Level Permissions"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"peso (user level) filtering"}),"\n",(0,i.jsx)(n.li,{children:"COD_ON_OFF field visibility"}),"\n",(0,i.jsx)(n.li,{children:"TB_MENU grant checking"}),"\n",(0,i.jsx)(n.li,{children:"Context filtering (source, ambiente, centro_dett)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Field Visibility"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"COD_ON_OFF bitmask evaluation"}),"\n",(0,i.jsx)(n.li,{children:"L (list), D (detail), R (search) flags"}),"\n",(0,i.jsx)(n.li,{children:"Dynamic field inclusion/exclusion"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Query Optimization"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Index-aware query generation"}),"\n",(0,i.jsx)(n.li,{children:"Efficient JOIN construction"}),"\n",(0,i.jsx)(n.li,{children:"Pagination support"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"core-components",children:"Core Components"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Main Query Engine:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"src/Core/Modules.php"})," - 4200+ lines of query logic"]}),"\n",(0,i.jsx)(n.li,{children:"Metadata-driven SQL generation"}),"\n",(0,i.jsx)(n.li,{children:"Field visibility enforcement"}),"\n",(0,i.jsx)(n.li,{children:"Context filtering application"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request Validation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"src/EventDispatcher/Subscriber/RequestValidatorSubscriber.php"})}),"\n",(0,i.jsx)(n.li,{children:"Token validation"}),"\n",(0,i.jsx)(n.li,{children:"Grant checking"}),"\n",(0,i.jsx)(n.li,{children:"Required parameter validation"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"corewrite-write-service",children:"CoreWrite (Write Service)"}),"\n",(0,i.jsx)(n.h3,{id:"technology-stack-2",children:"Technology Stack"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Language"}),": PHP 8.0+"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Framework"}),": Symfony 6.x"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Port"}),": 8082 (default)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Repository"}),": ",(0,i.jsx)(n.code,{children:"q01sdk/mscorewrite/dkcorewrite"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"responsibilities-2",children:"Responsibilities"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CRUD Operations"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"INSERT (POST)"}),"\n",(0,i.jsx)(n.li,{children:"UPDATE (PUT)"}),"\n",(0,i.jsx)(n.li,{children:"PARTIAL UPDATE (PATCH)"}),"\n",(0,i.jsx)(n.li,{children:"DELETE (DELETE)"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Entity Lifecycle"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"TREC state management (N\u2192M\u2192C)"}),"\n",(0,i.jsx)(n.li,{children:"Cascade operations (INSERT_CASCADE, UPDATE_CASCADE, DELETE_CASCADE)"}),"\n",(0,i.jsx)(n.li,{children:"Soft delete support"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Pre-Insert Functions"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"uuid, md5, counter, slugify, sequence"}),"\n",(0,i.jsx)(n.li,{children:"Metadata-driven field initialization"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Event Sourcing"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"OUTBOX pattern implementation"}),"\n",(0,i.jsx)(n.li,{children:"RabbitMQ event publishing"}),"\n",(0,i.jsx)(n.li,{children:"At-least-once delivery guarantee"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Transaction Management"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"ACID compliance"}),"\n",(0,i.jsx)(n.li,{children:"Row-level locking"}),"\n",(0,i.jsx)(n.li,{children:"Rollback on failure"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"core-components-1",children:"Core Components"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CRUD Engine:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"src/Core/DbInterface/DataStore.php"})," - 3354 lines"]}),"\n",(0,i.jsx)(n.li,{children:"INSERT, UPDATE, PATCH, DELETE operations"}),"\n",(0,i.jsx)(n.li,{children:"Cascade logic"}),"\n",(0,i.jsx)(n.li,{children:"OUTBOX event generation"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request Validation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"src/EventDispatcher/Subscriber/RequestValidatorSubscriber.php"})}),"\n",(0,i.jsx)(n.li,{children:"Token validation"}),"\n",(0,i.jsx)(n.li,{children:"Grant checking (write permissions)"}),"\n",(0,i.jsx)(n.li,{children:"Required field validation"}),"\n",(0,i.jsx)(n.li,{children:"COD_ON_OFF flag checking"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"request-flow",children:"Request Flow"}),"\n",(0,i.jsx)(n.h3,{id:"read-request-flow",children:"Read Request Flow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'1. Client \u2192 CoreService\n   GET https://api.q01.io/api/v4/core/products?limit=10\n\n2. CoreService \u2192 CoreQuery\n   \u2022 Route name: "coreIndexPath"\n   \u2022 Destination: QUERY_API\n   \u2022 Forwards to: http://corequery:8081/api/v4/core/products?limit=10\n\n3. CoreQuery Processing\n   \u2022 Validate token (JWT)\n   \u2022 Check TB_MENU grants (read permission)\n   \u2022 Load TB_DIM metadata (dimension: PRD)\n   \u2022 Load TB_VAR metadata (field definitions)\n   \u2022 Apply context filters (source, peso, ambiente, centro_dett)\n   \u2022 Evaluate COD_ON_OFF flags (L=list visible)\n   \u2022 Generate SQL: SELECT PRD_ID, XPRD01, XPRD02... FROM TB_ANAG_PRD00 WHERE source=? AND TREC=\'N\' LIMIT 10\n   \u2022 Execute query\n   \u2022 Build JSON response\n\n4. CoreQuery \u2192 CoreService\n   HTTP 200 OK\n   {"data": [...], "total": 150}\n\n5. CoreService \u2192 Client\n   HTTP 200 OK\n   {"data": [...], "total": 150}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"write-request-flow",children:"Write Request Flow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'1. Client \u2192 CoreService\n   POST https://api.q01.io/api/v4/core/products\n   {"XPRD01": "Widget", "XPRD02": 19.99}\n\n2. CoreService \u2192 CoreWrite\n   \u2022 Route name: "coreCreatePath"\n   \u2022 Destination: WRITE_API\n   \u2022 Forwards to: http://corewrite:8082/api/v4/core/products\n\n3. CoreWrite Processing\n   \u2022 Validate token (JWT)\n   \u2022 Check TB_MENU grants (create permission)\n   \u2022 Load TB_DIM metadata (dimension: PRD)\n   \u2022 Load TB_VAR metadata (field definitions)\n   \u2022 Validate required fields\n   \u2022 Apply context (source, peso, ambiente, centro_dett)\n   \u2022 Execute pre-insert functions (uuid, counter, etc.)\n   \u2022 Begin transaction\n   \u2022 INSERT INTO TB_ANAG_PRD00 (...)\n   \u2022 INSERT INTO OUTBOX (event_type=\'ProductCreated\', ...)\n   \u2022 Commit transaction\n   \u2022 Build JSON response\n\n4. CoreWrite \u2192 CoreService\n   HTTP 201 Created\n   {"PRD_ID": 123, "XPRD01": "Widget", ...}\n\n5. CoreService \u2192 Client\n   HTTP 201 Created\n   {"PRD_ID": 123, "XPRD01": "Widget", ...}\n\n6. Background: OUTBOX Publisher \u2192 RabbitMQ\n   \u2022 Poll OUTBOX table\n   \u2022 Publish event to fanout exchange\n   \u2022 Subscribers: search-indexer, cache-invalidator, etc.\n'})}),"\n",(0,i.jsx)(n.h2,{id:"cqrs-benefits",children:"CQRS Benefits"}),"\n",(0,i.jsx)(n.h3,{id:"read-optimization",children:"Read Optimization"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CoreQuery can:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use read replicas"}),"\n",(0,i.jsx)(n.li,{children:"Implement aggressive caching"}),"\n",(0,i.jsx)(n.li,{children:"Optimize for query performance"}),"\n",(0,i.jsx)(n.li,{children:"Scale independently"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  CoreQuery   \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Read Replica \u2502\n\u2502   (3 pods)   \u2502       \u2502   (MySQL)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h3,{id:"write-optimization",children:"Write Optimization"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CoreWrite can:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use write master"}),"\n",(0,i.jsx)(n.li,{children:"Implement write-ahead logging (OUTBOX)"}),"\n",(0,i.jsx)(n.li,{children:"Optimize for transaction throughput"}),"\n",(0,i.jsx)(n.li,{children:"Scale independently"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  CoreWrite   \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Write Master \u2502\n\u2502   (2 pods)   \u2502       \u2502   (MySQL)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502\n        \u2502 Events\n        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   RabbitMQ   \u2502\n\u2502   Fanout     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h2,{id:"deployment-architecture",children:"Deployment Architecture"}),"\n",(0,i.jsx)(n.h3,{id:"docker-compose-example",children:"Docker Compose Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  coreservice:\n    image: q01/coreservice:latest\n    ports:\n      - "8080:8080"\n    environment:\n      R_API_HOST: http://corequery\n      R_API_PORT: 8081\n      R_API_VERSION: v4\n      W_API_HOST: http://corewrite\n      W_API_PORT: 8082\n      W_API_VERSION: v4\n      GO_ENV: production\n    depends_on:\n      - corequery\n      - corewrite\n\n  corequery:\n    image: q01/corequery:latest\n    ports:\n      - "8081:8081"\n    environment:\n      DATABASE_HOST: mysql-read\n      DATABASE_PORT: 3306\n      DATABASE_NAME: q01_data\n      DATABASE_USER: q01_reader\n      DATABASE_PASSWORD: ${DB_READ_PASSWORD}\n    depends_on:\n      - mysql-read\n\n  corewrite:\n    image: q01/corewrite:latest\n    ports:\n      - "8082:8082"\n    environment:\n      DATABASE_HOST: mysql-write\n      DATABASE_PORT: 3306\n      DATABASE_NAME: q01_data\n      DATABASE_USER: q01_writer\n      DATABASE_PASSWORD: ${DB_WRITE_PASSWORD}\n      RABBITMQ_HOST: rabbitmq\n      RABBITMQ_PORT: 5672\n    depends_on:\n      - mysql-write\n      - rabbitmq\n\n  mysql-read:\n    image: mysql:8.0\n    environment:\n      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}\n      MYSQL_DATABASE: q01_data\n\n  mysql-write:\n    image: mysql:8.0\n    environment:\n      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}\n      MYSQL_DATABASE: q01_data\n\n  rabbitmq:\n    image: rabbitmq:3-management\n    ports:\n      - "5672:5672"\n      - "15672:15672"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"kubernetes-example",children:"Kubernetes Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: coreservice\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: coreservice\n  template:\n    metadata:\n      labels:\n        app: coreservice\n    spec:\n      containers:\n      - name: coreservice\n        image: q01/coreservice:latest\n        ports:\n        - containerPort: 8080\n        env:\n        - name: R_API_HOST\n          value: "http://corequery-service"\n        - name: R_API_PORT\n          value: "8081"\n        - name: W_API_HOST\n          value: "http://corewrite-service"\n        - name: W_API_PORT\n          value: "8082"\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: coreservice\nspec:\n  type: LoadBalancer\n  selector:\n    app: coreservice\n  ports:\n  - port: 80\n    targetPort: 8080\n'})}),"\n",(0,i.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,i.jsx)(n.h3,{id:"latency",children:"Latency"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Additional hop:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Client \u2192 CoreService: ~5ms"}),"\n",(0,i.jsx)(n.li,{children:"CoreService \u2192 CoreQuery/CoreWrite: ~2ms"}),"\n",(0,i.jsx)(n.li,{children:"Total overhead: ~7ms"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Mitigation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Deploy all services in same region/VPC"}),"\n",(0,i.jsx)(n.li,{children:"Use connection pooling"}),"\n",(0,i.jsx)(n.li,{children:"Enable HTTP keep-alive"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"throughput",children:"Throughput"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"CoreService bottleneck:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Go is highly concurrent (goroutines)"}),"\n",(0,i.jsx)(n.li,{children:"Can handle 10,000+ req/sec per pod"}),"\n",(0,i.jsx)(n.li,{children:"Scales horizontally"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Monitoring:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check CoreService throughput\ncurl http://coreservice:8080/metrics | grep http_requests_total\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use environment variables for configuration:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u2705 Good - external configuration\nexport R_API_HOST=http://corequery-prod\nexport W_API_HOST=http://corewrite-prod\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Scale services independently:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u2705 Good - scale reads more than writes\nkubectl scale deployment corequery --replicas=5\nkubectl scale deployment corewrite --replicas=2\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Monitor all three services:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u2705 Good - comprehensive monitoring\ncurl http://coreservice:8080/health\ncurl http://corequery:8081/health\ncurl http://corewrite:8082/health\n"})}),"\n",(0,i.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't call CoreQuery/CoreWrite directly:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u274c Bad - bypass CoreService\ncurl http://corequery:8081/api/v4/core/products\n\n# \u2705 Good - through CoreService\ncurl http://coreservice:8080/api/v4/core/products\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't hardcode backend URLs:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// \u274c Bad - hardcoded\napiUrl := "http://corequery:8081" + resource\n\n// \u2705 Good - environment variable\napiUrl := os.Getenv("R_API_HOST") + resource\n'})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 CoreService is the single public-facing API gateway"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Route-based routing (named routes, not path matching)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 CoreQuery handles all read operations (GET)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 CoreWrite handles all write operations (POST/PUT/PATCH/DELETE)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 CQRS enables independent scaling and optimization"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Environment variables control routing"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 All business logic in CoreQuery/CoreWrite, not CoreService"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Clean separation of concerns"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Users only call CoreService endpoints"}),"\n",(0,i.jsx)(n.li,{children:"Internal routing is completely transparent"}),"\n",(0,i.jsx)(n.li,{children:"Named routes determine destination (not HTTP method alone)"}),"\n",(0,i.jsx)(n.li,{children:"CQRS enables read/write optimization"}),"\n",(0,i.jsx)(n.li,{children:"Scale CoreQuery and CoreWrite independently"}),"\n",(0,i.jsx)(n.li,{children:"Monitor all three services"}),"\n",(0,i.jsx)(n.li,{children:"Deploy in same region for low latency"}),"\n",(0,i.jsx)(n.li,{children:"Never bypass CoreService in production"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://martinfowler.com/bliki/CQRS.html",children:"CQRS Pattern"})," - Martin Fowler"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://microservices.io/patterns/apigateway.html",children:"API Gateway Pattern"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/filtering",children:"Query Patterns"})," - Read operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/create-operations",children:"Write Patterns"})," - Write operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics",children:"Advanced Topics"})," - Overview"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>c,M:()=>l});var i=r(1504);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);