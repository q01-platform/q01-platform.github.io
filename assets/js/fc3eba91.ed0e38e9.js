"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[8836],{5412:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var t=s(7624),r=s(2172);const i={title:"Tenant Isolation",sidebar_label:"Tenant Isolation",sidebar_position:4,description:"Multi-tenancy and data isolation with source filtering"},o="Tenant Isolation",a={id:"products/map.q01.io/core-api-platform-v4/security/tenant-isolation",title:"Tenant Isolation",description:"Multi-tenancy and data isolation with source filtering",source:"@site/docs/products/map.q01.io/core-api-platform-v4/05-security/tenant-isolation.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/05-security",slug:"/products/map.q01.io/core-api-platform-v4/security/tenant-isolation",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/tenant-isolation",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Tenant Isolation",sidebar_label:"Tenant Isolation",sidebar_position:4,description:"Multi-tenancy and data isolation with source filtering"},sidebar:"mapSidebar",previous:{title:"Authorization",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/authorization"},next:{title:"Context Security",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/context-security"}},c={},l=[{value:"Overview",id:"overview",level:2},{value:"The <code>source</code> Field",id:"the-source-field",level:2},{value:"What is <code>source</code>?",id:"what-is-source",level:3},{value:"Source in Table Schema",id:"source-in-table-schema",level:3},{value:"Source in Session Context",id:"source-in-session-context",level:3},{value:"Automatic Tenant Filtering",id:"automatic-tenant-filtering",level:2},{value:"Read Operations (GET)",id:"read-operations-get",level:3},{value:"Write Operations (POST/PUT/PATCH)",id:"write-operations-postputpatch",level:3},{value:"Cross-Tenant Access Prevention",id:"cross-tenant-access-prevention",level:2},{value:"Attempt to Access Other Tenant&#39;s Data",id:"attempt-to-access-other-tenants-data",level:3},{value:"Attempt to Modify Source",id:"attempt-to-modify-source",level:3},{value:"Multi-Tenant Examples",id:"multi-tenant-examples",level:2},{value:"Example 1: E-Commerce Platform",id:"example-1-e-commerce-platform",level:3},{value:"Example 2: SaaS Application",id:"example-2-saas-application",level:3},{value:"Tenant-Specific Customization",id:"tenant-specific-customization",level:2},{value:"Metadata Per Tenant",id:"metadata-per-tenant",level:3},{value:"Tenant-Specific Workflows",id:"tenant-specific-workflows",level:3},{value:"Source and Centro_Dett",id:"source-and-centro_dett",level:2},{value:"Hierarchical Isolation",id:"hierarchical-isolation",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"tenant-isolation",children:"Tenant Isolation"}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["Q01 Core APIs implement ",(0,t.jsx)(n.strong,{children:"multi-tenant architecture"})," where multiple tenants share the same database but data is completely isolated. Every record belongs to a specific tenant (identified by ",(0,t.jsx)(n.code,{children:"source"})," field), and users can only access data from their own tenant."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Complete data isolation (zero cross-tenant access)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Single database (efficient resource usage)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Automatic filtering (transparent to application code)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Zero trust model (all queries filtered)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Tenant-specific customization"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Architecture:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Database (shared)\n\u251c\u2500\u2500 Tenant A (source='tenantA')\n\u2502   \u251c\u2500\u2500 Products (PRD_SOURCE='tenantA')\n\u2502   \u251c\u2500\u2500 Orders (ORD_SOURCE='tenantA')\n\u2502   \u2514\u2500\u2500 Customers (CUST_SOURCE='tenantA')\n\u251c\u2500\u2500 Tenant B (source='tenantB')\n\u2502   \u251c\u2500\u2500 Products (PRD_SOURCE='tenantB')\n\u2502   \u251c\u2500\u2500 Orders (ORD_SOURCE='tenantB')\n\u2502   \u2514\u2500\u2500 Customers (CUST_SOURCE='tenantB')\n\u2514\u2500\u2500 Tenant C (source='tenantC')\n    \u251c\u2500\u2500 Products (PRD_SOURCE='tenantC')\n    \u2514\u2500\u2500 Orders (ORD_SOURCE='tenantC')\n"})}),"\n",(0,t.jsxs)(n.h2,{id:"the-source-field",children:["The ",(0,t.jsx)(n.code,{children:"source"})," Field"]}),"\n",(0,t.jsxs)(n.h3,{id:"what-is-source",children:["What is ",(0,t.jsx)(n.code,{children:"source"}),"?"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"source"})," is the tenant identifier"]})," that appears in every record and session context."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"productManagement"})," - Product management application"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"warehouse"})," - Warehouse management system"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ecommerce"})," - E-commerce storefront"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"storePos"})," - Point-of-sale system"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"mobileApp"})," - Mobile application"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"source-in-table-schema",children:"Source in Table Schema"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Every dimension table includes source field:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE TB_ANAG_PRD00 (\n    PRD_ID VARCHAR(36) PRIMARY KEY,\n    XPRD01 VARCHAR(255),              -- Product name\n    XPRD02 DECIMAL(10,2),             -- Price\n    PRD_SOURCE VARCHAR(50) NOT NULL,  -- \u2b50 Tenant identifier\n    PRD_CENTRO_DETT VARCHAR(50),      -- Organizational unit\n    PRD_PESO VARCHAR(1),              -- User level\n    PRD_AMBIENTE VARCHAR(20),         -- Environment\n    TREC VARCHAR(1),\n    CREATED_BY VARCHAR(255),\n    CREATED_AT VARCHAR(14),\n    UPDATED_BY VARCHAR(255),\n    UPDATED_AT VARCHAR(14)\n);\n\nCREATE INDEX idx_prd_source ON TB_ANAG_PRD00(PRD_SOURCE);\nCREATE INDEX idx_prd_tenant ON TB_ANAG_PRD00(PRD_SOURCE, PRD_CENTRO_DETT, PRD_AMBIENTE);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Naming Convention:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Field name: ",(0,t.jsx)(n.code,{children:"{DIM}_SOURCE"})]}),"\n",(0,t.jsxs)(n.li,{children:["Examples: ",(0,t.jsx)(n.code,{children:"PRD_SOURCE"}),", ",(0,t.jsx)(n.code,{children:"ORD_SOURCE"}),", ",(0,t.jsx)(n.code,{children:"CUST_SOURCE"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"source-in-session-context",children:"Source in Session Context"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Source travels with every request:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "user_id": "user@example.com",\n  "tenant_id": "tenant_123",\n  "source": "productManagement",\n  "centro_dett": "admin",\n  "peso": "1",\n  "ambiente": "production",\n  "grants": ["products.read", "products.write"]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Set during login:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'POST /auth/login\n{\n  "username": "user@example.com",\n  "password": "secure_password",\n  "source": "productManagement",     # \u2b50 Tenant identifier\n  "centro_dett": "admin"\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"automatic-tenant-filtering",children:"Automatic Tenant Filtering"}),"\n",(0,t.jsx)(n.h3,{id:"read-operations-get",children:"Read Operations (GET)"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Every query automatically filters by source:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- User request: GET /api/v4/core/PRD\n\n-- CoreQuery adds WHERE clause automatically\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'productManagement'  -- \u2b50 Automatic filtering\n  AND PRD_CENTRO_DETT = 'admin'\n  AND PRD_AMBIENTE = 'production'\n  AND TREC != 'C';\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"CoreQuery Implementation:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'// Modules.php\npublic function buildQuery(string $dimension, array $sessionContext): string {\n    $source = $sessionContext[\'source\'];\n    $centroDett = $sessionContext[\'centro_dett\'];\n    $ambiente = $sessionContext[\'ambiente\'];\n\n    $sql = "SELECT * FROM TB_ANAG_{$dimension}00 WHERE 1=1";\n\n    // \u2b50 Automatic tenant filtering\n    $sql .= " AND {$dimension}_SOURCE = :source";\n    $sql .= " AND {$dimension}_CENTRO_DETT = :centro_dett";\n    $sql .= " AND {$dimension}_AMBIENTE = :ambiente";\n    $sql .= " AND TREC != \'C\'";\n\n    return $sql;\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["User with ",(0,t.jsx)(n.code,{children:"source='tenantA'"})," sees only records with ",(0,t.jsx)(n.code,{children:"PRD_SOURCE='tenantA'"})]}),"\n",(0,t.jsxs)(n.li,{children:["User with ",(0,t.jsx)(n.code,{children:"source='tenantB'"})," sees only records with ",(0,t.jsx)(n.code,{children:"PRD_SOURCE='tenantB'"})]}),"\n",(0,t.jsx)(n.li,{children:"No possibility of cross-tenant access"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"write-operations-postputpatch",children:"Write Operations (POST/PUT/PATCH)"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Source automatically set on creation:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/PRD\nAuthorization: Bearer {token with source=\'productManagement\'}\n{\n  "data": {\n    "XPRD01": "Widget Pro",\n    "XPRD02": 99.99\n    // PRD_SOURCE not specified by client\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"CoreWrite adds source automatically:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// DataStore.php\npublic function insert(string $dimension, array $data): array {\n    $sessionContext = $this->getSessionContext();\n\n    // \u2b50 Inject tenant fields automatically\n    $data[\"{$dimension}_SOURCE\"] = $sessionContext['source'];\n    $data[\"{$dimension}_CENTRO_DETT\"] = $sessionContext['centro_dett'];\n    $data[\"{$dimension}_PESO\"] = $sessionContext['peso'];\n    $data[\"{$dimension}_AMBIENTE\"] = $sessionContext['ambiente'];\n\n    // Insert record\n    return $this->executeInsert($dimension, $data);\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "data": {\n    "PRD_ID": "uuid-...",\n    "XPRD01": "Widget Pro",\n    "XPRD02": 99.99,\n    "PRD_SOURCE": "productManagement",  // \u2b50 Automatically set\n    "PRD_CENTRO_DETT": "admin",\n    "PRD_PESO": "1",\n    "PRD_AMBIENTE": "production",\n    "TREC": "N"\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Updates also verify source:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- PUT /api/v4/core/PRD/123\nUPDATE TB_ANAG_PRD00\nSET XPRD02 = 89.99\nWHERE PRD_ID = '123'\n  AND PRD_SOURCE = 'productManagement'  -- \u2b50 Only update if same tenant\n  AND PRD_CENTRO_DETT = 'admin'\n  AND PRD_AMBIENTE = 'production';\n\n-- If source doesn't match \u2192 404 Not Found (not 403)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"cross-tenant-access-prevention",children:"Cross-Tenant Access Prevention"}),"\n",(0,t.jsx)(n.h3,{id:"attempt-to-access-other-tenants-data",children:"Attempt to Access Other Tenant's Data"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Scenario:"})," User from ",(0,t.jsx)(n.code,{children:"tenantA"})," tries to access ",(0,t.jsx)(n.code,{children:"tenantB"})," record"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# User session: source='tenantA'\nGET /api/v4/core/PRD/123\n\n# Record 123 belongs to tenantB (PRD_SOURCE='tenantB')\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Query Executed:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM TB_ANAG_PRD00\nWHERE PRD_ID = '123'\n  AND PRD_SOURCE = 'tenantA'  -- \u2b50 No match!\n  AND PRD_CENTRO_DETT = 'admin'\n  AND PRD_AMBIENTE = 'production'\n  AND TREC != 'C';\n\n-- Returns: 0 rows\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "error": "NotFoundError",\n  "message": "Product not found: 123",\n  "code": "RECORD_NOT_FOUND",\n  "status": 404\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"User receives 404 Not Found (not 403 Forbidden)"}),"\n",(0,t.jsx)(n.li,{children:"No indication that record exists in different tenant"}),"\n",(0,t.jsx)(n.li,{children:"Complete data isolation maintained"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"attempt-to-modify-source",children:"Attempt to Modify Source"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Scenario:"})," User tries to change source field"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/PRD\nAuthorization: Bearer {token with source=\'tenantA\'}\n{\n  "data": {\n    "XPRD01": "Widget",\n    "PRD_SOURCE": "tenantB"  // \u2b50 Trying to set different tenant\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"CoreWrite Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "error": "ValidationError",\n  "message": "Field not allowed: PRD_SOURCE",\n  "code": "FIELD_NOT_CREATEABLE",\n  "status": 400,\n  "field": "PRD_SOURCE"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Reason:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"PRD_SOURCE"})," has ",(0,t.jsx)(n.code,{children:"COD_ON_OFF"})," without 'N' or 'M' flags"]}),"\n",(0,t.jsx)(n.li,{children:"Field is read-only, automatically managed"}),"\n",(0,t.jsx)(n.li,{children:"User cannot override tenant isolation"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"multi-tenant-examples",children:"Multi-Tenant Examples"}),"\n",(0,t.jsx)(n.h3,{id:"example-1-e-commerce-platform",children:"Example 1: E-Commerce Platform"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Scenario:"})," Multiple stores on same platform"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Database\n\u251c\u2500\u2500 Store A (source='storeA')\n\u2502   \u251c\u2500\u2500 Products (100 items)\n\u2502   \u251c\u2500\u2500 Orders (500 orders)\n\u2502   \u2514\u2500\u2500 Customers (200 customers)\n\u251c\u2500\u2500 Store B (source='storeB')\n\u2502   \u251c\u2500\u2500 Products (80 items)\n\u2502   \u251c\u2500\u2500 Orders (300 orders)\n\u2502   \u2514\u2500\u2500 Customers (150 customers)\n\u2514\u2500\u2500 Store C (source='storeC')\n    \u251c\u2500\u2500 Products (120 items)\n    \u2514\u2500\u2500 Orders (400 orders)\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"User from Store A:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Login with source=\'storeA\'\nPOST /auth/login\n{\n  "username": "admin@storeA.com",\n  "password": "...",\n  "source": "storeA"\n}\n\n# Query products\nGET /api/v4/core/PRD\nAuthorization: Bearer {token}\n\n# Response: Only Store A\'s 100 products\n'})}),"\n",(0,t.jsx)(n.h3,{id:"example-2-saas-application",children:"Example 2: SaaS Application"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Scenario:"})," Multiple companies using same SaaS product"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Database\n\u251c\u2500\u2500 Company X (source='companyX')\n\u2502   \u251c\u2500\u2500 Projects (50 projects)\n\u2502   \u2514\u2500\u2500 Tasks (500 tasks)\n\u251c\u2500\u2500 Company Y (source='companyY')\n\u2502   \u251c\u2500\u2500 Projects (30 projects)\n\u2502   \u2514\u2500\u2500 Tasks (300 tasks)\n\u2514\u2500\u2500 Company Z (source='companyZ')\n    \u251c\u2500\u2500 Projects (70 projects)\n    \u2514\u2500\u2500 Tasks (800 tasks)\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Complete Isolation:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Company X users see only Company X data"}),"\n",(0,t.jsx)(n.li,{children:"No cross-company data leakage"}),"\n",(0,t.jsx)(n.li,{children:"Each company's data customizable independently"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"tenant-specific-customization",children:"Tenant-Specific Customization"}),"\n",(0,t.jsx)(n.h3,{id:"metadata-per-tenant",children:"Metadata Per Tenant"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Different field configurations per tenant:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Store A: Price required\nINSERT INTO TB_COST (COD_DIM, COD_VAR, REQUIRED, COD_ON_OFF, SOURCE)\nVALUES ('PRD', 'XPRD02', '1', 'LDRNM', 'storeA');\n\n-- Store B: Price optional\nINSERT INTO TB_COST (COD_DIM, COD_VAR, REQUIRED, COD_ON_OFF, SOURCE)\nVALUES ('PRD', 'XPRD02', '0', 'LDRNM', 'storeB');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Store A: Must provide price when creating products"}),"\n",(0,t.jsx)(n.li,{children:"Store B: Price is optional"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"tenant-specific-workflows",children:"Tenant-Specific Workflows"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Different validation rules per tenant:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Custom validation per tenant\npublic function validateProduct(array $data, string $source): void {\n    switch ($source) {\n        case 'storeA':\n            // Store A requires SKU\n            if (empty($data['XPRD03'])) {\n                throw new ValidationException('SKU required for Store A');\n            }\n            break;\n\n        case 'storeB':\n            // Store B requires barcode\n            if (empty($data['XPRD_BARCODE'])) {\n                throw new ValidationException('Barcode required for Store B');\n            }\n            break;\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"source-and-centro_dett",children:"Source and Centro_Dett"}),"\n",(0,t.jsx)(n.h3,{id:"hierarchical-isolation",children:"Hierarchical Isolation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"source"})," + ",(0,t.jsx)(n.code,{children:"centro_dett"})," provide two-level isolation:"]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Tenant (source='retailChain')\n\u251c\u2500\u2500 Headquarters (centro_dett='hq')\n\u2502   \u2514\u2500\u2500 Can see all stores\n\u251c\u2500\u2500 Store 001 (centro_dett='store_001')\n\u2502   \u2514\u2500\u2500 Can see only Store 001 data\n\u251c\u2500\u2500 Store 002 (centro_dett='store_002')\n\u2502   \u2514\u2500\u2500 Can see only Store 002 data\n\u2514\u2500\u2500 Warehouse (centro_dett='warehouse')\n    \u2514\u2500\u2500 Can see only warehouse data\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Query Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- HQ user (can see all)\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'retailChain'\n  AND PRD_CENTRO_DETT IN ('hq', 'store_001', 'store_002', 'warehouse')\n  AND PRD_AMBIENTE = 'production';\n\n-- Store 001 user (only their store)\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'retailChain'\n  AND PRD_CENTRO_DETT = 'store_001'  -- \u2b50 Limited scope\n  AND PRD_AMBIENTE = 'production';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Always set source during login:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - explicit tenant\nawait login(username, password, 'storeA', 'admin');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Trust automatic filtering:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - Core APIs handle filtering\nconst products = await getProducts();\n// Only current tenant's products returned\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use source for tenant-specific logic:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - tenant customization\nif (sessionContext.source === 'premiumStore') {\n  enablePremiumFeatures();\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Verify source in session context:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - validate context\nif (!sessionContext.source) {\n  throw new Error('Missing tenant identifier');\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't try to override source:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - will be rejected\nawait createProduct({\n  XPRD01: 'Widget',\n  PRD_SOURCE: 'otherTenant'  // Validation error!\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't query without authentication:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# \u274c Bad - no tenant context\nGET /api/v4/core/PRD\n# 401 Unauthorized\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't assume cross-tenant access:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - will return 404\nawait getProduct(otherTenantProductId);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't hardcode source in code:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - inflexible\nconst source = 'storeA';\n\n// \u2705 Good - from session\nconst source = sessionContext.source;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Multi-tenant architecture with single shared database"}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.code,{children:"source"})," field identifies tenant for every record"]}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Automatic filtering on all queries (read and write)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Complete data isolation (zero cross-tenant access)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Source set automatically from session context"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Cannot override or modify source field"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Tenant-specific metadata and customization"}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.code,{children:"source"})," + ",(0,t.jsx)(n.code,{children:"centro_dett"})," provide hierarchical isolation"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Every record belongs to exactly one tenant (via ",(0,t.jsx)(n.code,{children:"source"})," field)"]}),"\n",(0,t.jsx)(n.li,{children:"Session context defines tenant for all operations"}),"\n",(0,t.jsx)(n.li,{children:"Core APIs automatically filter by source on every query"}),"\n",(0,t.jsx)(n.li,{children:"Cross-tenant access impossible (404 Not Found)"}),"\n",(0,t.jsx)(n.li,{children:"Source cannot be overridden by client"}),"\n",(0,t.jsx)(n.li,{children:"Same database, complete logical isolation"}),"\n",(0,t.jsx)(n.li,{children:"Tenant-specific customization via metadata"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Tenant Isolation Flow:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Login with source='tenantA'\n    \u2193\nJWT token includes source='tenantA'\n    \u2193\nAPI request with token\n    \u2193\nCoreQuery/CoreWrite extract source\n    \u2193\nAutomatic WHERE clause: SOURCE='tenantA'\n    \u2193\nOnly tenantA's data visible/accessible\n"})}),"\n",(0,t.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/authentication",children:"Authentication"})," - JWT tokens with source"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/authorization",children:"Authorization"})," - TB_MENU grants"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/context-security",children:"Context Security"})," - centro_dett/peso/ambiente"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security",children:"Security Overview"})," - Multi-level security"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/map-framework",children:"MAP Framework"})," - Metadata tables"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},2172:(e,n,s)=>{s.d(n,{I:()=>a,M:()=>o});var t=s(1504);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);