"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[1896],{5604:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var a=i(7624),t=i(2172);const r={title:"Media Handling",sidebar_label:"Media Handling",sidebar_position:3,description:"Binary files, images, and document management"},s="Media Handling",o={id:"products/map.q01.io/core-api-platform-v4/advanced-topics/media-handling",title:"Media Handling",description:"Binary files, images, and document management",source:"@site/docs/products/map.q01.io/core-api-platform-v4/06-advanced-topics/media-handling.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/06-advanced-topics",slug:"/products/map.q01.io/core-api-platform-v4/advanced-topics/media-handling",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/media-handling",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Media Handling",sidebar_label:"Media Handling",sidebar_position:3,description:"Binary files, images, and document management"},sidebar:"mapSidebar",previous:{title:"Multi-Database",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/multi-database"},next:{title:"Outbox Subscribers",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/outbox-subscribers"}},l={},d=[{value:"Overview",id:"overview",level:2},{value:"Media Endpoints",id:"media-endpoints",level:2},{value:"Upload Media",id:"upload-media",level:3},{value:"Retrieve Media",id:"retrieve-media",level:3},{value:"Get Thumbnail",id:"get-thumbnail",level:3},{value:"CoreService Media Handler",id:"coreservice-media-handler",level:2},{value:"Binary Response Handler",id:"binary-response-handler",level:3},{value:"Media Storage",id:"media-storage",level:2},{value:"File Storage Options",id:"file-storage-options",level:3},{value:"Image Processing",id:"image-processing",level:2},{value:"Image Resize",id:"image-resize",level:3},{value:"Lazy Loading Support",id:"lazy-loading-support",level:3},{value:"MIME Type Validation",id:"mime-type-validation",level:2},{value:"Allowed MIME Types",id:"allowed-mime-types",level:3},{value:"Virus Scanning",id:"virus-scanning",level:2},{value:"ClamAV Integration",id:"clamav-integration",level:3},{value:"CDN Integration",id:"cdn-integration",level:2},{value:"CloudFront Configuration",id:"cloudfront-configuration",level:3},{value:"Client-Side Implementation",id:"client-side-implementation",level:2},{value:"JavaScript File Upload",id:"javascript-file-upload",level:3},{value:"React Image Component",id:"react-image-component",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.M)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"media-handling",children:"Media Handling"}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsxs)(n.p,{children:["Q01 Core APIs provide specialized endpoints for handling ",(0,a.jsx)(n.strong,{children:"binary files"})," (images, PDFs, documents) separately from regular CRUD operations. Media endpoints support file upload, retrieval, resizing, and CDN integration."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Supported Media Types:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Images (JPEG, PNG, GIF, WebP)"}),"\n",(0,a.jsx)(n.li,{children:"Documents (PDF, DOC, DOCX, XLS, XLSX)"}),"\n",(0,a.jsx)(n.li,{children:"Videos (MP4, MOV)"}),"\n",(0,a.jsx)(n.li,{children:"Archives (ZIP, RAR)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Features:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u2705 Multipart form data upload"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Image resizing and thumbnails"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 MIME type validation"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Virus scanning"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 CDN integration"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Lazy loading support"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Binary response with proper headers"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"media-endpoints",children:"Media Endpoints"}),"\n",(0,a.jsx)(n.h3,{id:"upload-media",children:"Upload Media"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"POST /api/v4/media/upload:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/media/upload\nAuthorization: Bearer {token}\nContent-Type: multipart/form-data\n\n--boundary\nContent-Disposition: form-data; name="dimension"\n\nPRD\n--boundary\nContent-Disposition: form-data; name="record_id"\n\n123\n--boundary\nContent-Disposition: form-data; name="field"\n\nXPRD_IMAGE\n--boundary\nContent-Disposition: form-data; name="file"; filename="product.jpg"\nContent-Type: image/jpeg\n\n[binary data]\n--boundary--\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Response:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "data": {\n    "file_id": "uuid-...",\n    "filename": "product.jpg",\n    "mime_type": "image/jpeg",\n    "size": 2048576,\n    "url": "/api/v4/media/PRD/123/XPRD_IMAGE",\n    "thumbnail_url": "/api/v4/media/PRD/123/XPRD_IMAGE?size=thumbnail"\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"retrieve-media",children:"Retrieve Media"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["GET ",(0,a.jsx)(n.code,{children:"/api/v4/media/{dimension}/{id}/{field}"}),":"]})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'GET /api/v4/media/PRD/123/XPRD_IMAGE\nAuthorization: Bearer {token}\n\n# Response: Binary data with headers\nContent-Type: image/jpeg\nContent-Length: 2048576\nCache-Control: public, max-age=31536000\nETag: "abc123"\nLast-Modified: Thu, 19 Dec 2025 16:00:00 GMT\n'})}),"\n",(0,a.jsx)(n.h3,{id:"get-thumbnail",children:"Get Thumbnail"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["GET ",(0,a.jsx)(n.code,{children:"/api/v4/media/{dimension}/{id}/{field}?size=thumbnail"}),":"]})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/media/PRD/123/XPRD_IMAGE?size=thumbnail\nAuthorization: Bearer {token}\n\n# Response: Resized image (200x200)\nContent-Type: image/jpeg\nContent-Length: 15360\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Size Options:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"thumbnail"})," - 200x200"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"small"})," - 400x400"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"medium"})," - 800x800"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"large"})," - 1600x1600"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"original"})," - No resizing"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"coreservice-media-handler",children:"CoreService Media Handler"}),"\n",(0,a.jsx)(n.h3,{id:"binary-response-handler",children:"Binary Response Handler"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"routingController.go:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:'// routingGetImage handles binary media responses\nfunc routingGetImage(c buffalo.Context) error {\n    dimension := c.Param("dim")\n    recordID := c.Param("dim_id")\n    field := c.Param("field")\n    size := c.Request().URL.Query().Get("size")\n\n    // Forward to CoreQuery\n    apiURL := fmt.Sprintf(\n        "http://%s:%s/api/%s/media/%s/%s/%s?size=%s",\n        os.Getenv("R_API_HOST"),\n        os.Getenv("R_API_PORT"),\n        os.Getenv("R_API_VERSION"),\n        dimension,\n        recordID,\n        field,\n        size\n    )\n\n    resp, err := http.Get(apiURL)\n    if err != nil {\n        return c.Error(500, err)\n    }\n    defer resp.Body.Close()\n\n    // Copy headers\n    c.Response().Header().Set("Content-Type", resp.Header.Get("Content-Type"))\n    c.Response().Header().Set("Content-Length", resp.Header.Get("Content-Length"))\n    c.Response().Header().Set("Cache-Control", "public, max-age=31536000")\n    c.Response().Header().Set("ETag", resp.Header.Get("ETag"))\n\n    // Stream binary data\n    c.Response().WriteHeader(resp.StatusCode)\n    io.Copy(c.Response(), resp.Body)\n\n    return nil\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"media-storage",children:"Media Storage"}),"\n",(0,a.jsx)(n.h3,{id:"file-storage-options",children:"File Storage Options"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"1. Local Filesystem:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// MediaStorage/LocalStorage.php\nclass LocalStorage implements MediaStorageInterface {\n    private $basePath;\n\n    public function __construct(string $basePath) {\n        $this->basePath = $basePath;\n    }\n\n    public function store(string $path, $content): void {\n        $fullPath = $this->basePath . '/' . $path;\n        $dir = dirname($fullPath);\n\n        if (!is_dir($dir)) {\n            mkdir($dir, 0755, true);\n        }\n\n        file_put_contents($fullPath, $content);\n    }\n\n    public function retrieve(string $path): ?string {\n        $fullPath = $this->basePath . '/' . $path;\n\n        if (!file_exists($fullPath)) {\n            return null;\n        }\n\n        return file_get_contents($fullPath);\n    }\n\n    public function delete(string $path): void {\n        $fullPath = $this->basePath . '/' . $path;\n\n        if (file_exists($fullPath)) {\n            unlink($fullPath);\n        }\n    }\n}\n\n// Usage\n$storage = new LocalStorage('/var/www/media');\n$storage->store('PRD/123/XPRD_IMAGE.jpg', $fileContent);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"2. AWS S3:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// MediaStorage/S3Storage.php\nuse Aws\\S3\\S3Client;\n\nclass S3Storage implements MediaStorageInterface {\n    private $s3;\n    private $bucket;\n\n    public function __construct(S3Client $s3, string $bucket) {\n        $this->s3 = $s3;\n        $this->bucket = $bucket;\n    }\n\n    public function store(string $path, $content): void {\n        $this->s3->putObject([\n            'Bucket' => $this->bucket,\n            'Key' => $path,\n            'Body' => $content,\n            'ACL' => 'public-read',\n            'ContentType' => $this->getMimeType($path)\n        ]);\n    }\n\n    public function retrieve(string $path): ?string {\n        try {\n            $result = $this->s3->getObject([\n                'Bucket' => $this->bucket,\n                'Key' => $path\n            ]);\n\n            return $result['Body']->getContents();\n        } catch (\\Exception $e) {\n            return null;\n        }\n    }\n\n    public function getPublicURL(string $path): string {\n        return sprintf(\n            'https://%s.s3.amazonaws.com/%s',\n            $this->bucket,\n            $path\n        );\n    }\n}\n\n// Configuration\n$s3 = new S3Client([\n    'version' => 'latest',\n    'region' => 'us-east-1',\n    'credentials' => [\n        'key' => env('AWS_ACCESS_KEY_ID'),\n        'secret' => env('AWS_SECRET_ACCESS_KEY')\n    ]\n]);\n\n$storage = new S3Storage($s3, 'q01-media-bucket');\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"3. Azure Blob Storage:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// MediaStorage/AzureStorage.php\nuse MicrosoftAzure\\Storage\\Blob\\BlobRestProxy;\n\nclass AzureStorage implements MediaStorageInterface {\n    private $blobClient;\n    private $container;\n\n    public function __construct(BlobRestProxy $blobClient, string $container) {\n        $this->blobClient = $blobClient;\n        $this->container = $container;\n    }\n\n    public function store(string $path, $content): void {\n        $this->blobClient->createBlockBlob(\n            $this->container,\n            $path,\n            $content\n        );\n    }\n\n    public function retrieve(string $path): ?string {\n        try {\n            $blob = $this->blobClient->getBlob($this->container, $path);\n            return stream_get_contents($blob->getContentStream());\n        } catch (\\Exception $e) {\n            return null;\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"image-processing",children:"Image Processing"}),"\n",(0,a.jsx)(n.h3,{id:"image-resize",children:"Image Resize"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Intervention/Image library:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use Intervention\\Image\\ImageManager;\n\nclass ImageProcessor {\n    private $manager;\n\n    public function __construct() {\n        $this->manager = new ImageManager(['driver' => 'gd']);\n    }\n\n    public function resize(string $imagePath, int $width, int $height): string {\n        $image = $this->manager->make($imagePath);\n\n        // Resize maintaining aspect ratio\n        $image->resize($width, $height, function ($constraint) {\n            $constraint->aspectRatio();\n            $constraint->upsize();\n        });\n\n        // Save to temporary file\n        $tempPath = tempnam(sys_get_temp_dir(), 'img_');\n        $image->save($tempPath, 80); // 80% quality\n\n        return $tempPath;\n    }\n\n    public function thumbnail(string $imagePath, int $size = 200): string {\n        $image = $this->manager->make($imagePath);\n\n        // Crop to square\n        $image->fit($size, $size);\n\n        $tempPath = tempnam(sys_get_temp_dir(), 'thumb_');\n        $image->save($tempPath, 80);\n\n        return $tempPath;\n    }\n\n    public function optimize(string $imagePath): void {\n        $image = $this->manager->make($imagePath);\n\n        // Convert to WebP for better compression\n        $image->encode('webp', 85);\n        $image->save($imagePath);\n    }\n}\n\n// Usage\n$processor = new ImageProcessor();\n$thumbnailPath = $processor->thumbnail('/path/to/image.jpg', 200);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"lazy-loading-support",children:"Lazy Loading Support"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Generate multiple sizes on upload:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"public function handleUpload(UploadedFile $file, string $dimension, string $recordID, string $field): array {\n    $originalPath = \"{$dimension}/{$recordID}/{$field}_original.jpg\";\n    $this->storage->store($originalPath, file_get_contents($file->getPathname()));\n\n    // Generate thumbnails\n    $sizes = [\n        'thumbnail' => 200,\n        'small' => 400,\n        'medium' => 800,\n        'large' => 1600\n    ];\n\n    $urls = [];\n\n    foreach ($sizes as $sizeName => $sizePixels) {\n        $resizedPath = $this->processor->resize($file->getPathname(), $sizePixels, $sizePixels);\n        $storagePath = \"{$dimension}/{$recordID}/{$field}_{$sizeName}.jpg\";\n\n        $this->storage->store($storagePath, file_get_contents($resizedPath));\n\n        $urls[$sizeName] = \"/api/v4/media/{$dimension}/{$recordID}/{$field}?size={$sizeName}\";\n\n        unlink($resizedPath);\n    }\n\n    return [\n        'original' => \"/api/v4/media/{$dimension}/{$recordID}/{$field}\",\n        'sizes' => $urls\n    ];\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"mime-type-validation",children:"MIME Type Validation"}),"\n",(0,a.jsx)(n.h3,{id:"allowed-mime-types",children:"Allowed MIME Types"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"class MimeTypeValidator {\n    private $allowedTypes = [\n        // Images\n        'image/jpeg',\n        'image/png',\n        'image/gif',\n        'image/webp',\n        'image/svg+xml',\n\n        // Documents\n        'application/pdf',\n        'application/msword',\n        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n        'application/vnd.ms-excel',\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n\n        // Videos\n        'video/mp4',\n        'video/quicktime',\n\n        // Archives\n        'application/zip',\n        'application/x-rar-compressed'\n    ];\n\n    public function validate(UploadedFile $file): bool {\n        $mimeType = $file->getMimeType();\n\n        if (!in_array($mimeType, $this->allowedTypes)) {\n            throw new ValidationException(\n                \"MIME type not allowed: {$mimeType}\"\n            );\n        }\n\n        // Verify actual file content matches MIME type\n        $finfo = finfo_open(FILEINFO_MIME_TYPE);\n        $detectedMime = finfo_file($finfo, $file->getPathname());\n        finfo_close($finfo);\n\n        if ($detectedMime !== $mimeType) {\n            throw new ValidationException(\n                \"MIME type mismatch: declared={$mimeType}, detected={$detectedMime}\"\n            );\n        }\n\n        return true;\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"virus-scanning",children:"Virus Scanning"}),"\n",(0,a.jsx)(n.h3,{id:"clamav-integration",children:"ClamAV Integration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"use Xenolope\\Quahog\\Client as ClamAVClient;\n\nclass VirusScanner {\n    private $clamav;\n\n    public function __construct(string $socket = '/var/run/clamav/clamd.ctl') {\n        $this->clamav = new ClamAVClient($socket);\n    }\n\n    public function scan(string $filePath): bool {\n        $result = $this->clamav->scanFile($filePath);\n\n        if ($result['status'] === 'FOUND') {\n            throw new SecurityException(\n                \"Virus detected: {$result['reason']}\"\n            );\n        }\n\n        return true;\n    }\n}\n\n// Usage in upload handler\npublic function handleUpload(UploadedFile $file): void {\n    // Validate MIME type\n    $this->mimeValidator->validate($file);\n\n    // Scan for viruses\n    $this->virusScanner->scan($file->getPathname());\n\n    // Store file\n    $this->storage->store($path, file_get_contents($file->getPathname()));\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"cdn-integration",children:"CDN Integration"}),"\n",(0,a.jsx)(n.h3,{id:"cloudfront-configuration",children:"CloudFront Configuration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"class CDNManager {\n    private $cdnURL;\n\n    public function __construct(string $cdnURL) {\n        $this->cdnURL = $cdnURL;\n    }\n\n    public function getMediaURL(string $dimension, string $recordID, string $field, string $size = 'original'): string {\n        return sprintf(\n            '%s/media/%s/%s/%s?size=%s',\n            $this->cdnURL,\n            $dimension,\n            $recordID,\n            $field,\n            $size\n        );\n    }\n\n    public function invalidateCache(string $path): void {\n        // Invalidate CloudFront cache\n        $cloudFront = new CloudFrontClient([\n            'version' => 'latest',\n            'region' => 'us-east-1'\n        ]);\n\n        $cloudFront->createInvalidation([\n            'DistributionId' => env('CLOUDFRONT_DISTRIBUTION_ID'),\n            'InvalidationBatch' => [\n                'Paths' => [\n                    'Quantity' => 1,\n                    'Items' => [$path]\n                ],\n                'CallerReference' => uniqid()\n            ]\n        ]);\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"client-side-implementation",children:"Client-Side Implementation"}),"\n",(0,a.jsx)(n.h3,{id:"javascript-file-upload",children:"JavaScript File Upload"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"class MediaUploader {\n  constructor(apiBase, token) {\n    this.apiBase = apiBase;\n    this.token = token;\n  }\n\n  async uploadImage(dimension, recordID, field, file, onProgress) {\n    const formData = new FormData();\n    formData.append('dimension', dimension);\n    formData.append('record_id', recordID);\n    formData.append('field', field);\n    formData.append('file', file);\n\n    const response = await fetch(`${this.apiBase}/api/v4/media/upload`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${this.token}`\n      },\n      body: formData\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(error.message);\n    }\n\n    return response.json();\n  }\n\n  getMediaURL(dimension, recordID, field, size = 'original') {\n    return `${this.apiBase}/api/v4/media/${dimension}/${recordID}/${field}?size=${size}`;\n  }\n}\n\n// Usage\nconst uploader = new MediaUploader('https://api.example.com', token);\n\nasync function handleFileUpload(event) {\n  const file = event.target.files[0];\n\n  try {\n    const result = await uploader.uploadImage('PRD', '123', 'XPRD_IMAGE', file);\n\n    console.log('Upload successful:', result.data.url);\n\n    // Display image\n    document.getElementById('product-image').src = result.data.url;\n  } catch (error) {\n    console.error('Upload failed:', error.message);\n  }\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"react-image-component",children:"React Image Component"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"function ProductImage({ dimension, recordID, field, size = 'medium', alt }) {\n  const [src, setSrc] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const url = `${apiBase}/api/v4/media/${dimension}/${recordID}/${field}?size=${size}`;\n\n    fetch(url, {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    })\n      .then(response => {\n        if (!response.ok) throw new Error('Failed to load image');\n        return response.blob();\n      })\n      .then(blob => {\n        const objectURL = URL.createObjectURL(blob);\n        setSrc(objectURL);\n        setLoading(false);\n      })\n      .catch(err => {\n        setError(err.message);\n        setLoading(false);\n      });\n  }, [dimension, recordID, field, size]);\n\n  if (loading) return <div>Loading...</div>;\n  if (error) return <div>Error: {error}</div>;\n\n  return <img src={src} alt={alt} />;\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Validate MIME types:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// \u2705 Good - prevent malicious uploads\n$this->mimeValidator->validate($file);\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Scan for viruses:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// \u2705 Good - security\n$this->virusScanner->scan($file->getPathname());\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Generate multiple sizes:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// \u2705 Good - responsive images\nforeach (['thumbnail', 'small', 'medium', 'large'] as $size) {\n    $this->generateSize($file, $size);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Use CDN for media:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - performance\nconst url = cdn.getMediaURL(dimension, id, field);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Don't store media in database:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// \u274c Bad - bloats database\nUPDATE TB_ANAG_PRD00 SET XPRD_IMAGE = ?  // Binary data!\n\n// \u2705 Good - store file path\nUPDATE TB_ANAG_PRD00 SET XPRD_IMAGE_PATH = ?\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Don't skip virus scanning:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// \u274c Bad - security risk\n$this->storage->store($path, $file);\n\n// \u2705 Good - scan first\n$this->virusScanner->scan($file);\n$this->storage->store($path, $file);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u2705 Specialized media endpoints for binary files"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Image resizing and thumbnail generation"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 MIME type validation and virus scanning"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Multiple storage options (local, S3, Azure)"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 CDN integration for performance"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Lazy loading with multiple sizes"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Binary response with proper headers"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Use dedicated media endpoints (not CRUD)"}),"\n",(0,a.jsx)(n.li,{children:"Validate MIME types and scan for viruses"}),"\n",(0,a.jsx)(n.li,{children:"Generate multiple sizes for responsive images"}),"\n",(0,a.jsx)(n.li,{children:"Store files externally (S3, Azure, CDN)"}),"\n",(0,a.jsx)(n.li,{children:"Use CDN for performance"}),"\n",(0,a.jsx)(n.li,{children:"Support lazy loading with srcset"}),"\n",(0,a.jsx)(n.li,{children:"Set proper cache headers"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics",children:"Advanced Topics"})," - Overview"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/performance-optimization",children:"Performance Optimization"})," - CDN and caching"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/internal-architecture",children:"Internal Architecture"})," - Binary response handling"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.M)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},2172:(e,n,i)=>{i.d(n,{I:()=>o,M:()=>s});var a=i(1504);const t={},r=a.createContext(t);function s(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);