"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[2984],{9380:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var i=t(7624),a=t(2172);const r={title:"Anti-Patterns",sidebar_label:"Anti-Patterns",sidebar_position:3,description:"Common mistakes and what NOT to do"},s="Anti-Patterns",c={id:"products/map.q01.io/core-api-platform-v4/best-practices/anti-patterns",title:"Anti-Patterns",description:"Common mistakes and what NOT to do",source:"@site/docs/products/map.q01.io/core-api-platform-v4/07-best-practices/anti-patterns.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/07-best-practices",slug:"/products/map.q01.io/core-api-platform-v4/best-practices/anti-patterns",permalink:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/anti-patterns",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Anti-Patterns",sidebar_label:"Anti-Patterns",sidebar_position:3,description:"Common mistakes and what NOT to do"},sidebar:"mapSidebar",previous:{title:"Use Cases",permalink:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/use-cases"},next:{title:"Performance Tips",permalink:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/performance-tips"}},o={},l=[{value:"Overview",id:"overview",level:2},{value:"Metadata Anti-Patterns",id:"metadata-anti-patterns",level:2},{value:"\u274c Anti-Pattern 1: Hardcoding Field Names",id:"-anti-pattern-1-hardcoding-field-names",level:3},{value:"\u274c Anti-Pattern 2: Bypassing Metadata Validation",id:"-anti-pattern-2-bypassing-metadata-validation",level:3},{value:"\u274c Anti-Pattern 3: Ignoring COD_ON_OFF Flags",id:"-anti-pattern-3-ignoring-cod_on_off-flags",level:3},{value:"Security Anti-Patterns",id:"security-anti-patterns",level:2},{value:"\u274c Anti-Pattern 4: Missing Context Chain",id:"-anti-pattern-4-missing-context-chain",level:3},{value:"\u274c Anti-Pattern 5: Storing Tokens Insecurely",id:"-anti-pattern-5-storing-tokens-insecurely",level:3},{value:"\u274c Anti-Pattern 6: No Grant Checking",id:"-anti-pattern-6-no-grant-checking",level:3},{value:"Performance Anti-Patterns",id:"performance-anti-patterns",level:2},{value:"\u274c Anti-Pattern 7: N+1 Query Problem",id:"-anti-pattern-7-n1-query-problem",level:3},{value:"\u274c Anti-Pattern 8: Not Using Pagination",id:"-anti-pattern-8-not-using-pagination",level:3},{value:"\u274c Anti-Pattern 9: No Caching",id:"-anti-pattern-9-no-caching",level:3},{value:"Architecture Anti-Patterns",id:"architecture-anti-patterns",level:2},{value:"\u274c Anti-Pattern 10: Business Logic in Frontend",id:"-anti-pattern-10-business-logic-in-frontend",level:3},{value:"\u274c Anti-Pattern 11: Direct TREC Manipulation",id:"-anti-pattern-11-direct-trec-manipulation",level:3},{value:"\u274c Anti-Pattern 12: Skipping OUTBOX Pattern",id:"-anti-pattern-12-skipping-outbox-pattern",level:3},{value:"Data Management Anti-Patterns",id:"data-management-anti-patterns",level:2},{value:"\u274c Anti-Pattern 13: Mixing center_dett Values",id:"-anti-pattern-13-mixing-center_dett-values",level:3},{value:"\u274c Anti-Pattern 14: Not Validating Input",id:"-anti-pattern-14-not-validating-input",level:3},{value:"Summary",id:"summary",level:2},{value:"Critical Anti-Patterns to Avoid",id:"critical-anti-patterns-to-avoid",level:3},{value:"Quick Reference",id:"quick-reference",level:3},{value:"Related Concepts",id:"related-concepts",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.M)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"anti-patterns",children:"Anti-Patterns"}),"\n",(0,i.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(e.p,{children:["This guide identifies ",(0,i.jsx)(e.strong,{children:"common mistakes"})," when working with Q01 Core APIs and provides corrected implementations. Learning what NOT to do is as important as learning best practices."]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Categories:"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"Metadata Anti-Patterns"}),"\n",(0,i.jsx)(e.li,{children:"Security Anti-Patterns"}),"\n",(0,i.jsx)(e.li,{children:"Performance Anti-Patterns"}),"\n",(0,i.jsx)(e.li,{children:"Architecture Anti-Patterns"}),"\n",(0,i.jsx)(e.li,{children:"Data Management Anti-Patterns"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"metadata-anti-patterns",children:"Metadata Anti-Patterns"}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-1-hardcoding-field-names",children:"\u274c Anti-Pattern 1: Hardcoding Field Names"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Hardcoded field names break when metadata changes."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - Hardcoded field names\nasync function getProducts() {\n  const products = await api.get('/api/v4/core/products');\n\n  return products.data.map(p => ({\n    id: p.PRD_ID,\n    name: p.XPRD01,        // Hardcoded\n    price: p.XPRD02,       // Hardcoded\n    code: p.XPRD03,        // Hardcoded\n    category: p.XPRD05     // Hardcoded\n  }));\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Why it's bad:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Breaks when field names change in TB_VAR"}),"\n",(0,i.jsx)(e.li,{children:"No field visibility checking (COD_ON_OFF)"}),"\n",(0,i.jsx)(e.li,{children:"Tight coupling to specific dimension"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Metadata-driven field access:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"async function getProducts() {\n  // 1. Fetch field metadata\n  const fields = await api.get('/api/v4/core/products/fields');\n\n  // 2. Filter visible fields (COD_ON_OFF L flag)\n  const visibleFields = fields.data\n    .filter(f => f.COD_ON_OFF.includes('L'))\n    .map(f => f.VAR);\n\n  // 3. Fetch products with only visible fields\n  const products = await api.get('/api/v4/core/products', {\n    params: {fields: visibleFields.join(',')}\n  });\n\n  // 4. Dynamic mapping\n  return products.data.map(p => {\n    const mapped = {};\n    for (const field of visibleFields) {\n      mapped[field] = p[field];\n    }\n    return mapped;\n  });\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-2-bypassing-metadata-validation",children:"\u274c Anti-Pattern 2: Bypassing Metadata Validation"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Skipping TB_VAR validation leads to data inconsistencies."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - No validation\nasync function createProduct(data) {\n  return api.post('/api/v4/core/products', data);\n}\n\n// Usage\nawait createProduct({\n  XPRD01: null,           // Should be required!\n  XPRD02: 'invalid',      // Should be numeric!\n  XPRD99: 'unknown'       // Field doesn't exist!\n});\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Validate against TB_VAR:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"async function createProduct(data) {\n  // 1. Fetch field metadata\n  const fields = await api.get('/api/v4/core/products/fields');\n\n  // 2. Validate required fields\n  for (const field of fields.data) {\n    if (field.REQUIRED === 'Y' && !data[field.VAR]) {\n      throw new Error(`Required field missing: ${field.VAR}`);\n    }\n  }\n\n  // 3. Validate field types\n  for (const [key, value] of Object.entries(data)) {\n    const fieldMeta = fields.data.find(f => f.VAR === key);\n\n    if (!fieldMeta) {\n      throw new Error(`Unknown field: ${key}`);\n    }\n\n    if (fieldMeta.TYPE === 'numeric' && typeof value !== 'number') {\n      throw new Error(`Invalid type for ${key}: expected number`);\n    }\n  }\n\n  // 4. Create product\n  return api.post('/api/v4/core/products', data);\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-3-ignoring-cod_on_off-flags",children:"\u274c Anti-Pattern 3: Ignoring COD_ON_OFF Flags"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Showing fields that should be hidden."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - Ignoring field visibility\nasync function renderProductForm() {\n  const fields = await api.get('/api/v4/core/products/fields');\n\n  // Shows ALL fields, including hidden ones!\n  return fields.data.map(field => (\n    <input name={field.VAR} label={field.LABEL} />\n  ));\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Respect COD_ON_OFF:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"async function renderProductForm() {\n  const fields = await api.get('/api/v4/core/products/fields');\n\n  // Filter by COD_ON_OFF N flag (visible in new form)\n  const newFormFields = fields.data.filter(field =>\n    field.COD_ON_OFF.includes('N')\n  );\n\n  return newFormFields.map(field => (\n    <input\n      name={field.VAR}\n      label={field.LABEL}\n      required={field.REQUIRED === 'Y'}\n      type={getInputType(field.TYPE)}\n    />\n  ));\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"security-anti-patterns",children:"Security Anti-Patterns"}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-4-missing-context-chain",children:"\u274c Anti-Pattern 4: Missing Context Chain"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Requests without context bypass security filters."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - No context\nasync function getProducts() {\n  return api.get('/api/v4/core/products');\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Why it's bad:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"No tenant isolation (source)"}),"\n",(0,i.jsx)(e.li,{children:"No permission filtering (peso)"}),"\n",(0,i.jsx)(e.li,{children:"No environment filtering (ambiente)"}),"\n",(0,i.jsx)(e.li,{children:"No organizational filtering (centro_dett)"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Always include context:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"class CoreAPIClient {\n  constructor(config) {\n    this.baseURL = config.baseURL;\n    this.context = config.context;\n\n    // Add interceptor to include context headers\n    this.axios = axios.create({baseURL: this.baseURL});\n\n    this.axios.interceptors.request.use(config => {\n      config.headers['X-Source'] = this.context.source;\n      config.headers['X-Peso'] = this.context.peso;\n      config.headers['X-Ambiente'] = this.context.ambiente;\n      config.headers['X-Centro-Dett'] = this.context.centro_dett;\n      config.headers['X-Modulo'] = this.context.modulo;\n      config.headers['X-Lingua'] = this.context.lingua;\n      return config;\n    });\n  }\n\n  async get(url, options) {\n    return this.axios.get(url, options);\n  }\n}\n\n// Usage\nconst client = new CoreAPIClient({\n  baseURL: 'https://api.q01.io',\n  context: {\n    source: 'tenant_123',\n    peso: 3,\n    ambiente: 'P',\n    centro_dett: 'HQ',\n    modulo: 'sales',\n    lingua: 'IT'\n  }\n});\n"})}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-5-storing-tokens-insecurely",children:"\u274c Anti-Pattern 5: Storing Tokens Insecurely"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Tokens exposed in localStorage or code."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - Insecure storage\nlocalStorage.setItem('token', accessToken);  // XSS vulnerable!\n\n// \u274c BAD - Hardcoded token\nconst TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Secure token storage:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u2705 GOOD - httpOnly cookie (server-side)\nres.cookie('accessToken', token, {\n  httpOnly: true,        // Not accessible via JavaScript\n  secure: true,          // HTTPS only\n  sameSite: 'strict',    // CSRF protection\n  maxAge: 900000         // 15 minutes\n});\n\n// \u2705 GOOD - Environment variable for server-side\nconst TOKEN = process.env.CORE_API_TOKEN;\n\n// \u2705 GOOD - sessionStorage for short-lived tokens (if cookies not possible)\nsessionStorage.setItem('token', accessToken);  // Better than localStorage\n"})}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-6-no-grant-checking",children:"\u274c Anti-Pattern 6: No Grant Checking"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Performing operations without checking permissions."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - No grant check\nasync function deleteProduct(id) {\n  return api.delete(`/api/v4/core/products/${id}`);\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Check grants first:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"async function deleteProduct(id) {\n  // 1. Check if user has delete grant\n  const grants = await api.get('/api/v4/core/menu');\n  const hasDeleteGrant = grants.data.some(g =>\n    g.MENU_CODE === 'PRD' && g.GRANTS.includes('D')\n  );\n\n  if (!hasDeleteGrant) {\n    throw new Error('Permission denied: DELETE grant required');\n  }\n\n  // 2. Perform delete\n  return api.delete(`/api/v4/core/products/${id}`);\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"performance-anti-patterns",children:"Performance Anti-Patterns"}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-7-n1-query-problem",children:"\u274c Anti-Pattern 7: N+1 Query Problem"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Making separate requests for related data."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - N+1 queries\nasync function getProductsWithCategories() {\n  // 1 query\n  const products = await api.get('/api/v4/core/products?limit=100');\n\n  // 100 queries!\n  for (const product of products.data) {\n    product.category = await api.get(`/api/v4/core/categories/${product.XPRD05}`);\n  }\n\n  return products;\n}\n// Total: 101 queries!\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Use expansion or batch requests:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u2705 GOOD - Use expand parameter\nasync function getProductsWithCategories() {\n  // Single query with expansion\n  const products = await api.get('/api/v4/core/products', {\n    params: {\n      limit: 100,\n      expand: 'XPRD05'  // Expand category field\n    }\n  });\n\n  return products;\n}\n\n// \u2705 ALTERNATIVE - Batch request\nasync function getProductsWithCategories() {\n  // 1st query\n  const products = await api.get('/api/v4/core/products?limit=100');\n\n  // 2nd query (single request for all categories)\n  const categoryIds = [...new Set(products.data.map(p => p.XPRD05))];\n  const categories = await api.get('/api/v4/core/categories', {\n    params: {filters: `CAT_ID:in:${categoryIds.join(',')}`}\n  });\n\n  // Map in memory\n  const categoryMap = Object.fromEntries(\n    categories.data.map(c => [c.CAT_ID, c])\n  );\n\n  products.data.forEach(p => {\n    p.category = categoryMap[p.XPRD05];\n  });\n\n  return products;\n}\n// Total: 2 queries!\n"})}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-8-not-using-pagination",children:"\u274c Anti-Pattern 8: Not Using Pagination"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Fetching all records at once causes memory issues."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - No pagination\nasync function getAllProducts() {\n  return api.get('/api/v4/core/products?limit=999999');  // Disaster!\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Always paginate:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u2705 GOOD - Paginated fetching\nasync function* fetchAllProducts(batchSize = 100) {\n  let offset = 0;\n  let hasMore = true;\n\n  while (hasMore) {\n    const response = await api.get('/api/v4/core/products', {\n      params: {limit: batchSize, offset: offset}\n    });\n\n    yield response.data;\n\n    hasMore = response.data.length === batchSize;\n    offset += batchSize;\n  }\n}\n\n// Usage\nfor await (const batch of fetchAllProducts(100)) {\n  processBatch(batch);\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-9-no-caching",children:"\u274c Anti-Pattern 9: No Caching"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Fetching same data repeatedly."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - No caching\nasync function getProduct(id) {\n  return api.get(`/api/v4/core/products/${id}`);\n}\n\n// Called 100 times = 100 API requests!\nfor (let i = 0; i < 100; i++) {\n  await getProduct(123);\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Implement caching:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"class CachedAPIClient {\n  constructor(api, ttl = 300000) {\n    this.api = api;\n    this.cache = new Map();\n    this.ttl = ttl;\n  }\n\n  async get(url) {\n    const cached = this.cache.get(url);\n\n    if (cached && Date.now() - cached.timestamp < this.ttl) {\n      return cached.data;\n    }\n\n    const data = await this.api.get(url);\n\n    this.cache.set(url, {\n      data: data,\n      timestamp: Date.now()\n    });\n\n    return data;\n  }\n\n  invalidate(url) {\n    this.cache.delete(url);\n  }\n}\n\n// Usage\nconst cachedAPI = new CachedAPIClient(api);\n\n// Called 100 times = 1 API request + 99 cache hits!\nfor (let i = 0; i < 100; i++) {\n  await cachedAPI.get('/api/v4/core/products/123');\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"architecture-anti-patterns",children:"Architecture Anti-Patterns"}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-10-business-logic-in-frontend",children:"\u274c Anti-Pattern 10: Business Logic in Frontend"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Duplicating business logic across clients."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - Business logic in frontend\nfunction calculateOrderTotal(items) {\n  let total = 0;\n  for (const item of items) {\n    let price = item.price;\n\n    // Discount logic (duplicated in every client!)\n    if (item.quantity >= 10) {\n      price *= 0.9;  // 10% discount\n    }\n    if (item.category === 'PROMO') {\n      price *= 0.8;  // 20% discount\n    }\n\n    total += price * item.quantity;\n  }\n\n  return total;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Why it's bad:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Logic duplicated across web, mobile, backend"}),"\n",(0,i.jsx)(e.li,{children:"Inconsistent behavior when logic changes"}),"\n",(0,i.jsx)(e.li,{children:"Hard to maintain"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Business logic in backend:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u2705 GOOD - Business logic on server\n// Frontend just calls API\nasync function calculateOrderTotal(items) {\n  const response = await api.post('/api/v4/core/orders/calculate', {\n    items: items\n  });\n\n  return response.total;\n}\n\n// Backend implements consistent logic\n// POST /api/v4/core/orders/calculate\nasync function calculateTotal(req, res) {\n  const {items} = req.body;\n  let total = 0;\n\n  for (const item of items) {\n    const product = await getProduct(item.productId);\n    let price = product.price;\n\n    // Centralized discount logic\n    price = applyDiscounts(price, item.quantity, product.category);\n\n    total += price * item.quantity;\n  }\n\n  res.json({total});\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-11-direct-trec-manipulation",children:"\u274c Anti-Pattern 11: Direct TREC Manipulation"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Manually setting TREC instead of using lifecycle operations."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - Direct TREC manipulation\nawait api.patch(`/api/v4/core/products/${id}`, {\n  TREC: 'C'  // Manually setting to cancelled\n});\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Why it's bad:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Bypasses lifecycle validation"}),"\n",(0,i.jsx)(e.li,{children:"No OUTBOX event generated"}),"\n",(0,i.jsx)(e.li,{children:"Cascade operations not triggered"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Use proper lifecycle operations:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u2705 GOOD - Use DELETE for cancellation\nawait api.delete(`/api/v4/core/products/${id}`);\n\n// This properly:\n// 1. Changes TREC from N to C\n// 2. Sets DELETED_BY and DELETED_AT\n// 3. Generates OUTBOX event (ProductDeleted)\n// 4. Triggers cascade operations (if configured)\n"})}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-12-skipping-outbox-pattern",children:"\u274c Anti-Pattern 12: Skipping OUTBOX Pattern"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Not leveraging event sourcing for consistency."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - Manual synchronization\nasync function createProduct(data) {\n  // 1. Create in Core API\n  const product = await coreAPI.post('/api/v4/core/products', data);\n\n  // 2. Manual sync to search (can fail!)\n  await elasticsearch.index({\n    index: 'products',\n    id: product.PRD_ID,\n    body: product\n  });\n\n  // 3. Manual cache update (can fail!)\n  await redis.set(`product:${product.PRD_ID}`, JSON.stringify(product));\n\n  return product;\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Problems:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Search/cache update can fail silently"}),"\n",(0,i.jsx)(e.li,{children:"No retry mechanism"}),"\n",(0,i.jsx)(e.li,{children:"Data inconsistency"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Use OUTBOX subscribers:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u2705 GOOD - Let OUTBOX handle sync\nasync function createProduct(data) {\n  // Just create product - OUTBOX handles the rest\n  const product = await coreAPI.post('/api/v4/core/products', data);\n\n  // OUTBOX automatically:\n  // 1. Generates ProductCreated event\n  // 2. Publishes to RabbitMQ\n  // 3. search-indexer updates Elasticsearch\n  // 4. cache-invalidator clears Redis\n  // All with retry and error handling!\n\n  return product;\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"data-management-anti-patterns",children:"Data Management Anti-Patterns"}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-13-mixing-center_dett-values",children:"\u274c Anti-Pattern 13: Mixing center_dett Values"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Using wrong organizational unit context."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - Wrong center_dett\nasync function getHeadquarterOrders() {\n  // User is in Milan branch but queries HQ data\n  const orders = await api.get('/api/v4/core/orders', {\n    headers: {\n      'X-Centro-Dett': 'HQ'  // Wrong! User is in MILAN\n    }\n  });\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Use correct context:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u2705 GOOD - Correct center_dett\nasync function getUserOrders(userCentroDett) {\n  const orders = await api.get('/api/v4/core/orders', {\n    headers: {\n      'X-Centro-Dett': userCentroDett  // User's actual organizational unit\n    }\n  });\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"-anti-pattern-14-not-validating-input",children:"\u274c Anti-Pattern 14: Not Validating Input"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Problem"}),": Accepting user input without validation."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u274c BAD - No validation\nasync function createProduct(req, res) {\n  const data = req.body;  // Direct user input!\n  return api.post('/api/v4/core/products', data);\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Risks:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"SQL injection (if metadata has vulnerabilities)"}),"\n",(0,i.jsx)(e.li,{children:"XSS attacks"}),"\n",(0,i.jsx)(e.li,{children:"Data corruption"}),"\n",(0,i.jsx)(e.li,{children:"Invalid data types"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"\u2705 CORRECT - Always validate:"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-javascript",children:"// \u2705 GOOD - Validate and sanitize\nasync function createProduct(req, res) {\n  const data = req.body;\n\n  // 1. Validate required fields\n  if (!data.XPRD01 || !data.XPRD02) {\n    return res.status(400).json({error: 'Missing required fields'});\n  }\n\n  // 2. Validate types\n  if (typeof data.XPRD02 !== 'number' || data.XPRD02 <= 0) {\n    return res.status(400).json({error: 'Invalid price'});\n  }\n\n  // 3. Sanitize text fields\n  data.XPRD01 = sanitizeHTML(data.XPRD01);\n\n  // 4. Create product\n  return api.post('/api/v4/core/products', data);\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(e.h3,{id:"critical-anti-patterns-to-avoid",children:"Critical Anti-Patterns to Avoid"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"Hardcoding field names"})," \u2192 Use metadata-driven access"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"Bypassing validation"})," \u2192 Validate against TB_VAR"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"Ignoring COD_ON_OFF"})," \u2192 Respect field visibility"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"Missing context"})," \u2192 Always include full context chain"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"Insecure tokens"})," \u2192 Use httpOnly cookies or secure storage"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"No grant checking"})," \u2192 Verify permissions first"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"N+1 queries"})," \u2192 Use expansion or batch requests"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"No pagination"})," \u2192 Always paginate large datasets"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"No caching"})," \u2192 Implement caching for frequently accessed data"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"Business logic in frontend"})," \u2192 Centralize in backend"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"Direct TREC manipulation"})," \u2192 Use lifecycle operations"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"Skipping OUTBOX"})," \u2192 Leverage event sourcing"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"Wrong context values"})," \u2192 Use correct organizational unit"]}),"\n",(0,i.jsxs)(e.li,{children:["\u274c ",(0,i.jsx)(e.strong,{children:"No input validation"})," \u2192 Always validate and sanitize"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Always DO:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u2705 Use metadata-driven field access"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 Include full context chain"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 Check grants before operations"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 Respect COD_ON_OFF flags"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 Validate input data"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 Use pagination"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 Implement caching"}),"\n",(0,i.jsx)(e.li,{children:"\u2705 Leverage OUTBOX pattern"}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Never DO:"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u274c Hardcode field names"}),"\n",(0,i.jsx)(e.li,{children:"\u274c Skip validation"}),"\n",(0,i.jsx)(e.li,{children:"\u274c Bypass security checks"}),"\n",(0,i.jsx)(e.li,{children:"\u274c Manipulate TREC directly"}),"\n",(0,i.jsx)(e.li,{children:"\u274c Store tokens insecurely"}),"\n",(0,i.jsx)(e.li,{children:"\u274c Fetch all data without pagination"}),"\n",(0,i.jsx)(e.li,{children:"\u274c Duplicate business logic"}),"\n",(0,i.jsx)(e.li,{children:"\u274c Make N+1 queries"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/use-cases",children:"Use Cases"})," - Correct implementation patterns"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/security-tips",children:"Security Tips"})," - Security best practices"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/best-practices/performance-tips",children:"Performance Tips"})," - Optimization strategies"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/best-practices",children:"Best Practices"})," - Overview"]}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,a.M)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},2172:(n,e,t)=>{t.d(e,{I:()=>c,M:()=>s});var i=t(1504);const a={},r=i.createContext(a);function s(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:s(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);