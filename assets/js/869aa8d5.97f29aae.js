"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[3568],{9480:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var t=s(7624),r=s(2172);const i={title:"Context Security",sidebar_label:"Context Security",sidebar_position:5,description:"Multi-dimensional security with peso, ambiente, and centro_dett"},o="Context Security",l={id:"products/map.q01.io/core-api-platform-v4/security/context-security",title:"Context Security",description:"Multi-dimensional security with peso, ambiente, and centro_dett",source:"@site/docs/products/map.q01.io/core-api-platform-v4/05-security/context-security.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/05-security",slug:"/products/map.q01.io/core-api-platform-v4/security/context-security",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/context-security",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Context Security",sidebar_label:"Context Security",sidebar_position:5,description:"Multi-dimensional security with peso, ambiente, and centro_dett"},sidebar:"mapSidebar",previous:{title:"Tenant Isolation",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/tenant-isolation"},next:{title:"Rate Limiting",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/rate-limiting"}},c={},d=[{value:"Overview",id:"overview",level:2},{value:"Peso (User Level)",id:"peso-user-level",level:2},{value:"What is Peso?",id:"what-is-peso",level:3},{value:"Peso in Table Schema",id:"peso-in-table-schema",level:3},{value:"Peso Filtering",id:"peso-filtering",level:3},{value:"Peso Use Cases",id:"peso-use-cases",level:3},{value:"Ambiente (Environment)",id:"ambiente-environment",level:2},{value:"What is Ambiente?",id:"what-is-ambiente",level:3},{value:"Ambiente Filtering",id:"ambiente-filtering",level:3},{value:"Ambiente Use Cases",id:"ambiente-use-cases",level:3},{value:"Centro_Dett (Organizational Unit)",id:"centro_dett-organizational-unit",level:2},{value:"What is Centro_Dett?",id:"what-is-centro_dett",level:3},{value:"Centro_Dett Filtering",id:"centro_dett-filtering",level:3},{value:"Centro_Dett Use Cases",id:"centro_dett-use-cases",level:3},{value:"Complete Context Filtering",id:"complete-context-filtering",level:2},{value:"All Dimensions Together",id:"all-dimensions-together",level:3},{value:"JavaScript Context Example",id:"javascript-context-example",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.M)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"context-security",children:"Context Security"}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["Beyond tenant isolation (source), Q01 Core APIs implement ",(0,t.jsx)(n.strong,{children:"context-based security"})," using peso (user level), ambiente (environment), and centro_dett (organizational unit). These context dimensions filter what data is visible and provide fine-grained access control within a tenant."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Context Dimensions:"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Dimension"}),(0,t.jsx)(n.th,{children:"Purpose"}),(0,t.jsx)(n.th,{children:"Example Values"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"source"})}),(0,t.jsx)(n.td,{children:"Tenant identifier"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"productManagement"}),", ",(0,t.jsx)(n.code,{children:"storeA"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"centro_dett"})}),(0,t.jsx)(n.td,{children:"Organizational unit"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"admin"}),", ",(0,t.jsx)(n.code,{children:"warehouse"}),", ",(0,t.jsx)(n.code,{children:"store_001"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"peso"})}),(0,t.jsx)(n.td,{children:"User level (hierarchy)"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"1"})," (admin), ",(0,t.jsx)(n.code,{children:"2"})," (manager), ",(0,t.jsx)(n.code,{children:"3"})," (user)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ambiente"})}),(0,t.jsx)(n.td,{children:"Environment"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"production"}),", ",(0,t.jsx)(n.code,{children:"staging"}),", ",(0,t.jsx)(n.code,{children:"test"})]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Multi-Dimensional Filtering:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Every record filtered by:\n    source (tenant)\n        \u2193\n    centro_dett (organizational unit)\n        \u2193\n    peso (user level - hierarchical)\n        \u2193\n    ambiente (environment)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"peso-user-level",children:"Peso (User Level)"}),"\n",(0,t.jsx)(n.h3,{id:"what-is-peso",children:"What is Peso?"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"peso"})," is a hierarchical user level"]})," where lower numbers have broader access:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"peso='1'"})," - ",(0,t.jsx)(n.strong,{children:"Admin"})," (sees all levels: 1, 2, 3)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"peso='2'"})," - ",(0,t.jsx)(n.strong,{children:"Manager"})," (sees levels: 2, 3)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"peso='3'"})," - ",(0,t.jsx)(n.strong,{children:"User"})," (sees only level: 3)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Hierarchical Filtering:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"peso=1 (Admin)\n    \u251c\u2500\u2500 Can see peso=1 records \u2705\n    \u251c\u2500\u2500 Can see peso=2 records \u2705\n    \u2514\u2500\u2500 Can see peso=3 records \u2705\n\npeso=2 (Manager)\n    \u251c\u2500\u2500 Cannot see peso=1 records \u274c\n    \u251c\u2500\u2500 Can see peso=2 records \u2705\n    \u2514\u2500\u2500 Can see peso=3 records \u2705\n\npeso=3 (User)\n    \u251c\u2500\u2500 Cannot see peso=1 records \u274c\n    \u251c\u2500\u2500 Cannot see peso=2 records \u274c\n    \u2514\u2500\u2500 Can see peso=3 records \u2705\n"})}),"\n",(0,t.jsx)(n.h3,{id:"peso-in-table-schema",children:"Peso in Table Schema"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Every dimension table includes peso field:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE TB_ANAG_PRD00 (\n    PRD_ID VARCHAR(36) PRIMARY KEY,\n    XPRD01 VARCHAR(255),\n    XPRD02 DECIMAL(10,2),\n    PRD_SOURCE VARCHAR(50) NOT NULL,\n    PRD_CENTRO_DETT VARCHAR(50),\n    PRD_PESO VARCHAR(1),              -- \u2b50 User level\n    PRD_AMBIENTE VARCHAR(20),\n    TREC VARCHAR(1)\n);\n\nCREATE INDEX idx_prd_peso ON TB_ANAG_PRD00(PRD_PESO);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"peso-filtering",children:"Peso Filtering"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Automatic hierarchical filtering:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Admin user (peso='1') sees all records\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'storeA'\n  AND PRD_CENTRO_DETT = 'admin'\n  AND PRD_PESO <= '1'              -- \u2b50 Sees peso 1, 2, 3\n  AND PRD_AMBIENTE = 'production'\n  AND TREC != 'C';\n\n-- Manager user (peso='2') sees limited records\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'storeA'\n  AND PRD_CENTRO_DETT = 'admin'\n  AND PRD_PESO >= '2'              -- \u2b50 Sees only peso 2, 3\n  AND PRD_AMBIENTE = 'production'\n  AND TREC != 'C';\n\n-- Regular user (peso='3') sees minimal records\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'storeA'\n  AND PRD_CENTRO_DETT = 'admin'\n  AND PRD_PESO >= '3'              -- \u2b50 Sees only peso 3\n  AND PRD_AMBIENTE = 'production'\n  AND TREC != 'C';\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"CoreQuery Implementation:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"// Modules.php\npublic function applyPesoFilter(string $dimension, string $userPeso): string {\n    // Admin (peso=1) sees all\n    if ($userPeso === '1') {\n        return \" AND {$dimension}_PESO <= '1'\";\n    }\n\n    // Manager (peso=2) sees peso >= 2\n    if ($userPeso === '2') {\n        return \" AND {$dimension}_PESO >= '2'\";\n    }\n\n    // User (peso=3) sees only peso >= 3\n    return \" AND {$dimension}_PESO >= '{$userPeso}'\";\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"peso-use-cases",children:"Peso Use Cases"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example 1: Sensitive Product Information"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Admin-only product (peso='1')\nINSERT INTO TB_ANAG_PRD00 (\n    PRD_ID, XPRD01, XPRD02, PRD_SOURCE, PRD_PESO\n) VALUES (\n    'uuid-...', 'Confidential Product', 999.99, 'storeA', '1'\n);\n\n-- Manager-level product (peso='2')\nINSERT INTO TB_ANAG_PRD00 (\n    PRD_ID, XPRD01, XPRD02, PRD_SOURCE, PRD_PESO\n) VALUES (\n    'uuid-...', 'Internal Product', 199.99, 'storeA', '2'\n);\n\n-- Public product (peso='3')\nINSERT INTO TB_ANAG_PRD00 (\n    PRD_ID, XPRD01, XPRD02, PRD_SOURCE, PRD_PESO\n) VALUES (\n    'uuid-...', 'Standard Product', 99.99, 'storeA', '3'\n);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Query Results:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Admin user (peso='1')\nGET /api/v4/core/PRD\n# Returns: All 3 products\n\n# Manager user (peso='2')\nGET /api/v4/core/PRD\n# Returns: 2 products (Internal + Standard, no Confidential)\n\n# Regular user (peso='3')\nGET /api/v4/core/PRD\n# Returns: 1 product (Standard only)\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example 2: Order Visibility"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Executive orders (peso='1')\nINSERT INTO TB_ANAG_ORD00 (...) VALUES (..., '1');\n\n-- Manager orders (peso='2')\nINSERT INTO TB_ANAG_ORD00 (...) VALUES (..., '2');\n\n-- Sales rep orders (peso='3')\nINSERT INTO TB_ANAG_ORD00 (...) VALUES (..., '3');\n"})}),"\n",(0,t.jsx)(n.h2,{id:"ambiente-environment",children:"Ambiente (Environment)"}),"\n",(0,t.jsx)(n.h3,{id:"what-is-ambiente",children:"What is Ambiente?"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"ambiente"})," separates data by environment:"]})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"production"})," - Live production data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"staging"})," - Pre-production testing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"test"})," - Development/testing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"demo"})," - Demo/sandbox environment"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Complete Separation:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Database\n\u251c\u2500\u2500 Production Data (ambiente='production')\n\u2502   \u2514\u2500\u2500 Real customer data\n\u251c\u2500\u2500 Staging Data (ambiente='staging')\n\u2502   \u2514\u2500\u2500 Pre-release testing data\n\u251c\u2500\u2500 Test Data (ambiente='test')\n\u2502   \u2514\u2500\u2500 Development data\n\u2514\u2500\u2500 Demo Data (ambiente='demo')\n    \u2514\u2500\u2500 Demonstration data\n"})}),"\n",(0,t.jsx)(n.h3,{id:"ambiente-filtering",children:"Ambiente Filtering"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Strict environment isolation:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Production user (ambiente='production')\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'storeA'\n  AND PRD_CENTRO_DETT = 'admin'\n  AND PRD_PESO <= '1'\n  AND PRD_AMBIENTE = 'production'  -- \u2b50 Production only\n  AND TREC != 'C';\n\n-- Test user (ambiente='test')\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'storeA'\n  AND PRD_CENTRO_DETT = 'admin'\n  AND PRD_PESO <= '1'\n  AND PRD_AMBIENTE = 'test'        -- \u2b50 Test only\n  AND TREC != 'C';\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"No Cross-Environment Access:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Production user session\nPOST /auth/login\n{\n  "username": "user@example.com",\n  "source": "storeA",\n  "ambiente": "production"\n}\n\n# Query products\nGET /api/v4/core/PRD\n# Returns: Only production products (no test data visible)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"ambiente-use-cases",children:"Ambiente Use Cases"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example 1: Testing Without Production Impact"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Create test products\nINSERT INTO TB_ANAG_PRD00 (\n    PRD_ID, XPRD01, PRD_SOURCE, PRD_AMBIENTE\n) VALUES\n    ('uuid-1', 'Test Product 1', 'storeA', 'test'),\n    ('uuid-2', 'Test Product 2', 'storeA', 'test');\n\n-- Create production products\nINSERT INTO TB_ANAG_PRD00 (\n    PRD_ID, XPRD01, PRD_SOURCE, PRD_AMBIENTE\n) VALUES\n    ('uuid-3', 'Real Product 1', 'storeA', 'production'),\n    ('uuid-4', 'Real Product 2', 'storeA', 'production');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Test users see only test products"}),"\n",(0,t.jsx)(n.li,{children:"Production users see only production products"}),"\n",(0,t.jsx)(n.li,{children:"No risk of test data polluting production"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example 2: Demo Environment"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Create demo data for sales presentations\nINSERT INTO TB_ANAG_PRD00 (\n    PRD_ID, XPRD01, PRD_SOURCE, PRD_AMBIENTE\n) VALUES\n    ('uuid-demo-1', 'Demo Product', 'storeA', 'demo');\n"})}),"\n",(0,t.jsx)(n.h2,{id:"centro_dett-organizational-unit",children:"Centro_Dett (Organizational Unit)"}),"\n",(0,t.jsx)(n.h3,{id:"what-is-centro_dett",children:"What is Centro_Dett?"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"centro_dett"})," identifies organizational units within a tenant:"]})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"admin"})," - Administrative headquarters"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"warehouse"})," - Warehouse/distribution center"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"store_001"}),", ",(0,t.jsx)(n.code,{children:"store_002"})," - Individual store locations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"sales_north"}),", ",(0,t.jsx)(n.code,{children:"sales_south"})," - Sales regions"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"centro_dett-filtering",children:"Centro_Dett Filtering"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Exact match filtering (not hierarchical):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Admin user (centro_dett='admin')\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'retailChain'\n  AND PRD_CENTRO_DETT = 'admin'    -- \u2b50 Admin only\n  AND PRD_PESO <= '1'\n  AND PRD_AMBIENTE = 'production'\n  AND TREC != 'C';\n\n-- Store 001 user (centro_dett='store_001')\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'retailChain'\n  AND PRD_CENTRO_DETT = 'store_001'  -- \u2b50 Store 001 only\n  AND PRD_PESO <= '3'\n  AND PRD_AMBIENTE = 'production'\n  AND TREC != 'C';\n"})}),"\n",(0,t.jsx)(n.h3,{id:"centro_dett-use-cases",children:"Centro_Dett Use Cases"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example 1: Retail Chain with Multiple Stores"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- HQ products (centro_dett='hq')\nINSERT INTO TB_ANAG_PRD00 (\n    PRD_ID, XPRD01, PRD_SOURCE, PRD_CENTRO_DETT\n) VALUES\n    ('uuid-1', 'Corporate Product', 'retailChain', 'hq');\n\n-- Store 001 products (centro_dett='store_001')\nINSERT INTO TB_ANAG_PRD00 (\n    PRD_ID, XPRD01, PRD_SOURCE, PRD_CENTRO_DETT\n) VALUES\n    ('uuid-2', 'Store 001 Product', 'retailChain', 'store_001');\n\n-- Store 002 products (centro_dett='store_002')\nINSERT INTO TB_ANAG_PRD00 (\n    PRD_ID, XPRD01, PRD_SOURCE, PRD_CENTRO_DETT\n) VALUES\n    ('uuid-3', 'Store 002 Product', 'retailChain', 'store_002');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Query Results:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# HQ user (centro_dett='hq')\nGET /api/v4/core/PRD\n# Returns: Only HQ products\n\n# Store 001 user (centro_dett='store_001')\nGET /api/v4/core/PRD\n# Returns: Only Store 001 products\n\n# Store 002 user (centro_dett='store_002')\nGET /api/v4/core/PRD\n# Returns: Only Store 002 products\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example 2: Warehouse Management"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Warehouse inventory (centro_dett='warehouse')\nINSERT INTO TB_ANAG_INV00 (\n    INV_ID, XINV_QTY, INV_SOURCE, INV_CENTRO_DETT\n) VALUES\n    ('uuid-w1', 1000, 'logistics', 'warehouse');\n\n-- Store inventory (centro_dett='store_001')\nINSERT INTO TB_ANAG_INV00 (\n    INV_ID, XINV_QTY, INV_SOURCE, INV_CENTRO_DETT\n) VALUES\n    ('uuid-s1', 50, 'logistics', 'store_001');\n"})}),"\n",(0,t.jsx)(n.h2,{id:"complete-context-filtering",children:"Complete Context Filtering"}),"\n",(0,t.jsx)(n.h3,{id:"all-dimensions-together",children:"All Dimensions Together"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Session Context:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "user_id": "manager@retailchain.com",\n  "source": "retailChain",\n  "centro_dett": "store_001",\n  "peso": "2",\n  "ambiente": "production"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Generated Query:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'retailChain'          -- \u2b50 Tenant\n  AND PRD_CENTRO_DETT = 'store_001'       -- \u2b50 Organizational unit\n  AND PRD_PESO >= '2'                     -- \u2b50 User level (manager)\n  AND PRD_AMBIENTE = 'production'         -- \u2b50 Environment\n  AND TREC != 'C';                        -- Exclude deleted\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Result:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Only Store 001's products"}),"\n",(0,t.jsx)(n.li,{children:"Only production data"}),"\n",(0,t.jsx)(n.li,{children:"Only manager-level or lower (peso >= 2)"}),"\n",(0,t.jsx)(n.li,{children:"Within retailChain tenant"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"javascript-context-example",children:"JavaScript Context Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"class CoreAPIClient {\n  constructor(sessionContext) {\n    this.sessionContext = sessionContext;\n    this.apiBase = 'https://api.example.com';\n  }\n\n  async getProducts(filters = {}) {\n    // Session context automatically applied by server\n    const response = await fetch(\n      `${this.apiBase}/api/v4/core/PRD`,\n      {\n        headers: {\n          'Authorization': `Bearer ${this.token}`,\n          'Content-Type': 'application/json'\n        }\n      }\n    );\n\n    return response.json();\n\n    // Server applies:\n    // - source from token\n    // - centro_dett from token\n    // - peso from token\n    // - ambiente from token\n  }\n\n  getContextInfo() {\n    return {\n      tenant: this.sessionContext.source,\n      unit: this.sessionContext.centro_dett,\n      level: this.sessionContext.peso,\n      environment: this.sessionContext.ambiente\n    };\n  }\n}\n\n// Usage\nconst client = new CoreAPIClient({\n  source: 'retailChain',\n  centro_dett: 'store_001',\n  peso: '2',\n  ambiente: 'production'\n});\n\nconsole.log(client.getContextInfo());\n// {\n//   tenant: 'retailChain',\n//   unit: 'store_001',\n//   level: '2',\n//   environment: 'production'\n// }\n\nconst products = await client.getProducts();\n// Only products matching ALL context dimensions\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Set complete context during login:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - all dimensions specified\nawait login(username, password, {\n  source: 'retailChain',\n  centro_dett: 'store_001',\n  peso: '2',\n  ambiente: 'production'\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use peso for sensitive data:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - admin-only sensitive records\nINSERT INTO TB_ANAG_PRD00 (..., PRD_PESO)\nVALUES (..., '1');\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Separate environments:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# \u2705 Good - clear environment separation\n# Production\nPOST /auth/login { "ambiente": "production" }\n\n# Test\nPOST /auth/login { "ambiente": "test" }\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Trust automatic filtering:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - Core APIs handle all filtering\nconst products = await getProducts();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't try to override context fields:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - context fields are read-only\nawait createProduct({\n  XPRD01: 'Widget',\n  PRD_PESO: '1'      // Validation error!\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't mix environments:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - confusing production and test\nif (ambiente === 'test') {\n  createProduct(testData);\n} else {\n  createProduct(productionData);\n}\n\n// \u2705 Good - separate sessions entirely\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't assume hierarchical centro_dett:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - centro_dett is exact match, not hierarchical\n// User with centro_dett='store_001' cannot see centro_dett='hq'\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Don't hardcode context values:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - inflexible\nconst peso = '2';\n\n// \u2705 Good - from session\nconst peso = sessionContext.peso;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u2705 Multi-dimensional context security: source + centro_dett + peso + ambiente"}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Peso"}),": Hierarchical user level (1=admin sees all, 3=user sees minimal)"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Ambiente"}),": Environment isolation (production/staging/test/demo)"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Centro_Dett"}),": Organizational unit (exact match filtering)"]}),"\n",(0,t.jsx)(n.li,{children:"\u2705 All dimensions automatically applied to every query"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Context set during login, carried in JWT token"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Cannot override context fields (read-only)"}),"\n",(0,t.jsx)(n.li,{children:"\u2705 Complete isolation across all dimensions"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Context dimensions work together for fine-grained security"}),"\n",(0,t.jsx)(n.li,{children:"Peso is hierarchical (lower numbers see more)"}),"\n",(0,t.jsx)(n.li,{children:"Ambiente provides environment isolation"}),"\n",(0,t.jsx)(n.li,{children:"Centro_dett provides organizational unit separation"}),"\n",(0,t.jsx)(n.li,{children:"All context fields automatically filtered on every query"}),"\n",(0,t.jsx)(n.li,{children:"Context set once during login, cannot be changed per request"}),"\n",(0,t.jsx)(n.li,{children:"Trust automatic filtering - no manual WHERE clauses needed"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Context Hierarchy:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"source (tenant)\n    \u2193\ncentro_dett (organizational unit)\n    \u2193\npeso (user level - hierarchical)\n    \u2193\nambiente (environment)\n    \u2193\nFinal filtered dataset\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example Query Flow:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"User Login:\n- source: 'retailChain'\n- centro_dett: 'store_001'\n- peso: '2'\n- ambiente: 'production'\n\nQuery: GET /api/v4/core/PRD\n\nAutomatic Filtering:\nWHERE PRD_SOURCE = 'retailChain'\n  AND PRD_CENTRO_DETT = 'store_001'\n  AND PRD_PESO >= '2'\n  AND PRD_AMBIENTE = 'production'\n\nResult: Only Store 001's manager-level production products\n"})}),"\n",(0,t.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/tenant-isolation",children:"Tenant Isolation"})," - source filtering"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/authentication",children:"Authentication"})," - JWT with context"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/authorization",children:"Authorization"})," - TB_MENU grants"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security",children:"Security Overview"})," - Multi-level security"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/context-chain",children:"Context Chain"})," - Context fundamentals"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},2172:(e,n,s)=>{s.d(n,{I:()=>l,M:()=>o});var t=s(1504);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);