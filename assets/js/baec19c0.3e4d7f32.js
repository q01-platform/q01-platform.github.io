"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[2776],{4624:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>a});var s=r(7624),i=r(2172);const t={title:"TREC Lifecycle",sidebar_label:"TREC Lifecycle",sidebar_position:4,description:"Complete reference for TREC record lifecycle states - N, M, C, P definitions, transitions, and filtering patterns"},d="TREC Lifecycle",l={id:"products/map.q01.io/core-api-platform-v4/reference/trec-lifecycle",title:"TREC Lifecycle",description:"Complete reference for TREC record lifecycle states - N, M, C, P definitions, transitions, and filtering patterns",source:"@site/docs/products/map.q01.io/core-api-platform-v4/08-reference/trec-lifecycle.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/08-reference",slug:"/products/map.q01.io/core-api-platform-v4/reference/trec-lifecycle",permalink:"/docs/products/map.q01.io/core-api-platform-v4/reference/trec-lifecycle",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"TREC Lifecycle",sidebar_label:"TREC Lifecycle",sidebar_position:4,description:"Complete reference for TREC record lifecycle states - N, M, C, P definitions, transitions, and filtering patterns"},sidebar:"mapSidebar",previous:{title:"COD_ON_OFF Flags",permalink:"/docs/products/map.q01.io/core-api-platform-v4/reference/cod-on-off-flags"},next:{title:"API Endpoints",permalink:"/docs/products/map.q01.io/core-api-platform-v4/reference/api-endpoints"}},c={},a=[{value:"Overview",id:"overview",level:2},{value:"State Definitions",id:"state-definitions",level:2},{value:"N - New",id:"n---new",level:3},{value:"M - Modified",id:"m---modified",level:3},{value:"C - Cancelled (Soft Delete)",id:"c---cancelled-soft-delete",level:3},{value:"P - Processed",id:"p---processed",level:3},{value:"State Transitions",id:"state-transitions",level:2},{value:"Complete State Machine",id:"complete-state-machine",level:3},{value:"Valid Transitions",id:"valid-transitions",level:3},{value:"Invalid Transitions",id:"invalid-transitions",level:3},{value:"Automatic TREC Management",id:"automatic-trec-management",level:2},{value:"Creation (POST)",id:"creation-post",level:3},{value:"Update (PUT/PATCH)",id:"update-putpatch",level:3},{value:"Soft Delete (DELETE)",id:"soft-delete-delete",level:3},{value:"Filtering by TREC",id:"filtering-by-trec",level:2},{value:"Default Behavior",id:"default-behavior",level:3},{value:"Include Deleted Records",id:"include-deleted-records",level:3},{value:"Filter by Specific State",id:"filter-by-specific-state",level:3},{value:"Processing State",id:"processing-state",level:3},{value:"Common Use Cases",id:"common-use-cases",level:2},{value:"Soft Delete with Trash",id:"soft-delete-with-trash",level:3},{value:"Audit Trail",id:"audit-trail",level:3},{value:"Change Detection",id:"change-detection",level:3},{value:"Batch Processing",id:"batch-processing",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO",id:"-do",level:3},{value:"\u274c DON&#39;T",id:"-dont",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Issue 1: Expecting TREC=&#39;N&#39; After Update",id:"issue-1-expecting-trecn-after-update",level:3},{value:"Issue 2: Soft-Deleted Records Not Visible",id:"issue-2-soft-deleted-records-not-visible",level:3},{value:"Issue 3: Cannot Force Delete",id:"issue-3-cannot-force-delete",level:3},{value:"Issue 4: TREC Override Not Working",id:"issue-4-trec-override-not-working",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"trec-lifecycle",children:"TREC Lifecycle"}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"TREC (Transaction Record)"})," is a ",(0,s.jsx)(n.strong,{children:"system-managed field"})," that tracks the lifecycle state of every record in Q01 Core APIs. TREC values indicate whether a record is new, modified, cancelled (soft deleted), or in a special processing state."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TREC States:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"N"})," - New (just created, never modified)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"M"})," - Modified (updated at least once)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"C"})," - Cancelled (soft deleted, excluded from queries by default)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"P"})," - Processed (special workflow state, rarely used)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key Principle"}),": TREC is ",(0,s.jsx)(n.strong,{children:"automatically managed"})," by CoreWrite. Applications should never manually set TREC values."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"state-definitions",children:"State Definitions"}),"\n",(0,s.jsx)(n.h3,{id:"n---new",children:"N - New"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Meaning"}),": Record was just created and has never been updated"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Set By"}),": POST (create operation)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Characteristics"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 First state in lifecycle"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Indicates pristine record"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Visible in standard queries (TREC != 'C')"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Can transition to M (via PUT/PATCH) or C (via DELETE)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Automatic Fields Set"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "TREC": "N",\n  "CDATA": "20251219153045",        // Creation timestamp\n  "OWNER": "user@example.com"       // Creator\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/PRD\n{\n  "data": {\n    "XPRD01": "New Product",\n    "XPRD02": 99.99\n  }\n}\n\n# Response\n{\n  "data": {\n    "PRD_ID": 123,\n    "TREC": "N",              # \u2190 Automatically set\n    "CDATA": "20251219153045",\n    "OWNER": "user@example.com",\n    "XPRD01": "New Product",\n    "XPRD02": 99.99\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"m---modified",children:"M - Modified"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Meaning"}),": Record has been updated at least once since creation"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Set By"}),": PUT/PATCH (update operations)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Characteristics"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Second state in lifecycle (after N)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Indicates record has change history"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Visible in standard queries (TREC != 'C')"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Can transition to C (via DELETE) but never back to N"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Automatic Fields Updated"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "TREC": "M",\n  "LDATA": "20251219160000",        // Last modification timestamp\n  "LOWNER": "admin@example.com"     // Last modifier\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'PATCH /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD02": 89.99\n  }\n}\n\n# Response\n{\n  "data": {\n    "PRD_ID": 123,\n    "TREC": "M",              # \u2190 Changed from \'N\' to \'M\'\n    "LDATA": "20251219160000",\n    "LOWNER": "admin@example.com",\n    "XPRD01": "New Product",\n    "XPRD02": 89.99           # \u2190 Updated\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"c---cancelled-soft-delete",children:"C - Cancelled (Soft Delete)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Meaning"}),": Record is soft deleted (logically deleted but physically present)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Set By"}),": DELETE (without ",(0,s.jsx)(n.code,{children:"?force=true"})," parameter)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Characteristics"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Terminal state for soft delete"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Record remains in database"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Excluded from standard queries (filtered by TREC != 'C')"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Can be restored by setting TREC='M' via PATCH"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Can be force deleted (physical removal) via DELETE?force=true"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Automatic Fields Updated"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "TREC": "C",\n  "LDATA": "20251219170000",        // Deletion timestamp\n  "LOWNER": "admin@example.com"     // Deleter\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'DELETE /api/v4/core/PRD/123\n\n# Record updated with TREC=\'C\', not physically deleted\n{\n  "message": "Record soft deleted",\n  "record": {\n    "PRD_ID": 123,\n    "TREC": "C",              # \u2190 Changed to \'C\'\n    "LDATA": "20251219170000",\n    "LOWNER": "admin@example.com"\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Restore Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Restore soft-deleted record by setting TREC=\'M\'\nPATCH /api/v4/core/PRD/123\n{\n  "data": {\n    "TREC": "M"\n  }\n}\n\n# Record is now active again\n{\n  "data": {\n    "PRD_ID": 123,\n    "TREC": "M",              # \u2190 Restored\n    "LDATA": "20251219180000"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"p---processed",children:"P - Processed"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Meaning"}),": Special workflow state for batch processing or custom workflows"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Set By"}),": Custom workflow logic (rarely used)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Characteristics"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Indicates record is in processing state"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Application-specific meaning"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Visible in standard queries (TREC != 'C')"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Can transition to M or C"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example Use Cases"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Batch import processing (TREC='P' during import, 'M' when complete)"}),"\n",(0,s.jsx)(n.li,{children:"Approval workflows (TREC='P' while pending approval)"}),"\n",(0,s.jsx)(n.li,{children:"Queue processing (TREC='P' in queue, 'M' when processed)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Custom workflow sets TREC=\'P\'\nPATCH /api/v4/core/ORD/456\n{\n  "data": {\n    "TREC": "P",\n    "XORD_STATUS": "processing"\n  }\n}\n\n# After processing completes\nPATCH /api/v4/core/ORD/456\n{\n  "data": {\n    "TREC": "M",\n    "XORD_STATUS": "completed"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"state-transitions",children:"State Transitions"}),"\n",(0,s.jsx)(n.h3,{id:"complete-state-machine",children:"Complete State Machine"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"        POST (Create)\n             \u2193\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502 TREC=N \u2502 (New)\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2193\n    PUT/PATCH (Update)\n             \u2193\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502 TREC=M \u2502 (Modified)\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2193\n   DELETE (Soft Delete)\n             \u2193\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502 TREC=C \u2502 (Cancelled)\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2193\n   DELETE?force=true\n             \u2193\n     Physical Deletion\n   (Record removed from DB)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"valid-transitions",children:"Valid Transitions"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"From"}),(0,s.jsx)(n.th,{children:"To"}),(0,s.jsx)(n.th,{children:"Operation"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"(none)"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"N"})}),(0,s.jsx)(n.td,{children:"POST"}),(0,s.jsx)(n.td,{children:"Create new record"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"N"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"M"})}),(0,s.jsx)(n.td,{children:"PUT/PATCH"}),(0,s.jsx)(n.td,{children:"First update"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"M"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"M"})}),(0,s.jsx)(n.td,{children:"PUT/PATCH"}),(0,s.jsx)(n.td,{children:"Subsequent updates"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"N"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"C"})}),(0,s.jsx)(n.td,{children:"DELETE"}),(0,s.jsx)(n.td,{children:"Soft delete new record"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"M"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"C"})}),(0,s.jsx)(n.td,{children:"DELETE"}),(0,s.jsx)(n.td,{children:"Soft delete modified record"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"C"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"M"})}),(0,s.jsx)(n.td,{children:"PATCH"}),(0,s.jsx)(n.td,{children:"Restore soft-deleted record"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"N"})}),(0,s.jsx)(n.td,{children:"(deleted)"}),(0,s.jsx)(n.td,{children:"DELETE?force=true"}),(0,s.jsx)(n.td,{children:"Force delete new record"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"M"})}),(0,s.jsx)(n.td,{children:"(deleted)"}),(0,s.jsx)(n.td,{children:"DELETE?force=true"}),(0,s.jsx)(n.td,{children:"Force delete modified record"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"C"})}),(0,s.jsx)(n.td,{children:"(deleted)"}),(0,s.jsx)(n.td,{children:"DELETE?force=true"}),(0,s.jsx)(n.td,{children:"Force delete cancelled record"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"P"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"M"})}),(0,s.jsx)(n.td,{children:"PATCH"}),(0,s.jsx)(n.td,{children:"Complete processing"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.strong,{children:"N"}),"/",(0,s.jsx)(n.strong,{children:"M"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"P"})}),(0,s.jsx)(n.td,{children:"PATCH"}),(0,s.jsx)(n.td,{children:"Enter processing state"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"invalid-transitions",children:"Invalid Transitions"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"From"}),(0,s.jsx)(n.th,{children:"To"}),(0,s.jsx)(n.th,{children:"Why Invalid"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"M"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"N"})}),(0,s.jsx)(n.td,{children:'Cannot "un-modify" a record'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"C"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"N"})}),(0,s.jsx)(n.td,{children:'Cannot restore to "new" state'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"P"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"N"})}),(0,s.jsx)(n.td,{children:'Cannot reset to "new" after processing'})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"automatic-trec-management",children:"Automatic TREC Management"}),"\n",(0,s.jsx)(n.h3,{id:"creation-post",children:"Creation (POST)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"CoreWrite Logic"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"public function insert(string $dimension, array $data): array {\n  // System sets TREC automatically\n  $data['TREC'] = 'N';\n  $data['CDATA'] = date('YmdHis');\n  $data['OWNER'] = $this->getAuthenticatedUser();\n\n  // Insert record\n  $this->pdo->insert($dimension, $data);\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"User Attempt to Override"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u274c BAD - Attempting to set TREC manually\nPOST /api/v4/core/PRD\n{\n  "data": {\n    "TREC": "M",              # Ignored! System sets to \'N\'\n    "XPRD01": "Product"\n  }\n}\n\n# Actual result: TREC=\'N\' (system override)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"update-putpatch",children:"Update (PUT/PATCH)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"CoreWrite Logic"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"public function update(string $dimension, string $id, array $data): array {\n  // System updates TREC automatically\n  $data['TREC'] = 'M';\n  $data['LDATA'] = date('YmdHis');\n  $data['LOWNER'] = $this->getAuthenticatedUser();\n\n  // Update record\n  $this->pdo->update($dimension, $id, $data);\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"User Attempt to Keep TREC='N'"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u274c BAD - Attempting to prevent TREC update\nPATCH /api/v4/core/PRD/123\n{\n  "data": {\n    "TREC": "N",              # Ignored! System sets to \'M\'\n    "XPRD02": 89.99\n  }\n}\n\n# Actual result: TREC=\'M\' (system override)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"soft-delete-delete",children:"Soft Delete (DELETE)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"CoreWrite Logic"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"public function delete(string $dimension, string $id, bool $force = false): void {\n  if ($force) {\n    // Physical deletion\n    $this->pdo->delete($dimension, $id);\n  } else {\n    // Soft deletion - update TREC\n    $this->pdo->update($dimension, $id, [\n      'TREC' => 'C',\n      'LDATA' => date('YmdHis'),\n      'LOWNER' => $this->getAuthenticatedUser()\n    ]);\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Soft vs Force Delete"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Soft delete - TREC='C'\nDELETE /api/v4/core/PRD/123\n\n# Force delete - physically removed\nDELETE /api/v4/core/PRD/123?force=true\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"filtering-by-trec",children:"Filtering by TREC"}),"\n",(0,s.jsx)(n.h3,{id:"default-behavior",children:"Default Behavior"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Standard queries exclude cancelled records"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- CoreQuery automatically adds TREC filter\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'ecommerce'\n  AND TREC != 'C'            -- \u2190 Automatically added\nLIMIT 100;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"API Request"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD?$num_rows=100\n\n# Returns only active records (TREC='N' or TREC='M')\n"})}),"\n",(0,s.jsx)(n.h3,{id:"include-deleted-records",children:"Include Deleted Records"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Explicitly filter for all TREC states"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD?filter[TREC][$in]=N,M,C\n\n# Returns all records including soft-deleted (TREC='C')\n"})}),"\n",(0,s.jsx)(n.h3,{id:"filter-by-specific-state",children:"Filter by Specific State"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"New records only"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD?filter[TREC]=N\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Modified records only"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD?filter[TREC]=M\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cancelled records only"})," (trash):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD?filter[TREC]=C\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Active records"})," (default):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD?filter[TREC][$ne]=C\n\n# Equivalent to default behavior\n"})}),"\n",(0,s.jsx)(n.h3,{id:"processing-state",children:"Processing State"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Records in processing"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/ORD?filter[TREC]=P\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"common-use-cases",children:"Common Use Cases"}),"\n",(0,s.jsx)(n.h3,{id:"soft-delete-with-trash",children:"Soft Delete with Trash"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"class ProductService {\n  // Soft delete product\n  async deleteProduct(productId) {\n    await coreAPI.delete(`/api/v4/core/PRD/${productId}`);\n    // TREC automatically set to 'C'\n  }\n\n  // Get trash (soft-deleted products)\n  async getTrash() {\n    return await coreAPI.get('/api/v4/core/PRD', {\n      params: {\n        filter: { TREC: 'C' }\n      }\n    });\n  }\n\n  // Restore from trash\n  async restoreProduct(productId) {\n    await coreAPI.patch(`/api/v4/core/PRD/${productId}`, {\n      data: { TREC: 'M' }\n    });\n  }\n\n  // Permanent delete\n  async permanentDelete(productId) {\n    await coreAPI.delete(`/api/v4/core/PRD/${productId}`, {\n      params: { force: true }\n    });\n    // Record physically removed\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"audit-trail",children:"Audit Trail"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Track record history"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"class AuditService {\n  async getRecordHistory(dimension, recordId) {\n    const record = await coreAPI.get(`/api/v4/core/${dimension}/${recordId}`);\n\n    return {\n      created: {\n        timestamp: record.data.CDATA,\n        user: record.data.OWNER,\n        state: 'N'\n      },\n      lastModified: record.data.TREC === 'M' ? {\n        timestamp: record.data.LDATA,\n        user: record.data.LOWNER,\n        state: 'M'\n      } : null,\n      currentState: record.data.TREC\n    };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"change-detection",children:"Change Detection"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Find recently created records"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD?filter[TREC]=N&sort=-CDATA\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Find recently modified records"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD?filter[TREC]=M&sort=-LDATA\n"})}),"\n",(0,s.jsx)(n.h3,{id:"batch-processing",children:"Batch Processing"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Process pending records"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"class BatchProcessor {\n  async processPendingOrders() {\n    // Get orders in processing state\n    const pending = await coreAPI.get('/api/v4/core/ORD', {\n      params: {\n        filter: { TREC: 'P', XORD_STATUS: 'pending' }\n      }\n    });\n\n    for (const order of pending.data) {\n      await this.processOrder(order);\n\n      // Mark as processed\n      await coreAPI.patch(`/api/v4/core/ORD/${order.ORD_ID}`, {\n        data: {\n          TREC: 'M',\n          XORD_STATUS: 'completed'\n        }\n      });\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"-do",children:"\u2705 DO"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Rely on automatic TREC management"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - let system manage TREC\nawait coreAPI.post('/api/v4/core/PRD', {\n  data: {\n    XPRD01: 'Product',\n    XPRD02: 99.99\n    // TREC automatically set to 'N'\n  }\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use soft delete by default"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - reversible\nawait coreAPI.delete('/api/v4/core/PRD/123');\n\n// Can be restored later\nawait coreAPI.patch('/api/v4/core/PRD/123', {\n  data: { TREC: 'M' }\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Filter out cancelled records explicitly when needed"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - clear intent\nconst activeProducts = await coreAPI.get('/api/v4/core/PRD', {\n  params: {\n    filter: { TREC: { $ne: 'C' } }\n  }\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Don't manually set TREC on create"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - TREC will be overridden to 'N'\nawait coreAPI.post('/api/v4/core/PRD', {\n  data: {\n    TREC: 'M',        // Ignored\n    XPRD01: 'Product'\n  }\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Don't try to prevent TREC='M' on update"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - TREC will always become 'M' on update\nawait coreAPI.patch('/api/v4/core/PRD/123', {\n  data: {\n    TREC: 'N',        // Ignored, will be 'M'\n    XPRD02: 89.99\n  }\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Don't force delete without good reason"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - irreversible\nawait coreAPI.delete('/api/v4/core/PRD/123', {\n  params: { force: true }\n});\n\n// \u2705 Better - soft delete\nawait coreAPI.delete('/api/v4/core/PRD/123');\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"issue-1-expecting-trecn-after-update",children:"Issue 1: Expecting TREC='N' After Update"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Symptom"}),": Record has TREC='M' but I want it to be TREC='N'"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": Any update automatically sets TREC='M'"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),": Accept that modified records have TREC='M' - this is correct behavior"]}),"\n",(0,s.jsx)(n.h3,{id:"issue-2-soft-deleted-records-not-visible",children:"Issue 2: Soft-Deleted Records Not Visible"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Symptom"}),": Record exists in database but not returned by API"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": Record has TREC='C' and is excluded from default queries"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Include cancelled records in query\nGET /api/v4/core/PRD?filter[TREC][$in]=N,M,C\n"})}),"\n",(0,s.jsx)(n.h3,{id:"issue-3-cannot-force-delete",children:"Issue 3: Cannot Force Delete"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Symptom"}),": DELETE?force=true returns permission error"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": User lacks 'force_delete' grant"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),": Use soft delete instead (DELETE without force parameter)"]}),"\n",(0,s.jsx)(n.h3,{id:"issue-4-trec-override-not-working",children:"Issue 4: TREC Override Not Working"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Symptom"}),": Setting TREC manually has no effect"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": TREC is system-managed and cannot be manually controlled"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),": Trust automatic TREC management - it ensures data integrity"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"TREC"})," tracks record lifecycle: N (new) \u2192 M (modified) \u2192 C (cancelled)"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"System-managed"})," - never set TREC manually"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Automatic transitions"})," on POST (N), PUT/PATCH (M), DELETE (C)"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Soft delete"})," default - TREC='C', record remains in database"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Force delete"})," optional - physical removal with ?force=true"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Filter by TREC"})," to include/exclude cancelled records"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"TREC is automatic - trust the system"}),"\n",(0,s.jsx)(n.li,{children:"Soft delete (TREC='C') is reversible"}),"\n",(0,s.jsx)(n.li,{children:"Force delete is permanent - use sparingly"}),"\n",(0,s.jsx)(n.li,{children:"Default queries exclude TREC='C'"}),"\n",(0,s.jsx)(n.li,{children:"Filter by TREC for trash functionality"}),"\n",(0,s.jsx)(n.li,{children:"Never manually set TREC in create/update operations"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Common Filters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Active records: ",(0,s.jsx)(n.code,{children:"?filter[TREC][$ne]=C"})," (default)"]}),"\n",(0,s.jsxs)(n.li,{children:["New records: ",(0,s.jsx)(n.code,{children:"?filter[TREC]=N"})]}),"\n",(0,s.jsxs)(n.li,{children:["Modified records: ",(0,s.jsx)(n.code,{children:"?filter[TREC]=M"})]}),"\n",(0,s.jsxs)(n.li,{children:["Cancelled records: ",(0,s.jsx)(n.code,{children:"?filter[TREC]=C"})]}),"\n",(0,s.jsxs)(n.li,{children:["All records: ",(0,s.jsx)(n.code,{children:"?filter[TREC][$in]=N,M,C"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/entity-lifecycle",children:"Entity Lifecycle"})," - TREC concept explained"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/",children:"Write Patterns"})," - Create, update, delete operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/delete-operations",children:"Delete Operations"})," - Soft vs force delete"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/reference/metadata-tables",children:"Metadata Tables"})," - TB_COST TREC configuration"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>l,M:()=>d});var s=r(1504);const i={},t=s.createContext(i);function d(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);