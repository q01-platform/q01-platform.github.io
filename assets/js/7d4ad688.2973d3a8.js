"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[88],{7964:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>a});var s=r(7624),i=r(2172);const l={title:"Counter Management",sidebar_label:"12. Counter Management",sidebar_position:13,description:"Sequential identifier generation with formatting templates for business-friendly IDs"},t="Counter Management",c={id:"products/map.q01.io/core-api-platform-v4/core-concepts/counter-management",title:"Counter Management",description:"Sequential identifier generation with formatting templates for business-friendly IDs",source:"@site/docs/products/map.q01.io/core-api-platform-v4/01-core-concepts/counter-management.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/01-core-concepts",slug:"/products/map.q01.io/core-api-platform-v4/core-concepts/counter-management",permalink:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/counter-management",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:13,frontMatter:{title:"Counter Management",sidebar_label:"12. Counter Management",sidebar_position:13,description:"Sequential identifier generation with formatting templates for business-friendly IDs"},sidebar:"mapSidebar",previous:{title:"11. Pre-Insert Functions",permalink:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/pre-insert-functions"},next:{title:"13. Source Parameter",permalink:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/source-parameter"}},d={},a=[{value:"What is Counter Management?",id:"what-is-counter-management",level:2},{value:"Why Counter Management Matters",id:"why-counter-management-matters",level:2},{value:"Simple Auto-Increment (Limited)",id:"simple-auto-increment-limited",level:3},{value:"Counter Management (Q01 Approach)",id:"counter-management-q01-approach",level:3},{value:"TB_COUNTER Structure",id:"tb_counter-structure",level:2},{value:"Table Schema",id:"table-schema",level:3},{value:"Key Fields Explained",id:"key-fields-explained",level:3},{value:"COUNTER_SQL Configuration",id:"counter_sql-configuration",level:2},{value:"JSON Structure",id:"json-structure",level:3},{value:"Basic Counter (No Partitioning)",id:"basic-counter-no-partitioning",level:3},{value:"Year-Partitioned Counter",id:"year-partitioned-counter",level:3},{value:"Store-Partitioned Counter",id:"store-partitioned-counter",level:3},{value:"External Counter Table",id:"external-counter-table",level:3},{value:"COUNTER_FORMAT Template",id:"counter_format-template",level:2},{value:"Template Syntax",id:"template-syntax",level:3},{value:"pad Function",id:"pad-function",level:3},{value:"Placeholders",id:"placeholders",level:3},{value:"Format Examples",id:"format-examples",level:3},{value:"Example 1: Simple Year-Padded Counter",id:"example-1-simple-year-padded-counter",level:4},{value:"Example 2: Formatted Invoice Number",id:"example-2-formatted-invoice-number",level:4},{value:"Example 3: Store-Based Order Number",id:"example-3-store-based-order-number",level:4},{value:"Example 4: Body Field in Format",id:"example-4-body-field-in-format",level:4},{value:"COUNTER_INITVAL - Starting Value",id:"counter_initval---starting-value",level:2},{value:"TB_ANAG_COUNT00 - Counter Storage",id:"tb_anag_count00---counter-storage",level:2},{value:"Purpose",id:"purpose",level:3},{value:"Structure",id:"structure",level:3},{value:"Use Case",id:"use-case",level:3},{value:"Concurrency Safety",id:"concurrency-safety",level:2},{value:"FOR UPDATE Locking",id:"for-update-locking",level:3},{value:"Transaction Flow",id:"transaction-flow",level:3},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Example 1: Simple Integer Counter",id:"example-1-simple-integer-counter",level:3},{value:"Example 2: Year-Partitioned Invoice",id:"example-2-year-partitioned-invoice",level:3},{value:"Example 3: Multi-Partition Counter",id:"example-3-multi-partition-counter",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO: Use varchar for Formatted Counters",id:"-do-use-varchar-for-formatted-counters",level:3},{value:"\u2705 DO: Partition by Logical Boundaries",id:"-do-partition-by-logical-boundaries",level:3},{value:"\u2705 DO: Use COUNTER_INITVAL for Professional Appearance",id:"-do-use-counter_initval-for-professional-appearance",level:3},{value:"\u2705 DO: Test Counter with Concurrent Requests",id:"-do-test-counter-with-concurrent-requests",level:3},{value:"\u274c DON&#39;T: Use Counters Without Partitioning for Multi-Tenant",id:"-dont-use-counters-without-partitioning-for-multi-tenant",level:3},{value:"\u274c DON&#39;T: Change COUNTER_FORMAT After Production Use",id:"-dont-change-counter_format-after-production-use",level:3},{value:"\u274c DON&#39;T: Use Small Padding for High-Volume Counters",id:"-dont-use-small-padding-for-high-volume-counters",level:3},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"Pitfall 1: Forgetting FOR UPDATE Lock",id:"pitfall-1-forgetting-for-update-lock",level:3},{value:"Pitfall 2: Using Session Variables in COUNTER_FORMAT",id:"pitfall-2-using-session-variables-in-counter_format",level:3},{value:"Pitfall 3: Not Testing Year Rollover",id:"pitfall-3-not-testing-year-rollover",level:3},{value:"Summary",id:"summary",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"counter-management",children:"Counter Management"}),"\n",(0,s.jsx)(n.h2,{id:"what-is-counter-management",children:"What is Counter Management?"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Counter Management"})," is Q01's system for generating ",(0,s.jsx)(n.strong,{children:"sequential, formatted, business-friendly identifiers"}),' (e.g., "INV-2025-00123", "ORD-ABC-000456") using metadata-driven configuration in TB_COUNTER.']}),"\n",(0,s.jsx)(n.p,{children:"Unlike simple auto-increment IDs, counters provide:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Custom formatting"})," - Templates with year, padding, prefixes, separators"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Partitioning"})," - Separate sequences per year, store, category, etc."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Concurrency safety"})," - ",(0,s.jsx)(n.code,{children:"FOR UPDATE"})," locking prevents duplicates"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fallback mechanisms"})," - TB_ANAG_COUNT00 stores last values for reliability"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Insight:"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:'Counters transform simple auto-increment into business-meaningful identifiers - "Order #000123" becomes "ORD-2025-NYC-00123" with metadata configuration, no code changes.'}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"why-counter-management-matters",children:"Why Counter Management Matters"}),"\n",(0,s.jsx)(n.h3,{id:"simple-auto-increment-limited",children:"Simple Auto-Increment (Limited)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Traditional approach:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE TB_ANAG_ORD00 (\n  ORD_ID INT PRIMARY KEY AUTO_INCREMENT,\n  ...\n);\n\nINSERT INTO TB_ANAG_ORD00 (...) VALUES (...);\n-- Result: ORD_ID = 123\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Problems:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'\u274c Not human-friendly ("Order 123" - what year? which store?)'}),"\n",(0,s.jsx)(n.li,{children:"\u274c No partitioning (sequence shared across all stores/years)"}),"\n",(0,s.jsx)(n.li,{children:"\u274c No formatting flexibility (can't add prefixes, separators)"}),"\n",(0,s.jsx)(n.li,{children:"\u274c Database-specific (MySQL AUTO_INCREMENT \u2260 Oracle SEQUENCE)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"counter-management-q01-approach",children:"Counter Management (Q01 Approach)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Metadata-driven:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'-- TB_COUNTER configuration\nINSERT INTO TB_COUNTER (\n  COD_DIM, FIELD_KEY, FIELD_TYPE,\n  COUNTER_SQL, COUNTER_FORMAT, COUNTER_INITVAL\n) VALUES (\n  \'ORD\', \'XORD01\', \'varchar\',\n  \'{"select":"XORD01","from":"TB_ANAG_ORD00","where":"YEAR(CDATA)=YEAR(NOW())"}\',\n  \'pad|%year%|2|0|LEFT__SEP__-__SEP__pad|#NEXT#|6|0|LEFT\',\n  1\n);\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"}),' "ORD-25-000123" (auto-generated, partitioned by year, zero-padded)']}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Human-friendly format"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Partitioned sequences (per year, store, category)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Configurable formatting"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Concurrent-safe"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Database-agnostic"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"tb_counter-structure",children:"TB_COUNTER Structure"}),"\n",(0,s.jsx)(n.h3,{id:"table-schema",children:"Table Schema"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE TB_COUNTER (\n  COUNTER_ID INT PRIMARY KEY AUTO_INCREMENT,\n  COD_DIM VARCHAR(50),        -- Dimension code (e.g., 'ORD', 'INV')\n  FIELD_KEY VARCHAR(100),     -- Field name (e.g., 'XORD01')\n  FIELD_TYPE VARCHAR(50),     -- Data type ('int' or 'varchar')\n  COUNTER_SQL TEXT,           -- JSON: SELECT query configuration\n  COUNTER_FORMAT TEXT,        -- Template for formatting\n  COUNTER_INITVAL INT         -- Starting value (default: 1)\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"key-fields-explained",children:"Key Fields Explained"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Purpose"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"COD_DIM"})}),(0,s.jsx)(n.td,{children:"Dimension using counter"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:'"ORD"'}),", ",(0,s.jsx)(n.code,{children:'"INV"'}),", ",(0,s.jsx)(n.code,{children:'"PRD"'})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"FIELD_KEY"})}),(0,s.jsx)(n.td,{children:"Field to auto-populate"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:'"XORD01"'}),", ",(0,s.jsx)(n.code,{children:'"XINV_CODE"'})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"FIELD_TYPE"})}),(0,s.jsx)(n.td,{children:"Result data type"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:'"int"'})," (numeric) or ",(0,s.jsx)(n.code,{children:'"varchar"'})," (formatted)"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"COUNTER_SQL"})}),(0,s.jsx)(n.td,{children:"JSON query config"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'{"select":"...", "from":"...", "where":"..."}'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"COUNTER_FORMAT"})}),(0,s.jsx)(n.td,{children:"Format template"}),(0,s.jsx)(n.td,{children:'`"pad'})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"COUNTER_INITVAL"})}),(0,s.jsx)(n.td,{children:"Starting number"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"1"}),", ",(0,s.jsx)(n.code,{children:"1000"}),", ",(0,s.jsx)(n.code,{children:"10000"})]})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"counter_sql-configuration",children:"COUNTER_SQL Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"json-structure",children:"JSON Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "select": "FIELD_NAME",\n  "from": "TABLE_NAME",\n  "where": "PARTITION_CONDITION",\n  "extraselect": "ADDITIONAL_FIELDS"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Fields:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"select"}),": Field containing counter value"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"from"}),": Table to query for MAX value"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"where"}),": Optional partition condition (year, store, etc.)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"extraselect"}),": Additional fields to retrieve (optional)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"basic-counter-no-partitioning",children:"Basic Counter (No Partitioning)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Get next sequence from same table:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "select": "XORD01",\n  "from": "TB_ANAG_ORD00"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Generated SQL:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT IFNULL(MAX(CAST(XORD01 AS UNSIGNED)), 0) + 1 AS NEXT\nFROM TB_ANAG_ORD00\nFOR UPDATE;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," Global sequence (1, 2, 3, ...) across all orders."]}),"\n",(0,s.jsx)(n.h3,{id:"year-partitioned-counter",children:"Year-Partitioned Counter"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Reset sequence each year:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "select": "XORD01",\n  "from": "TB_ANAG_ORD00",\n  "where": "YEAR(CDATA) = YEAR(NOW())"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Generated SQL:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT IFNULL(MAX(CAST(XORD01 AS UNSIGNED)), 0) + 1 AS NEXT\nFROM TB_ANAG_ORD00\nWHERE YEAR(CDATA) = YEAR(NOW())\nFOR UPDATE;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," Per-year sequence:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"2024: 1, 2, 3, ..."}),"\n",(0,s.jsx)(n.li,{children:"2025: 1, 2, 3, ... (resets)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"store-partitioned-counter",children:"Store-Partitioned Counter"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Separate sequence per store:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "select": "XORD01",\n  "from": "TB_ANAG_ORD00",\n  "where": "XORD06 = \'%codice_sede%\'"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Generated SQL:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT IFNULL(MAX(CAST(XORD01 AS UNSIGNED)), 0) + 1 AS NEXT\nFROM TB_ANAG_ORD00\nWHERE XORD06 = 'NYC'  -- From session variable\nFOR UPDATE;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," Per-store sequence:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"NYC: 1, 2, 3, ..."}),"\n",(0,s.jsx)(n.li,{children:"LAX: 1, 2, 3, ... (independent)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Code Reference:"})," ",(0,s.jsx)(n.code,{children:"DataStore.php:158-165"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'$counterWhere = "";\nif (isset($counterSql["where"]) && $counterSql["where"] != \'\') {\n    $sess = $this->session->getArraySession();\n    // Replace %varName% with session value\n    $counterSql["where"] = $this->replaceVariablesInTemplate(\n        $counterSql["where"],\n        $sess["grant_session"],\n        "%"\n    );\n    $counterWhere = " WHERE " . $counterSql["where"];\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"external-counter-table",children:"External Counter Table"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use TB_ANAG_COUNT00 as counter source:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "select": "XCOUNT03",\n  "from": "TB_ANAG_COUNT00",\n  "where": "XCOUNT01 = \'ORD\' AND XCOUNT06 = YEAR(NOW())"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Use Case:"})," Share counter across multiple dimensions or separate counter storage."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Code Reference:"})," ",(0,s.jsx)(n.code,{children:"DataStore.php:180-185"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'// If counter table differs from dimension table, update counter table\nif ($counterSql[\'from\'] != "TB_ANAG_".$param[\'counter_dim\']."00" && $counterWhere != "") {\n    $sql = "update {$counterSql[\'from\']} set {$counterSql["select"]} = {$data["NEXT"]} {$counterWhere}";\n    $stmt = $this->db_data->prepare($sql);\n    $stmt->execute();\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"counter_format-template",children:"COUNTER_FORMAT Template"}),"\n",(0,s.jsx)(n.h3,{id:"template-syntax",children:"Template Syntax"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Format:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"function|arg1|arg2|arg3|arg4__SEP__function|arg1|arg2|arg3|arg4\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Separator:"})," ",(0,s.jsx)(n.code,{children:"__SEP__"})," (joins multiple format segments)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Function:"})," Currently only ",(0,s.jsx)(n.code,{children:"pad"})," is supported"]}),"\n",(0,s.jsx)(n.h3,{id:"pad-function",children:"pad Function"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Syntax:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pad|input|length|padChar|direction\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"input"}),": Value to pad (can use placeholders)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"length"}),": Target length after padding"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"padChar"}),": Character to use for padding (e.g., ",(0,s.jsx)(n.code,{children:"0"}),", ",(0,s.jsx)(n.code,{children:" "}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"direction"}),": ",(0,s.jsx)(n.code,{children:"LEFT"}),", ",(0,s.jsx)(n.code,{children:"RIGHT"}),", or ",(0,s.jsx)(n.code,{children:"BOTH"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"placeholders",children:"Placeholders"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Placeholder"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Value"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"%year%"})}),(0,s.jsx)(n.td,{children:"Date function"}),(0,s.jsx)(n.td,{children:"Current 2-digit year"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:'"25"'})," (2025)"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"%day%"})}),(0,s.jsx)(n.td,{children:"Date function"}),(0,s.jsx)(n.td,{children:"Current day"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:'"19"'})," (19th)"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"%now%"})}),(0,s.jsx)(n.td,{children:"Date function"}),(0,s.jsx)(n.td,{children:"YYYYMMDDHHmmss"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"20250119120000"'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"@varName@"})}),(0,s.jsx)(n.td,{children:"Session variable"}),(0,s.jsx)(n.td,{children:"Session value"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"@codice_sede@"})," \u2192 ",(0,s.jsx)(n.code,{children:'"NYC"'})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"#NEXT#"})}),(0,s.jsx)(n.td,{children:"Query result"}),(0,s.jsx)(n.td,{children:"Next counter value"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"123"'})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"#FIELD#"})}),(0,s.jsx)(n.td,{children:"Query result"}),(0,s.jsx)(n.td,{children:"Extra field from query"}),(0,s.jsxs)(n.td,{children:["From ",(0,s.jsx)(n.code,{children:"extraselect"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"__fieldName__"})}),(0,s.jsx)(n.td,{children:"Request body"}),(0,s.jsx)(n.td,{children:"Field from POST body"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"__XORD07__"})," \u2192 ",(0,s.jsx)(n.code,{children:'"RETAIL"'})]})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Code Reference:"})," ",(0,s.jsx)(n.code,{children:"DataStore.php:232-271"})]}),"\n",(0,s.jsx)(n.h3,{id:"format-examples",children:"Format Examples"}),"\n",(0,s.jsx)(n.h4,{id:"example-1-simple-year-padded-counter",children:"Example 1: Simple Year-Padded Counter"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Format:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pad|%year%|2|0|LEFT__SEP__pad|#NEXT#|6|0|LEFT\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Breakdown:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pad|%year%|2|0|LEFT"}),' \u2192 "25" (2025, padded to 2 digits)']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"__SEP__"})," \u2192 Separator (nothing in output)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pad|#NEXT#|6|0|LEFT"}),' \u2192 "000123" (sequence padded to 6 digits)']}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," ",(0,s.jsx)(n.code,{children:'"25000123"'})]}),"\n",(0,s.jsx)(n.h4,{id:"example-2-formatted-invoice-number",children:"Example 2: Formatted Invoice Number"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Format:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pad|INV|3|0|LEFT__SEP__-__SEP__pad|%year%|2|0|LEFT__SEP__-__SEP__pad|#NEXT#|5|0|LEFT\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Breakdown:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pad|INV|3|0|LEFT"}),' \u2192 "INV"']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"-"})," \u2192 Literal hyphen"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pad|%year%|2|0|LEFT"}),' \u2192 "25"']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"-"})," \u2192 Literal hyphen"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pad|#NEXT#|5|0|LEFT"}),' \u2192 "00123"']}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," ",(0,s.jsx)(n.code,{children:'"INV-25-00123"'})]}),"\n",(0,s.jsx)(n.h4,{id:"example-3-store-based-order-number",children:"Example 3: Store-Based Order Number"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Format:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pad|ORD|3|0|LEFT__SEP__-__SEP__pad|@codice_sede@|3| |LEFT__SEP__-__SEP__pad|#NEXT#|4|0|LEFT\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Breakdown:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pad|ORD|3|0|LEFT"}),' \u2192 "ORD"']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"-"})," \u2192 Hyphen"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pad|@codice_sede@|3| |LEFT"}),' \u2192 "NYC" (from session, space-padded)']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"-"})," \u2192 Hyphen"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pad|#NEXT#|4|0|LEFT"}),' \u2192 "0023"']}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," ",(0,s.jsx)(n.code,{children:'"ORD-NYC-0023"'})]}),"\n",(0,s.jsx)(n.h4,{id:"example-4-body-field-in-format",children:"Example 4: Body Field in Format"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Format:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pad|__XORD07__|6| |RIGHT__SEP__-__SEP__pad|#NEXT#|5|0|LEFT\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "XORD07": "RETAIL",\n  "XORD01": "Customer Order"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," ",(0,s.jsx)(n.code,{children:'"RETAIL-00123"'})]}),"\n",(0,s.jsx)(n.h2,{id:"counter_initval---starting-value",children:"COUNTER_INITVAL - Starting Value"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Purpose:"})," Define minimum counter value."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COUNTER_INITVAL = 1     -- Start at 1 (default)\nCOUNTER_INITVAL = 1000  -- Start at 1000\nCOUNTER_INITVAL = 10000 -- Start at 10000\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"if ($initVal > $nextCounter) {\n    $nextCounter = $initVal;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Start invoice numbers at 10000 for professional appearance"}),"\n",(0,s.jsx)(n.li,{children:"Reserve ranges (1-999 for system, 1000+ for user)"}),"\n",(0,s.jsx)(n.li,{children:"Migrate from legacy system (continue from old max)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Code Reference:"})," ",(0,s.jsx)(n.code,{children:"DataStore.php:145-151"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'if (is_numeric($dataCounter["COUNTER_INITVAL"]) && intval($dataCounter["COUNTER_INITVAL"]) > 0) {\n    $initValIfNull = intval($dataCounter["COUNTER_INITVAL"]) - 1;\n    $initVal = intval($dataCounter["COUNTER_INITVAL"]);\n} else {\n    $initValIfNull = 0;\n    $initVal = 1;\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"tb_anag_count00---counter-storage",children:"TB_ANAG_COUNT00 - Counter Storage"}),"\n",(0,s.jsx)(n.h3,{id:"purpose",children:"Purpose"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Persistent counter cache"})," - stores last-used counter values for reliability."]}),"\n",(0,s.jsx)(n.h3,{id:"structure",children:"Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE TB_ANAG_COUNT00 (\n  COUNT_ID INT PRIMARY KEY AUTO_INCREMENT,\n  XCOUNT01 VARCHAR(50),   -- Dimension code\n  XCOUNT02 VARCHAR(100),  -- Field key\n  XCOUNT03 INT,           -- Counter value\n  XCOUNT04 VARCHAR(50),   -- Partition key (optional)\n  XCOUNT05 VARCHAR(50),   -- Additional partition (optional)\n  XCOUNT06 VARCHAR(4),    -- Year (for year-partitioned counters)\n  -- Standard audit fields\n  OWNER VARCHAR(50),\n  CDATA VARCHAR(14),\n  LOWNER VARCHAR(50),\n  LDATA VARCHAR(14),\n  TREC CHAR(1),\n  TIMESTAMP BIGINT\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"use-case",children:"Use Case"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scenario:"})," Dimension table doesn't exist yet, but you need counter."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example:"})," Shared invoice counter across multiple invoice types."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TB_COUNTER Configuration:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "select": "XCOUNT03",\n  "from": "TB_ANAG_COUNT00",\n  "where": "XCOUNT01 = \'INV\' AND XCOUNT06 = YEAR(NOW())"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," Counter stored in TB_ANAG_COUNT00 instead of dimension table."]}),"\n",(0,s.jsx)(n.h2,{id:"concurrency-safety",children:"Concurrency Safety"}),"\n",(0,s.jsx)(n.h3,{id:"for-update-locking",children:"FOR UPDATE Locking"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["Every counter query uses ",(0,s.jsx)(n.code,{children:"FOR UPDATE"}),":"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT IFNULL(MAX(CAST(XORD01 AS UNSIGNED)), 0) + 1 AS NEXT\nFROM TB_ANAG_ORD00\nWHERE YEAR(CDATA) = YEAR(NOW())\nFOR UPDATE;  -- Row lock\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"First transaction locks row"}),"\n",(0,s.jsx)(n.li,{children:"Second transaction waits until first commits"}),"\n",(0,s.jsx)(n.li,{children:"No duplicate counters"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Code Reference:"})," ",(0,s.jsx)(n.code,{children:"DataStore.php:167"})]}),"\n",(0,s.jsx)(n.h3,{id:"transaction-flow",children:"Transaction Flow"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Concurrent CREATE requests:"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Transaction 1:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"BEGIN;\nSELECT MAX(XORD01) + 1 FROM TB_ANAG_ORD00 FOR UPDATE;  -- Returns 123, locks\nINSERT INTO TB_ANAG_ORD00 (XORD01, ...) VALUES (123, ...);\nCOMMIT;  -- Releases lock\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Transaction 2 (waiting):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"BEGIN;\nSELECT MAX(XORD01) + 1 FROM TB_ANAG_ORD00 FOR UPDATE;  -- Waits for T1 commit\n-- After T1 commits, returns 124\nINSERT INTO TB_ANAG_ORD00 (XORD01, ...) VALUES (124, ...);\nCOMMIT;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," No collision, sequential counters (123, 124)."]}),"\n",(0,s.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,s.jsx)(n.h3,{id:"example-1-simple-integer-counter",children:"Example 1: Simple Integer Counter"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TB_COUNTER Configuration:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COUNTER (\n  COD_DIM, FIELD_KEY, FIELD_TYPE,\n  COUNTER_SQL, COUNTER_FORMAT, COUNTER_INITVAL\n) VALUES (\n  'PRD', 'XPRD21', 'int',\n  '{\"select\":\"XPRD21\",\"from\":\"TB_ANAG_PRD00\"}',\n  '',  -- No formatting, return raw integer\n  1\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Create Product Request:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/PRD\n{\n  "XPRD01": "Widget",\n  "source": "productCreate"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Result:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "PRD_ID": "555",\n  "XPRD21": 123,  // Auto-generated counter\n  "XPRD01": "Widget"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-2-year-partitioned-invoice",children:"Example 2: Year-Partitioned Invoice"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TB_COUNTER Configuration:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'INSERT INTO TB_COUNTER (\n  COD_DIM, FIELD_KEY, FIELD_TYPE,\n  COUNTER_SQL, COUNTER_FORMAT, COUNTER_INITVAL\n) VALUES (\n  \'INV\', \'XINV_NUMBER\', \'varchar\',\n  \'{"select":"XINV_NUMBER","from":"TB_ANAG_INV00","where":"YEAR(CDATA)=YEAR(NOW())"}\',\n  \'pad|INV|3|0|LEFT__SEP__-__SEP__pad|%year%|2|0|LEFT__SEP__-__SEP__pad|#NEXT#|6|0|LEFT\',\n  1000\n);\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Create Invoice (January 2025):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/INV\n{\n  "XINV_CUSTOMER": "ACME Corp",\n  "source": "invoiceCreate"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Result:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "XINV_ID": "1",\n  "XINV_NUMBER": "INV-25-001000",  // Auto-generated\n  "XINV_CUSTOMER": "ACME Corp"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Create Invoice (January 2026):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/INV\n{\n  "XINV_CUSTOMER": "ACME Corp",\n  "source": "invoiceCreate"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Result:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "XINV_ID": "12345",\n  "XINV_NUMBER": "INV-26-001000",  // Counter reset for new year\n  "XINV_CUSTOMER": "ACME Corp"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-3-multi-partition-counter",children:"Example 3: Multi-Partition Counter"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TB_COUNTER Configuration:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:'INSERT INTO TB_COUNTER (\n  COD_DIM, FIELD_KEY, FIELD_TYPE,\n  COUNTER_SQL, COUNTER_FORMAT, COUNTER_INITVAL\n) VALUES (\n  \'ORD\', \'XORD01\', \'varchar\',\n  \'{"select":"XORD01","from":"TB_ANAG_ORD00","where":"XORD05=%codice_sede% AND YEAR(CDATA)=YEAR(NOW())"}\',\n  \'pad|@codice_sede@|3| |LEFT__SEP__-__SEP__pad|%year%|2|0|LEFT__SEP__-__SEP__pad|#NEXT#|4|0|LEFT\',\n  1\n);\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Create Order (Store: NYC, 2025):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/ORD\n{\n  "XORD05": "NYC",\n  "XORD01": "Customer Order",\n  "source": "orderCreate"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," ",(0,s.jsx)(n.code,{children:'"XORD01": "NYC-25-0001"'})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Create Order (Store: LAX, 2025):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/ORD\n{\n  "XORD05": "LAX",\n  "XORD01": "Customer Order",\n  "source": "orderCreate"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," ",(0,s.jsx)(n.code,{children:'"XORD01": "LAX-25-0001"'})," (independent sequence)"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"-do-use-varchar-for-formatted-counters",children:"\u2705 DO: Use varchar for Formatted Counters"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Correct:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"FIELD_TYPE = 'varchar',\nCOUNTER_FORMAT = 'pad|INV|3|0|LEFT__SEP__-__SEP__pad|#NEXT#|5|0|LEFT'\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," ",(0,s.jsx)(n.code,{children:'"INV-00123"'})," (string)"]}),"\n",(0,s.jsx)(n.h3,{id:"-do-partition-by-logical-boundaries",children:"\u2705 DO: Partition by Logical Boundaries"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Per year: ",(0,s.jsx)(n.code,{children:'"YEAR(CDATA) = YEAR(NOW())"'})]}),"\n",(0,s.jsxs)(n.li,{children:["Per store: ",(0,s.jsx)(n.code,{children:"\"XORD05 = '%codice_sede%'\""})]}),"\n",(0,s.jsxs)(n.li,{children:["Per category: ",(0,s.jsx)(n.code,{children:"\"XPRD05 = '__category__'\""})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benefit:"})," Logical grouping, predictable sequences."]}),"\n",(0,s.jsx)(n.h3,{id:"-do-use-counter_initval-for-professional-appearance",children:"\u2705 DO: Use COUNTER_INITVAL for Professional Appearance"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Start invoices at 10000:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"COUNTER_INITVAL = 10000\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"}),' First invoice = "INV-25-010000" (looks established)']}),"\n",(0,s.jsx)(n.h3,{id:"-do-test-counter-with-concurrent-requests",children:"\u2705 DO: Test Counter with Concurrent Requests"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Simulate concurrent creation:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Terminal 1\ncurl -X POST /api/v4/core/ORD -d \'{"XORD01":"Order A"}\'\n\n# Terminal 2 (immediately after)\ncurl -X POST /api/v4/core/ORD -d \'{"XORD01":"Order B"}\'\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Verify:"})," No duplicate XORD01 values."]}),"\n",(0,s.jsx)(n.h3,{id:"-dont-use-counters-without-partitioning-for-multi-tenant",children:"\u274c DON'T: Use Counters Without Partitioning for Multi-Tenant"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Wrong:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "select": "XORD01",\n  "from": "TB_ANAG_ORD00"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem:"})," All tenants share same sequence \u2192 security/privacy issue."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Right:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "select": "XORD01",\n  "from": "TB_ANAG_ORD00",\n  "where": "XORD08 = \'%ambiente%\'"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," Separate sequence per tenant."]}),"\n",(0,s.jsx)(n.h3,{id:"-dont-change-counter_format-after-production-use",children:"\u274c DON'T: Change COUNTER_FORMAT After Production Use"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem:"})," Inconsistent formatting across records."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:'Before: "INV-25-00123"'}),"\n",(0,s.jsx)(n.li,{children:'After change: "2025-INV-123"'}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Result:"})," Mixed formats confuse users."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution:"})," Migrate all existing values or use new counter field."]}),"\n",(0,s.jsx)(n.h3,{id:"-dont-use-small-padding-for-high-volume-counters",children:"\u274c DON'T: Use Small Padding for High-Volume Counters"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Wrong:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pad|#NEXT#|3|0|LEFT  -- Max 999\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem:"})," Exceeds format after 999 records."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Right:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pad|#NEXT#|6|0|LEFT  -- Max 999,999\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Rule:"})," Estimate max records, add buffer (10-year volume \xd7 2)."]}),"\n",(0,s.jsx)(n.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,s.jsx)(n.h3,{id:"pitfall-1-forgetting-for-update-lock",children:"Pitfall 1: Forgetting FOR UPDATE Lock"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem:"})," Custom counter queries without FOR UPDATE \u2192 duplicates."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Wrong:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT MAX(XORD01) + 1 FROM TB_ANAG_ORD00;  -- No lock!\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Right:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT MAX(XORD01) + 1 FROM TB_ANAG_ORD00 FOR UPDATE;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"pitfall-2-using-session-variables-in-counter_format",children:"Pitfall 2: Using Session Variables in COUNTER_FORMAT"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem:"})," Session variable not available at format time."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Wrong:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pad|%codice_sede%|3|0|LEFT  -- % prefix only works in COUNTER_SQL where clause\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Right:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"pad|@codice_sede@|3|0|LEFT  -- @ prefix for session variables in format\n"})}),"\n",(0,s.jsx)(n.h3,{id:"pitfall-3-not-testing-year-rollover",children:"Pitfall 3: Not Testing Year Rollover"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem:"})," Year-partitioned counter breaks at year boundary."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Test:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Manually set CDATA to December 31, 2024\nUPDATE TB_ANAG_ORD00 SET CDATA = '20241231235959' WHERE ORD_ID = 1;\n\n-- Create order (should reset counter for 2025)\nPOST /api/v4/core/ORD {...}\n\n-- Verify counter = 1 for 2025\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Counter Management"})," provides:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Business-friendly IDs"}),' - "INV-2025-00123" instead of "123"']}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Flexible formatting"})," - Templates with year, padding, prefixes"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Logical partitioning"})," - Per year, store, category, etc."]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Concurrency safety"})," - FOR UPDATE locking prevents duplicates"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Database abstraction"})," - Works with MySQL and Oracle"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Metadata-driven"})," - Configure in TB_COUNTER, no code changes"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Insight:"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Counters are the ",(0,s.jsx)(n.strong,{children:"ID beautification layer"})," - transforming technical auto-increment into human-meaningful, formatted, partitioned business identifiers. Define format once in TB_COUNTER, benefit everywhere."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Congratulations!"})," You've completed all 12 Core Concepts. You now understand the foundational architecture of Q01 Core APIs. Ready to start using them? Head to ",(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/api-operations/",children:"API Operations"})," to learn how to query and manipulate data."]})]})}function h(e={}){const{wrapper:n}={...(0,i.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},2172:(e,n,r)=>{r.d(n,{I:()=>c,M:()=>t});var s=r(1504);const i={},l=s.createContext(i);function t(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);