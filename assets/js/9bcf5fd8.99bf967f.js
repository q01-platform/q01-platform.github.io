"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[4024],{1620:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>d,toc:()=>a});var s=i(7624),r=i(2172);const l={title:"Relational Queries",sidebar_label:"Relational Queries",sidebar_position:7,description:"Joining data across dimensions with TB_OBJECT views"},t="Relational Queries",d={id:"products/map.q01.io/core-api-platform-v4/query-patterns/relational-queries",title:"Relational Queries",description:"Joining data across dimensions with TB_OBJECT views",source:"@site/docs/products/map.q01.io/core-api-platform-v4/03-query-patterns/relational-queries.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/03-query-patterns",slug:"/products/map.q01.io/core-api-platform-v4/query-patterns/relational-queries",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/relational-queries",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"Relational Queries",sidebar_label:"Relational Queries",sidebar_position:7,description:"Joining data across dimensions with TB_OBJECT views"},sidebar:"mapSidebar",previous:{title:"TREC Filtering",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/trec-filtering"},next:{title:"Aggregations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/aggregations"}},o={},a=[{value:"Overview",id:"overview",level:2},{value:"TB_OBJECT Views",id:"tb_object-views",level:2},{value:"View Definition",id:"view-definition",level:3},{value:"Example View",id:"example-view",level:3},{value:"Common Join Patterns",id:"common-join-patterns",level:2},{value:"Pattern 1: Left Join (One-to-One)",id:"pattern-1-left-join-one-to-one",level:3},{value:"Pattern 2: Multiple Joins",id:"pattern-2-multiple-joins",level:3},{value:"Pattern 3: Nested Subquery",id:"pattern-3-nested-subquery",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Indexed Joins",id:"indexed-joins",level:3},{value:"View Materialization",id:"view-materialization",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"relational-queries",children:"Relational Queries"}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Relational queries retrieve data from multiple dimensions using ",(0,s.jsx)(n.strong,{children:"TB_OBJECT"})," views. These views define SQL SELECT statements that join related tables."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Concepts:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"TB_OBJECT defines SQL views with joins"}),"\n",(0,s.jsx)(n.li,{children:"Core APIs execute view queries automatically"}),"\n",(0,s.jsx)(n.li,{children:"Views appear as read-only dimensions"}),"\n",(0,s.jsx)(n.li,{children:"Optimize complex joins and aggregations"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"tb_object-views",children:"TB_OBJECT Views"}),"\n",(0,s.jsx)(n.h3,{id:"view-definition",children:"View Definition"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"TB_OBJECT Structure:"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Purpose"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"NAME_OBJ"}),(0,s.jsx)(n.td,{children:"View/table name"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"V_PRODUCTS_WITH_CATEGORY"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"COD_DIM"}),(0,s.jsx)(n.td,{children:"Associated dimension"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PRD"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TYPE_OBJ"}),(0,s.jsx)(n.td,{children:"0=table, 1=view, 2=select"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"1"})," (view)"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"VIEW_SCHEMA"}),(0,s.jsx)(n.td,{children:"SQL SELECT statement"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SELECT p.*, c.NAME..."})})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"example-view",children:"Example View"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Products with Category Name:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_OBJECT (\n  NAME_OBJ,\n  COD_DIM,\n  TYPE_OBJ,\n  VIEW_SCHEMA\n) VALUES (\n  'V_PRODUCTS_CATEGORY',\n  'PRD',\n  1,\n  'SELECT p.PRD_ID, p.XPRD01, p.XPRD02, p.XPRD05,\n          c.XCAT01 as CATEGORY_NAME\n   FROM TB_ANAG_PRD00 p\n   LEFT JOIN TB_ANAG_CAT00 c ON p.XPRD05 = c.CAT_ID\n   WHERE p.TREC != ''C'''\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Query the view:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"GET /api/v4/core/PRD?source=productListWithCategory\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response includes joined data:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "data": [\n    {\n      "PRD_ID": 123,\n      "XPRD01": "Widget Pro",\n      "XPRD02": 49.99,\n      "XPRD05": "cat_elec",\n      "CATEGORY_NAME": "Electronics"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"common-join-patterns",children:"Common Join Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"pattern-1-left-join-one-to-one",children:"Pattern 1: Left Join (One-to-One)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Product with Supplier:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"VIEW_SCHEMA:\nSELECT p.*, s.XSUP01 as SUPPLIER_NAME, s.XSUP02 as SUPPLIER_EMAIL\nFROM TB_ANAG_PRD00 p\nLEFT JOIN TB_ANAG_SUP00 s ON p.XPRD32 = s.SUP_ID\nWHERE p.TREC != 'C'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"pattern-2-multiple-joins",children:"Pattern 2: Multiple Joins"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Order with Customer and Items:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"VIEW_SCHEMA:\nSELECT o.ORD_ID, o.XORD01, o.XORD02,\n       c.XCLI01 as CUSTOMER_NAME,\n       COUNT(i.ORDITEM_ID) as ITEM_COUNT,\n       SUM(i.XORDITEM07) as ORDER_TOTAL\nFROM TB_ANAG_ORD00 o\nLEFT JOIN TB_ANAG_CLI00 c ON o.XORD09 = c.CLI_ID\nLEFT JOIN TB_ANAG_ORDITEM00 i ON o.ORD_ID = i.XORDITEM01\nWHERE o.TREC != 'C'\nGROUP BY o.ORD_ID, o.XORD01, o.XORD02, c.XCLI01\n"})}),"\n",(0,s.jsx)(n.h3,{id:"pattern-3-nested-subquery",children:"Pattern 3: Nested Subquery"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Products with Stock Level:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"VIEW_SCHEMA:\nSELECT p.*,\n       (SELECT SUM(XSTK_QUANTITY)\n        FROM TB_ANAG_STK00\n        WHERE XSTK_PRODUCT_ID = p.PRD_ID) as TOTAL_STOCK\nFROM TB_ANAG_PRD00 p\nWHERE p.TREC != 'C'\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"indexed-joins",children:"Indexed Joins"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u2705 Good - Join on indexed fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"LEFT JOIN TB_ANAG_CAT00 c ON p.XPRD05 = c.CAT_ID\n-- Both fields are primary/foreign keys (indexed)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u274c Slow - Join on non-indexed fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"LEFT JOIN TB_ANAG_CAT00 c ON p.XPRD39 = c.XCAT_NAME\n-- String comparison without index\n"})}),"\n",(0,s.jsx)(n.h3,{id:"view-materialization",children:"View Materialization"}),"\n",(0,s.jsx)(n.p,{children:"For frequently accessed complex views, consider:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Database materialized views"}),"\n",(0,s.jsx)(n.li,{children:"Caching layer"}),"\n",(0,s.jsx)(n.li,{children:"Pre-computed aggregations"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Join on indexed fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"ON p.XPRD33 = c.CAT_ID\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Include TREC filter:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"WHERE p.TREC != 'C' AND c.TREC != 'C'\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use LEFT JOIN for optional relationships:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"LEFT JOIN TB_ANAG_SUP00 s ON p.XPRD34 = s.SUP_ID\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't join on text fields:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Slow\nON p.XPRD01 = c.XCAT01\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't create views without indexes:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Missing index on XPRD_CATEGORY\nON p.XPRD_CATEGORY = c.XCAT01\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Use TB_OBJECT to define SQL views"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Views enable complex joins without application code"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Always join on indexed fields"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Include TREC filtering in view definition"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Views are read-only (no POST/PUT/DELETE)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Next:"})," ",(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/aggregations",children:"Aggregations \u2192"})]}),"\n",(0,s.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/map-framework",children:"MAP Framework"})," - TB_OBJECT structure"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/dimensions",children:"Dimensions"})," - View dimensions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/query-performance",children:"Query Performance"})," - Join optimization"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},2172:(e,n,i)=>{i.d(n,{I:()=>d,M:()=>t});var s=i(1504);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);