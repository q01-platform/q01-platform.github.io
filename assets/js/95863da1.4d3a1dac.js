"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[2996],{2012:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>c});var r=s(7624),a=s(2172);const t={title:"Cascade Operations",sidebar_label:"Cascade Operations",sidebar_position:8,description:"Automatic propagation of operations to related records"},i="Cascade Operations",d={id:"products/map.q01.io/core-api-platform-v4/write-patterns/cascade-operations",title:"Cascade Operations",description:"Automatic propagation of operations to related records",source:"@site/docs/products/map.q01.io/core-api-platform-v4/04-write-patterns/cascade-operations.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/04-write-patterns",slug:"/products/map.q01.io/core-api-platform-v4/write-patterns/cascade-operations",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/cascade-operations",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Cascade Operations",sidebar_label:"Cascade Operations",sidebar_position:8,description:"Automatic propagation of operations to related records"},sidebar:"mapSidebar",previous:{title:"ACID Transactions",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/transactions"},next:{title:"Outbox Pattern",permalink:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/outbox-pattern"}},l={},c=[{value:"Overview",id:"overview",level:2},{value:"INSERT_CASCADE",id:"insert_cascade",level:2},{value:"Metadata Configuration",id:"metadata-configuration",level:3},{value:"Single Request Creates Multiple Records",id:"single-request-creates-multiple-records",level:3},{value:"Multi-Level Cascades",id:"multi-level-cascades",level:3},{value:"UPDATE_CASCADE",id:"update_cascade",level:2},{value:"Metadata Configuration",id:"metadata-configuration-1",level:3},{value:"Propagates Updates Automatically",id:"propagates-updates-automatically",level:3},{value:"Conditional Cascades",id:"conditional-cascades",level:3},{value:"DELETE_CASCADE",id:"delete_cascade",level:2},{value:"Metadata Configuration",id:"metadata-configuration-2",level:3},{value:"Soft Delete Cascade",id:"soft-delete-cascade",level:3},{value:"Force Delete Cascade",id:"force-delete-cascade",level:3},{value:"Common Cascade Patterns",id:"common-cascade-patterns",level:2},{value:"Pattern 1: Master-Detail (1)",id:"pattern-1-master-detail-1",level:3},{value:"Pattern 2: Parent-Child Hierarchy",id:"pattern-2-parent-child-hierarchy",level:3},{value:"Pattern 3: Denormalized Fields",id:"pattern-3-denormalized-fields",level:3},{value:"Pattern 4: Multi-Level Hierarchy",id:"pattern-4-multi-level-hierarchy",level:3},{value:"JavaScript Examples",id:"javascript-examples",level:2},{value:"Create with Cascades",id:"create-with-cascades",level:3},{value:"Update with Cascades",id:"update-with-cascades",level:3},{value:"Delete with Cascades",id:"delete-with-cascades",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Cascade Performance",id:"cascade-performance",level:3},{value:"Indexing for Cascades",id:"indexing-for-cascades",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"cascade-operations",children:"Cascade Operations"}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cascade operations"})," automatically propagate create, update, and delete operations to related records. This is achieved through metadata-driven configuration in TB_COST, eliminating the need for application code to manage relationships."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Cascade Types:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"INSERT_CASCADE"})," - Create related records on POST"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"UPDATE_CASCADE"})," - Update related records on PUT/PATCH"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"DELETE_CASCADE"})," - Delete related records on DELETE"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Single API call creates master + detail records"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Maintains referential integrity automatically"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Reduces N+1 query problems"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Metadata-driven (no application code)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Transactional (ACID guarantees)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"insert_cascade",children:"INSERT_CASCADE"}),"\n",(0,r.jsx)(n.h3,{id:"metadata-configuration",children:"Metadata Configuration"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"TB_COST.INSERT_CASCADE defines automatic record creation:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- When order is created, also create order items\nINSERT INTO TB_COST (\n    COD_DIM,\n    NUM_COST,\n    COD_VAR,\n    INSERT_CASCADE,\n    DESCRIZIONE_COST\n) VALUES (\n    'ORD',  -- Source dimension (Order)\n    10,     -- Field position\n    'items', -- JSON field name\n    'ORDITEM:XORDITEM_ORDER_ID',  -- Target: Dimension:ForeignKeyField\n    'Order items'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Format:"})," ",(0,r.jsx)(n.code,{children:"TargetDimension:ForeignKeyField"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TargetDimension"}),": Dimension to create (ORDITEM)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ForeignKeyField"}),": Field that links back to parent (XORDITEM_ORDER_ID)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"single-request-creates-multiple-records",children:"Single Request Creates Multiple Records"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/ORD\n{\n  "data": {\n    "XORD01": "ORD-2025-001",\n    "XORD_CUSTOMER_ID": "cust_123",\n    "XORD03": 299.97,\n    "items": [\n      {\n        "XORDITEM10": "prd_1",\n        "XORDITEM_QTY": 2,\n        "XORDITEM09": 99.99\n      },\n      {\n        "XORDITEM10": "prd_2",\n        "XORDITEM_QTY": 1,\n        "XORDITEM09": 99.99\n      }\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Generated SQL (single transaction):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"BEGIN TRANSACTION;\n\n-- 1. Insert order\nINSERT INTO TB_ANAG_ORD00 (\n    ORD_ID, XORD01, XORD_CUSTOMER_ID, XORD03,\n    TREC, CDATA, OWNER\n) VALUES (\n    123, 'ORD-2025-001', 'cust_123', 299.97,\n    'N', '20251219160000', 'user@example.com'\n);\n\n-- 2. Insert order item 1 (cascade)\nINSERT INTO TB_ANAG_ORDITEM00 (\n    ORDITEM_ID, XORDITEM_ORDER_ID, XORDITEM10,\n    XORDITEM_QTY, XORDITEM09,\n    TREC, CDATA, OWNER\n) VALUES (\n    UUID(), 123, 'prd_1',\n    2, 99.99,\n    'N', '20251219160000', 'user@example.com'\n);\n\n-- 3. Insert order item 2 (cascade)\nINSERT INTO TB_ANAG_ORDITEM00 (\n    ORDITEM_ID, XORDITEM_ORDER_ID, XORDITEM10,\n    XORDITEM_QTY, XORDITEM09,\n    TREC, CDATA, OWNER\n) VALUES (\n    UUID(), 123, 'prd_2',\n    1, 99.99,\n    'N', '20251219160000', 'user@example.com'\n);\n\n-- 4. Insert outbox event\nINSERT INTO OUTBOX (...) VALUES (...);\n\nCOMMIT;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Response:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "data": {\n    "ORD_ID": 123,\n    "XORD01": "ORD-2025-001",\n    "XORD03": 299.97,\n    "items": [\n      {\n        "ORDITEM_ID": "uuid-1",\n        "XORDITEM_ORDER_ID": 123,\n        "XORDITEM10": "prd_1",\n        "XORDITEM_QTY": 2\n      },\n      {\n        "ORDITEM_ID": "uuid-2",\n        "XORDITEM_ORDER_ID": 123,\n        "XORDITEM10": "prd_2",\n        "XORDITEM_QTY": 1\n      }\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"multi-level-cascades",children:"Multi-Level Cascades"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Cascades can be nested:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Level 1: Order \u2192 Items\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, INSERT_CASCADE)\nVALUES ('ORD', 10, 'items', 'ORDITEM:XORDITEM_ORDER_ID');\n\n-- Level 2: Items \u2192 Item Options\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, INSERT_CASCADE)\nVALUES ('ORDITEM', 5, 'options', 'ORDITEMOPT:XOPT_ITEM_ID');\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'POST /api/v4/core/ORD\n{\n  "data": {\n    "XORD01": "ORD-2025-001",\n    "items": [\n      {\n        "XORDITEM10": "prd_1",\n        "XORDITEM_QTY": 2,\n        "options": [\n          { "XOPT_NAME": "Color", "XOPT_VALUE": "Red" },\n          { "XOPT_NAME": "Size", "XOPT_VALUE": "L" }\n        ]\n      }\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Result:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"1 order created"}),"\n",(0,r.jsx)(n.li,{children:"1 item created"}),"\n",(0,r.jsx)(n.li,{children:"2 item options created"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"update_cascade",children:"UPDATE_CASCADE"}),"\n",(0,r.jsx)(n.h3,{id:"metadata-configuration-1",children:"Metadata Configuration"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"TB_COST.UPDATE_CASCADE defines automatic propagation:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- When product name changes, update all order items\nINSERT INTO TB_COST (\n    COD_DIM,\n    NUM_COST,\n    COD_VAR,\n    UPDATE_CASCADE,\n    DESCRIZIONE_COST\n) VALUES (\n    'PRD',  -- Source dimension\n    1,      -- Field position\n    'XPRD01',  -- Source field (product name)\n    'ORDITEM:XORDITEM_PRODUCT_NAME',  -- Target: Dimension:FieldToUpdate\n    'Product name'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Format:"})," ",(0,r.jsx)(n.code,{children:"TargetDimension:FieldToUpdate"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TargetDimension"}),": Dimension to update (ORDITEM)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FieldToUpdate"}),": Field that should receive new value (XORDITEM_PRODUCT_NAME)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"propagates-updates-automatically",children:"Propagates Updates Automatically"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'PATCH /api/v4/core/PRD/123\n{\n  "data": {\n    "XPRD01": "Widget Pro V2"  // Name changed\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Generated SQL (single transaction):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"BEGIN TRANSACTION;\n\n-- 1. Update product\nUPDATE TB_ANAG_PRD00\nSET XPRD01 = 'Widget Pro V2',\n    TREC = 'M',\n    LDATA = '20251219160000',\n    LOWNER = 'admin@example.com'\nWHERE PRD_ID = 123;\n\n-- 2. Update all related order items (cascade)\nUPDATE TB_ANAG_ORDITEM00\nSET XORDITEM_PRODUCT_NAME = 'Widget Pro V2',\n    TREC = 'M',\n    LDATA = '20251219160000',\n    LOWNER = 'admin@example.com'\nWHERE XORDITEM10 = 123;\n\n-- 3. Insert outbox events\nINSERT INTO OUTBOX (...) VALUES (...);\n\nCOMMIT;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,r.jsx)(n.strong,{children:"Caution:"})," UPDATE_CASCADE affects ALL related records. Use carefully for fields like price (you may NOT want to update historical orders)."]}),"\n",(0,r.jsx)(n.h3,{id:"conditional-cascades",children:"Conditional Cascades"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Only cascade to active records:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Only update active order items (not completed orders)\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, UPDATE_CASCADE)\nVALUES ('PRD', 1, 'XPRD01', 'ORDITEM:XORDITEM_PRODUCT_NAME:WHERE XORDITEM_STATUS=''pending''');\n"})}),"\n",(0,r.jsx)(n.h2,{id:"delete_cascade",children:"DELETE_CASCADE"}),"\n",(0,r.jsx)(n.h3,{id:"metadata-configuration-2",children:"Metadata Configuration"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"TB_COST.DELETE_CASCADE defines automatic deletion:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- When order is deleted, also delete order items\nINSERT INTO TB_COST (\n    COD_DIM,\n    NUM_COST,\n    COD_VAR,\n    DELETE_CASCADE,\n    DESCRIZIONE_COST\n) VALUES (\n    'ORD',  -- Source dimension\n    10,     -- Field position\n    'items',  -- Relationship name\n    'ORDITEM:XORDITEM_ORDER_ID:soft',  -- Target:ForeignKey:Mode\n    'Order items'\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Format:"})," ",(0,r.jsx)(n.code,{children:"TargetDimension:ForeignKeyField:Mode"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"TargetDimension"}),": Dimension to delete from (ORDITEM)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ForeignKeyField"}),": Field linking to parent (XORDITEM_ORDER_ID)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Mode"}),": ",(0,r.jsx)(n.code,{children:"soft"})," (TREC='C') or ",(0,r.jsx)(n.code,{children:"force"})," (physical delete)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"soft-delete-cascade",children:"Soft Delete Cascade"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"DELETE /api/v4/core/ORD/123\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Generated SQL (soft delete):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"BEGIN TRANSACTION;\n\n-- 1. Soft delete order\nUPDATE TB_ANAG_ORD00\nSET TREC = 'C',\n    LDATA = '20251219160000',\n    LOWNER = 'admin@example.com'\nWHERE ORD_ID = 123;\n\n-- 2. Soft delete all order items (cascade)\nUPDATE TB_ANAG_ORDITEM00\nSET TREC = 'C',\n    LDATA = '20251219160000',\n    LOWNER = 'admin@example.com'\nWHERE XORDITEM_ORDER_ID = 123;\n\n-- 3. Insert outbox events\nINSERT INTO OUTBOX (...) VALUES (...);\n\nCOMMIT;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"force-delete-cascade",children:"Force Delete Cascade"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"DELETE /api/v4/core/ORD/123?force=true\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Generated SQL (force delete):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"BEGIN TRANSACTION;\n\n-- 1. Force delete all order items (cascade)\nDELETE FROM TB_ANAG_ORDITEM00\nWHERE XORDITEM_ORDER_ID = 123;\n\n-- 2. Force delete order\nDELETE FROM TB_ANAG_ORD00\nWHERE ORD_ID = 123;\n\n-- 3. Insert outbox events\nINSERT INTO OUTBOX (...) VALUES (...);\n\nCOMMIT;\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," Cascade deletes happen BEFORE parent delete to satisfy foreign key constraints."]}),"\n",(0,r.jsx)(n.h2,{id:"common-cascade-patterns",children:"Common Cascade Patterns"}),"\n",(0,r.jsxs)(n.h3,{id:"pattern-1-master-detail-1",children:["Pattern 1: Master-Detail (1",":N",")"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Order \u2192 Order Items:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, COD_VAR, INSERT_CASCADE, UPDATE_CASCADE, DELETE_CASCADE)\nVALUES ('ORD', 'items',\n    'ORDITEM:XORDITEM_ORDER_ID',      -- Create items with order\n    NULL,                              -- No update cascade needed\n    'ORDITEM:XORDITEM_ORDER_ID:soft'  -- Soft delete items with order\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pattern-2-parent-child-hierarchy",children:"Pattern 2: Parent-Child Hierarchy"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Category \u2192 Subcategories:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (COD_DIM, COD_VAR, INSERT_CASCADE, DELETE_CASCADE)\nVALUES ('CAT', 'subcategories',\n    'CAT:XCAT_PARENT_ID',           -- Create subcategories\n    'CAT:XCAT_PARENT_ID:soft'       -- Soft delete subcategories\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pattern-3-denormalized-fields",children:"Pattern 3: Denormalized Fields"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Product Name in Order Items:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Propagate product name changes to order items\nINSERT INTO TB_COST (COD_DIM, NUM_COST, COD_VAR, UPDATE_CASCADE)\nVALUES ('PRD', 1, 'XPRD01', 'ORDITEM:XORDITEM_PRODUCT_NAME');\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,r.jsx)(n.strong,{children:"Use carefully:"})," Only cascade updates for reference data, not transactional data."]}),"\n",(0,r.jsx)(n.h3,{id:"pattern-4-multi-level-hierarchy",children:"Pattern 4: Multi-Level Hierarchy"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Project \u2192 Tasks \u2192 Subtasks:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Level 1: Project \u2192 Tasks\nINSERT INTO TB_COST (COD_DIM, COD_VAR, INSERT_CASCADE, DELETE_CASCADE)\nVALUES ('PROJECT', 'tasks',\n    'TASK:XTASK_PROJECT_ID',\n    'TASK:XTASK_PROJECT_ID:soft'\n);\n\n-- Level 2: Task \u2192 Subtasks\nINSERT INTO TB_COST (COD_DIM, COD_VAR, INSERT_CASCADE, DELETE_CASCADE)\nVALUES ('TASK', 'subtasks',\n    'SUBTASK:XSUBTASK_TASK_ID',\n    'SUBTASK:XSUBTASK_TASK_ID:soft'\n);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"javascript-examples",children:"JavaScript Examples"}),"\n",(0,r.jsx)(n.h3,{id:"create-with-cascades",children:"Create with Cascades"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"async function createOrderWithItems(orderData, items) {\n  const response = await fetch(`${apiBase}/api/v4/core/ORD`, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      data: {\n        ...orderData,\n        items: items  // Cascade creates order items\n      }\n    })\n  });\n\n  const result = await response.json();\n  console.log('Order created:', result.data.ORD_ID);\n  console.log('Items created:', result.data.items.length);\n\n  return result;\n}\n\n// Usage\nawait createOrderWithItems(\n  {\n    XORD_CUSTOMER_ID: 'cust_123',\n    XORD03: 299.97\n  },\n  [\n    { XORDITEM10: 'prd_1', XORDITEM_QTY: 2, XORDITEM09: 99.99 },\n    { XORDITEM10: 'prd_2', XORDITEM_QTY: 1, XORDITEM09: 99.99 }\n  ]\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"update-with-cascades",children:"Update with Cascades"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"async function updateProductName(productId, newName) {\n  // Update propagates to all order items automatically\n  const response = await fetch(`${apiBase}/api/v4/core/PRD/${productId}`, {\n    method: 'PATCH',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      data: { XPRD01: newName }\n    })\n  });\n\n  const result = await response.json();\n  console.log('Product updated:', result.data.PRD_ID);\n  // Cascade updates happen automatically in transaction\n\n  return result;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"delete-with-cascades",children:"Delete with Cascades"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"async function deleteOrderWithItems(orderId) {\n  // Soft delete cascades to all items automatically\n  const response = await fetch(`${apiBase}/api/v4/core/ORD/${orderId}`, {\n    method: 'DELETE',\n    headers: { 'Authorization': `Bearer ${token}` }\n  });\n\n  const result = await response.json();\n  console.log('Order soft deleted:', orderId);\n  // All items also soft deleted (TREC='C')\n\n  return result;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use INSERT_CASCADE for master-detail:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - single request creates order + items\nINSERT INTO TB_COST (COD_DIM, COD_VAR, INSERT_CASCADE)\nVALUES ('ORD', 'items', 'ORDITEM:XORDITEM_ORDER_ID');\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use soft DELETE_CASCADE by default:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - reversible\nDELETE_CASCADE = 'ORDITEM:XORDITEM_ORDER_ID:soft'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Be selective with UPDATE_CASCADE:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - only reference data\nUPDATE_CASCADE = 'ORDITEM:XORDITEM_PRODUCT_NAME'  -- Product name\n"})}),"\n",(0,r.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Don't cascade updates for transactional fields:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - changes historical orders\nUPDATE_CASCADE = 'ORDITEM:XORDITEM09'  -- Product price\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Don't use force DELETE_CASCADE without reason:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - irreversible\nDELETE_CASCADE = 'ORDITEM:XORDITEM_ORDER_ID:force'\n\n-- \u2705 Good - soft delete first\nDELETE_CASCADE = 'ORDITEM:XORDITEM_ORDER_ID:soft'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Don't create circular cascades:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - infinite loop\n-- Order cascades to Items, Items cascade back to Order\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"cascade-performance",children:"Cascade Performance"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Large cascades impact transaction time:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Order with 1 item:    ~10ms\nOrder with 10 items:  ~50ms\nOrder with 100 items: ~500ms\nOrder with 1000 items: ~5s\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Optimization strategies:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Batch inserts when possible"}),"\n",(0,r.jsx)(n.li,{children:"Use database batch operations"}),"\n",(0,r.jsx)(n.li,{children:"Consider async processing for large cascades"}),"\n",(0,r.jsx)(n.li,{children:"Monitor transaction duration"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"indexing-for-cascades",children:"Indexing for Cascades"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Index foreign key fields:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - fast cascade lookups\nCREATE INDEX idx_orditem_order_id ON TB_ANAG_ORDITEM00(XORDITEM_ORDER_ID);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 INSERT_CASCADE creates related records automatically"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 UPDATE_CASCADE propagates changes to related records"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 DELETE_CASCADE deletes related records (soft or force)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Metadata-driven via TB_COST configuration"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Transactional (ACID guarantees)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Single API call for complex operations"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Reduces N+1 query problems"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Cascades are metadata-driven (no application code)"}),"\n",(0,r.jsx)(n.li,{children:"All cascade operations are transactional"}),"\n",(0,r.jsxs)(n.li,{children:["INSERT_CASCADE: ",(0,r.jsx)(n.code,{children:"TargetDimension:ForeignKeyField"})]}),"\n",(0,r.jsxs)(n.li,{children:["UPDATE_CASCADE: ",(0,r.jsx)(n.code,{children:"TargetDimension:FieldToUpdate"})]}),"\n",(0,r.jsxs)(n.li,{children:["DELETE_CASCADE: ",(0,r.jsx)(n.code,{children:"TargetDimension:ForeignKeyField:Mode"})]}),"\n",(0,r.jsx)(n.li,{children:"Soft delete cascade is default (reversible)"}),"\n",(0,r.jsx)(n.li,{children:"Be selective with UPDATE_CASCADE (avoid transactional fields)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Cascade Types:"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Cascade"}),(0,r.jsx)(n.th,{children:"Format"}),(0,r.jsx)(n.th,{children:"Example"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"INSERT"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"DIM:FK"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ORDITEM:XORDITEM_ORDER_ID"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"UPDATE"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"DIM:FIELD"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ORDITEM:XORDITEM_PRODUCT_NAME"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"DELETE"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"DIM:FK:MODE"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ORDITEM:XORDITEM_ORDER_ID:soft"})})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Next:"})," ",(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/outbox-pattern",children:"Outbox Pattern \u2192"})]}),"\n",(0,r.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/create-operations",children:"Create Operations"})," - INSERT_CASCADE"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/update-operations",children:"Update Operations"})," - UPDATE_CASCADE"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/delete-operations",children:"Delete Operations"})," - DELETE_CASCADE"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/transactions",children:"Transactions"})," - ACID guarantees"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},2172:(e,n,s)=>{s.d(n,{I:()=>d,M:()=>i});var r=s(1504);const a={},t=r.createContext(a);function i(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);