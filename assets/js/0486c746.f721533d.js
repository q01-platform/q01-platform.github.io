"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[6216],{6364:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>E,frontMatter:()=>r,metadata:()=>a,toc:()=>o});var i=t(7624),d=t(2172);const r={title:"Audit Trail",sidebar_label:"Audit Trail",sidebar_position:7,description:"Complete tracking of user operations for compliance and debugging"},s="Audit Trail",a={id:"products/map.q01.io/core-api-platform-v4/security/audit-trail",title:"Audit Trail",description:"Complete tracking of user operations for compliance and debugging",source:"@site/docs/products/map.q01.io/core-api-platform-v4/05-security/audit-trail.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/05-security",slug:"/products/map.q01.io/core-api-platform-v4/security/audit-trail",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/audit-trail",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"Audit Trail",sidebar_label:"Audit Trail",sidebar_position:7,description:"Complete tracking of user operations for compliance and debugging"},sidebar:"mapSidebar",previous:{title:"Rate Limiting",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/rate-limiting"},next:{title:"Security Checklist",permalink:"/docs/products/map.q01.io/core-api-platform-v4/security/security-checklist"}},l={},o=[{value:"Overview",id:"overview",level:2},{value:"Automatic Audit Fields",id:"automatic-audit-fields",level:2},{value:"Standard Audit Fields",id:"standard-audit-fields",level:3},{value:"Audit Field Population",id:"audit-field-population",level:3},{value:"Create (POST)",id:"create-post",level:4},{value:"Update (PUT/PATCH)",id:"update-putpatch",level:4},{value:"Delete (Soft)",id:"delete-soft",level:4},{value:"CoreWrite Audit Implementation",id:"corewrite-audit-implementation",level:2},{value:"Automatic Audit Injection",id:"automatic-audit-injection",level:3},{value:"Querying Audit Information",id:"querying-audit-information",level:2},{value:"Who Created a Record?",id:"who-created-a-record",level:3},{value:"Who Modified a Record?",id:"who-modified-a-record",level:3},{value:"Records Created by User",id:"records-created-by-user",level:3},{value:"Records Updated Recently",id:"records-updated-recently",level:3},{value:"Deleted Records",id:"deleted-records",level:3},{value:"Outbox Event Audit",id:"outbox-event-audit",level:2},{value:"Complete Operation Log",id:"complete-operation-log",level:3},{value:"Query Operation History",id:"query-operation-history",level:3},{value:"Audit Dashboard Example",id:"audit-dashboard-example",level:2},{value:"User Activity Dashboard",id:"user-activity-dashboard",level:3},{value:"Compliance Requirements",id:"compliance-requirements",level:2},{value:"GDPR Compliance",id:"gdpr-compliance",level:3},{value:"SOX Compliance",id:"sox-compliance",level:3},{value:"HIPAA Compliance",id:"hipaa-compliance",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"audit-trail",children:"Audit Trail"}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["Q01 Core APIs automatically maintain a ",(0,i.jsx)(n.strong,{children:"complete audit trail"})," of all operations for compliance, debugging, and accountability. Every record includes who created it, who modified it, and when these actions occurred."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Complete accountability (who did what, when)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Compliance with regulations (GDPR, SOX, HIPAA)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Debugging and troubleshooting"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Security investigation"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Change history tracking"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Automatic (no manual logging needed)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Audit Information Tracked:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"User identity (who)"}),"\n",(0,i.jsx)(n.li,{children:"Operation type (what - create/update/delete)"}),"\n",(0,i.jsx)(n.li,{children:"Timestamp (when)"}),"\n",(0,i.jsx)(n.li,{children:"Record affected (which)"}),"\n",(0,i.jsx)(n.li,{children:"IP address and user agent (where/how)"}),"\n",(0,i.jsx)(n.li,{children:"Payload (what changed)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"automatic-audit-fields",children:"Automatic Audit Fields"}),"\n",(0,i.jsx)(n.h3,{id:"standard-audit-fields",children:"Standard Audit Fields"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Every dimension table includes audit fields:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE TB_ANAG_PRD00 (\n    PRD_ID VARCHAR(36) PRIMARY KEY,\n\n    -- Business fields\n    XPRD01 VARCHAR(255),\n    XPRD02 DECIMAL(10,2),\n\n    -- Context fields\n    PRD_SOURCE VARCHAR(50),\n    PRD_CENTRO_DETT VARCHAR(50),\n    PRD_PESO VARCHAR(1),\n    PRD_AMBIENTE VARCHAR(20),\n    TREC VARCHAR(1),\n\n    -- \u2b50 Audit fields (automatic)\n    CREATED_BY VARCHAR(255),          -- Who created\n    CREATED_AT VARCHAR(14),            -- When created (YYYYMMDDHHmmss)\n    UPDATED_BY VARCHAR(255),           -- Who last updated\n    UPDATED_AT VARCHAR(14),            -- When last updated\n    DELETED_BY VARCHAR(255),           -- Who deleted (soft delete)\n    DELETED_AT VARCHAR(14),            -- When deleted\n\n    INDEX idx_created_by (CREATED_BY),\n    INDEX idx_updated_by (UPDATED_BY),\n    INDEX idx_created_at (CREATED_AT),\n    INDEX idx_updated_at (UPDATED_AT)\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"audit-field-population",children:"Audit Field Population"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Automatically set on every operation:"})}),"\n",(0,i.jsx)(n.h4,{id:"create-post",children:"Create (POST)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_ANAG_PRD00 (\n    PRD_ID,\n    XPRD01,\n    XPRD02,\n    CREATED_BY,              -- \u2b50 From JWT token\n    CREATED_AT,              -- \u2b50 Current timestamp\n    UPDATED_BY,              -- \u2b50 Same as CREATED_BY\n    UPDATED_AT               -- \u2b50 Same as CREATED_AT\n) VALUES (\n    'uuid-...',\n    'Widget Pro',\n    99.99,\n    'user@example.com',      -- From session\n    '20251219160000',        -- YYYYMMDDHHmmss\n    'user@example.com',\n    '20251219160000'\n);\n"})}),"\n",(0,i.jsx)(n.h4,{id:"update-putpatch",children:"Update (PUT/PATCH)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"UPDATE TB_ANAG_PRD00\nSET XPRD02 = 89.99,\n    UPDATED_BY = 'admin@example.com',  -- \u2b50 From JWT token\n    UPDATED_AT = '20251219170000',      -- \u2b50 Current timestamp\n    TREC = 'M'\nWHERE PRD_ID = 'uuid-...';\n\n-- CREATED_BY and CREATED_AT unchanged (original creator preserved)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"delete-soft",children:"Delete (Soft)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"UPDATE TB_ANAG_PRD00\nSET TREC = 'C',\n    DELETED_BY = 'admin@example.com',  -- \u2b50 From JWT token\n    DELETED_AT = '20251219180000',      -- \u2b50 Current timestamp\n    UPDATED_BY = 'admin@example.com',   -- Also updated\n    UPDATED_AT = '20251219180000'\nWHERE PRD_ID = 'uuid-...';\n"})}),"\n",(0,i.jsx)(n.h2,{id:"corewrite-audit-implementation",children:"CoreWrite Audit Implementation"}),"\n",(0,i.jsx)(n.h3,{id:"automatic-audit-injection",children:"Automatic Audit Injection"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"DataStore.php handles audit fields:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"// DataStore.php\npublic function insert(string $dimension, array $data): array {\n    $sessionContext = $this->getSessionContext();\n    $userId = $sessionContext['user_id'];\n    $timestamp = date('YmdHis');\n\n    // \u2b50 Inject audit fields automatically\n    $data['CREATED_BY'] = $userId;\n    $data['CREATED_AT'] = $timestamp;\n    $data['UPDATED_BY'] = $userId;\n    $data['UPDATED_AT'] = $timestamp;\n\n    // Also inject context fields\n    $data[\"{$dimension}_SOURCE\"] = $sessionContext['source'];\n    $data[\"{$dimension}_CENTRO_DETT\"] = $sessionContext['centro_dett'];\n    $data[\"{$dimension}_PESO\"] = $sessionContext['peso'];\n    $data[\"{$dimension}_AMBIENTE\"] = $sessionContext['ambiente'];\n    $data['TREC'] = 'N';\n\n    return $this->executeInsert($dimension, $data);\n}\n\npublic function update(string $dimension, string $id, array $data): array {\n    $sessionContext = $this->getSessionContext();\n    $userId = $sessionContext['user_id'];\n    $timestamp = date('YmdHis');\n\n    // \u2b50 Update audit fields\n    $data['UPDATED_BY'] = $userId;\n    $data['UPDATED_AT'] = $timestamp;\n    $data['TREC'] = 'M';\n\n    // CREATED_BY and CREATED_AT NOT modified\n\n    return $this->executeUpdate($dimension, $id, $data);\n}\n\npublic function delete(string $dimension, string $id, bool $force = false): array {\n    $sessionContext = $this->getSessionContext();\n    $userId = $sessionContext['user_id'];\n    $timestamp = date('YmdHis');\n\n    if ($force) {\n        // Force delete - no audit fields (record deleted)\n        return $this->executePhysicalDelete($dimension, $id);\n    }\n\n    // Soft delete - set audit fields\n    $data = [\n        'TREC' => 'C',\n        'DELETED_BY' => $userId,\n        'DELETED_AT' => $timestamp,\n        'UPDATED_BY' => $userId,\n        'UPDATED_AT' => $timestamp\n    ];\n\n    return $this->executeUpdate($dimension, $id, $data);\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"querying-audit-information",children:"Querying Audit Information"}),"\n",(0,i.jsx)(n.h3,{id:"who-created-a-record",children:"Who Created a Record?"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT CREATED_BY, CREATED_AT, XPRD01\nFROM TB_ANAG_PRD00\nWHERE PRD_ID = '123';\n\n-- Result:\n-- CREATED_BY: user@example.com\n-- CREATED_AT: 20251219160000\n-- XPRD01: Widget Pro\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"JavaScript:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"async function getRecordAudit(dimension, id) {\n  const response = await fetch(\n    `${apiBase}/api/v4/core/${dimension}/${id}`,\n    {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    }\n  );\n\n  const result = await response.json();\n\n  return {\n    createdBy: result.data.CREATED_BY,\n    createdAt: parseTimestamp(result.data.CREATED_AT),\n    updatedBy: result.data.UPDATED_BY,\n    updatedAt: parseTimestamp(result.data.UPDATED_AT)\n  };\n}\n\nfunction parseTimestamp(timestamp) {\n  // YYYYMMDDHHmmss \u2192 Date\n  const year = timestamp.substr(0, 4);\n  const month = timestamp.substr(4, 2) - 1;\n  const day = timestamp.substr(6, 2);\n  const hour = timestamp.substr(8, 2);\n  const minute = timestamp.substr(10, 2);\n  const second = timestamp.substr(12, 2);\n\n  return new Date(year, month, day, hour, minute, second);\n}\n\n// Usage\nconst audit = await getRecordAudit('PRD', '123');\nconsole.log(`Created by ${audit.createdBy} on ${audit.createdAt}`);\nconsole.log(`Last updated by ${audit.updatedBy} on ${audit.updatedAt}`);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"who-modified-a-record",children:"Who Modified a Record?"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT UPDATED_BY, UPDATED_AT, CREATED_BY, CREATED_AT\nFROM TB_ANAG_PRD00\nWHERE PRD_ID = '123';\n\n-- Result shows both creator and last updater\n"})}),"\n",(0,i.jsx)(n.h3,{id:"records-created-by-user",children:"Records Created by User"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT PRD_ID, XPRD01, CREATED_AT\nFROM TB_ANAG_PRD00\nWHERE CREATED_BY = 'user@example.com'\n  AND PRD_SOURCE = 'productManagement'\n  AND TREC != 'C'\nORDER BY CREATED_AT DESC;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"records-updated-recently",children:"Records Updated Recently"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT PRD_ID, XPRD01, UPDATED_BY, UPDATED_AT\nFROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'productManagement'\n  AND UPDATED_AT >= '20251219000000'  -- Today\n  AND TREC = 'M'\nORDER BY UPDATED_AT DESC;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"deleted-records",children:"Deleted Records"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT PRD_ID, XPRD01, DELETED_BY, DELETED_AT\nFROM TB_ANAG_PRD00\nWHERE PRD_SOURCE = 'productManagement'\n  AND TREC = 'C'\n  AND DELETED_AT >= '20251219000000'  -- Today\nORDER BY DELETED_AT DESC;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"outbox-event-audit",children:"Outbox Event Audit"}),"\n",(0,i.jsx)(n.h3,{id:"complete-operation-log",children:"Complete Operation Log"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"OUTBOX table provides detailed event log:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE OUTBOX (\n    OUTBOX_ID VARCHAR(36) PRIMARY KEY,\n    EVENT_TYPE VARCHAR(100) NOT NULL,     -- ProductCreated, OrderUpdated, etc.\n    AGGREGATE_ID VARCHAR(36) NOT NULL,    -- Record ID\n    AGGREGATE_TYPE VARCHAR(10) NOT NULL,  -- Dimension (PRD, ORD, etc.)\n    OPERATION VARCHAR(10) NOT NULL,       -- POST, PUT, PATCH, DELETE\n    PAYLOAD TEXT NOT NULL,                -- Full record data (JSON)\n    METADATA TEXT,                        -- Session context\n    USER VARCHAR(255),                    -- \u2b50 Who performed operation\n    CREATED_AT VARCHAR(14) NOT NULL,      -- \u2b50 When operation occurred\n    PUBLISHED_AT VARCHAR(14),\n    STATUS VARCHAR(20),\n\n    INDEX idx_outbox_user (USER),\n    INDEX idx_outbox_created_at (CREATED_AT),\n    INDEX idx_outbox_aggregate (AGGREGATE_TYPE, AGGREGATE_ID)\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"query-operation-history",children:"Query Operation History"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"All operations on a record:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT OUTBOX_ID, EVENT_TYPE, OPERATION, USER, CREATED_AT\nFROM OUTBOX\nWHERE AGGREGATE_TYPE = 'PRD'\n  AND AGGREGATE_ID = '123'\nORDER BY CREATED_AT ASC;\n\n-- Result:\n-- ProductCreated   POST   user@example.com   20251219160000\n-- ProductUpdated   PATCH  admin@example.com  20251219170000\n-- ProductDeleted   DELETE admin@example.com  20251219180000\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"All operations by user:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT AGGREGATE_TYPE, AGGREGATE_ID, EVENT_TYPE, CREATED_AT\nFROM OUTBOX\nWHERE USER = 'admin@example.com'\n  AND CREATED_AT >= '20251219000000'  -- Today\nORDER BY CREATED_AT DESC\nLIMIT 100;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Operations by type:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- All delete operations today\nSELECT AGGREGATE_TYPE, AGGREGATE_ID, USER, CREATED_AT\nFROM OUTBOX\nWHERE OPERATION = 'DELETE'\n  AND CREATED_AT >= '20251219000000'\nORDER BY CREATED_AT DESC;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"audit-dashboard-example",children:"Audit Dashboard Example"}),"\n",(0,i.jsx)(n.h3,{id:"user-activity-dashboard",children:"User Activity Dashboard"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"class AuditDashboard {\n  async getUserActivity(userId, startDate, endDate) {\n    // Query OUTBOX for user's operations\n    const response = await fetch(\n      `${apiBase}/api/v4/audit/users/${userId}?` +\n      `start=${startDate}&end=${endDate}`,\n      {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }\n    );\n\n    const data = await response.json();\n\n    return {\n      totalOperations: data.total,\n      creates: data.operations.filter(op => op.OPERATION === 'POST').length,\n      updates: data.operations.filter(op => op.OPERATION === 'PATCH').length,\n      deletes: data.operations.filter(op => op.OPERATION === 'DELETE').length,\n      operations: data.operations\n    };\n  }\n\n  async getRecordHistory(dimension, recordId) {\n    const response = await fetch(\n      `${apiBase}/api/v4/audit/records/${dimension}/${recordId}`,\n      {\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      }\n    );\n\n    const data = await response.json();\n\n    return data.history.map(event => ({\n      timestamp: parseTimestamp(event.CREATED_AT),\n      user: event.USER,\n      operation: event.OPERATION,\n      changes: JSON.parse(event.PAYLOAD)\n    }));\n  }\n\n  renderActivity(activity) {\n    return `\n      <div class=\"audit-summary\">\n        <h3>User Activity</h3>\n        <p>Total Operations: ${activity.totalOperations}</p>\n        <ul>\n          <li>Creates: ${activity.creates}</li>\n          <li>Updates: ${activity.updates}</li>\n          <li>Deletes: ${activity.deletes}</li>\n        </ul>\n      </div>\n\n      <table>\n        <tr>\n          <th>Timestamp</th>\n          <th>Operation</th>\n          <th>Type</th>\n          <th>Record</th>\n        </tr>\n        ${activity.operations.map(op => `\n          <tr>\n            <td>${parseTimestamp(op.CREATED_AT).toLocaleString()}</td>\n            <td>${op.OPERATION}</td>\n            <td>${op.AGGREGATE_TYPE}</td>\n            <td>${op.AGGREGATE_ID}</td>\n          </tr>\n        `).join('')}\n      </table>\n    `;\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"compliance-requirements",children:"Compliance Requirements"}),"\n",(0,i.jsx)(n.h3,{id:"gdpr-compliance",children:"GDPR Compliance"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Right to be forgotten:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Remove user's personal data from audit fields\nUPDATE TB_ANAG_PRD00\nSET CREATED_BY = 'deleted-user',\n    UPDATED_BY = CASE WHEN UPDATED_BY = 'user@example.com' THEN 'deleted-user' ELSE UPDATED_BY END\nWHERE CREATED_BY = 'user@example.com';\n\n-- Also update OUTBOX\nUPDATE OUTBOX\nSET USER = 'deleted-user'\nWHERE USER = 'user@example.com';\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Data access request:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Export all operations by user\nSELECT *\nFROM OUTBOX\nWHERE USER = 'user@example.com'\nORDER BY CREATED_AT DESC;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"sox-compliance",children:"SOX Compliance"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Audit trail requirements:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Who performed operation (CREATED_BY, UPDATED_BY)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 When operation occurred (CREATED_AT, UPDATED_AT)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 What changed (OUTBOX PAYLOAD)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Cannot be modified (OUTBOX is append-only)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Complete history (all operations logged)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"hipaa-compliance",children:"HIPAA Compliance"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Access logging:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Log all access to sensitive records\nINSERT INTO ACCESS_LOG (\n    USER, RESOURCE_TYPE, RESOURCE_ID, ACTION, TIMESTAMP\n) VALUES (\n    'doctor@hospital.com', 'PATIENT', '123', 'READ', '20251219160000'\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Trust automatic audit fields:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - audit fields handled automatically\nawait createProduct({ XPRD01: 'Widget' });\n// CREATED_BY, CREATED_AT set automatically\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Query audit fields for debugging:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - investigate who changed record\nSELECT UPDATED_BY, UPDATED_AT, XPRD02\nFROM TB_ANAG_PRD00\nWHERE PRD_ID = '123';\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Use OUTBOX for complete history:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - full operation history\nSELECT * FROM OUTBOX\nWHERE AGGREGATE_TYPE = 'PRD'\n  AND AGGREGATE_ID = '123'\nORDER BY CREATED_AT ASC;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Preserve audit trail on delete:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - soft delete preserves audit\nDELETE /api/v4/core/PRD/123\n-- Sets DELETED_BY, DELETED_AT, TREC='C'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't try to override audit fields:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - audit fields are read-only\nawait createProduct({\n  XPRD01: 'Widget',\n  CREATED_BY: 'other@example.com'  // Validation error!\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't force delete unnecessarily:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u274c Bad - destroys audit trail\nDELETE /api/v4/core/PRD/123?force=true\n# Record physically deleted, no DELETED_BY/DELETED_AT\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't modify OUTBOX:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - OUTBOX is append-only\nUPDATE OUTBOX SET USER = 'anonymous' WHERE ...;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Don't store sensitive data in OUTBOX:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"// \u26a0\ufe0f Caution - OUTBOX stores full payload\nawait createUser({\n  username: 'user@example.com',\n  password: 'plaintext'  // Don't do this!\n});\n// Password in OUTBOX forever\n"})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Automatic audit fields (CREATED_BY, UPDATED_BY, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Every operation tracked with user and timestamp"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 OUTBOX provides complete operation history"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Audit fields read-only (cannot be overridden)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Soft delete preserves audit trail"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Compliance with GDPR, SOX, HIPAA"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Query audit history for debugging and investigation"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"All records include audit fields automatically"}),"\n",(0,i.jsx)(n.li,{children:"Audit fields populated from JWT token (user_id)"}),"\n",(0,i.jsx)(n.li,{children:"Cannot override or modify audit fields"}),"\n",(0,i.jsx)(n.li,{children:"Soft delete preserves audit trail"}),"\n",(0,i.jsx)(n.li,{children:"OUTBOX provides complete operation history"}),"\n",(0,i.jsx)(n.li,{children:"Query audit fields for investigation"}),"\n",(0,i.jsx)(n.li,{children:"Comply with regulatory requirements"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Audit Fields:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field"}),(0,i.jsx)(n.th,{children:"Purpose"}),(0,i.jsx)(n.th,{children:"Set On"}),(0,i.jsx)(n.th,{children:"Modified On"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CREATED_BY"}),(0,i.jsx)(n.td,{children:"Who created"}),(0,i.jsx)(n.td,{children:"POST"}),(0,i.jsx)(n.td,{children:"Never"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CREATED_AT"}),(0,i.jsx)(n.td,{children:"When created"}),(0,i.jsx)(n.td,{children:"POST"}),(0,i.jsx)(n.td,{children:"Never"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"UPDATED_BY"}),(0,i.jsx)(n.td,{children:"Who last updated"}),(0,i.jsx)(n.td,{children:"POST, PUT, PATCH, DELETE"}),(0,i.jsx)(n.td,{children:"PUT, PATCH, DELETE"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"UPDATED_AT"}),(0,i.jsx)(n.td,{children:"When last updated"}),(0,i.jsx)(n.td,{children:"POST, PUT, PATCH, DELETE"}),(0,i.jsx)(n.td,{children:"PUT, PATCH, DELETE"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DELETED_BY"}),(0,i.jsx)(n.td,{children:"Who deleted"}),(0,i.jsx)(n.td,{children:"DELETE (soft)"}),(0,i.jsx)(n.td,{children:"Never"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DELETED_AT"}),(0,i.jsx)(n.td,{children:"When deleted"}),(0,i.jsx)(n.td,{children:"DELETE (soft)"}),(0,i.jsx)(n.td,{children:"Never"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Audit Query Examples:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"-- Who created record?\nSELECT CREATED_BY FROM TB_ANAG_PRD00 WHERE PRD_ID = '123';\n\n-- When was record last updated?\nSELECT UPDATED_BY, UPDATED_AT FROM TB_ANAG_PRD00 WHERE PRD_ID = '123';\n\n-- Complete operation history\nSELECT * FROM OUTBOX WHERE AGGREGATE_TYPE = 'PRD' AND AGGREGATE_ID = '123';\n"})}),"\n",(0,i.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security",children:"Security Overview"})," - Multi-level security"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/security/authentication",children:"Authentication"})," - JWT tokens with user_id"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/delete-operations",children:"Delete Operations"})," - Soft vs force delete"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/write-patterns/outbox-pattern",children:"Outbox Pattern"})," - Event sourcing"]}),"\n"]})]})}function E(e={}){const{wrapper:n}={...(0,d.M)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},2172:(e,n,t)=>{t.d(n,{I:()=>a,M:()=>s});var i=t(1504);const d={},r=i.createContext(d);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);