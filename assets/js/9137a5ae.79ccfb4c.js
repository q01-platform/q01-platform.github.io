"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[7596],{2280:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>l});var s=i(7624),r=i(2172);const o={title:"Performance Optimization",sidebar_label:"Performance Optimization",sidebar_position:6,description:"Query tuning, indexing, and performance best practices"},a="Performance Optimization",t={id:"products/map.q01.io/core-api-platform-v4/advanced-topics/performance-optimization",title:"Performance Optimization",description:"Query tuning, indexing, and performance best practices",source:"@site/docs/products/map.q01.io/core-api-platform-v4/06-advanced-topics/performance-optimization.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/06-advanced-topics",slug:"/products/map.q01.io/core-api-platform-v4/advanced-topics/performance-optimization",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/performance-optimization",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Performance Optimization",sidebar_label:"Performance Optimization",sidebar_position:6,description:"Query tuning, indexing, and performance best practices"},sidebar:"mapSidebar",previous:{title:"Caching Strategies",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/caching-strategies"},next:{title:"Webhook Integration",permalink:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/webhook-integration"}},c={},l=[{value:"Overview",id:"overview",level:2},{value:"Query Optimization",id:"query-optimization",level:2},{value:"Use EXPLAIN to Analyze Queries",id:"use-explain-to-analyze-queries",level:3},{value:"Select Only Required Fields",id:"select-only-required-fields",level:3},{value:"Use Indexed Fields in WHERE Clauses",id:"use-indexed-fields-in-where-clauses",level:3},{value:"Avoid SELECT DISTINCT When Possible",id:"avoid-select-distinct-when-possible",level:3},{value:"Database Indexing",id:"database-indexing",level:2},{value:"Strategic Index Design",id:"strategic-index-design",level:3},{value:"Index Best Practices",id:"index-best-practices",level:3},{value:"Monitor Index Usage",id:"monitor-index-usage",level:3},{value:"Pagination Best Practices",id:"pagination-best-practices",level:2},{value:"Keyset Pagination (Recommended)",id:"keyset-pagination-recommended",level:3},{value:"Avoid Large Offsets",id:"avoid-large-offsets",level:3},{value:"N+1 Query Prevention",id:"n1-query-prevention",level:2},{value:"Problem: Query Explosion",id:"problem-query-explosion",level:3},{value:"Solution: Batch Requests",id:"solution-batch-requests",level:3},{value:"Use Field Expansion",id:"use-field-expansion",level:3},{value:"Connection Pooling",id:"connection-pooling",level:2},{value:"Configure Connection Pools",id:"configure-connection-pools",level:3},{value:"Connection Pool Sizing",id:"connection-pool-sizing",level:3},{value:"Query Result Caching",id:"query-result-caching",level:2},{value:"Application-Level Caching",id:"application-level-caching",level:3},{value:"Database Query Cache",id:"database-query-cache",level:3},{value:"Monitoring and Profiling",id:"monitoring-and-profiling",level:2},{value:"Enable Slow Query Log",id:"enable-slow-query-log",level:3},{value:"API Response Time Monitoring",id:"api-response-time-monitoring",level:3},{value:"Database Profiling",id:"database-profiling",level:3},{value:"Performance Checklist",id:"performance-checklist",level:2},{value:"\u2705 DO:",id:"-do",level:3},{value:"\u274c DON&#39;T:",id:"-dont",level:3},{value:"Summary",id:"summary",level:2},{value:"Related Concepts",id:"related-concepts",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Q01 Core APIs performance depends on ",(0,s.jsx)(n.strong,{children:"query optimization"}),", ",(0,s.jsx)(n.strong,{children:"proper indexing"}),", ",(0,s.jsx)(n.strong,{children:"connection management"}),", and ",(0,s.jsx)(n.strong,{children:"caching strategies"}),". This guide covers techniques to maximize throughput and minimize latency."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Areas:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Query Optimization"})," - Efficient SQL patterns"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database Indexing"})," - Strategic index design"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Connection Pooling"})," - Resource management"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"N+1 Query Prevention"})," - Avoiding query explosions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pagination"})," - Efficient large dataset handling"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitoring"})," - Performance metrics and profiling"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Faster response times (reduced latency)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Higher throughput (more requests/second)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Lower database load (reduced CPU/IO)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Better user experience"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Cost savings (fewer resources needed)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"query-optimization",children:"Query Optimization"}),"\n",(0,s.jsx)(n.h3,{id:"use-explain-to-analyze-queries",children:"Use EXPLAIN to Analyze Queries"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Identify slow queries:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- MySQL\nEXPLAIN SELECT * FROM TB_ANAG_PRD00\nWHERE XPRD05 = 'electronics'\nAND XPRD06 = 'Y'\nLIMIT 10;\n\n-- Look for:\n-- - type: ALL (bad - full table scan)\n-- - type: ref/index (good - using index)\n-- - Extra: Using filesort (bad - sorting without index)\n-- - Extra: Using temporary (bad - temporary table)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example output:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"+----+-------------+----------------+------+---------------+------+---------+------+-------+-------------+\n| id | select_type | table          | type | possible_keys | key  | key_len | ref  | rows  | Extra       |\n+----+-------------+----------------+------+---------------+------+---------+------+-------+-------------+\n|  1 | SIMPLE      | TB_ANAG_PRD00  | ALL  | NULL          | NULL | NULL    | NULL | 50000 | Using where |\n+----+-------------+----------------+------+---------------+------+---------+------+-------+-------------+\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u274c Problem"}),": Full table scan (type=ALL) scanning 50,000 rows"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u2705 Solution"}),": Add composite index on ",(0,s.jsx)(n.code,{children:"(XPRD05, XPRD06)"})]}),"\n",(0,s.jsx)(n.h3,{id:"select-only-required-fields",children:"Select Only Required Fields"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u274c Bad - fetches all 50 fields\ncurl "https://api.q01.io/api/v4/core/products?limit=100"\n\n# \u2705 Good - fetches only 5 fields\ncurl "https://api.q01.io/api/v4/core/products?limit=100&fields=PRD_ID,XPRD01,XPRD02,XPRD03,XPRD05"\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Performance impact:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Reduced network transfer (5x smaller payload)"}),"\n",(0,s.jsx)(n.li,{children:"Faster serialization (less data to encode)"}),"\n",(0,s.jsx)(n.li,{children:"Lower memory usage (smaller result set)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"use-indexed-fields-in-where-clauses",children:"Use Indexed Fields in WHERE Clauses"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - function on indexed column\nSELECT * FROM TB_ANAG_PRD00\nWHERE UPPER(XPRD03) = 'ABC123';\n\n-- \u2705 Good - direct comparison\nSELECT * FROM TB_ANAG_PRD00\nWHERE XPRD03 = 'ABC123';\n\n-- \u274c Bad - leading wildcard\nSELECT * FROM TB_ANAG_PRD00\nWHERE XPRD01 LIKE '%widget%';\n\n-- \u2705 Good - prefix search\nSELECT * FROM TB_ANAG_PRD00\nWHERE XPRD01 LIKE 'widget%';\n"})}),"\n",(0,s.jsx)(n.h3,{id:"avoid-select-distinct-when-possible",children:"Avoid SELECT DISTINCT When Possible"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - DISTINCT forces sorting\nSELECT DISTINCT XPRD05 FROM TB_ANAG_PRD00;\n\n-- \u2705 Good - GROUP BY with index\nSELECT XPRD05 FROM TB_ANAG_PRD00\nGROUP BY XPRD05;\n\n-- \u2705 Better - use dimension relationships\nSELECT CAT_ID, XCAT01 FROM TB_ANAG_CAT00;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"database-indexing",children:"Database Indexing"}),"\n",(0,s.jsx)(n.h3,{id:"strategic-index-design",children:"Strategic Index Design"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Single-column indexes:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- High cardinality columns (many unique values)\nCREATE INDEX idx_prd_code ON TB_ANAG_PRD00(XPRD03);\nCREATE INDEX idx_prd_created ON TB_ANAG_PRD00(CREATED_AT);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Composite indexes:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Most selective column first\nCREATE INDEX idx_prd_category_active\nON TB_ANAG_PRD00(XPRD05, XPRD06);\n\n-- Order matters: (category, active) \u2260 (active, category)\n-- Good for: WHERE XPRD05 = 'electronics'\n-- Good for: WHERE XPRD05 = 'electronics' AND XPRD06 = 'Y'\n-- Bad for:  WHERE XPRD06 = 'Y' (doesn't use index)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Covering indexes:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Include frequently accessed columns\nCREATE INDEX idx_prd_category_active_name\nON TB_ANAG_PRD00(XPRD05, XPRD06, XPRD01);\n\n-- Query can be satisfied entirely from index (no table lookup)\nSELECT XPRD01 FROM TB_ANAG_PRD00\nWHERE XPRD05 = 'electronics' AND XPRD06 = 'Y';\n"})}),"\n",(0,s.jsx)(n.h3,{id:"index-best-practices",children:"Index Best Practices"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u2705 DO index:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Primary keys (automatic in most databases)"}),"\n",(0,s.jsx)(n.li,{children:"Foreign keys for JOIN operations"}),"\n",(0,s.jsx)(n.li,{children:"Fields used in WHERE clauses"}),"\n",(0,s.jsx)(n.li,{children:"Fields used in ORDER BY"}),"\n",(0,s.jsx)(n.li,{children:"Fields used in GROUP BY"}),"\n",(0,s.jsx)(n.li,{children:"High cardinality columns"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u274c DON'T index:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Low cardinality columns (e.g., TREC with only 4 values)"}),"\n",(0,s.jsx)(n.li,{children:"Frequently updated columns (index maintenance overhead)"}),"\n",(0,s.jsx)(n.li,{children:"Small tables (<1000 rows)"}),"\n",(0,s.jsx)(n.li,{children:"Columns with many NULL values"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"monitor-index-usage",children:"Monitor Index Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- MySQL: Show unused indexes\nSELECT\n  t.TABLE_NAME,\n  s.INDEX_NAME,\n  s.CARDINALITY\nFROM information_schema.TABLES t\nLEFT JOIN information_schema.STATISTICS s\n  ON t.TABLE_NAME = s.TABLE_NAME\nWHERE t.TABLE_SCHEMA = 'q01_data'\n  AND s.INDEX_NAME NOT IN ('PRIMARY')\nORDER BY s.CARDINALITY DESC;\n\n-- Check index usage statistics\nSHOW INDEX FROM TB_ANAG_PRD00;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"pagination-best-practices",children:"Pagination Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"keyset-pagination-recommended",children:"Keyset Pagination (Recommended)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u2705 Good - cursor-based pagination\n# First page\ncurl "https://api.q01.io/api/v4/core/products?limit=50&order_by=PRD_ID"\n\n# Response includes last ID: {"last_id": 1050, "data": [...]}\n\n# Next page\ncurl "https://api.q01.io/api/v4/core/products?limit=50&order_by=PRD_ID&after=1050"\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"SQL implementation:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- First page\nSELECT * FROM TB_ANAG_PRD00\nWHERE TREC = 'N'\nORDER BY PRD_ID ASC\nLIMIT 50;\n\n-- Next page\nSELECT * FROM TB_ANAG_PRD00\nWHERE TREC = 'N'\nAND PRD_ID > 1050\nORDER BY PRD_ID ASC\nLIMIT 50;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Consistent performance regardless of offset"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 No skipped/duplicate records"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Works with real-time data changes"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"avoid-large-offsets",children:"Avoid Large Offsets"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - scans and discards 1M rows\nSELECT * FROM TB_ANAG_PRD00\nORDER BY PRD_ID\nLIMIT 50 OFFSET 1000000;\n\n-- \u2705 Good - uses keyset pagination\nSELECT * FROM TB_ANAG_PRD00\nWHERE PRD_ID > 1000050\nORDER BY PRD_ID\nLIMIT 50;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Performance comparison:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"OFFSET 0: ~10ms"}),"\n",(0,s.jsx)(n.li,{children:"OFFSET 10000: ~100ms"}),"\n",(0,s.jsx)(n.li,{children:"OFFSET 100000: ~1000ms"}),"\n",(0,s.jsx)(n.li,{children:"OFFSET 1000000: ~10000ms (10 seconds!)"}),"\n",(0,s.jsx)(n.li,{children:"Keyset: ~10ms (constant time)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"n1-query-prevention",children:"N+1 Query Prevention"}),"\n",(0,s.jsx)(n.h3,{id:"problem-query-explosion",children:"Problem: Query Explosion"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u274c Bad - N+1 queries\nasync function getProductsWithCategories() {\n  // 1 query\n  const products = await api.get('/api/v4/core/products?limit=100');\n\n  // 100 queries!\n  for (const product of products.data) {\n    product.category = await api.get(`/api/v4/core/categories/${product.XPRD05}`);\n  }\n\n  return products;\n}\n// Total: 101 queries (1 + 100)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"solution-batch-requests",children:"Solution: Batch Requests"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - 2 queries total\nasync function getProductsWithCategories() {\n  // 1 query\n  const products = await api.get('/api/v4/core/products?limit=100');\n\n  // 1 query with IN clause\n  const categoryIds = [...new Set(products.data.map(p => p.XPRD05))];\n  const categories = await api.get(\n    `/api/v4/core/categories?filters=CAT_ID:in:${categoryIds.join(',')}`\n  );\n\n  // Map in memory\n  const categoryMap = Object.fromEntries(\n    categories.data.map(c => [c.CAT_ID, c])\n  );\n\n  products.data.forEach(p => {\n    p.category = categoryMap[p.XPRD05];\n  });\n\n  return products;\n}\n// Total: 2 queries (1 + 1)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"use-field-expansion",children:"Use Field Expansion"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u2705 Best - single query with expansion\ncurl "https://api.q01.io/api/v4/core/products?limit=100&expand=XPRD05"\n\n# Response includes expanded category data\n{\n  "data": [\n    {\n      "PRD_ID": 123,\n      "XPRD01": "Widget",\n      "XPRD05": 5,\n      "_expanded": {\n        "XPRD05": {\n          "CAT_ID": 5,\n          "XCAT01": "Electronics",\n          "XCAT02": "Electronic goods"\n        }\n      }\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,s.jsx)(n.h3,{id:"configure-connection-pools",children:"Configure Connection Pools"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"PHP (PDO):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'class DatabasePool {\n    private static $pool = [];\n    private const MAX_CONNECTIONS = 20;\n    private const MIN_CONNECTIONS = 5;\n\n    public static function getConnection(): PDO {\n        // Reuse idle connection\n        if (!empty(self::$pool)) {\n            return array_pop(self::$pool);\n        }\n\n        // Create new connection\n        return new PDO(\n            "mysql:host=db;dbname=q01_data",\n            "user",\n            "pass",\n            [\n                PDO::ATTR_PERSISTENT => true,\n                PDO::ATTR_TIMEOUT => 5,\n                PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8mb4"\n            ]\n        );\n    }\n\n    public static function releaseConnection(PDO $conn): void {\n        if (count(self::$pool) < self::MAX_CONNECTIONS) {\n            self::$pool[] = $conn;\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Node.js (mysql2):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const mysql = require('mysql2/promise');\n\nconst pool = mysql.createPool({\n  host: 'db',\n  user: 'user',\n  password: 'pass',\n  database: 'q01_data',\n  waitForConnections: true,\n  connectionLimit: 20,      // Max connections\n  maxIdle: 10,              // Max idle connections\n  idleTimeout: 60000,       // Close idle after 60s\n  queueLimit: 0,            // Unlimited queue\n  enableKeepAlive: true,\n  keepAliveInitialDelay: 0\n});\n\n// Usage\nasync function query(sql, params) {\n  const connection = await pool.getConnection();\n  try {\n    const [rows] = await connection.query(sql, params);\n    return rows;\n  } finally {\n    connection.release();  // Return to pool\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"connection-pool-sizing",children:"Connection Pool Sizing"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Formula"}),": ",(0,s.jsx)(n.code,{children:"connections = (core_count * 2) + effective_spindle_count"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"4 CPU cores"}),"\n",(0,s.jsx)(n.li,{children:"1 SSD (effectively unlimited spindles)"}),"\n",(0,s.jsxs)(n.li,{children:["Recommended: ",(0,s.jsx)(n.code,{children:"(4 * 2) + 1 = 9 connections"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Tuning:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Too few: Connection queueing, slow response"}),"\n",(0,s.jsx)(n.li,{children:"Too many: Memory overhead, context switching"}),"\n",(0,s.jsx)(n.li,{children:"Monitor: Connection usage, wait times, query queue"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"query-result-caching",children:"Query Result Caching"}),"\n",(0,s.jsx)(n.h3,{id:"application-level-caching",children:"Application-Level Caching"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const Redis = require('ioredis');\nconst redis = new Redis();\n\nclass CachedQuery {\n  async query(sql, params, ttl = 300) {\n    const cacheKey = `query:${this.hash(sql, params)}`;\n\n    // Check cache\n    const cached = await redis.get(cacheKey);\n    if (cached) {\n      console.log('Cache hit');\n      return JSON.parse(cached);\n    }\n\n    // Execute query\n    console.log('Cache miss');\n    const result = await db.query(sql, params);\n\n    // Store in cache\n    await redis.set(cacheKey, JSON.stringify(result), 'EX', ttl);\n\n    return result;\n  }\n\n  hash(sql, params) {\n    const crypto = require('crypto');\n    return crypto\n      .createHash('md5')\n      .update(sql + JSON.stringify(params))\n      .digest('hex');\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"database-query-cache",children:"Database Query Cache"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"MySQL Query Cache (Legacy):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Enable query cache (MySQL 5.7 and earlier)\nSET GLOBAL query_cache_type = 1;\nSET GLOBAL query_cache_size = 268435456; -- 256MB\n\n-- Check cache statistics\nSHOW STATUS LIKE 'Qcache%';\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Modern approach: Result set caching"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Use indexed materialized views\nCREATE TABLE product_stats_cache AS\nSELECT\n  XPRD05 as category_id,\n  COUNT(*) as product_count,\n  AVG(XPRD02) as avg_price,\n  MAX(UPDATED_AT) as last_updated\nFROM TB_ANAG_PRD00\nWHERE TREC = 'N'\nGROUP BY XPRD05;\n\n-- Add index\nCREATE INDEX idx_category ON product_stats_cache(category_id);\n\n-- Refresh periodically (via cron or trigger)\nTRUNCATE product_stats_cache;\nINSERT INTO product_stats_cache\nSELECT XPRD05, COUNT(*), AVG(XPRD02), MAX(UPDATED_AT)\nFROM TB_ANAG_PRD00 WHERE TREC = 'N' GROUP BY XPRD05;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"monitoring-and-profiling",children:"Monitoring and Profiling"}),"\n",(0,s.jsx)(n.h3,{id:"enable-slow-query-log",children:"Enable Slow Query Log"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"MySQL:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- Enable slow query log\nSET GLOBAL slow_query_log = 1;\nSET GLOBAL long_query_time = 1;  -- Log queries > 1 second\nSET GLOBAL slow_query_log_file = '/var/log/mysql/slow.log';\n\n-- Analyze slow queries\nSELECT\n  DIGEST_TEXT,\n  COUNT_STAR,\n  AVG_TIMER_WAIT / 1000000000 as avg_ms,\n  SUM_TIMER_WAIT / 1000000000 as total_ms\nFROM performance_schema.events_statements_summary_by_digest\nORDER BY SUM_TIMER_WAIT DESC\nLIMIT 10;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"api-response-time-monitoring",children:"API Response Time Monitoring"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"const promClient = require('prom-client');\n\n// Histogram for response times\nconst httpDuration = new promClient.Histogram({\n  name: 'http_request_duration_seconds',\n  help: 'HTTP request duration',\n  labelNames: ['method', 'route', 'status']\n});\n\n// Middleware\napp.use((req, res, next) => {\n  const timer = httpDuration.startTimer();\n\n  res.on('finish', () => {\n    timer({\n      method: req.method,\n      route: req.route?.path || req.path,\n      status: res.statusCode\n    });\n  });\n\n  next();\n});\n\n// Expose metrics\napp.get('/metrics', async (req, res) => {\n  res.set('Content-Type', promClient.register.contentType);\n  res.end(await promClient.register.metrics());\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"database-profiling",children:"Database Profiling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- MySQL: Profile a specific query\nSET profiling = 1;\n\nSELECT * FROM TB_ANAG_PRD00\nWHERE XPRD05 = 'electronics'\nAND XPRD06 = 'Y'\nLIMIT 10;\n\nSHOW PROFILE FOR QUERY 1;\n\n-- Output shows time breakdown:\n-- Sending data: 0.002s\n-- Executing: 0.001s\n-- Opening tables: 0.0003s\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-checklist",children:"Performance Checklist"}),"\n",(0,s.jsx)(n.h3,{id:"-do",children:"\u2705 DO:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Optimize queries:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - selective WHERE clause\nSELECT PRD_ID, XPRD01 FROM TB_ANAG_PRD00\nWHERE XPRD05 = 123 AND TREC = 'N'\nLIMIT 10;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use proper indexes:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u2705 Good - composite index\nCREATE INDEX idx_prd_category_trec ON TB_ANAG_PRD00(XPRD05, TREC);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Implement caching:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - cache with TTL\nawait cache.set(key, data, 300);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Monitor performance:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",children:"// \u2705 Good - track metrics\nconst timer = histogram.startTimer();\nawait processRequest();\ntimer();\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-dont",children:"\u274c DON'T:"}),"\n",(0,s.jsxs)(n.p,{children:["*",(0,s.jsxs)(n.em,{children:["Avoid SELECT ",(0,s.jsx)(n.em,{children:":"})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - fetches all columns\nSELECT * FROM TB_ANAG_PRD00;\n\n-- \u2705 Good - specific columns\nSELECT PRD_ID, XPRD01, XPRD02 FROM TB_ANAG_PRD00;\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Don't use functions on indexed columns:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - function prevents index usage\nWHERE UPPER(XPRD03) = 'ABC123'\n\n-- \u2705 Good - direct comparison\nWHERE XPRD03 = 'ABC123'\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Avoid large offsets:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"-- \u274c Bad - scans millions of rows\nLIMIT 50 OFFSET 1000000\n\n-- \u2705 Good - keyset pagination\nWHERE PRD_ID > 1000050 LIMIT 50\n"})}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Use EXPLAIN to analyze and optimize queries"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Create strategic indexes on frequently queried fields"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Implement keyset pagination for large datasets"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Prevent N+1 queries with batch requests"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Configure connection pooling appropriately"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Cache query results at application level"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Monitor slow queries and response times"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Select only required fields"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Key Takeaways:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Query optimization starts with proper indexing"}),"\n",(0,s.jsx)(n.li,{children:"Use EXPLAIN to identify performance bottlenecks"}),"\n",(0,s.jsx)(n.li,{children:"Keyset pagination outperforms offset-based pagination"}),"\n",(0,s.jsx)(n.li,{children:"Prevent N+1 queries with batching or expansion"}),"\n",(0,s.jsx)(n.li,{children:"Connection pooling prevents resource exhaustion"}),"\n",(0,s.jsx)(n.li,{children:"Cache query results with appropriate TTL"}),"\n",(0,s.jsx)(n.li,{children:"Monitor performance metrics continuously"}),"\n",(0,s.jsx)(n.li,{children:"Profile slow queries to identify optimization opportunities"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-concepts",children:"Related Concepts"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics/caching-strategies",children:"Caching Strategies"})," - Multi-layer caching"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/query-patterns/filtering",children:"Query Patterns"})," - Advanced filtering"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/advanced-topics",children:"Advanced Topics"})," - Overview"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},2172:(e,n,i)=>{i.d(n,{I:()=>t,M:()=>a});var s=i(1504);const r={},o=s.createContext(r);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);