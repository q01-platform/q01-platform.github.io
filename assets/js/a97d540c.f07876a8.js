"use strict";(self.webpackChunkq_01_docs=self.webpackChunkq_01_docs||[]).push([[4488],{6876:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>t,toc:()=>a});var r=s(7624),i=s(2172);const l={title:"Pre-Insert Functions",sidebar_label:"11. Pre-Insert Functions",sidebar_position:12,description:"Metadata-driven automatic field population during record creation"},c="Pre-Insert Functions",t={id:"products/map.q01.io/core-api-platform-v4/core-concepts/pre-insert-functions",title:"Pre-Insert Functions",description:"Metadata-driven automatic field population during record creation",source:"@site/docs/products/map.q01.io/core-api-platform-v4/01-core-concepts/pre-insert-functions.md",sourceDirName:"products/map.q01.io/core-api-platform-v4/01-core-concepts",slug:"/products/map.q01.io/core-api-platform-v4/core-concepts/pre-insert-functions",permalink:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/pre-insert-functions",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:12,frontMatter:{title:"Pre-Insert Functions",sidebar_label:"11. Pre-Insert Functions",sidebar_position:12,description:"Metadata-driven automatic field population during record creation"},sidebar:"mapSidebar",previous:{title:"10. Outbox Pattern",permalink:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/outbox-pattern"},next:{title:"12. Counter Management",permalink:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/counter-management"}},d={},a=[{value:"What Are Pre-Insert Functions?",id:"what-are-pre-insert-functions",level:2},{value:"Why Pre-Insert Functions Matter",id:"why-pre-insert-functions-matter",level:2},{value:"Manual Field Population (Without Functions)",id:"manual-field-population-without-functions",level:3},{value:"Pre-Insert Functions (Q01 Approach)",id:"pre-insert-functions-q01-approach",level:3},{value:"TB_COST Configuration",id:"tb_cost-configuration",level:2},{value:"FUNCTION Field Format",id:"function-field-format",level:3},{value:"Available Functions",id:"available-functions",level:2},{value:"1. uuid - Generate UUID",id:"1-uuid---generate-uuid",level:3},{value:"2. md5 - Hash Field Value",id:"2-md5---hash-field-value",level:3},{value:"3. sequence - Auto-Increment Field",id:"3-sequence---auto-increment-field",level:3},{value:"4. slugify - Create URL-Friendly Slug",id:"4-slugify---create-url-friendly-slug",level:3},{value:"5. current_user - Set Current User ID",id:"5-current_user---set-current-user-id",level:3},{value:"6. concat - Concatenate Fields",id:"6-concat---concatenate-fields",level:3},{value:"7. replace - Copy Field Value",id:"7-replace---copy-field-value",level:3},{value:"8. ifnull - Default Value If Empty",id:"8-ifnull---default-value-if-empty",level:3},{value:"Execution Flow",id:"execution-flow",level:2},{value:"CREATE Request Lifecycle",id:"create-request-lifecycle",level:3},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Example 1: Product with UUID and Slug",id:"example-1-product-with-uuid-and-slug",level:3},{value:"Example 2: Order Items with Sequence",id:"example-2-order-items-with-sequence",level:3},{value:"Example 3: User with Hashed Password",id:"example-3-user-with-hashed-password",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 DO: Use Pre-Insert Functions for Derived Values",id:"-do-use-pre-insert-functions-for-derived-values",level:3},{value:"\u2705 DO: Use uuid for Global Identifiers",id:"-do-use-uuid-for-global-identifiers",level:3},{value:"\u2705 DO: Use sequence for Partition-Scoped Sequences",id:"-do-use-sequence-for-partition-scoped-sequences",level:3},{value:"\u2705 DO: Use current_user for Audit Fields",id:"-do-use-current_user-for-audit-fields",level:3},{value:"\u274c DON&#39;T: Use md5 for Password Hashing (New Systems)",id:"-dont-use-md5-for-password-hashing-new-systems",level:3},{value:"\u274c DON&#39;T: Manually Override Pre-Insert Fields",id:"-dont-manually-override-pre-insert-fields",level:3},{value:"\u274c DON&#39;T: Combine Incompatible Functions",id:"-dont-combine-incompatible-functions",level:3},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"Pitfall 1: Expecting Client-Provided UUID to Persist",id:"pitfall-1-expecting-client-provided-uuid-to-persist",level:3},{value:"Pitfall 2: Using sequence Without Partition",id:"pitfall-2-using-sequence-without-partition",level:3},{value:"Pitfall 3: Slugifying Mutable Fields",id:"pitfall-3-slugifying-mutable-fields",level:3},{value:"Summary",id:"summary",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"pre-insert-functions",children:"Pre-Insert Functions"}),"\n",(0,r.jsx)(n.h2,{id:"what-are-pre-insert-functions",children:"What Are Pre-Insert Functions?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pre-insert functions"})," are metadata-configured operations that automatically populate field values during record creation (POST operations). Instead of requiring clients to provide every field value, CoreWrite executes functions defined in TB_COST metadata to generate values automatically."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Insight:"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Pre-insert functions eliminate boilerplate - UUIDs, timestamps, slugs, sequences, hashes, and user IDs are auto-populated based on TB_COST configuration. Clients send minimal data, CoreWrite enriches it before INSERT."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"why-pre-insert-functions-matter",children:"Why Pre-Insert Functions Matter"}),"\n",(0,r.jsx)(n.h3,{id:"manual-field-population-without-functions",children:"Manual Field Population (Without Functions)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Tedious client code:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// Client must generate UUID\nconst uuid = crypto.randomUUID();\n\n// Client must get current user\nconst userId = getCurrentUser();\n\n// Client must slugify title\nconst slug = slugify(productName);\n\n// Client must hash password\nconst passwordHash = md5(password);\n\n// POST request with all values\nawait fetch('/api/v4/core/PRD', {\n  method: 'POST',\n  body: JSON.stringify({\n    XPRD10: uuid,\n    XPRD01: 'Premium Widget',\n    XPRD11: slug,\n    OWNER: userId,\n    source: 'productCreate'\n  })\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Problems:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u274c Client logic duplication across platforms (web, mobile, desktop)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Inconsistent UUID formats, hash algorithms"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Security risk (client-side user ID manipulation)"}),"\n",(0,r.jsx)(n.li,{children:"\u274c Verbose request payloads"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"pre-insert-functions-q01-approach",children:"Pre-Insert Functions (Q01 Approach)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Clean client code:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// Client sends minimal data\nawait fetch('/api/v4/core/PRD', {\n  method: 'POST',\n  body: JSON.stringify({\n    XPRD01: 'Premium Widget',\n    source: 'productCreate'\n  })\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"CoreWrite automatically:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Generates UUID for XPRD10"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Creates slug from XPRD01"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Sets OWNER to authenticated user"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Populates timestamps, sequences, hashes"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Result:"})," Consistent, secure, minimal client code."]}),"\n",(0,r.jsx)(n.h2,{id:"tb_cost-configuration",children:"TB_COST Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"function-field-format",children:"FUNCTION Field Format"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Syntax:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"{action}|{functionName}|{arg1}|{arg2}|...\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Components:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"{action}"}),": ",(0,r.jsx)(n.code,{children:"BI"})," = Before Insert, ",(0,r.jsx)(n.code,{children:"PI"})," = Post Insert, ",(0,r.jsx)(n.code,{children:"BE"})," = Before Edit, etc."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"{functionName}"}),": Function to execute (uuid, md5, sequence, etc.)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"{args}"}),": Function-specific arguments (pipe-separated)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (\n  DIM_COD, COD_COST, DESC_COST, TIPO_CAMPO, COD_ON_OFF, FUNCTION, ...\n) VALUES (\n  'PRD', 'XPRD10', 'Product UUID', 'varchar(36)', 'L,D', 'BI|uuid|microtime', ...\n);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Interpretation:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"BI"}),": Execute before INSERT"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"uuid"}),": Generate UUID"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"microtime"}),": Use microtime as UUID component"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Reference:"})," ",(0,r.jsx)(n.code,{children:"DataStore.php:1433-1454"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:'private function getFunction($fields, $action) {\n    foreach ($fields as $codCost => $costArr) {\n        if ($costArr[\'function\']) {\n            $arrFunc = explode("|", $costArr[\'function\']);\n            $prePostAction = array_shift($arrFunc);  // BI\n\n            if ($action == "nuovo" && $prePostAction == \'BI\') {\n                $funcName = array_shift($arrFunc);  // uuid\n                $funcObj[$funcName . "__" . $codCost] = [\n                    "key" => $codCost,\n                    "args" => $arrFunc  // [microtime]\n                ];\n            }\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"available-functions",children:"Available Functions"}),"\n",(0,r.jsx)(n.h3,{id:"1-uuid---generate-uuid",children:"1. uuid - Generate UUID"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Create globally unique identifier using UUID v5."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|uuid|microtime'\nFUNCTION = 'BI|uuid|pad,XPRD02,10,0,LEFT|microtime'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:'// Example 1: Simple microtime UUID\n$uuid = date("YmdHis") . str_replace(".", "", microtime(true));\n$result = UUID::v5(\'00000000-0000-0000-0000-000000000000\', $uuid);\n// Result: "A7F3C2B1-5D4E-5678-9ABC-DEF012345678"\n\n// Example 2: UUID with padded field\n$uuid = str_pad($param[\'XPRD02\'], 10, \'0\', STR_PAD_LEFT) . "-" .\n        date("YmdHis") . str_replace(".", "", microtime(true));\n$result = UUID::v5(\'00000000-0000-0000-0000-000000000000\', $uuid);\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"microtime"}),": Append current date + microsecond timestamp"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pad,FIELD,LENGTH,CHAR,DIRECTION"}),": Pad field value before UUID generation"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Globally unique product IDs"}),"\n",(0,r.jsx)(n.li,{children:"Session identifiers"}),"\n",(0,r.jsx)(n.li,{children:"Transaction IDs"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Reference:"})," ",(0,r.jsx)(n.code,{children:"DataStore.php:1474-1502"})]}),"\n",(0,r.jsx)(n.h3,{id:"2-md5---hash-field-value",children:"2. md5 - Hash Field Value"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Generate MD5 hash of field value (e.g., passwords)."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|md5'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$param['XUSER_PASSWORD'] = md5($param['XUSER_PASSWORD']);\n// \"secret\" -> \"5ebe2294ecd0e0f08eab7690d2a6ee69\"\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Password hashing (legacy systems - prefer bcrypt for new systems)"}),"\n",(0,r.jsx)(n.li,{children:"Checksum generation"}),"\n",(0,r.jsx)(n.li,{children:"Simple data fingerprints"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Reference:"})," ",(0,r.jsx)(n.code,{children:"DataStore.php:1519-1521"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Security Warning:"})," MD5 is ",(0,r.jsx)(n.strong,{children:"not cryptographically secure"})," for passwords. Use for checksums only."]}),"\n",(0,r.jsx)(n.h3,{id:"3-sequence---auto-increment-field",children:"3. sequence - Auto-Increment Field"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Generate sequential numbers within a partition (e.g., line item sequence per order)."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|sequence|#XORDITEM01#'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Get max sequence for partition\nSELECT MAX(XORDITEM04) + 1 as NEXT_SEQ\nFROM TB_ANAG_ORDITEM00\nWHERE XORDITEM01 = '555';  // Partition key\n\n// If no records: NEXT_SEQ = 1\n// If max = 5: NEXT_SEQ = 6\n$param['XORDITEM04'] = $nextSeq;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"#FIELD#"}),": Partition field wrapped in ",(0,r.jsx)(n.code,{children:"#"})," (e.g., ",(0,r.jsx)(n.code,{children:"#XORDITEM01#"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Line item numbering (1, 2, 3, ... per order)"}),"\n",(0,r.jsx)(n.li,{children:"Step sequence in workflows"}),"\n",(0,r.jsx)(n.li,{children:"Position in lists"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Reference:"})," ",(0,r.jsx)(n.code,{children:"DataStore.php:1542-1574"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example:"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"TB_COST Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Order item sequence field\nINSERT INTO TB_COST (DIM_COD, COD_COST, FUNCTION, ...)\nVALUES ('ORDITEM', 'XORDITEM04', 'BI|sequence|#XORDITEM01#', ...);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create Order Item Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/ORDITEM\n{\n  "XORDITEM01": "555",\n  "XORDITEM01": "Widget A",\n  "source": "orderItemCreate"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"CoreWrite Automatically:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Check existing items for order 555\nSELECT MAX(XORDITEM04) FROM TB_ANAG_ORDITEM00 WHERE XORDITEM01 = '555';\n-- Returns 2 (items 1 and 2 exist)\n\n-- Insert with sequence = 3\nINSERT INTO TB_ANAG_ORDITEM00 (XORDITEM01, XORDITEM01, XORDITEM04, ...)\nVALUES ('555', 'Widget A', 3, ...);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-slugify---create-url-friendly-slug",children:"4. slugify - Create URL-Friendly Slug"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Convert text to URL-safe slug (lowercase, hyphens, no special chars)."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|slugify|XPRD01'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$text = $param['XPRD01'];  // \"Premium Widget\u2122 2025\"\n$slug = $this->slugify($text);\n// Result: \"premium-widget-2025\"\n\n$param['XPRD11'] = $slug;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Slugify Algorithm:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"function slugify($text, $divider = '-') {\n    // Replace non-alphanumeric with divider\n    $text = preg_replace('~[^\\pL\\d]+~u', $divider, $text);\n\n    // Transliterate to ASCII\n    $text = iconv('utf-8', 'us-ascii//TRANSLIT', $text);\n\n    // Remove unwanted characters\n    $text = preg_replace('~[^-\\w]+~', '', $text);\n\n    // Trim and lowercase\n    $text = trim($text, $divider);\n    $text = strtolower($text);\n\n    // Remove duplicate dividers\n    $text = preg_replace('~-+~', $divider, $text);\n\n    return $text;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FIELD"}),": Source field to slugify"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["SEO-friendly URLs (",(0,r.jsx)(n.code,{children:"/products/premium-widget-2025"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Unique identifiers from names"}),"\n",(0,r.jsx)(n.li,{children:"File names from titles"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Reference:"})," ",(0,r.jsx)(n.code,{children:"DataStore.php:1576-1608"})]}),"\n",(0,r.jsx)(n.h3,{id:"5-current_user---set-current-user-id",children:"5. current_user - Set Current User ID"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Auto-populate field with authenticated user ID from session."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|current_user'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:'$param[\'XPRD23\'] = $this->session->get("login_id", null, "grant_session");\n// Result: "user_5"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Created by tracking (alternative to OWNER)"}),"\n",(0,r.jsx)(n.li,{children:"Modified by tracking"}),"\n",(0,r.jsx)(n.li,{children:"Ownership assignment"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Reference:"})," ",(0,r.jsx)(n.code,{children:"DataStore.php:1581-1583"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Security:"})," Cannot be overridden by client - always uses session user ID."]}),"\n",(0,r.jsx)(n.h3,{id:"6-concat---concatenate-fields",children:"6. concat - Concatenate Fields"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Combine multiple field values into single string."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|concat|XPRD01|XPRD02'\nFUNCTION = 'BI|concat|pad,XPRD02,10,0,LEFT|XPRD01'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Example 1: Simple concatenation\n$concat = $param['XPRD01'] . $param['XPRD02'];\n// \"Widget\" + \"Premium\" -> \"WidgetPremium\"\n\n// Example 2: With padding\n$concat = str_pad($param['XPRD02'], 10, '0', STR_PAD_LEFT) . $param['XPRD01'];\n// 123 + \"Widget\" -> \"0000000123Widget\"\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"FIELD1|FIELD2|..."}),": Fields to concatenate"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"pad,FIELD,LENGTH,CHAR,DIRECTION"}),": Pad specific field"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Composite keys"}),"\n",(0,r.jsx)(n.li,{children:"Display names (first + last name)"}),"\n",(0,r.jsx)(n.li,{children:"Code generation"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Reference:"})," ",(0,r.jsx)(n.code,{children:"DataStore.php:1523-1540"})]}),"\n",(0,r.jsx)(n.h3,{id:"7-replace---copy-field-value",children:"7. replace - Copy Field Value"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Copy value from one field to another."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|replace|SOURCE_FIELD'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$param['XPRD29'] = $param['XPRD01'];\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Field duplication"}),"\n",(0,r.jsx)(n.li,{children:"Default value from another field"}),"\n",(0,r.jsx)(n.li,{children:"Backup original values"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Reference:"})," ",(0,r.jsx)(n.code,{children:"DataStore.php:1468-1472"})]}),"\n",(0,r.jsx)(n.h3,{id:"8-ifnull---default-value-if-empty",children:"8. ifnull - Default Value If Empty"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Set field value only if not already provided."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|ifnull|DefaultValue'\nFUNCTION = 'BI|ifnull|#XPRD01#'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// If field not set or empty\nif (!isset($param['XPRD13']) || $param['XPRD13'] == \"\") {\n    // Use static value\n    $param['XPRD13'] = 'ACTIVE';\n\n    // OR use value from another field (wrapped in #)\n    $param['XPRD05'] = $param['XPRD01'];\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Arguments:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Static value: ",(0,r.jsx)(n.code,{children:"'DefaultValue'"})]}),"\n",(0,r.jsxs)(n.li,{children:["Dynamic value: ",(0,r.jsx)(n.code,{children:"'#FIELD#'"})," (wrapped in ",(0,r.jsx)(n.code,{children:"#"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use Cases:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Default status values"}),"\n",(0,r.jsx)(n.li,{children:"Fallback to other fields"}),"\n",(0,r.jsx)(n.li,{children:"Required field auto-population"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Reference:"})," ",(0,r.jsx)(n.code,{children:"DataStore.php:1504-1517"})]}),"\n",(0,r.jsx)(n.h2,{id:"execution-flow",children:"Execution Flow"}),"\n",(0,r.jsx)(n.h3,{id:"create-request-lifecycle",children:"CREATE Request Lifecycle"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Client Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/PRD\n{\n  "XPRD01": "Premium Widget",\n  "XPRD02": 49.99,\n  "source": "productCreate"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. CoreWrite Loads Metadata:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Load TB_COST metadata for PRD dimension\n$fields = [\n    'XPRD01' => ['TIPO_CAMPO' => 'varchar(255)', 'FUNCTION' => null],\n    'XPRD02' => ['TIPO_CAMPO' => 'decimal(10,2)', 'FUNCTION' => null],\n    'XPRD10' => ['TIPO_CAMPO' => 'varchar(36)', 'FUNCTION' => 'BI|uuid|microtime'],\n    'XPRD11' => ['TIPO_CAMPO' => 'varchar(255)', 'FUNCTION' => 'BI|slugify|XPRD01'],\n    'XPRD23' => ['TIPO_CAMPO' => 'varchar(50)', 'FUNCTION' => 'BI|current_user']\n];\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Extract Pre-Insert Functions:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$functions = getFunction($fields, 'nuovo');\n// Result:\n[\n    'uuid__XPRD10' => ['key' => 'XPRD10', 'args' => ['microtime']],\n    'slugify__XPRD11' => ['key' => 'XPRD11', 'args' => ['XPRD01']],\n    'current_user__XPRD23' => ['key' => 'XPRD23', 'args' => []]\n]\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"4. Execute Functions:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"foreach ($functions as $funcName => $object) {\n    preInsert($param, $funcName, $object);\n}\n\n// After execution, $param enriched:\n$param = [\n    'XPRD01' => 'Premium Widget',\n    'XPRD02' => 49.99,\n    'XPRD10' => 'A7F3C2B1-5D4E-5678-9ABC-DEF012345678',  // Generated\n    'XPRD11' => 'premium-widget',                         // Generated\n    'XPRD23' => 'user_5',                            // Generated\n    'source' => 'productCreate'\n];\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"5. INSERT with Enriched Data:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_ANAG_PRD00 (\n  XPRD01, XPRD02, XPRD10, XPRD11, XPRD23,\n  OWNER, CDATA, LOWNER, LDATA, TREC\n) VALUES (\n  'Premium Widget', 49.99, 'A7F3C2B1-...', 'premium-widget', 'user_5',\n  'user_5', '20250119120000', 'user_5', '20250119120000', 'N'\n);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,r.jsx)(n.h3,{id:"example-1-product-with-uuid-and-slug",children:"Example 1: Product with UUID and Slug"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"TB_COST Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (DIM_COD, COD_COST, DESC_COST, TIPO_CAMPO, COD_ON_OFF, FUNCTION)\nVALUES\n  ('PRD', 'XPRD01', 'Product Name', 'varchar(255)', 'L,D,N,M,R', NULL),\n  ('PRD', 'XPRD10', 'UUID', 'varchar(36)', 'L,D', 'BI|uuid|microtime'),\n  ('PRD', 'XPRD11', 'URL Slug', 'varchar(255)', 'L,D', 'BI|slugify|XPRD01');\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Client Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/PRD\n{\n  "XPRD01": "Awesome Widget\u2122",\n  "source": "productCreate"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Result:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "PRD_ID": "123",\n  "XPRD01": "Awesome Widget\u2122",\n  "XPRD10": "B8C4D3E2-6F5A-5789-ABCD-EF1234567890",\n  "XPRD11": "awesome-widget"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"example-2-order-items-with-sequence",children:"Example 2: Order Items with Sequence"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"TB_COST Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (DIM_COD, COD_COST, FUNCTION)\nVALUES\n  ('ORDITEM', 'XORDITEM04', 'BI|sequence|#XORDITEM01#');\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create Multiple Items:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/ORDITEM\n{\n  "XORDITEM01": "555",\n  "XORDITEM01": "Widget A"\n}\n\nPOST /api/v4/core/ORDITEM\n{\n  "XORDITEM01": "555",\n  "XORDITEM01": "Widget B"\n}\n\nPOST /api/v4/core/ORDITEM\n{\n  "XORDITEM01": "555",\n  "XORDITEM01": "Widget C"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Result:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'[\n  {"ORDITEM_ID": "1", "XORDITEM04": 1, "XORDITEM01": "Widget A"},\n  {"ORDITEM_ID": "2", "XORDITEM04": 2, "XORDITEM01": "Widget B"},\n  {"ORDITEM_ID": "3", "XORDITEM04": 3, "XORDITEM01": "Widget C"}\n]\n'})}),"\n",(0,r.jsx)(n.h3,{id:"example-3-user-with-hashed-password",children:"Example 3: User with Hashed Password"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"TB_COST Configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"INSERT INTO TB_COST (DIM_COD, COD_COST, FUNCTION)\nVALUES\n  ('USER', 'XUSER_PASSWORD', 'BI|md5');\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Client Request:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/USER\n{\n  "XUSER_EMAIL": "john@example.com",\n  "XUSER_PASSWORD": "secret123",\n  "source": "userCreate"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Result (stored in database):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "XUSER_ID": "5",\n  "XUSER_EMAIL": "john@example.com",\n  "XUSER_PASSWORD": "f2d3c4e5a6b7c8d9e0f1a2b3c4d5e6f7"  // MD5 hash\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"-do-use-pre-insert-functions-for-derived-values",children:"\u2705 DO: Use Pre-Insert Functions for Derived Values"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Prefer metadata configuration:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|slugify|XPRD01'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Over client-side logic:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// Avoid this\nconst slug = slugify(productName);\nfetch('/api/v4/core/PRD', { body: { XPRD01: productName, XPRD11: slug } });\n"})}),"\n",(0,r.jsx)(n.h3,{id:"-do-use-uuid-for-global-identifiers",children:"\u2705 DO: Use uuid for Global Identifiers"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"For distributed systems:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|uuid|microtime'\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Benefit:"})," No collision risk across tenants/microservices."]}),"\n",(0,r.jsx)(n.h3,{id:"-do-use-sequence-for-partition-scoped-sequences",children:"\u2705 DO: Use sequence for Partition-Scoped Sequences"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"For line items, steps, positions:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|sequence|#PARENT_ID_FIELD#'\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Benefit:"})," Consistent numbering per partition (order, workflow, etc.)."]}),"\n",(0,r.jsx)(n.h3,{id:"-do-use-current_user-for-audit-fields",children:"\u2705 DO: Use current_user for Audit Fields"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Track creator without client input:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|current_user'\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Benefit:"})," Tamper-proof user tracking."]}),"\n",(0,r.jsx)(n.h3,{id:"-dont-use-md5-for-password-hashing-new-systems",children:"\u274c DON'T: Use md5 for Password Hashing (New Systems)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Wrong (insecure):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|md5'\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Right (use bcrypt or Argon2):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$hashedPassword = password_hash($password, PASSWORD_BCRYPT);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why:"})," MD5 is cryptographically broken. Use for checksums only."]}),"\n",(0,r.jsx)(n.h3,{id:"-dont-manually-override-pre-insert-fields",children:"\u274c DON'T: Manually Override Pre-Insert Fields"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Wrong:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/PRD\n{\n  "XPRD01": "Widget",\n  "XPRD10": "CUSTOM-UUID",  // Manual override\n  "source": "productCreate"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why:"})," Pre-insert function will overwrite manual value."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Workaround (if needed):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'POST /api/v4/core/PRD\n{\n  "XPRD01": "Widget",\n  "skip_preinsert": {\n    "XPRD10": true  // Skip UUID generation for this field\n  },\n  "XPRD10": "CUSTOM-UUID",\n  "source": "productCreate"\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Code Reference:"})," ",(0,r.jsx)(n.code,{children:"DataStore.php:1498-1500"})]}),"\n",(0,r.jsx)(n.h3,{id:"-dont-combine-incompatible-functions",children:"\u274c DON'T: Combine Incompatible Functions"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Wrong:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- md5 and slugify on same field\nFUNCTION = 'BI|md5|BI|slugify|XPRD01'\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Why:"})," Only one function per field. Use separate fields for different transformations."]}),"\n",(0,r.jsx)(n.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,r.jsx)(n.h3,{id:"pitfall-1-expecting-client-provided-uuid-to-persist",children:"Pitfall 1: Expecting Client-Provided UUID to Persist"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem:"})," Client sends UUID, but pre-insert function overwrites it."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution:"})," Either:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Remove pre-insert function from TB_COST"}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"skip_preinsert"})," parameter"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"pitfall-2-using-sequence-without-partition",children:"Pitfall 2: Using sequence Without Partition"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Problem:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|sequence'  -- Missing partition field\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Result:"})," Sequences collide across all records."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution:"})," Always specify partition:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|sequence|#PARENT_ID#'\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pitfall-3-slugifying-mutable-fields",children:"Pitfall 3: Slugifying Mutable Fields"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem:"})," Slug changes when source field updates."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution:"})," Only slugify on INSERT (BI), not UPDATE (BE):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"FUNCTION = 'BI|slugify|XPRD01'  -- Only on create\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Alternative:"})," Use immutable field as slug source."]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pre-Insert Functions"})," provide:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Automatic field population"})," - UUIDs, slugs, sequences, hashes"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Metadata-driven"})," - Configure in TB_COST, no code changes"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Consistent logic"})," - Same transformations across all clients"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Security"})," - Server-side user ID population prevents tampering"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Minimal client code"})," - Clients send essential data only"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Insight:"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Pre-insert functions are the ",(0,r.jsx)(n.strong,{children:"data enrichment layer"})," - transforming minimal client input into complete, consistent database records. Define once in metadata, benefit everywhere."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Next Concept:"})}),"\n",(0,r.jsxs)(n.p,{children:["Continue to ",(0,r.jsx)(n.a,{href:"/docs/products/map.q01.io/core-api-platform-v4/core-concepts/counter-management",children:"Counter Management"})," to understand sequential identifier generation for business-friendly IDs."]})]})}function u(e={}){const{wrapper:n}={...(0,i.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},2172:(e,n,s)=>{s.d(n,{I:()=>t,M:()=>c});var r=s(1504);const i={},l=r.createContext(i);function c(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);